(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[415],{3901:function(eo,ec,ed){var em=ed(2601);eo.exports=function(){"use strict";var eo,ec,ed;function define(em,e_){if(eo){if(ec){var eg="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+eo+")(sharedChunk); ("+ec+")(sharedChunk); self.onerror = null;",ex={};eo(ex),ed=e_(ex),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(ed.workerUrl=window.URL.createObjectURL(new Blob([eg],{type:"text/javascript"})))}else ec=e_}else eo=e_}return define(["exports"],function(eo){let ec,ed,e_,eg,ex,ev,eb,ew,eT;var eE,eM="undefined"!=typeof self?self:{},eS="2.15.0";let eA={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==ec){let eo=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{ec=null!=em.env.API_URL_REGEX?new RegExp(em.env.API_URL_REGEX):eo}catch(ed){ec=eo}}return ec},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!eA.API_URL)return null;try{let eo=new URL(eA.API_URL);return"api.mapbox.cn"===eo.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===eo.hostname?"https://events.mapbox.com/events/v2":null}catch(eo){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},eI={supported:!1,testSupport:function(eo){!ez&&eP&&(eD?c(eo):eC=eo)}},eC,eP,ez=!1,eD=!1;function c(eo){let ec=eo.createTexture();eo.bindTexture(eo.TEXTURE_2D,ec);try{if(eo.texImage2D(eo.TEXTURE_2D,0,eo.RGBA,eo.RGBA,eo.UNSIGNED_BYTE,eP),eo.isContextLost())return;eI.supported=!0}catch(eo){}eo.deleteTexture(ec),ez=!0}function p(eo){return eo&&eo.__esModule&&Object.prototype.hasOwnProperty.call(eo,"default")?eo.default:eo}function f(eo,ec,ed,em){this.cx=3*eo,this.bx=3*(ed-eo)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*ec,this.by=3*(em-ec)-this.cy,this.ay=1-this.cy-this.by,this.p1x=eo,this.p1y=ec,this.p2x=ed,this.p2y=em}eM.document&&((eP=eM.document.createElement("img")).onload=function(){eC&&c(eC),eC=null,eD=!0},eP.onerror=function(){ez=!0,eC=null},eP.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),f.prototype={sampleCurveX:function(eo){return((this.ax*eo+this.bx)*eo+this.cx)*eo},sampleCurveY:function(eo){return((this.ay*eo+this.by)*eo+this.cy)*eo},sampleCurveDerivativeX:function(eo){return(3*this.ax*eo+2*this.bx)*eo+this.cx},solveCurveX:function(eo,ec){if(void 0===ec&&(ec=1e-6),eo<0)return 0;if(eo>1)return 1;for(var ed=eo,em=0;em<8;em++){var e_=this.sampleCurveX(ed)-eo;if(Math.abs(e_)<ec)return ed;var eg=this.sampleCurveDerivativeX(ed);if(1e-6>Math.abs(eg))break;ed-=e_/eg}var ex=0,ev=1;for(ed=eo,em=0;em<20&&!(Math.abs((e_=this.sampleCurveX(ed))-eo)<ec);em++)eo>e_?ex=ed:ev=ed,ed=.5*(ev-ex)+ex;return ed},solve:function(eo,ec){return this.sampleCurveY(this.solveCurveX(eo,ec))}};var ek=p(f);function g(eo,ec){this.x=eo,this.y=ec}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(eo){return this.clone()._add(eo)},sub:function(eo){return this.clone()._sub(eo)},multByPoint:function(eo){return this.clone()._multByPoint(eo)},divByPoint:function(eo){return this.clone()._divByPoint(eo)},mult:function(eo){return this.clone()._mult(eo)},div:function(eo){return this.clone()._div(eo)},rotate:function(eo){return this.clone()._rotate(eo)},rotateAround:function(eo,ec){return this.clone()._rotateAround(eo,ec)},matMult:function(eo){return this.clone()._matMult(eo)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(eo){return this.x===eo.x&&this.y===eo.y},dist:function(eo){return Math.sqrt(this.distSqr(eo))},distSqr:function(eo){var ec=eo.x-this.x,ed=eo.y-this.y;return ec*ec+ed*ed},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(eo){return Math.atan2(this.y-eo.y,this.x-eo.x)},angleWith:function(eo){return this.angleWithSep(eo.x,eo.y)},angleWithSep:function(eo,ec){return Math.atan2(this.x*ec-this.y*eo,this.x*eo+this.y*ec)},_matMult:function(eo){var ec=eo[2]*this.x+eo[3]*this.y;return this.x=eo[0]*this.x+eo[1]*this.y,this.y=ec,this},_add:function(eo){return this.x+=eo.x,this.y+=eo.y,this},_sub:function(eo){return this.x-=eo.x,this.y-=eo.y,this},_mult:function(eo){return this.x*=eo,this.y*=eo,this},_div:function(eo){return this.x/=eo,this.y/=eo,this},_multByPoint:function(eo){return this.x*=eo.x,this.y*=eo.y,this},_divByPoint:function(eo){return this.x/=eo.x,this.y/=eo.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var eo=this.y;return this.y=this.x,this.x=-eo,this},_rotate:function(eo){var ec=Math.cos(eo),ed=Math.sin(eo),em=ed*this.x+ec*this.y;return this.x=ec*this.x-ed*this.y,this.y=em,this},_rotateAround:function(eo,ec){var ed=Math.cos(eo),em=Math.sin(eo),e_=ec.y+em*(this.x-ec.x)+ed*(this.y-ec.y);return this.x=ec.x+ed*(this.x-ec.x)-em*(this.y-ec.y),this.y=e_,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(eo){return eo instanceof g?eo:Array.isArray(eo)?new g(eo[0],eo[1]):eo};var eL=p(g);let eR=Math.PI/180,eB=180/Math.PI,eF=[[0,0],[1,0],[1,1],[0,1]];function S(eo){if(eo<=0)return 0;if(eo>=1)return 1;let ec=eo*eo,ed=ec*eo;return 4*(eo<.5?ed:3*(eo-ec)+ed-.75)}function k(eo,ec,ed,em){let e_=new ek(eo,ec,ed,em);return function(eo){return e_.solve(eo)}}let eO=k(.25,.1,.25,1);function M(eo,ec,ed){return Math.min(ed,Math.max(ec,eo))}function T(eo,ec,ed){return(ed=M((ed-eo)/(ec-eo),0,1))*ed*(3-2*ed)}function z(eo,ec,ed){let em=ed-ec,e_=((eo-ec)%em+em)%em+ec;return e_===ec?ed:e_}function B(eo,ec,ed){if(!eo.length)return ed(null,[]);let em=eo.length,e_=Array(eo.length),eg=null;eo.forEach((eo,ex)=>{ec(eo,(eo,ec)=>{eo&&(eg=eo),e_[ex]=ec,0==--em&&ed(eg,e_)})})}function E(eo){let ec=[];for(let ed in eo)ec.push(eo[ed]);return ec}function C(eo,...ec){for(let ed of ec)for(let ec in ed)eo[ec]=ed[ec];return eo}let eU=1;function D(){return eU++}function V(){return function t(eo){return eo?(eo^Math.random()*(16>>eo/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function L(eo){return eo<=1?1:Math.pow(2,Math.ceil(Math.log(eo)/Math.LN2))}function F(eo){return!!eo&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(eo)}function R(eo,ec){eo.forEach(eo=>{ec[eo]&&(ec[eo]=ec[eo].bind(ec))})}function U(eo,ec){return -1!==eo.indexOf(ec,eo.length-ec.length)}function $(eo,ec,ed){let em={};for(let e_ in eo)em[e_]=ec.call(ed||this,eo[e_],e_,eo);return em}function j(eo,ec,ed){let em={};for(let e_ in eo)ec.call(ed||this,eo[e_],e_,eo)&&(em[e_]=eo[e_]);return em}function O(eo){return Array.isArray(eo)?eo.map(O):"object"==typeof eo&&eo?$(eo,O):eo}let eN={};function N(eo){eN[eo]||("undefined"!=typeof console&&console.warn(eo),eN[eo]=!0)}function G(eo,ec,ed){return(ed.y-eo.y)*(ec.x-eo.x)>(ec.y-eo.y)*(ed.x-eo.x)}function K(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function X(eo){let ec={};if(eo.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(eo,ed,em,e_)=>{let eg=em||e_;return ec[ed]=!eg||eg.toLowerCase(),""}),ec["max-age"]){let eo=parseInt(ec["max-age"],10);isNaN(eo)?delete ec["max-age"]:ec["max-age"]=eo}return ec}let eV=null;function H(eo){if(null==eV){let ec=eo.navigator?eo.navigator.userAgent:null;eV=!!eo.safari||!(!ec||!(/\b(iPad|iPhone|iPod)\b/.test(ec)||ec.match("Safari")&&!ec.match("Chrome")))}return eV}function Y(eo){try{let ec=eM[eo];return ec.setItem("_mapbox_test_",1),ec.removeItem("_mapbox_test_"),!0}catch(eo){return!1}}function W(eo,ec){return[eo[4*ec],eo[4*ec+1],eo[4*ec+2],eo[4*ec+3]]}let ej="mapbox-tiles",eG=500,eZ=50;function it(){try{return eM.caches}catch(eo){}}function st(){it()&&!ed&&(ed=eM.caches.open(ej))}function at(eo){let ec=eo.indexOf("?");if(ec<0)return eo;let ed=function(eo){let ec=eo.indexOf("?");return ec>0?eo.slice(ec+1).split("&"):[]}(eo),em=ed.filter(eo=>{let ec=eo.split("=");return"language"===ec[0]||"worldview"===ec[0]});return em.length?`${eo.slice(0,ec)}?${em.join("&")}`:eo.slice(0,ec)}let e$=1/0,eq={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(eq);let ut=class ut extends Error{constructor(eo,ec,ed){401===ec&&bt(ed)&&(eo+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(eo),this.status=ec,this.url=ed}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}};let eX=K()?()=>self.worker&&self.worker.referrer:()=>("blob:"===eM.location.protocol?eM.parent:eM).location.href,ht=function(eo,ec){var em;if(!(/^file:/.test(em=eo.url)||/^file:/.test(eX())&&!/^\w+:/.test(em))){if(eM.fetch&&eM.Request&&eM.AbortController&&eM.Request.prototype.hasOwnProperty("signal"))return function(eo,ec){var em;let eg=new eM.AbortController,ex=new eM.Request(eo.url,{method:eo.method||"GET",body:eo.body,credentials:eo.credentials,headers:eo.headers,referrer:eX(),referrerPolicy:eo.referrerPolicy,signal:eg.signal}),ev=!1,eb=!1,ew=(em=ex.url).indexOf("sku=")>0&&bt(em);"json"===eo.type&&ex.headers.set("Accept","application/json");let u=(ed,em,e_)=>{if(eb)return;if(ed&&"SecurityError"!==ed.message&&N(ed.toString()),em&&e_)return c(em);let eg=Date.now();eM.fetch(ex).then(ed=>{if(ed.ok){let eo=ew?ed.clone():null;return c(ed,eo,eg)}return ec(new ut(ed.statusText,ed.status,eo.url))}).catch(ed=>{"AbortError"!==ed.name&&ec(Error(`${ed.message} ${eo.url}`))})},c=(em,eg,ew)=>{("arrayBuffer"===eo.type?em.arrayBuffer():"json"===eo.type?em.json():em.text()).then(eo=>{eb||(eg&&ew&&function(eo,ec,em){if(st(),!ed)return;let eg={status:ec.status,statusText:ec.statusText,headers:new eM.Headers};ec.headers.forEach((eo,ec)=>eg.headers.set(ec,eo));let ex=X(ec.headers.get("Cache-Control")||"");if(ex["no-store"])return;ex["max-age"]&&eg.headers.set("Expires",new Date(em+1e3*ex["max-age"]).toUTCString());let ev=eg.headers.get("Expires");ev&&(new Date(ev).getTime()-em<42e4||function(eo,ec){if(void 0===e_)try{new Response(new ReadableStream),e_=!0}catch(eo){e_=!1}e_?ec(eo.body):eo.blob().then(ec)}(ec,ec=>{let em=new eM.Response(ec,eg);st(),ed&&ed.then(ec=>ec.put(at(eo.url),em)).catch(eo=>N(eo.message))}))}(ex,eg,ew),ev=!0,ec(null,eo,em.headers.get("Cache-Control"),em.headers.get("Expires")))}).catch(eo=>{eb||ec(Error(eo.message))})};return ew?function(eo,ec){if(st(),!ed)return ec(null);let em=at(eo.url);ed.then(eo=>{eo.match(em).then(ed=>{let e_=function(eo){if(!eo)return!1;let ec=new Date(eo.headers.get("Expires")||0),ed=X(eo.headers.get("Cache-Control")||"");return ec>Date.now()&&!ed["no-cache"]}(ed);eo.delete(em),e_&&eo.put(em,ed.clone()),ec(null,ed,e_)}).catch(ec)}).catch(ec)}(ex,u):u(null,null),{cancel:()=>{eb=!0,ev||eg.abort()}}}(eo,ec);if(K()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",eo,ec,void 0,!0)}return function(eo,ec){let ed=new eM.XMLHttpRequest;for(let ec in ed.open(eo.method||"GET",eo.url,!0),"arrayBuffer"===eo.type&&(ed.responseType="arraybuffer"),eo.headers)ed.setRequestHeader(ec,eo.headers[ec]);return"json"===eo.type&&(ed.responseType="text",ed.setRequestHeader("Accept","application/json")),ed.withCredentials="include"===eo.credentials,ed.onerror=()=>{ec(Error(ed.statusText))},ed.onload=()=>{if((ed.status>=200&&ed.status<300||0===ed.status)&&null!==ed.response){let em=ed.response;if("json"===eo.type)try{em=JSON.parse(ed.response)}catch(eo){return ec(eo)}ec(null,em,ed.getResponseHeader("Cache-Control"),ed.getResponseHeader("Expires"))}else ec(new ut(ed.statusText,ed.status,eo.url))},ed.send(eo.body),{cancel:()=>ed.abort()}}(eo,ec)},pt=function(eo,ec){return ht(C(eo,{type:"arrayBuffer"}),ec)},eW="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";eg=[],ex=0;let gt=function(eo,ec){if(eI.supported&&(eo.headers||(eo.headers={}),eo.headers.accept="image/webp,*/*"),ex>=eA.MAX_PARALLEL_IMAGE_REQUESTS){let ed={requestParameters:eo,callback:ec,cancelled:!1,cancel(){this.cancelled=!0}};return eg.push(ed),ed}ex++;let ed=!1,a=()=>{if(!ed)for(ed=!0,ex--;eg.length&&ex<eA.MAX_PARALLEL_IMAGE_REQUESTS;){let eo=eg.shift(),{requestParameters:ec,callback:ed,cancelled:em}=eo;em||(eo.cancel=gt(ec,ed).cancel)}},em=pt(eo,(eo,ed,em,e_)=>{a(),eo?ec(eo):ed&&(eM.createImageBitmap?function(eo,ec){let ed=new eM.Blob([new Uint8Array(eo)],{type:"image/png"});eM.createImageBitmap(ed).then(eo=>{ec(null,eo)}).catch(eo=>{ec(Error(`Could not load image because of ${eo.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(ed,(eo,ed)=>ec(eo,ed,em,e_)):function(eo,ec){let ed=new eM.Image,em=eM.URL;ed.onload=()=>{ec(null,ed),em.revokeObjectURL(ed.src),ed.onload=null,eM.requestAnimationFrame(()=>{ed.src=eW})},ed.onerror=()=>ec(Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let e_=new eM.Blob([new Uint8Array(eo)],{type:"image/png"});ed.src=eo.byteLength?em.createObjectURL(e_):eW}(ed,(eo,ed)=>ec(eo,ed,em,e_)))});return{cancel:()=>{em.cancel(),a()}}},eH="NO_ACCESS_TOKEN";function vt(eo){return 0===eo.indexOf("mapbox:")}function bt(eo){return eA.API_URL_REGEX.test(eo)}function wt(eo){return eA.API_CDN_URL_REGEX.test(eo)}function _t(eo){return eA.API_STYLE_REGEX.test(eo)&&!At(eo)}function At(eo){return eA.API_SPRITE_REGEX.test(eo)}let eJ=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function kt(eo){let ec=eo.match(eJ);if(!ec)throw Error("Unable to parse URL object");return{protocol:ec[1],authority:ec[2],path:ec[3]||"/",params:ec[4]?ec[4].split("&"):[]}}function It(eo){let ec=eo.params.length?`?${eo.params.join("&")}`:"";return`${eo.protocol}://${eo.authority}${eo.path}${ec}`}let eY="mapbox.eventData";function Tt(eo){if(!eo)return null;let ec=eo.split(".");if(!ec||3!==ec.length)return null;try{return JSON.parse(decodeURIComponent(eM.atob(ec[1]).split("").map(eo=>"%"+("00"+eo.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(eo){return null}}let zt=class zt{constructor(eo){this.type=eo,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(eo){let ec=Tt(eA.ACCESS_TOKEN),ed="";return ed=ec&&ec.u?eM.btoa(encodeURIComponent(ec.u).replace(/%([0-9A-F]{2})/g,(eo,ec)=>String.fromCharCode(Number("0x"+ec)))):eA.ACCESS_TOKEN||"",eo?`${eY}.${eo}:${ed}`:`${eY}:${ed}`}fetchEventData(){let eo=Y("localStorage"),ec=this.getStorageKey(),ed=this.getStorageKey("uuid");if(eo)try{let eo=eM.localStorage.getItem(ec);eo&&(this.eventData=JSON.parse(eo));let em=eM.localStorage.getItem(ed);em&&(this.anonId=em)}catch(eo){N("Unable to read from LocalStorage")}}saveEventData(){let eo=Y("localStorage"),ec=this.getStorageKey(),ed=this.getStorageKey("uuid");if(eo)try{eM.localStorage.setItem(ed,this.anonId),Object.keys(this.eventData).length>=1&&eM.localStorage.setItem(ec,JSON.stringify(this.eventData))}catch(eo){N("Unable to write to LocalStorage")}}processRequests(eo){}postEvent(eo,ec,ed,em){if(!eA.EVENTS_URL)return;let e_=kt(eA.EVENTS_URL);e_.params.push(`access_token=${em||eA.ACCESS_TOKEN||""}`);let eg={event:this.type,created:new Date(eo).toISOString()},ex=ec?C(eg,ec):eg,ev={url:It(e_),headers:{"Content-Type":"text/plain"},body:JSON.stringify([ex])};this.pendingRequest=ht(C(ev,{method:"POST"}),eo=>{this.pendingRequest=null,ed(eo),this.saveEventData(),this.processRequests(em)})}queueRequest(eo,ec){this.queue.push(eo),this.processRequests(ec)}};let eK=new class extends zt{constructor(eo){super("appUserTurnstile"),this._customAccessToken=eo}postTurnstileEvent(eo,ec){eA.EVENTS_URL&&eA.ACCESS_TOKEN&&Array.isArray(eo)&&eo.some(eo=>vt(eo)||bt(eo))&&this.queueRequest(Date.now(),ec)}processRequests(eo){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let ec=Tt(eA.ACCESS_TOKEN),ed=ec?ec.u:eA.ACCESS_TOKEN,em=ed!==this.eventData.tokenU;F(this.anonId)||(this.anonId=V(),em=!0);let e_=this.queue.shift();if(this.eventData.lastSuccess){let eo=new Date(this.eventData.lastSuccess),ec=new Date(e_),ed=(e_-this.eventData.lastSuccess)/864e5;em=em||ed>=1||ed<-1||eo.getDate()!==ec.getDate()}else em=!0;em?this.postEvent(e_,{sdkIdentifier:"mapbox-gl-js",sdkVersion:eS,skuId:"01","enabled.telemetry":!1,userId:this.anonId},eo=>{eo||(this.eventData.lastSuccess=e_,this.eventData.tokenU=ed)},eo):this.processRequests()}},eQ=eK.postTurnstileEvent.bind(eK),e0=new class extends zt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(eo,ec,ed,em){this.skuToken=ec,this.errorCb=em,eA.EVENTS_URL&&(ed||eA.ACCESS_TOKEN?this.queueRequest({id:eo,timestamp:Date.now()},ed):this.errorCb(Error(eH)))}processRequests(eo){if(this.pendingRequest||0===this.queue.length)return;let{id:ec,timestamp:ed}=this.queue.shift();ec&&this.success[ec]||(this.anonId||this.fetchEventData(),F(this.anonId)||(this.anonId=V()),this.postEvent(ed,{sdkIdentifier:"mapbox-gl-js",sdkVersion:eS,skuId:"01",skuToken:this.skuToken,userId:this.anonId},eo=>{eo?this.errorCb(eo):ec&&(this.success[ec]=!0)},eo))}},e1=e0.postMapLoadEvent.bind(e0),e2=new class extends zt{constructor(){super("gljs.performance")}postPerformanceEvent(eo,ec){eA.EVENTS_URL&&(eo||eA.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:ec},eo)}processRequests(eo){if(this.pendingRequest||0===this.queue.length)return;let{timestamp:ec,performanceData:ed}=this.queue.shift(),em=function(eo){let ec=eM.performance.getEntriesByType("resource"),ed=eM.performance.getEntriesByType("mark"),em=function(eo){let ec={};if(eo){for(let ed in eo)if("other"!==ed)for(let em of eo[ed]){let eo=`${ed}ResolveRangeMin`,e_=`${ed}ResolveRangeMax`,eg=`${ed}RequestCount`,ex=`${ed}RequestCachedCount`;ec[eo]=Math.min(ec[eo]||1/0,em.startTime),ec[e_]=Math.max(ec[e_]||-1/0,em.responseEnd);let o=eo=>{void 0===ec[eo]&&(ec[eo]=0),++ec[eo]};void 0!==em.transferSize&&0===em.transferSize&&o(ex),o(eg)}}return ec}(function(eo,ec){let ed={};if(eo)for(let em of eo){let eo=ec(em);void 0===ed[eo]&&(ed[eo]=[]),ed[eo].push(em)}return ed}(ec,jt)),e_=eM.devicePixelRatio,eg=eM.navigator.connection||eM.navigator.mozConnection||eM.navigator.webkitConnection,ex={counters:[],metadata:[],attributes:[]},u=(eo,ec,ed)=>{null!=ed&&eo.push({name:ec,value:ed.toString()})};for(let eo in em)u(ex.counters,eo,em[eo]);if(eo.interactionRange[0]!==1/0&&eo.interactionRange[1]!==-1/0&&(u(ex.counters,"interactionRangeMin",eo.interactionRange[0]),u(ex.counters,"interactionRangeMax",eo.interactionRange[1])),ed)for(let eo of Object.keys(e8)){let ec=e8[eo],em=ed.find(eo=>eo.name===ec);em&&u(ex.counters,ec,em.startTime)}return u(ex.counters,"visibilityHidden",eo.visibilityHidden),u(ex.attributes,"style",function(eo){if(eo)for(let ec of eo){let eo=ec.name.split("?")[0];if(_t(eo)){let ec=eo.split("/").slice(-2);if(2===ec.length)return`mapbox://styles/${ec[0]}/${ec[1]}`}}}(ec)),u(ex.attributes,"terrainEnabled",eo.terrainEnabled?"true":"false"),u(ex.attributes,"fogEnabled",eo.fogEnabled?"true":"false"),u(ex.attributes,"projection",eo.projection),u(ex.attributes,"zoom",eo.zoom),u(ex.metadata,"devicePixelRatio",e_),u(ex.metadata,"connectionEffectiveType",eg?eg.effectiveType:void 0),u(ex.metadata,"navigatorUserAgent",eM.navigator.userAgent),u(ex.metadata,"screenWidth",eM.screen.width),u(ex.metadata,"screenHeight",eM.screen.height),u(ex.metadata,"windowWidth",eM.innerWidth),u(ex.metadata,"windowHeight",eM.innerHeight),u(ex.metadata,"mapWidth",eo.width/e_),u(ex.metadata,"mapHeight",eo.height/e_),u(ex.metadata,"webglRenderer",eo.renderer),u(ex.metadata,"webglVendor",eo.vendor),u(ex.metadata,"sdkVersion",eS),u(ex.metadata,"sdkIdentifier","mapbox-gl-js"),ex}(ed);for(let eo of em.metadata);for(let eo of em.counters);for(let eo of em.attributes);this.postEvent(ec,em,()=>{},eo)}},e3=e2.postPerformanceEvent.bind(e2),e5=new class extends zt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(eo,ec,ed,em){if(!eA.API_URL||!eA.SESSION_PATH)return;let e_=kt(eA.API_URL+eA.SESSION_PATH);e_.params.push(`sku=${ec||""}`),e_.params.push(`access_token=${em||eA.ACCESS_TOKEN||""}`);let eg={url:It(e_),headers:{"Content-Type":"text/plain"}};this.pendingRequest=ht(C(eg,{method:"GET"}),eo=>{this.pendingRequest=null,ed(eo),this.saveEventData(),this.processRequests(em)})}getSessionAPI(eo,ec,ed,em){this.skuToken=ec,this.errorCb=em,eA.SESSION_PATH&&eA.API_URL&&(ed||eA.ACCESS_TOKEN?this.queueRequest({id:eo,timestamp:Date.now()},ed):this.errorCb(Error(eH)))}processRequests(eo){if(this.pendingRequest||0===this.queue.length)return;let{id:ec,timestamp:ed}=this.queue.shift();ec&&this.success[ec]||this.getSession(ed,this.skuToken,eo=>{eo?this.errorCb(eo):ec&&(this.success[ec]=!0)},eo)}},e4=e5.getSessionAPI.bind(e5),e6=new Set,e8={create:"create",load:"load",fullLoad:"fullLoad"};function jt(eo){let ec=eo.name.split("?")[0];return wt(ec)&&ec.includes("mapbox-gl.js")?"javascript":wt(ec)&&ec.includes("mapbox-gl.css")?"css":eA.API_FONTS_REGEX.test(ec)?"fontRange":At(ec)?"sprite":_t(ec)?"style":eA.API_TILEJSON_REGEX.test(ec)?"tilejson":"other"}let e9=eM.performance;function qt(eo){let ec=eo?eo.url.toString():void 0;return e9.getEntriesByName(ec)}let e7={now:()=>void 0!==ew?ew:eM.performance.now(),setNow(eo){ew=eo},restoreNow(){ew=void 0},frame(eo){let ec=eM.requestAnimationFrame(eo);return{cancel:()=>eM.cancelAnimationFrame(ec)}},getImageData(eo,ec=0){let{width:ed,height:em}=eo;eT||(eT=eM.document.createElement("canvas"));let e_=eT.getContext("2d",{willReadFrequently:!0});if(!e_)throw Error("failed to create canvas 2d context");return(ed>eT.width||em>eT.height)&&(eT.width=ed,eT.height=em),e_.clearRect(-ec,-ec,ed+2*ec,em+2*ec),e_.drawImage(eo,0,0,ed,em),e_.getImageData(-ec,-ec,ed+2*ec,em+2*ec)},resolveURL:eo=>(ev||(ev=eM.document.createElement("a")),ev.href=eo,ev.href),get devicePixelRatio(){return eM.devicePixelRatio},get prefersReducedMotion(){return!!eM.matchMedia&&(null==eb&&(eb=eM.matchMedia("(prefers-reduced-motion: reduce)")),eb.matches)}};function Jt(eo,ec,ed){ed[eo]&&-1!==ed[eo].indexOf(ec)||(ed[eo]=ed[eo]||[],ed[eo].push(ec))}function Ht(eo,ec,ed){if(ed&&ed[eo]){let em=ed[eo].indexOf(ec);-1!==em&&ed[eo].splice(em,1)}}let Yt=class Yt{constructor(eo,ec={}){C(this,ec),this.type=eo}};let Wt=class Wt extends Yt{constructor(eo,ec={}){super("error",C({error:eo},ec))}};let Qt=class Qt{on(eo,ec){return this._listeners=this._listeners||{},Jt(eo,ec,this._listeners),this}off(eo,ec){return Ht(eo,ec,this._listeners),Ht(eo,ec,this._oneTimeListeners),this}once(eo,ec){return ec?(this._oneTimeListeners=this._oneTimeListeners||{},Jt(eo,ec,this._oneTimeListeners),this):new Promise(ec=>this.once(eo,ec))}fire(eo,ec){"string"==typeof eo&&(eo=new Yt(eo,ec||{}));let ed=eo.type;if(this.listens(ed)){eo.target=this;let ec=this._listeners&&this._listeners[ed]?this._listeners[ed].slice():[];for(let ed of ec)ed.call(this,eo);let em=this._oneTimeListeners&&this._oneTimeListeners[ed]?this._oneTimeListeners[ed].slice():[];for(let ec of em)Ht(ed,ec,this._oneTimeListeners),ec.call(this,eo);let e_=this._eventedParent;e_&&(C(eo,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),e_.fire(eo))}else eo instanceof Wt&&console.error(eo.error);return this}listens(eo){return!!(this._listeners&&this._listeners[eo]&&this._listeners[eo].length>0||this._oneTimeListeners&&this._oneTimeListeners[eo]&&this._oneTimeListeners[eo].length>0||this._eventedParent&&this._eventedParent.listens(eo))}setEventedParent(eo,ec){return this._eventedParent=eo,this._eventedParentData=ec,this}};var tr=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ee(eo,...ec){for(let ed of ec)for(let ec in ed)eo[ec]=ed[ec];return eo}function re(eo){return eo instanceof Number||eo instanceof String||eo instanceof Boolean?eo.valueOf():eo}function ne(eo){if(Array.isArray(eo))return eo.map(ne);if(eo instanceof Object&&!(eo instanceof Number||eo instanceof String||eo instanceof Boolean)){let ec={};for(let ed in eo)ec[ed]=ne(eo[ed]);return ec}return re(eo)}var ts=class extends Error{constructor(eo,ec){super(ec),this.message=ec,this.key=eo}};let ae=class ae{constructor(eo,ec=[]){for(let[ed,em]of(this.parent=eo,this.bindings={},ec))this.bindings[ed]=em}concat(eo){return new ae(this,eo)}get(eo){if(this.bindings[eo])return this.bindings[eo];if(this.parent)return this.parent.get(eo);throw Error(`${eo} not found in scope.`)}has(eo){return!!this.bindings[eo]||!!this.parent&&this.parent.has(eo)}};let tl={kind:"null"},td={kind:"number"},tp={kind:"string"},tm={kind:"boolean"},t_={kind:"color"},tg={kind:"object"},tx={kind:"value"},tv={kind:"collator"},tb={kind:"formatted"},tw={kind:"resolvedImage"};function xe(eo,ec){return{kind:"array",itemType:eo,N:ec}}function ve(eo){if("array"===eo.kind){let ec=ve(eo.itemType);return"number"==typeof eo.N?`array<${ec}, ${eo.N}>`:"value"===eo.itemType.kind?"array":`array<${ec}>`}return eo.kind}let tT=[tl,td,tp,tm,t_,tb,tg,xe(tx),tw];function we(eo,ec){if("error"===ec.kind)return null;if("array"===eo.kind){if("array"===ec.kind&&(0===ec.N&&"value"===ec.itemType.kind||!we(eo.itemType,ec.itemType))&&("number"!=typeof eo.N||eo.N===ec.N))return null}else{if(eo.kind===ec.kind)return null;if("value"===eo.kind){for(let eo of tT)if(!we(eo,ec))return null}}return`Expected ${ve(eo)} but found ${ve(ec)} instead.`}function _e(eo,ec){return ec.some(ec=>ec.kind===eo.kind)}function Ae(eo,ec){return ec.some(ec=>"null"===ec?null===eo:"array"===ec?Array.isArray(eo):"object"===ec?eo&&!Array.isArray(eo)&&"object"==typeof eo:ec===typeof eo)}var tE,tM={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ie(eo){return(eo=Math.round(eo))<0?0:eo>255?255:eo}function Me(eo){return Ie("%"===eo[eo.length-1]?parseFloat(eo)/100*255:parseInt(eo))}function Te(eo){var ec;return(ec="%"===eo[eo.length-1]?parseFloat(eo)/100:parseFloat(eo))<0?0:ec>1?1:ec}function ze(eo,ec,ed){return ed<0?ed+=1:ed>1&&(ed-=1),6*ed<1?eo+(ec-eo)*ed*6:2*ed<1?ec:3*ed<2?eo+(ec-eo)*(2/3-ed)*6:eo}try{tE=({}).parseCSSColor=function(eo){var ec,ed=eo.replace(/ /g,"").toLowerCase();if(ed in tM)return tM[ed].slice();if("#"===ed[0])return 4===ed.length?(ec=parseInt(ed.substr(1),16))>=0&&ec<=4095?[(3840&ec)>>4|(3840&ec)>>8,240&ec|(240&ec)>>4,15&ec|(15&ec)<<4,1]:null:7===ed.length&&(ec=parseInt(ed.substr(1),16))>=0&&ec<=16777215?[(16711680&ec)>>16,(65280&ec)>>8,255&ec,1]:null;var em=ed.indexOf("("),e_=ed.indexOf(")");if(-1!==em&&e_+1===ed.length){var eg=ed.substr(0,em),ex=ed.substr(em+1,e_-(em+1)).split(","),ev=1;switch(eg){case"rgba":if(4!==ex.length)break;ev=Te(ex.pop());case"rgb":return 3!==ex.length?null:[Me(ex[0]),Me(ex[1]),Me(ex[2]),ev];case"hsla":if(4!==ex.length)break;ev=Te(ex.pop());case"hsl":if(3!==ex.length)break;var eb=(parseFloat(ex[0])%360+360)%360/360,ew=Te(ex[1]),eT=Te(ex[2]),eE=eT<=.5?eT*(ew+1):eT+ew-eT*ew,eM=2*eT-eE;return[Ie(255*ze(eM,eE,eb+1/3)),Ie(255*ze(eM,eE,eb)),Ie(255*ze(eM,eE,eb-1/3)),ev]}}return null}}catch(eo){}let Be=class Be{constructor(eo,ec,ed,em=1){this.r=eo,this.g=ec,this.b=ed,this.a=em}static parse(eo){if(!eo)return;if(eo instanceof Be)return eo;if("string"!=typeof eo)return;let ec=tE(eo);return ec?new Be(ec[0]/255*ec[3],ec[1]/255*ec[3],ec[2]/255*ec[3],ec[3]):void 0}toString(){let[eo,ec,ed,em]=this.toArray();return`rgba(${Math.round(eo)},${Math.round(ec)},${Math.round(ed)},${em})`}toArray(){let{r:eo,g:ec,b:ed,a:em}=this;return 0===em?[0,0,0,0]:[255*eo/em,255*ec/em,255*ed/em,em]}toArray01(){let{r:eo,g:ec,b:ed,a:em}=this;return 0===em?[0,0,0,0]:[eo/em,ec/em,ed/em,em]}toArray01PremultipliedAlpha(){let{r:eo,g:ec,b:ed,a:em}=this;return[eo,ec,ed,em]}};Be.black=new Be(0,0,0,1),Be.white=new Be(1,1,1,1),Be.transparent=new Be(0,0,0,0),Be.red=new Be(1,0,0,1),Be.blue=new Be(0,0,1,1);let Ce=class Ce{constructor(eo,ec,ed){this.sensitivity=eo?ec?"variant":"case":ec?"accent":"base",this.locale=ed,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(eo,ec){return this.collator.compare(eo,ec)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}};let Pe=class Pe{constructor(eo,ec,ed,em,e_){this.text=eo.normalize?eo.normalize():eo,this.image=ec,this.scale=ed,this.fontStack=em,this.textColor=e_}};let De=class De{constructor(eo){this.sections=eo}static fromString(eo){return new De([new Pe(eo,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(eo=>0!==eo.text.length||eo.image&&0!==eo.image.name.length)}static factory(eo){return eo instanceof De?eo:De.fromString(eo)}toString(){return 0===this.sections.length?"":this.sections.map(eo=>eo.text).join("")}serialize(){let eo=["format"];for(let ec of this.sections){if(ec.image){eo.push(["image",ec.image.name]);continue}eo.push(ec.text);let ed={};ec.fontStack&&(ed["text-font"]=["literal",ec.fontStack.split(",")]),ec.scale&&(ed["font-scale"]=ec.scale),ec.textColor&&(ed["text-color"]=["rgba"].concat(ec.textColor.toArray())),eo.push(ed)}return eo}};let Ve=class Ve{constructor(eo){this.name=eo.name,this.available=eo.available}toString(){return this.name}static fromString(eo){return eo?new Ve({name:eo,available:!1}):null}serialize(){return["image",this.name]}};function Le(eo,ec,ed,em){return"number"==typeof eo&&eo>=0&&eo<=255&&"number"==typeof ec&&ec>=0&&ec<=255&&"number"==typeof ed&&ed>=0&&ed<=255?void 0===em||"number"==typeof em&&em>=0&&em<=1?null:`Invalid rgba value [${[eo,ec,ed,em].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof em?[eo,ec,ed,em]:[eo,ec,ed]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fe(eo){if(null===eo||"string"==typeof eo||"boolean"==typeof eo||"number"==typeof eo||eo instanceof Be||eo instanceof Ce||eo instanceof De||eo instanceof Ve)return!0;if(Array.isArray(eo)){for(let ec of eo)if(!Fe(ec))return!1;return!0}if("object"==typeof eo){for(let ec in eo)if(!Fe(eo[ec]))return!1;return!0}return!1}function Re(eo){if(null===eo)return tl;if("string"==typeof eo)return tp;if("boolean"==typeof eo)return tm;if("number"==typeof eo)return td;if(eo instanceof Be)return t_;if(eo instanceof Ce)return tv;if(eo instanceof De)return tb;if(eo instanceof Ve)return tw;if(Array.isArray(eo)){let ec;let ed=eo.length;for(let ed of eo){let eo=Re(ed);if(ec){if(ec===eo)continue;ec=tx;break}ec=eo}return xe(ec||tx,ed)}return tg}function Ue(eo){let ec=typeof eo;return null===eo?"":"string"===ec||"number"===ec||"boolean"===ec?String(eo):eo instanceof Be||eo instanceof De||eo instanceof Ve?eo.toString():JSON.stringify(eo)}let $e=class $e{constructor(eo,ec){this.type=eo,this.value=ec}static parse(eo,ec){if(2!==eo.length)return ec.error(`'literal' expression requires exactly one argument, but found ${eo.length-1} instead.`);if(!Fe(eo[1]))return ec.error("invalid value");let ed=eo[1],em=Re(ed),e_=ec.expectedType;return"array"===em.kind&&0===em.N&&e_&&"array"===e_.kind&&("number"!=typeof e_.N||0===e_.N)&&(em=e_),new $e(em,ed)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Be?["rgba"].concat(this.value.toArray()):this.value instanceof De?this.value.serialize():this.value}};var tS=class{constructor(eo){this.name="ExpressionEvaluationError",this.message=eo}toJSON(){return this.message}};let tA={string:tp,number:td,boolean:tm,object:tg};let Ne=class Ne{constructor(eo,ec){this.type=eo,this.args=ec}static parse(eo,ec){if(eo.length<2)return ec.error("Expected at least one argument.");let ed,em=1,e_=eo[0];if("array"===e_){let e_,eg;if(eo.length>2){let ed=eo[1];if("string"!=typeof ed||!(ed in tA)||"object"===ed)return ec.error('The item type argument of "array" must be one of string, number, boolean',1);e_=tA[ed],em++}else e_=tx;if(eo.length>3){if(null!==eo[2]&&("number"!=typeof eo[2]||eo[2]<0||eo[2]!==Math.floor(eo[2])))return ec.error('The length argument to "array" must be a positive integer literal',2);eg=eo[2],em++}ed=xe(e_,eg)}else ed=tA[e_];let eg=[];for(;em<eo.length;em++){let ed=ec.parse(eo[em],em,tx);if(!ed)return null;eg.push(ed)}return new Ne(ed,eg)}evaluate(eo){for(let ec=0;ec<this.args.length;ec++){let ed=this.args[ec].evaluate(eo);if(!we(this.type,Re(ed)))return ed;if(ec===this.args.length-1)throw new tS(`Expected value to be of type ${ve(this.type)}, but found ${ve(Re(ed))} instead.`)}return null}eachChild(eo){this.args.forEach(eo)}outputDefined(){return this.args.every(eo=>eo.outputDefined())}serialize(){let eo=this.type,ec=[eo.kind];if("array"===eo.kind){let ed=eo.itemType;if("string"===ed.kind||"number"===ed.kind||"boolean"===ed.kind){ec.push(ed.kind);let em=eo.N;("number"==typeof em||this.args.length>1)&&ec.push(em)}}return ec.concat(this.args.map(eo=>eo.serialize()))}};let Ze=class Ze{constructor(eo){this.type=tb,this.sections=eo}static parse(eo,ec){if(eo.length<2)return ec.error("Expected at least one argument.");let ed=eo[1];if(!Array.isArray(ed)&&"object"==typeof ed)return ec.error("First argument must be an image or text section.");let em=[],e_=!1;for(let ed=1;ed<=eo.length-1;++ed){let eg=eo[ed];if(e_&&"object"==typeof eg&&!Array.isArray(eg)){e_=!1;let eo=null;if(eg["font-scale"]&&!(eo=ec.parse(eg["font-scale"],1,td)))return null;let ed=null;if(eg["text-font"]&&!(ed=ec.parse(eg["text-font"],1,xe(tp))))return null;let ex=null;if(eg["text-color"]&&!(ex=ec.parse(eg["text-color"],1,t_)))return null;let ev=em[em.length-1];ev.scale=eo,ev.font=ed,ev.textColor=ex}else{let eg=ec.parse(eo[ed],1,tx);if(!eg)return null;let ex=eg.type.kind;if("string"!==ex&&"value"!==ex&&"null"!==ex&&"resolvedImage"!==ex)return ec.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");e_=!0,em.push({content:eg,scale:null,font:null,textColor:null})}}return new Ze(em)}evaluate(eo){return new De(this.sections.map(ec=>{let ed=ec.content.evaluate(eo);return Re(ed)===tw?new Pe("",ed,null,null,null):new Pe(Ue(ed),null,ec.scale?ec.scale.evaluate(eo):null,ec.font?ec.font.evaluate(eo).join(","):null,ec.textColor?ec.textColor.evaluate(eo):null)}))}eachChild(eo){for(let ec of this.sections)eo(ec.content),ec.scale&&eo(ec.scale),ec.font&&eo(ec.font),ec.textColor&&eo(ec.textColor)}outputDefined(){return!1}serialize(){let eo=["format"];for(let ec of this.sections){eo.push(ec.content.serialize());let ed={};ec.scale&&(ed["font-scale"]=ec.scale.serialize()),ec.font&&(ed["text-font"]=ec.font.serialize()),ec.textColor&&(ed["text-color"]=ec.textColor.serialize()),eo.push(ed)}return eo}};let Ke=class Ke{constructor(eo){this.type=tw,this.input=eo}static parse(eo,ec){if(2!==eo.length)return ec.error("Expected two arguments.");let ed=ec.parse(eo[1],1,tp);return ed?new Ke(ed):ec.error("No image name provided.")}evaluate(eo){let ec=this.input.evaluate(eo),ed=Ve.fromString(ec);return ed&&eo.availableImages&&(ed.available=eo.availableImages.indexOf(ec)>-1),ed}eachChild(eo){eo(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}};let tI={"to-boolean":tm,"to-color":t_,"to-number":td,"to-string":tp};let Je=class Je{constructor(eo,ec){this.type=eo,this.args=ec}static parse(eo,ec){if(eo.length<2)return ec.error("Expected at least one argument.");let ed=eo[0];if(("to-boolean"===ed||"to-string"===ed)&&2!==eo.length)return ec.error("Expected one argument.");let em=tI[ed],e_=[];for(let ed=1;ed<eo.length;ed++){let em=ec.parse(eo[ed],ed,tx);if(!em)return null;e_.push(em)}return new Je(em,e_)}evaluate(eo){if("boolean"===this.type.kind)return!!this.args[0].evaluate(eo);if("color"===this.type.kind){let ec,ed;for(let em of this.args){if(ec=em.evaluate(eo),ed=null,ec instanceof Be)return ec;if("string"==typeof ec){let ed=eo.parseColor(ec);if(ed)return ed}else if(Array.isArray(ec)&&!(ed=ec.length<3||ec.length>4?`Invalid rbga value ${JSON.stringify(ec)}: expected an array containing either three or four numeric values.`:Le(ec[0],ec[1],ec[2],ec[3])))return new Be(ec[0]/255,ec[1]/255,ec[2]/255,ec[3])}throw new tS(ed||`Could not parse color from value '${"string"==typeof ec?ec:String(JSON.stringify(ec))}'`)}if("number"===this.type.kind){let ec=null;for(let ed of this.args){if(null===(ec=ed.evaluate(eo)))return 0;let em=Number(ec);if(!isNaN(em))return em}throw new tS(`Could not convert ${JSON.stringify(ec)} to number.`)}return"formatted"===this.type.kind?De.fromString(Ue(this.args[0].evaluate(eo))):"resolvedImage"===this.type.kind?Ve.fromString(Ue(this.args[0].evaluate(eo))):Ue(this.args[0].evaluate(eo))}eachChild(eo){this.args.forEach(eo)}outputDefined(){return this.args.every(eo=>eo.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ze([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ke(this.args[0]).serialize();let eo=[`to-${this.type.kind}`];return this.eachChild(ec=>{eo.push(ec.serialize())}),eo}};let tC=["Unknown","Point","LineString","Polygon"];var tP=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?tC[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let eo=this.featureDistanceData.center,ec=this.featureDistanceData.scale,{x:ed,y:em}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(ed*ec-eo[0])+this.featureDistanceData.bearing[1]*(em*ec-eo[1])}return 0}parseColor(eo){let ec=this._parseColorCache[eo];return ec||(ec=this._parseColorCache[eo]=Be.parse(eo)),ec}};let Qe=class Qe{constructor(eo,ec,ed,em){this.name=eo,this.type=ec,this._evaluate=ed,this.args=em}evaluate(eo){return this._evaluate(eo,this.args)}eachChild(eo){this.args.forEach(eo)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(eo=>eo.serialize()))}static parse(eo,ec){let ed=eo[0],em=Qe.definitions[ed];if(!em)return ec.error(`Unknown expression "${ed}". If you wanted a literal array, use ["literal", [...]].`,0);let e_=Array.isArray(em)?em[0]:em.type,eg=Array.isArray(em)?[[em[1],em[2]]]:em.overloads,ex=eg.filter(([ec])=>!Array.isArray(ec)||ec.length===eo.length-1),ev=null;for(let[em,eg]of ex){ev=new tz(ec.registry,ec.path,null,ec.scope);let ex=[],eb=!1;for(let ec=1;ec<eo.length;ec++){let ed=eo[ec],e_=Array.isArray(em)?em[ec-1]:em.type,eg=ev.parse(ed,1+ex.length,e_);if(!eg){eb=!0;break}ex.push(eg)}if(!eb){if(Array.isArray(em)&&em.length!==ex.length)ev.error(`Expected ${em.length} arguments, but found ${ex.length} instead.`);else{for(let eo=0;eo<ex.length;eo++){let ec=Array.isArray(em)?em[eo]:em.type,ed=ex[eo];ev.concat(eo+1).checkSubtype(ec,ed.type)}if(0===ev.errors.length)return new Qe(ed,e_,eg,ex)}}}if(1===ex.length)ec.errors.push(...ev.errors);else{let ed=(ex.length?ex:eg).map(([eo])=>Array.isArray(eo)?`(${eo.map(ve).join(", ")})`:`(${ve(eo.type)}...)`).join(" | "),em=[];for(let ed=1;ed<eo.length;ed++){let e_=ec.parse(eo[ed],1+em.length);if(!e_)return null;em.push(ve(e_.type))}ec.error(`Expected arguments of type ${ed}, but found (${em.join(", ")}) instead.`)}return null}static register(eo,ec){for(let ed in Qe.definitions=ec,ec)eo[ed]=Qe}};let er=class er{constructor(eo,ec,ed){this.type=tv,this.locale=ed,this.caseSensitive=eo,this.diacriticSensitive=ec}static parse(eo,ec){if(2!==eo.length)return ec.error("Expected one argument.");let ed=eo[1];if("object"!=typeof ed||Array.isArray(ed))return ec.error("Collator options argument must be an object.");let em=ec.parse(void 0!==ed["case-sensitive"]&&ed["case-sensitive"],1,tm);if(!em)return null;let e_=ec.parse(void 0!==ed["diacritic-sensitive"]&&ed["diacritic-sensitive"],1,tm);if(!e_)return null;let eg=null;return!ed.locale||(eg=ec.parse(ed.locale,1,tp))?new er(em,e_,eg):null}evaluate(eo){return new Ce(this.caseSensitive.evaluate(eo),this.diacriticSensitive.evaluate(eo),this.locale?this.locale.evaluate(eo):null)}eachChild(eo){eo(this.caseSensitive),eo(this.diacriticSensitive),this.locale&&eo(this.locale)}outputDefined(){return!1}serialize(){let eo={};return eo["case-sensitive"]=this.caseSensitive.serialize(),eo["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(eo.locale=this.locale.serialize()),["collator",eo]}};function nr(eo,ec){eo[0]=Math.min(eo[0],ec[0]),eo[1]=Math.min(eo[1],ec[1]),eo[2]=Math.max(eo[2],ec[0]),eo[3]=Math.max(eo[3],ec[1])}function ir(eo,ec){return!(eo[0]<=ec[0]||eo[2]>=ec[2]||eo[1]<=ec[1]||eo[3]>=ec[3])}function or(eo,ec){var ed,em;let e_=!1;for(let eg=0,ex=ec.length;eg<ex;eg++){let ex=ec[eg];for(let ec=0,eg=ex.length;ec<eg-1;ec++){if(function(eo,ec,ed){let em=eo[0]-ec[0],e_=eo[1]-ec[1],eg=eo[0]-ed[0],ex=eo[1]-ed[1];return em*ex-eg*e_==0&&em*eg<=0&&e_*ex<=0}(eo,ex[ec],ex[ec+1]))return!1;(ed=ex[ec])[1]>eo[1]!=(em=ex[ec+1])[1]>eo[1]&&eo[0]<(em[0]-ed[0])*(eo[1]-ed[1])/(em[1]-ed[1])+ed[0]&&(e_=!e_)}}return e_}function ur(eo,ec,ed,em){let e_=em[0]-ed[0],eg=em[1]-ed[1],ex=(eo[0]-ed[0])*eg-e_*(eo[1]-ed[1]),ev=(ec[0]-ed[0])*eg-e_*(ec[1]-ed[1]);return ex>0&&ev<0||ex<0&&ev>0}function hr(eo,ec){for(let ed=0;ed<eo.length;++ed)if(!or(eo[ed],ec))return!1;for(let ed=0;ed<eo.length-1;++ed)if(function(eo,ec,ed){var em,e_,eg,ex;for(let ev of ed)for(let ed=0;ed<ev.length-1;++ed)if(0!=(eg=[(e_=ev[ed+1])[0]-(em=ev[ed])[0],e_[1]-em[1]])[0]*(ex=[ec[0]-eo[0],ec[1]-eo[1]])[1]-eg[1]*ex[0]&&ur(eo,ec,em,e_)&&ur(em,e_,eo,ec))return!0;return!1}(eo[ed],eo[ed+1],ec))return!1;return!0}function dr(eo,ec,ed){let em=[];for(let e_=0;e_<eo.length;e_++){let eg=[];for(let em=0;em<eo[e_].length;em++){let ex=function(eo,ec){let ed=(180+eo[0])/360,em=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+eo[1]*Math.PI/360)))/360,e_=Math.pow(2,ec.z);return[Math.round(ed*e_*8192),Math.round(em*e_*8192)]}(eo[e_][em],ed);nr(ec,ex),eg.push(ex)}em.push(eg)}return em}function fr(eo,ec,ed){let em=[];for(let e_=0;e_<eo.length;e_++){let eg=dr(eo[e_],ec,ed);em.push(eg)}return em}function yr(eo,ec,ed,em){if(eo[0]<ed[0]||eo[0]>ed[2]){let ec=.5*em,e_=eo[0]-ed[0]>ec?-em:ed[0]-eo[0]>ec?em:0;0===e_&&(e_=eo[0]-ed[2]>ec?-em:ed[2]-eo[0]>ec?em:0),eo[0]+=e_}nr(ec,eo)}function mr(eo,ec,ed,em){let e_=8192*Math.pow(2,em.z),eg=[8192*em.x,8192*em.y],ex=[];if(!eo)return ex;for(let em of eo)for(let eo of em){let em=[eo.x+eg[0],eo.y+eg[1]];yr(em,ec,ed,e_),ex.push(em)}return ex}function gr(eo,ec,ed,em){let e_=8192*Math.pow(2,em.z),eg=[8192*em.x,8192*em.y],ex=[];if(!eo)return ex;for(let ed of eo){let eo=[];for(let em of ed){let ed=[em.x+eg[0],em.y+eg[1]];nr(ec,ed),eo.push(ed)}ex.push(eo)}if(ec[2]-ec[0]<=e_/2)for(let eo of(ec[0]=ec[1]=1/0,ec[2]=ec[3]=-1/0,ex))for(let em of eo)yr(em,ec,ed,e_);return ex}let xr=class xr{constructor(eo,ec){this.type=tm,this.geojson=eo,this.geometries=ec}static parse(eo,ec){if(2!==eo.length)return ec.error(`'within' expression requires exactly one argument, but found ${eo.length-1} instead.`);if(Fe(eo[1])){let ec=eo[1];if("FeatureCollection"===ec.type)for(let eo=0;eo<ec.features.length;++eo){let ed=ec.features[eo].geometry.type;if("Polygon"===ed||"MultiPolygon"===ed)return new xr(ec,ec.features[eo].geometry)}else if("Feature"===ec.type){let eo=ec.geometry.type;if("Polygon"===eo||"MultiPolygon"===eo)return new xr(ec,ec.geometry)}else if("Polygon"===ec.type||"MultiPolygon"===ec.type)return new xr(ec,ec)}return ec.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(eo){if(null!=eo.geometry()&&null!=eo.canonicalID()){if("Point"===eo.geometryType())return function(eo,ec){let ed=[1/0,1/0,-1/0,-1/0],em=[1/0,1/0,-1/0,-1/0],e_=eo.canonicalID();if(!e_)return!1;if("Polygon"===ec.type){let eg=dr(ec.coordinates,em,e_),ex=mr(eo.geometry(),ed,em,e_);if(!ir(ed,em))return!1;for(let eo of ex)if(!or(eo,eg))return!1}if("MultiPolygon"===ec.type){let eg=fr(ec.coordinates,em,e_),ex=mr(eo.geometry(),ed,em,e_);if(!ir(ed,em))return!1;for(let eo of ex)if(!function(eo,ec){for(let ed=0;ed<ec.length;ed++)if(or(eo,ec[ed]))return!0;return!1}(eo,eg))return!1}return!0}(eo,this.geometries);if("LineString"===eo.geometryType())return function(eo,ec){let ed=[1/0,1/0,-1/0,-1/0],em=[1/0,1/0,-1/0,-1/0],e_=eo.canonicalID();if(!e_)return!1;if("Polygon"===ec.type){let eg=dr(ec.coordinates,em,e_),ex=gr(eo.geometry(),ed,em,e_);if(!ir(ed,em))return!1;for(let eo of ex)if(!hr(eo,eg))return!1}if("MultiPolygon"===ec.type){let eg=fr(ec.coordinates,em,e_),ex=gr(eo.geometry(),ed,em,e_);if(!ir(ed,em))return!1;for(let eo of ex)if(!function(eo,ec){for(let ed=0;ed<ec.length;ed++)if(hr(eo,ec[ed]))return!0;return!1}(eo,eg))return!1}return!0}(eo,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}};function br(eo){if(eo instanceof Qe&&("get"===eo.name&&1===eo.args.length||"feature-state"===eo.name||"has"===eo.name&&1===eo.args.length||"properties"===eo.name||"geometry-type"===eo.name||"id"===eo.name||/^filter-/.test(eo.name))||eo instanceof xr)return!1;let ec=!0;return eo.eachChild(eo=>{ec&&!br(eo)&&(ec=!1)}),ec}function wr(eo){if(eo instanceof Qe&&"feature-state"===eo.name)return!1;let ec=!0;return eo.eachChild(eo=>{ec&&!wr(eo)&&(ec=!1)}),ec}function _r(eo,ec){if(eo instanceof Qe&&ec.indexOf(eo.name)>=0)return!1;let ed=!0;return eo.eachChild(eo=>{ed&&!_r(eo,ec)&&(ed=!1)}),ed}let Ar=class Ar{constructor(eo,ec){this.type=ec.type,this.name=eo,this.boundExpression=ec}static parse(eo,ec){if(2!==eo.length||"string"!=typeof eo[1])return ec.error("'var' expression requires exactly one string literal argument.");let ed=eo[1];return ec.scope.has(ed)?new Ar(ed,ec.scope.get(ed)):ec.error(`Unknown variable "${ed}". Make sure "${ed}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(eo){return this.boundExpression.evaluate(eo)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}};let kr=class kr{constructor(eo,ec=[],ed,em=new ae,e_=[]){this.registry=eo,this.path=ec,this.key=ec.map(eo=>`[${eo}]`).join(""),this.scope=em,this.errors=e_,this.expectedType=ed}parse(eo,ec,ed,em,e_={}){return ec?this.concat(ec,ed,em)._parse(eo,e_):this._parse(eo,e_)}_parse(eo,ec){function r(eo,ec,ed){return"assert"===ed?new Ne(ec,[eo]):"coerce"===ed?new Je(ec,[eo]):eo}if(null!==eo&&"string"!=typeof eo&&"boolean"!=typeof eo&&"number"!=typeof eo||(eo=["literal",eo]),Array.isArray(eo)){if(0===eo.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let ed=eo[0];if("string"!=typeof ed)return this.error(`Expression name must be a string, but found ${typeof ed} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;let em=this.registry[ed];if(em){let ed=em.parse(eo,this);if(!ed)return null;if(this.expectedType){let eo=this.expectedType,em=ed.type;if("string"!==eo.kind&&"number"!==eo.kind&&"boolean"!==eo.kind&&"object"!==eo.kind&&"array"!==eo.kind||"value"!==em.kind){if("color"!==eo.kind&&"formatted"!==eo.kind&&"resolvedImage"!==eo.kind||"value"!==em.kind&&"string"!==em.kind){if(this.checkSubtype(eo,em))return null}else ed=r(ed,eo,ec.typeAnnotation||"coerce")}else ed=r(ed,eo,ec.typeAnnotation||"assert")}if(!(ed instanceof $e)&&"resolvedImage"!==ed.type.kind&&function Mr(eo){if(eo instanceof Ar)return Mr(eo.boundExpression);if(eo instanceof Qe&&"error"===eo.name||eo instanceof er||eo instanceof xr)return!1;let ec=eo instanceof Je||eo instanceof Ne,ed=!0;return eo.eachChild(eo=>{ed=ec?ed&&Mr(eo):ed&&eo instanceof $e}),!!ed&&br(eo)&&_r(eo,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}(ed)){let eo=new tP;try{ed=new $e(ed.type,ed.evaluate(eo))}catch(eo){return this.error(eo.message),null}}return ed}return this.error(`Unknown expression "${ed}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===eo?"'undefined' value invalid. Use null instead.":"object"==typeof eo?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof eo} instead.`)}concat(eo,ec,ed){let em="number"==typeof eo?this.path.concat(eo):this.path,e_=ed?this.scope.concat(ed):this.scope;return new kr(this.registry,em,ec||null,e_,this.errors)}error(eo,...ec){let ed=`${this.key}${ec.map(eo=>`[${eo}]`).join("")}`;this.errors.push(new ts(ed,eo))}checkSubtype(eo,ec){let ed=we(eo,ec);return ed&&this.error(ed),ed}};var tz=kr;function Tr(eo,ec){let ed=eo.length-1,em,e_,eg=0,ex=ed,ev=0;for(;eg<=ex;)if(em=eo[ev=Math.floor((eg+ex)/2)],e_=eo[ev+1],em<=ec){if(ev===ed||ec<e_)return ev;eg=ev+1}else{if(!(em>ec))throw new tS("Input is not a number.");ex=ev-1}return 0}let zr=class zr{constructor(eo,ec,ed){for(let[em,e_]of(this.type=eo,this.input=ec,this.labels=[],this.outputs=[],ed))this.labels.push(em),this.outputs.push(e_)}static parse(eo,ec){if(eo.length-1<4)return ec.error(`Expected at least 4 arguments, but found only ${eo.length-1}.`);if((eo.length-1)%2!=0)return ec.error("Expected an even number of arguments.");let ed=ec.parse(eo[1],1,td);if(!ed)return null;let em=[],e_=null;ec.expectedType&&"value"!==ec.expectedType.kind&&(e_=ec.expectedType);for(let ed=1;ed<eo.length;ed+=2){let eg=1===ed?-1/0:eo[ed],ex=eo[ed+1],ev=ed,eb=ed+1;if("number"!=typeof eg)return ec.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',ev);if(em.length&&em[em.length-1][0]>=eg)return ec.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',ev);let ew=ec.parse(ex,eb,e_);if(!ew)return null;e_=e_||ew.type,em.push([eg,ew])}return new zr(e_,ed,em)}evaluate(eo){let ec=this.labels,ed=this.outputs;if(1===ec.length)return ed[0].evaluate(eo);let em=this.input.evaluate(eo);if(em<=ec[0])return ed[0].evaluate(eo);let e_=ec.length;return em>=ec[e_-1]?ed[e_-1].evaluate(eo):ed[Tr(ec,em)].evaluate(eo)}eachChild(eo){for(let ec of(eo(this.input),this.outputs))eo(ec)}outputDefined(){return this.outputs.every(eo=>eo.outputDefined())}serialize(){let eo=["step",this.input.serialize()];for(let ec=0;ec<this.labels.length;ec++)ec>0&&eo.push(this.labels[ec]),eo.push(this.outputs[ec].serialize());return eo}};function Er(eo,ec,ed){return eo*(1-ed)+ec*ed}var tD=Object.freeze({__proto__:null,array:function(eo,ec,ed){return eo.map((eo,em)=>Er(eo,ec[em],ed))},color:function(eo,ec,ed){return new Be(Er(eo.r,ec.r,ed),Er(eo.g,ec.g,ed),Er(eo.b,ec.b,ed),Er(eo.a,ec.a,ed))},number:Er});let tk=4/29,tL=6/29,tR=3*tL*tL,tB=tL*tL*tL,tF=Math.PI/180,tO=180/Math.PI;function jr(eo){return eo>tB?Math.pow(eo,1/3):eo/tR+tk}function Or(eo){return eo>tL?eo*eo*eo:tR*(eo-tk)}function qr(eo){return 255*(eo<=.0031308?12.92*eo:1.055*Math.pow(eo,1/2.4)-.055)}function Nr(eo){return(eo/=255)<=.04045?eo/12.92:Math.pow((eo+.055)/1.055,2.4)}function Gr(eo){let ec=Nr(eo.r),ed=Nr(eo.g),em=Nr(eo.b),e_=jr((.4124564*ec+.3575761*ed+.1804375*em)/.95047),eg=jr((.2126729*ec+.7151522*ed+.072175*em)/1);return{l:116*eg-16,a:500*(e_-eg),b:200*(eg-jr((.0193339*ec+.119192*ed+.9503041*em)/1.08883)),alpha:eo.a}}function Zr(eo){let ec=(eo.l+16)/116,ed=isNaN(eo.a)?ec:ec+eo.a/500,em=isNaN(eo.b)?ec:ec-eo.b/200;return ec=1*Or(ec),ed=.95047*Or(ed),em=1.08883*Or(em),new Be(qr(3.2404542*ed-1.5371385*ec-.4985314*em),qr(-.969266*ed+1.8760108*ec+.041556*em),qr(.0556434*ed-.2040259*ec+1.0572252*em),eo.alpha)}let tU={forward:Gr,reverse:Zr,interpolate:function(eo,ec,ed){return{l:Er(eo.l,ec.l,ed),a:Er(eo.a,ec.a,ed),b:Er(eo.b,ec.b,ed),alpha:Er(eo.alpha,ec.alpha,ed)}}},tN={forward:function(eo){let{l:ec,a:ed,b:em}=Gr(eo),e_=Math.atan2(em,ed)*tO;return{h:e_<0?e_+360:e_,c:Math.sqrt(ed*ed+em*em),l:ec,alpha:eo.a}},reverse:function(eo){let ec=eo.h*tF,ed=eo.c;return Zr({l:eo.l,a:Math.cos(ec)*ed,b:Math.sin(ec)*ed,alpha:eo.alpha})},interpolate:function(eo,ec,ed){return{h:function(eo,ec,ed){let em=ec-eo;return eo+ed*(em>180||em<-180?em-360*Math.round(em/360):em)}(eo.h,ec.h,ed),c:Er(eo.c,ec.c,ed),l:Er(eo.l,ec.l,ed),alpha:Er(eo.alpha,ec.alpha,ed)}}};var tV=Object.freeze({__proto__:null,hcl:tN,lab:tU});let Yr=class Yr{constructor(eo,ec,ed,em,e_){for(let[eg,ex]of(this.type=eo,this.operator=ec,this.interpolation=ed,this.input=em,this.labels=[],this.outputs=[],e_))this.labels.push(eg),this.outputs.push(ex)}static interpolationFactor(eo,ec,ed,em){let e_=0;if("exponential"===eo.name)e_=Wr(ec,eo.base,ed,em);else if("linear"===eo.name)e_=Wr(ec,1,ed,em);else if("cubic-bezier"===eo.name){let eg=eo.controlPoints;e_=new ek(eg[0],eg[1],eg[2],eg[3]).solve(Wr(ec,1,ed,em))}return e_}static parse(eo,ec){let[ed,em,e_,...eg]=eo;if(!Array.isArray(em)||0===em.length)return ec.error("Expected an interpolation type expression.",1);if("linear"===em[0])em={name:"linear"};else if("exponential"===em[0]){let eo=em[1];if("number"!=typeof eo)return ec.error("Exponential interpolation requires a numeric base.",1,1);em={name:"exponential",base:eo}}else{if("cubic-bezier"!==em[0])return ec.error(`Unknown interpolation type ${String(em[0])}`,1,0);{let eo=em.slice(1);if(4!==eo.length||eo.some(eo=>"number"!=typeof eo||eo<0||eo>1))return ec.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);em={name:"cubic-bezier",controlPoints:eo}}}if(eo.length-1<4)return ec.error(`Expected at least 4 arguments, but found only ${eo.length-1}.`);if((eo.length-1)%2!=0)return ec.error("Expected an even number of arguments.");if(!(e_=ec.parse(e_,2,td)))return null;let ex=[],ev=null;"interpolate-hcl"===ed||"interpolate-lab"===ed?ev=t_:ec.expectedType&&"value"!==ec.expectedType.kind&&(ev=ec.expectedType);for(let eo=0;eo<eg.length;eo+=2){let ed=eg[eo],em=eg[eo+1],e_=eo+3,eb=eo+4;if("number"!=typeof ed)return ec.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',e_);if(ex.length&&ex[ex.length-1][0]>=ed)return ec.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',e_);let ew=ec.parse(em,eb,ev);if(!ew)return null;ev=ev||ew.type,ex.push([ed,ew])}return"number"===ev.kind||"color"===ev.kind||"array"===ev.kind&&"number"===ev.itemType.kind&&"number"==typeof ev.N?new Yr(ev,ed,em,e_,ex):ec.error(`Type ${ve(ev)} is not interpolatable.`)}evaluate(eo){let ec=this.labels,ed=this.outputs;if(1===ec.length)return ed[0].evaluate(eo);let em=this.input.evaluate(eo);if(em<=ec[0])return ed[0].evaluate(eo);let e_=ec.length;if(em>=ec[e_-1])return ed[e_-1].evaluate(eo);let eg=Tr(ec,em),ex=Yr.interpolationFactor(this.interpolation,em,ec[eg],ec[eg+1]),ev=ed[eg].evaluate(eo),eb=ed[eg+1].evaluate(eo);return"interpolate"===this.operator?tD[this.type.kind.toLowerCase()](ev,eb,ex):"interpolate-hcl"===this.operator?tN.reverse(tN.interpolate(tN.forward(ev),tN.forward(eb),ex)):tU.reverse(tU.interpolate(tU.forward(ev),tU.forward(eb),ex))}eachChild(eo){for(let ec of(eo(this.input),this.outputs))eo(ec)}outputDefined(){return this.outputs.every(eo=>eo.outputDefined())}serialize(){let eo;eo="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let ec=[this.operator,eo,this.input.serialize()];for(let eo=0;eo<this.labels.length;eo++)ec.push(this.labels[eo],this.outputs[eo].serialize());return ec}};function Wr(eo,ec,ed,em){let e_=em-ed,eg=eo-ed;return 0===e_?0:1===ec?eg/e_:(Math.pow(ec,eg)-1)/(Math.pow(ec,e_)-1)}let tn=class tn{constructor(eo,ec){this.type=eo,this.args=ec}static parse(eo,ec){if(eo.length<2)return ec.error("Expectected at least one argument.");let ed=null,em=ec.expectedType;em&&"value"!==em.kind&&(ed=em);let e_=[];for(let em of eo.slice(1)){let eo=ec.parse(em,1+e_.length,ed,void 0,{typeAnnotation:"omit"});if(!eo)return null;ed=ed||eo.type,e_.push(eo)}let eg=em&&e_.some(eo=>we(em,eo.type));return new tn(eg?tx:ed,e_)}evaluate(eo){let ec,ed=null,em=0;for(let e_ of this.args){if(em++,(ed=e_.evaluate(eo))&&ed instanceof Ve&&!ed.available&&(ec||(ec=ed),ed=null,em===this.args.length))return ec;if(null!==ed)break}return ed}eachChild(eo){this.args.forEach(eo)}outputDefined(){return this.args.every(eo=>eo.outputDefined())}serialize(){let eo=["coalesce"];return this.eachChild(ec=>{eo.push(ec.serialize())}),eo}};let rn=class rn{constructor(eo,ec){this.type=ec.type,this.bindings=[].concat(eo),this.result=ec}evaluate(eo){return this.result.evaluate(eo)}eachChild(eo){for(let ec of this.bindings)eo(ec[1]);eo(this.result)}static parse(eo,ec){if(eo.length<4)return ec.error(`Expected at least 3 arguments, but found ${eo.length-1} instead.`);let ed=[];for(let em=1;em<eo.length-1;em+=2){let e_=eo[em];if("string"!=typeof e_)return ec.error(`Expected string, but found ${typeof e_} instead.`,em);if(/[^a-zA-Z0-9_]/.test(e_))return ec.error("Variable names must contain only alphanumeric characters or '_'.",em);let eg=ec.parse(eo[em+1],em+1);if(!eg)return null;ed.push([e_,eg])}let em=ec.parse(eo[eo.length-1],eo.length-1,ec.expectedType,ed);return em?new rn(ed,em):null}outputDefined(){return this.result.outputDefined()}serialize(){let eo=["let"];for(let[ec,ed]of this.bindings)eo.push(ec,ed.serialize());return eo.push(this.result.serialize()),eo}};let sn=class sn{constructor(eo,ec,ed){this.type=eo,this.index=ec,this.input=ed}static parse(eo,ec){if(3!==eo.length)return ec.error(`Expected 2 arguments, but found ${eo.length-1} instead.`);let ed=ec.parse(eo[1],1,td),em=ec.parse(eo[2],2,xe(ec.expectedType||tx));return ed&&em?new sn(em.type.itemType,ed,em):null}evaluate(eo){let ec=this.index.evaluate(eo),ed=this.input.evaluate(eo);if(ec<0)throw new tS(`Array index out of bounds: ${ec} < 0.`);if(ec>=ed.length)throw new tS(`Array index out of bounds: ${ec} > ${ed.length-1}.`);if(ec!==Math.floor(ec))throw new tS(`Array index must be an integer, but found ${ec} instead.`);return ed[ec]}eachChild(eo){eo(this.index),eo(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}};let on=class on{constructor(eo,ec){this.type=tm,this.needle=eo,this.haystack=ec}static parse(eo,ec){if(3!==eo.length)return ec.error(`Expected 2 arguments, but found ${eo.length-1} instead.`);let ed=ec.parse(eo[1],1,tx),em=ec.parse(eo[2],2,tx);return ed&&em?_e(ed.type,[tm,tp,td,tl,tx])?new on(ed,em):ec.error(`Expected first argument to be of type boolean, string, number or null, but found ${ve(ed.type)} instead`):null}evaluate(eo){let ec=this.needle.evaluate(eo),ed=this.haystack.evaluate(eo);if(null==ed)return!1;if(!Ae(ec,["boolean","string","number","null"]))throw new tS(`Expected first argument to be of type boolean, string, number or null, but found ${ve(Re(ec))} instead.`);if(!Ae(ed,["string","array"]))throw new tS(`Expected second argument to be of type array or string, but found ${ve(Re(ed))} instead.`);return ed.indexOf(ec)>=0}eachChild(eo){eo(this.needle),eo(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}};let un=class un{constructor(eo,ec,ed){this.type=td,this.needle=eo,this.haystack=ec,this.fromIndex=ed}static parse(eo,ec){if(eo.length<=2||eo.length>=5)return ec.error(`Expected 3 or 4 arguments, but found ${eo.length-1} instead.`);let ed=ec.parse(eo[1],1,tx),em=ec.parse(eo[2],2,tx);if(!ed||!em)return null;if(!_e(ed.type,[tm,tp,td,tl,tx]))return ec.error(`Expected first argument to be of type boolean, string, number or null, but found ${ve(ed.type)} instead`);if(4===eo.length){let e_=ec.parse(eo[3],3,td);return e_?new un(ed,em,e_):null}return new un(ed,em)}evaluate(eo){let ec=this.needle.evaluate(eo),ed=this.haystack.evaluate(eo);if(!Ae(ec,["boolean","string","number","null"]))throw new tS(`Expected first argument to be of type boolean, string, number or null, but found ${ve(Re(ec))} instead.`);if(!Ae(ed,["string","array"]))throw new tS(`Expected second argument to be of type array or string, but found ${ve(Re(ed))} instead.`);if(this.fromIndex){let em=this.fromIndex.evaluate(eo);return ed.indexOf(ec,em)}return ed.indexOf(ec)}eachChild(eo){eo(this.needle),eo(this.haystack),this.fromIndex&&eo(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){let eo=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),eo]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}};let hn=class hn{constructor(eo,ec,ed,em,e_,eg){this.inputType=eo,this.type=ec,this.input=ed,this.cases=em,this.outputs=e_,this.otherwise=eg}static parse(eo,ec){let ed,em;if(eo.length<5)return ec.error(`Expected at least 4 arguments, but found only ${eo.length-1}.`);if(eo.length%2!=1)return ec.error("Expected an even number of arguments.");ec.expectedType&&"value"!==ec.expectedType.kind&&(em=ec.expectedType);let e_={},eg=[];for(let ex=2;ex<eo.length-1;ex+=2){let ev=eo[ex],eb=eo[ex+1];Array.isArray(ev)||(ev=[ev]);let ew=ec.concat(ex);if(0===ev.length)return ew.error("Expected at least one branch label.");for(let eo of ev){if("number"!=typeof eo&&"string"!=typeof eo)return ew.error("Branch labels must be numbers or strings.");if("number"==typeof eo&&Math.abs(eo)>Number.MAX_SAFE_INTEGER)return ew.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof eo&&Math.floor(eo)!==eo)return ew.error("Numeric branch labels must be integer values.");if(ed){if(ew.checkSubtype(ed,Re(eo)))return null}else ed=Re(eo);if(void 0!==e_[String(eo)])return ew.error("Branch labels must be unique.");e_[String(eo)]=eg.length}let eT=ec.parse(eb,ex,em);if(!eT)return null;em=em||eT.type,eg.push(eT)}let ex=ec.parse(eo[1],1,tx);if(!ex)return null;let ev=ec.parse(eo[eo.length-1],eo.length-1,em);return ev?"value"!==ex.type.kind&&ec.concat(1).checkSubtype(ed,ex.type)?null:new hn(ed,em,ex,e_,eg,ev):null}evaluate(eo){let ec=this.input.evaluate(eo);return(Re(ec)===this.inputType&&this.outputs[this.cases[ec]]||this.otherwise).evaluate(eo)}eachChild(eo){eo(this.input),this.outputs.forEach(eo),eo(this.otherwise)}outputDefined(){return this.outputs.every(eo=>eo.outputDefined())&&this.otherwise.outputDefined()}serialize(){let eo=["match",this.input.serialize()],ec=Object.keys(this.cases).sort(),ed=[],em={};for(let eo of ec){let ec=em[this.cases[eo]];void 0===ec?(em[this.cases[eo]]=ed.length,ed.push([this.cases[eo],[eo]])):ed[ec][1].push(eo)}let i=eo=>"number"===this.inputType.kind?Number(eo):eo;for(let[ec,em]of ed)eo.push(1===em.length?i(em[0]):em.map(i)),eo.push(this.outputs[ec].serialize());return eo.push(this.otherwise.serialize()),eo}};let dn=class dn{constructor(eo,ec,ed){this.type=eo,this.branches=ec,this.otherwise=ed}static parse(eo,ec){let ed;if(eo.length<4)return ec.error(`Expected at least 3 arguments, but found only ${eo.length-1}.`);if(eo.length%2!=0)return ec.error("Expected an odd number of arguments.");ec.expectedType&&"value"!==ec.expectedType.kind&&(ed=ec.expectedType);let em=[];for(let e_=1;e_<eo.length-1;e_+=2){let eg=ec.parse(eo[e_],e_,tm);if(!eg)return null;let ex=ec.parse(eo[e_+1],e_+1,ed);if(!ex)return null;em.push([eg,ex]),ed=ed||ex.type}let e_=ec.parse(eo[eo.length-1],eo.length-1,ed);return e_?new dn(ed,em,e_):null}evaluate(eo){for(let[ec,ed]of this.branches)if(ec.evaluate(eo))return ed.evaluate(eo);return this.otherwise.evaluate(eo)}eachChild(eo){for(let[ec,ed]of this.branches)eo(ec),eo(ed);eo(this.otherwise)}outputDefined(){return this.branches.every(([eo,ec])=>ec.outputDefined())&&this.otherwise.outputDefined()}serialize(){let eo=["case"];return this.eachChild(ec=>{eo.push(ec.serialize())}),eo}};let yn=class yn{constructor(eo,ec,ed,em){this.type=eo,this.input=ec,this.beginIndex=ed,this.endIndex=em}static parse(eo,ec){if(eo.length<=2||eo.length>=5)return ec.error(`Expected 3 or 4 arguments, but found ${eo.length-1} instead.`);let ed=ec.parse(eo[1],1,tx),em=ec.parse(eo[2],2,td);if(!ed||!em)return null;if(!_e(ed.type,[xe(tx),tp,tx]))return ec.error(`Expected first argument to be of type array or string, but found ${ve(ed.type)} instead`);if(4===eo.length){let e_=ec.parse(eo[3],3,td);return e_?new yn(ed.type,ed,em,e_):null}return new yn(ed.type,ed,em)}evaluate(eo){let ec=this.input.evaluate(eo),ed=this.beginIndex.evaluate(eo);if(!Ae(ec,["string","array"]))throw new tS(`Expected first argument to be of type array or string, but found ${ve(Re(ec))} instead.`);if(this.endIndex){let em=this.endIndex.evaluate(eo);return ec.slice(ed,em)}return ec.slice(ed)}eachChild(eo){eo(this.input),eo(this.beginIndex),this.endIndex&&eo(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){let eo=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),eo]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}};function gn(eo,ec){return"=="===eo||"!="===eo?"boolean"===ec.kind||"string"===ec.kind||"number"===ec.kind||"null"===ec.kind||"value"===ec.kind:"string"===ec.kind||"number"===ec.kind||"value"===ec.kind}function xn(eo,ec,ed,em){return 0===em.compare(ec,ed)}function vn(eo,ec,ed){let em="=="!==eo&&"!="!==eo;return class i{constructor(eo,ec,ed){this.type=tm,this.lhs=eo,this.rhs=ec,this.collator=ed,this.hasUntypedArgument="value"===eo.type.kind||"value"===ec.type.kind}static parse(eo,ec){if(3!==eo.length&&4!==eo.length)return ec.error("Expected two or three arguments.");let ed=eo[0],e_=ec.parse(eo[1],1,tx);if(!e_)return null;if(!gn(ed,e_.type))return ec.concat(1).error(`"${ed}" comparisons are not supported for type '${ve(e_.type)}'.`);let eg=ec.parse(eo[2],2,tx);if(!eg)return null;if(!gn(ed,eg.type))return ec.concat(2).error(`"${ed}" comparisons are not supported for type '${ve(eg.type)}'.`);if(e_.type.kind!==eg.type.kind&&"value"!==e_.type.kind&&"value"!==eg.type.kind)return ec.error(`Cannot compare types '${ve(e_.type)}' and '${ve(eg.type)}'.`);em&&("value"===e_.type.kind&&"value"!==eg.type.kind?e_=new Ne(eg.type,[e_]):"value"!==e_.type.kind&&"value"===eg.type.kind&&(eg=new Ne(e_.type,[eg])));let ex=null;if(4===eo.length){if("string"!==e_.type.kind&&"string"!==eg.type.kind&&"value"!==e_.type.kind&&"value"!==eg.type.kind)return ec.error("Cannot use collator to compare non-string types.");if(!(ex=ec.parse(eo[3],3,tv)))return null}return new i(e_,eg,ex)}evaluate(e_){let eg=this.lhs.evaluate(e_),ex=this.rhs.evaluate(e_);if(em&&this.hasUntypedArgument){let ec=Re(eg),ed=Re(ex);if(ec.kind!==ed.kind||"string"!==ec.kind&&"number"!==ec.kind)throw new tS(`Expected arguments for "${eo}" to be (string, string) or (number, number), but found (${ec.kind}, ${ed.kind}) instead.`)}if(this.collator&&!em&&this.hasUntypedArgument){let eo=Re(eg),ed=Re(ex);if("string"!==eo.kind||"string"!==ed.kind)return ec(e_,eg,ex)}return this.collator?ed(e_,eg,ex,this.collator.evaluate(e_)):ec(e_,eg,ex)}eachChild(eo){eo(this.lhs),eo(this.rhs),this.collator&&eo(this.collator)}outputDefined(){return!0}serialize(){let ec=[eo];return this.eachChild(eo=>{ec.push(eo.serialize())}),ec}}}let tj=vn("==",function(eo,ec,ed){return ec===ed},xn),tG=vn("!=",function(eo,ec,ed){return ec!==ed},function(eo,ec,ed,em){return!xn(0,ec,ed,em)}),tZ=vn("<",function(eo,ec,ed){return ec<ed},function(eo,ec,ed,em){return 0>em.compare(ec,ed)}),t$=vn(">",function(eo,ec,ed){return ec>ed},function(eo,ec,ed,em){return em.compare(ec,ed)>0}),tq=vn("<=",function(eo,ec,ed){return ec<=ed},function(eo,ec,ed,em){return 0>=em.compare(ec,ed)}),tX=vn(">=",function(eo,ec,ed){return ec>=ed},function(eo,ec,ed,em){return em.compare(ec,ed)>=0});let In=class In{constructor(eo,ec,ed,em,e_,eg){this.type=tp,this.number=eo,this.locale=ec,this.currency=ed,this.unit=em,this.minFractionDigits=e_,this.maxFractionDigits=eg}static parse(eo,ec){if(3!==eo.length)return ec.error("Expected two arguments.");let ed=ec.parse(eo[1],1,td);if(!ed)return null;let em=eo[2];if("object"!=typeof em||Array.isArray(em))return ec.error("NumberFormat options argument must be an object.");let e_=null;if(em.locale&&!(e_=ec.parse(em.locale,1,tp)))return null;let eg=null;if(em.currency&&!(eg=ec.parse(em.currency,1,tp)))return null;let ex=null;if(em.unit&&!(ex=ec.parse(em.unit,1,tp)))return null;let ev=null;if(em["min-fraction-digits"]&&!(ev=ec.parse(em["min-fraction-digits"],1,td)))return null;let eb=null;return!em["max-fraction-digits"]||(eb=ec.parse(em["max-fraction-digits"],1,td))?new In(ed,e_,eg,ex,ev,eb):null}evaluate(eo){return new Intl.NumberFormat(this.locale?this.locale.evaluate(eo):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(eo):void 0,unit:this.unit?this.unit.evaluate(eo):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(eo):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(eo):void 0}).format(this.number.evaluate(eo))}eachChild(eo){eo(this.number),this.locale&&eo(this.locale),this.currency&&eo(this.currency),this.unit&&eo(this.unit),this.minFractionDigits&&eo(this.minFractionDigits),this.maxFractionDigits&&eo(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let eo={};return this.locale&&(eo.locale=this.locale.serialize()),this.currency&&(eo.currency=this.currency.serialize()),this.unit&&(eo.unit=this.unit.serialize()),this.minFractionDigits&&(eo["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(eo["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),eo]}};let Mn=class Mn{constructor(eo){this.type=td,this.input=eo}static parse(eo,ec){if(2!==eo.length)return ec.error(`Expected 1 argument, but found ${eo.length-1} instead.`);let ed=ec.parse(eo[1],1);return ed?"array"!==ed.type.kind&&"string"!==ed.type.kind&&"value"!==ed.type.kind?ec.error(`Expected argument of type string or array, but found ${ve(ed.type)} instead.`):new Mn(ed):null}evaluate(eo){let ec=this.input.evaluate(eo);if("string"==typeof ec||Array.isArray(ec))return ec.length;throw new tS(`Expected value to be of type string or array, but found ${ve(Re(ec))} instead.`)}eachChild(eo){eo(this.input)}outputDefined(){return!1}serialize(){let eo=["length"];return this.eachChild(ec=>{eo.push(ec.serialize())}),eo}};let tW={"==":tj,"!=":tG,">":t$,"<":tZ,">=":tX,"<=":tq,array:Ne,at:sn,boolean:Ne,case:dn,coalesce:tn,collator:er,format:Ze,image:Ke,in:on,"index-of":un,interpolate:Yr,"interpolate-hcl":Yr,"interpolate-lab":Yr,length:Mn,let:rn,literal:$e,match:hn,number:Ne,"number-format":In,object:Ne,slice:yn,step:zr,string:Ne,"to-boolean":Je,"to-color":Je,"to-number":Je,"to-string":Je,var:Ar,within:xr};function zn(eo,[ec,ed,em,e_]){ec=ec.evaluate(eo),ed=ed.evaluate(eo),em=em.evaluate(eo);let eg=e_?e_.evaluate(eo):1,ex=Le(ec,ed,em,eg);if(ex)throw new tS(ex);return new Be(ec/255*eg,ed/255*eg,em/255*eg,eg)}function En(eo,ec){let ed=ec[eo];return void 0===ed?null:ed}function Cn(eo){return{type:eo}}function Dn(eo){return{result:"success",value:eo}}function Vn(eo){return{result:"error",value:eo}}function Ln(eo){return"data-driven"===eo["property-type"]}function Fn(eo){return!!eo.expression&&eo.expression.parameters.indexOf("zoom")>-1}function Rn(eo){return!!eo.expression&&eo.expression.interpolated}function Un(eo){return eo instanceof Number?"number":eo instanceof String?"string":eo instanceof Boolean?"boolean":Array.isArray(eo)?"array":null===eo?"null":typeof eo}function $n(eo){return"object"==typeof eo&&null!==eo&&!Array.isArray(eo)}function jn(eo){return eo}function qn(eo,ec,ed){return void 0!==eo?eo:void 0!==ec?ec:void 0!==ed?ed:void 0}function Nn(eo,ec,ed,em,e_){return qn(typeof ed===e_?em[ed]:void 0,eo.default,ec.default)}function Gn(eo,ec,ed){if("number"!==Un(ed))return qn(eo.default,ec.default);let em=eo.stops.length;if(1===em||ed<=eo.stops[0][0])return eo.stops[0][1];if(ed>=eo.stops[em-1][0])return eo.stops[em-1][1];let e_=Tr(eo.stops.map(eo=>eo[0]),ed);return eo.stops[e_][1]}function Zn(eo,ec,ed){let em=void 0!==eo.base?eo.base:1;if("number"!==Un(ed))return qn(eo.default,ec.default);let e_=eo.stops.length;if(1===e_||ed<=eo.stops[0][0])return eo.stops[0][1];if(ed>=eo.stops[e_-1][0])return eo.stops[e_-1][1];let eg=Tr(eo.stops.map(eo=>eo[0]),ed),ex=function(eo,ec,ed,em){let e_=em-ed,eg=eo-ed;return 0===e_?0:1===ec?eg/e_:(Math.pow(ec,eg)-1)/(Math.pow(ec,e_)-1)}(ed,em,eo.stops[eg][0],eo.stops[eg+1][0]),ev=eo.stops[eg][1],eb=eo.stops[eg+1][1],ew=tD[ec.type]||jn;if(eo.colorSpace&&"rgb"!==eo.colorSpace){let ec=tV[eo.colorSpace];ew=(eo,ed)=>ec.reverse(ec.interpolate(ec.forward(eo),ec.forward(ed),ex))}return"function"==typeof ev.evaluate?{evaluate(...eo){let ec=ev.evaluate.apply(void 0,eo),ed=eb.evaluate.apply(void 0,eo);if(void 0!==ec&&void 0!==ed)return ew(ec,ed,ex)}}:ew(ev,eb,ex)}function Kn(eo,ec,ed){return"color"===ec.type?ed=Be.parse(ed):"formatted"===ec.type?ed=De.fromString(ed.toString()):"resolvedImage"===ec.type?ed=Ve.fromString(ed.toString()):Un(ed)===ec.type||"enum"===ec.type&&ec.values[ed]||(ed=void 0),qn(ed,eo.default,ec.default)}Qe.register(tW,{error:[{kind:"error"},[tp],(eo,[ec])=>{throw new tS(ec.evaluate(eo))}],typeof:[tp,[tx],(eo,[ec])=>ve(Re(ec.evaluate(eo)))],"to-rgba":[xe(td,4),[t_],(eo,[ec])=>ec.evaluate(eo).toArray()],rgb:[t_,[td,td,td],zn],rgba:[t_,[td,td,td,td],zn],has:{type:tm,overloads:[[[tp],(eo,[ec])=>ec.evaluate(eo) in eo.properties()],[[tp,tg],(eo,[ec,ed])=>ec.evaluate(eo) in ed.evaluate(eo)]]},get:{type:tx,overloads:[[[tp],(eo,[ec])=>En(ec.evaluate(eo),eo.properties())],[[tp,tg],(eo,[ec,ed])=>En(ec.evaluate(eo),ed.evaluate(eo))]]},"feature-state":[tx,[tp],(eo,[ec])=>En(ec.evaluate(eo),eo.featureState||{})],properties:[tg,[],eo=>eo.properties()],"geometry-type":[tp,[],eo=>eo.geometryType()],id:[tx,[],eo=>eo.id()],zoom:[td,[],eo=>eo.globals.zoom],pitch:[td,[],eo=>eo.globals.pitch||0],"distance-from-center":[td,[],eo=>eo.distanceFromCenter()],"heatmap-density":[td,[],eo=>eo.globals.heatmapDensity||0],"line-progress":[td,[],eo=>eo.globals.lineProgress||0],"sky-radial-progress":[td,[],eo=>eo.globals.skyRadialProgress||0],accumulated:[tx,[],eo=>void 0===eo.globals.accumulated?null:eo.globals.accumulated],"+":[td,Cn(td),(eo,ec)=>{let ed=0;for(let em of ec)ed+=em.evaluate(eo);return ed}],"*":[td,Cn(td),(eo,ec)=>{let ed=1;for(let em of ec)ed*=em.evaluate(eo);return ed}],"-":{type:td,overloads:[[[td,td],(eo,[ec,ed])=>ec.evaluate(eo)-ed.evaluate(eo)],[[td],(eo,[ec])=>-ec.evaluate(eo)]]},"/":[td,[td,td],(eo,[ec,ed])=>ec.evaluate(eo)/ed.evaluate(eo)],"%":[td,[td,td],(eo,[ec,ed])=>ec.evaluate(eo)%ed.evaluate(eo)],ln2:[td,[],()=>Math.LN2],pi:[td,[],()=>Math.PI],e:[td,[],()=>Math.E],"^":[td,[td,td],(eo,[ec,ed])=>Math.pow(ec.evaluate(eo),ed.evaluate(eo))],sqrt:[td,[td],(eo,[ec])=>Math.sqrt(ec.evaluate(eo))],log10:[td,[td],(eo,[ec])=>Math.log(ec.evaluate(eo))/Math.LN10],ln:[td,[td],(eo,[ec])=>Math.log(ec.evaluate(eo))],log2:[td,[td],(eo,[ec])=>Math.log(ec.evaluate(eo))/Math.LN2],sin:[td,[td],(eo,[ec])=>Math.sin(ec.evaluate(eo))],cos:[td,[td],(eo,[ec])=>Math.cos(ec.evaluate(eo))],tan:[td,[td],(eo,[ec])=>Math.tan(ec.evaluate(eo))],asin:[td,[td],(eo,[ec])=>Math.asin(ec.evaluate(eo))],acos:[td,[td],(eo,[ec])=>Math.acos(ec.evaluate(eo))],atan:[td,[td],(eo,[ec])=>Math.atan(ec.evaluate(eo))],min:[td,Cn(td),(eo,ec)=>Math.min(...ec.map(ec=>ec.evaluate(eo)))],max:[td,Cn(td),(eo,ec)=>Math.max(...ec.map(ec=>ec.evaluate(eo)))],abs:[td,[td],(eo,[ec])=>Math.abs(ec.evaluate(eo))],round:[td,[td],(eo,[ec])=>{let ed=ec.evaluate(eo);return ed<0?-Math.round(-ed):Math.round(ed)}],floor:[td,[td],(eo,[ec])=>Math.floor(ec.evaluate(eo))],ceil:[td,[td],(eo,[ec])=>Math.ceil(ec.evaluate(eo))],"filter-==":[tm,[tp,tx],(eo,[ec,ed])=>eo.properties()[ec.value]===ed.value],"filter-id-==":[tm,[tx],(eo,[ec])=>eo.id()===ec.value],"filter-type-==":[tm,[tp],(eo,[ec])=>eo.geometryType()===ec.value],"filter-<":[tm,[tp,tx],(eo,[ec,ed])=>{let em=eo.properties()[ec.value],e_=ed.value;return typeof em==typeof e_&&em<e_}],"filter-id-<":[tm,[tx],(eo,[ec])=>{let ed=eo.id(),em=ec.value;return typeof ed==typeof em&&ed<em}],"filter->":[tm,[tp,tx],(eo,[ec,ed])=>{let em=eo.properties()[ec.value],e_=ed.value;return typeof em==typeof e_&&em>e_}],"filter-id->":[tm,[tx],(eo,[ec])=>{let ed=eo.id(),em=ec.value;return typeof ed==typeof em&&ed>em}],"filter-<=":[tm,[tp,tx],(eo,[ec,ed])=>{let em=eo.properties()[ec.value],e_=ed.value;return typeof em==typeof e_&&em<=e_}],"filter-id-<=":[tm,[tx],(eo,[ec])=>{let ed=eo.id(),em=ec.value;return typeof ed==typeof em&&ed<=em}],"filter->=":[tm,[tp,tx],(eo,[ec,ed])=>{let em=eo.properties()[ec.value],e_=ed.value;return typeof em==typeof e_&&em>=e_}],"filter-id->=":[tm,[tx],(eo,[ec])=>{let ed=eo.id(),em=ec.value;return typeof ed==typeof em&&ed>=em}],"filter-has":[tm,[tx],(eo,[ec])=>ec.value in eo.properties()],"filter-has-id":[tm,[],eo=>null!==eo.id()&&void 0!==eo.id()],"filter-type-in":[tm,[xe(tp)],(eo,[ec])=>ec.value.indexOf(eo.geometryType())>=0],"filter-id-in":[tm,[xe(tx)],(eo,[ec])=>ec.value.indexOf(eo.id())>=0],"filter-in-small":[tm,[tp,xe(tx)],(eo,[ec,ed])=>ed.value.indexOf(eo.properties()[ec.value])>=0],"filter-in-large":[tm,[tp,xe(tx)],(eo,[ec,ed])=>(function(eo,ec,ed,em){for(;ed<=em;){let e_=ed+em>>1;if(ec[e_]===eo)return!0;ec[e_]>eo?em=e_-1:ed=e_+1}return!1})(eo.properties()[ec.value],ed.value,0,ed.value.length-1)],all:{type:tm,overloads:[[[tm,tm],(eo,[ec,ed])=>ec.evaluate(eo)&&ed.evaluate(eo)],[Cn(tm),(eo,ec)=>{for(let ed of ec)if(!ed.evaluate(eo))return!1;return!0}]]},any:{type:tm,overloads:[[[tm,tm],(eo,[ec,ed])=>ec.evaluate(eo)||ed.evaluate(eo)],[Cn(tm),(eo,ec)=>{for(let ed of ec)if(ed.evaluate(eo))return!0;return!1}]]},"!":[tm,[tm],(eo,[ec])=>!ec.evaluate(eo)],"is-supported-script":[tm,[tp],(eo,[ec])=>{let ed=eo.globals&&eo.globals.isSupportedScript;return!ed||ed(ec.evaluate(eo))}],upcase:[tp,[tp],(eo,[ec])=>ec.evaluate(eo).toUpperCase()],downcase:[tp,[tp],(eo,[ec])=>ec.evaluate(eo).toLowerCase()],concat:[tp,Cn(tx),(eo,ec)=>ec.map(ec=>Ue(ec.evaluate(eo))).join("")],"resolved-locale":[tp,[tv],(eo,[ec])=>ec.evaluate(eo).resolvedLocale()]});let Xn=class Xn{constructor(eo,ec){this.expression=eo,this._warningHistory={},this._evaluator=new tP,this._defaultValue=ec?"color"===ec.type&&($n(ec.default)||Array.isArray(ec.default))?new Be(0,0,0,0):"color"===ec.type?Be.parse(ec.default)||null:void 0===ec.default?null:ec.default:null,this._enumValues=ec&&"enum"===ec.type?ec.values:null}evaluateWithoutErrorHandling(eo,ec,ed,em,e_,eg,ex,ev){return this._evaluator.globals=eo,this._evaluator.feature=ec,this._evaluator.featureState=ed,this._evaluator.canonical=em||null,this._evaluator.availableImages=e_||null,this._evaluator.formattedSection=eg,this._evaluator.featureTileCoord=ex||null,this._evaluator.featureDistanceData=ev||null,this.expression.evaluate(this._evaluator)}evaluate(eo,ec,ed,em,e_,eg,ex,ev){this._evaluator.globals=eo,this._evaluator.feature=ec||null,this._evaluator.featureState=ed||null,this._evaluator.canonical=em||null,this._evaluator.availableImages=e_||null,this._evaluator.formattedSection=eg||null,this._evaluator.featureTileCoord=ex||null,this._evaluator.featureDistanceData=ev||null;try{let eo=this.expression.evaluate(this._evaluator);if(null==eo||"number"==typeof eo&&eo!=eo)return this._defaultValue;if(this._enumValues&&!(eo in this._enumValues))throw new tS(`Expected value to be one of ${Object.keys(this._enumValues).map(eo=>JSON.stringify(eo)).join(", ")}, but found ${JSON.stringify(eo)} instead.`);return eo}catch(eo){return this._warningHistory[eo.message]||(this._warningHistory[eo.message]=!0,"undefined"!=typeof console&&console.warn(eo.message)),this._defaultValue}}};function Jn(eo){return Array.isArray(eo)&&eo.length>0&&"string"==typeof eo[0]&&eo[0]in tW}function Hn(eo,ec){let ed=new tz(tW,[],ec?function(eo){let ec={color:t_,string:tp,number:td,enum:tp,boolean:tm,formatted:tb,resolvedImage:tw};return"array"===eo.type?xe(ec[eo.value]||tx,eo.length):ec[eo.type]}(ec):void 0),em=ed.parse(eo,void 0,void 0,void 0,ec&&"string"===ec.type?{typeAnnotation:"coerce"}:void 0);return em?Dn(new Xn(em,ec)):Vn(ed.errors)}let Yn=class Yn{constructor(eo,ec){this.kind=eo,this._styleExpression=ec,this.isStateDependent="constant"!==eo&&!wr(ec.expression)}evaluateWithoutErrorHandling(eo,ec,ed,em,e_,eg){return this._styleExpression.evaluateWithoutErrorHandling(eo,ec,ed,em,e_,eg)}evaluate(eo,ec,ed,em,e_,eg){return this._styleExpression.evaluate(eo,ec,ed,em,e_,eg)}};let Wn=class Wn{constructor(eo,ec,ed,em){this.kind=eo,this.zoomStops=ed,this._styleExpression=ec,this.isStateDependent="camera"!==eo&&!wr(ec.expression),this.interpolationType=em}evaluateWithoutErrorHandling(eo,ec,ed,em,e_,eg){return this._styleExpression.evaluateWithoutErrorHandling(eo,ec,ed,em,e_,eg)}evaluate(eo,ec,ed,em,e_,eg){return this._styleExpression.evaluate(eo,ec,ed,em,e_,eg)}interpolationFactor(eo,ec,ed){return this.interpolationType?Yr.interpolationFactor(this.interpolationType,eo,ec,ed):0}};function Qn(eo,ec){if("error"===(eo=Hn(eo,ec)).result)return eo;let ed=eo.value.expression,em=br(ed);if(!em&&!Ln(ec))return Vn([new ts("","data expressions not supported")]);let e_=_r(ed,["zoom","pitch","distance-from-center"]);if(!e_&&!Fn(ec))return Vn([new ts("","zoom expressions not supported")]);let eg=function ei(eo){let ec=null;if(eo instanceof rn)ec=ei(eo.result);else if(eo instanceof tn){for(let ed of eo.args)if(ec=ei(ed))break}else(eo instanceof zr||eo instanceof Yr)&&eo.input instanceof Qe&&"zoom"===eo.input.name&&(ec=eo);return ec instanceof ts||eo.eachChild(eo=>{let ed=ei(eo);ed instanceof ts?ec=ed:!ec&&ed?ec=new ts("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):ec&&ed&&ec!==ed&&(ec=new ts("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),ec}(ed);return eg||e_?eg instanceof ts?Vn([eg]):eg instanceof Yr&&!Rn(ec)?Vn([new ts("",'"interpolate" expressions cannot be used with this property')]):Dn(eg?new Wn(em?"camera":"composite",eo.value,eg.labels,eg instanceof Yr?eg.interpolation:void 0):new Yn(em?"constant":"source",eo.value)):Vn([new ts("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}let ti=class ti{constructor(eo,ec){this._parameters=eo,this._specification=ec,ee(this,function On(eo,ec){let ed,em,e_;let eg="color"===ec.type,ex=eo.stops&&"object"==typeof eo.stops[0][0],ev=ex||!(ex||void 0!==eo.property),eb=eo.type||(Rn(ec)?"exponential":"interval");if(eg&&((eo=ee({},eo)).stops&&(eo.stops=eo.stops.map(eo=>[eo[0],Be.parse(eo[1])])),eo.default=Be.parse(eo.default?eo.default:ec.default)),eo.colorSpace&&"rgb"!==eo.colorSpace&&!tV[eo.colorSpace])throw Error(`Unknown color space: ${eo.colorSpace}`);if("exponential"===eb)ed=Zn;else if("interval"===eb)ed=Gn;else if("categorical"===eb){for(let ec of(ed=Nn,em=Object.create(null),eo.stops))em[ec[0]]=ec[1];e_=typeof eo.stops[0][0]}else{if("identity"!==eb)throw Error(`Unknown function type "${eb}"`);ed=Kn}if(ex){let ed={},em=[];for(let ec=0;ec<eo.stops.length;ec++){let e_=eo.stops[ec],eg=e_[0].zoom;void 0===ed[eg]&&(ed[eg]={zoom:eg,type:eo.type,property:eo.property,default:eo.default,stops:[]},em.push(eg)),ed[eg].stops.push([e_[0].value,e_[1]])}let e_=[];for(let eo of em)e_.push([ed[eo].zoom,On(ed[eo],ec)]);let eg={name:"linear"};return{kind:"composite",interpolationType:eg,interpolationFactor:Yr.interpolationFactor.bind(void 0,eg),zoomStops:e_.map(eo=>eo[0]),evaluate:({zoom:ed},em)=>Zn({stops:e_,base:eo.base},ec,ed).evaluate(ed,em)}}if(ev){let eg="exponential"===eb?{name:"exponential",base:void 0!==eo.base?eo.base:1}:null;return{kind:"camera",interpolationType:eg,interpolationFactor:Yr.interpolationFactor.bind(void 0,eg),zoomStops:eo.stops.map(eo=>eo[0]),evaluate:({zoom:eg})=>ed(eo,ec,eg,em,e_)}}return{kind:"source",evaluate(eg,ex){let ev=ex&&ex.properties?ex.properties[eo.property]:void 0;return void 0===ev?qn(eo.default,ec.default):ed(eo,ec,ev,em,e_)}}}(this._parameters,this._specification))}static deserialize(eo){return new ti(eo._parameters,eo._specification)}static serialize(eo){return{_parameters:eo._parameters,_specification:eo._specification}}};let ri=class ri{constructor(eo,ec,ed,em){this.message=(eo?`${eo}: `:"")+ed,em&&(this.identifier=em),null!=ec&&ec.__line__&&(this.line=ec.__line__)}};function ni(eo){let ec=eo.key,ed=eo.value,em=eo.valueSpec||{},e_=eo.objectElementValidators||{},eg=eo.style,ex=eo.styleSpec,ev=[],eb=Un(ed);if("object"!==eb)return[new ri(ec,ed,`object expected, ${eb} found`)];for(let eo in ed){let eb;let ew=eo.split(".")[0];e_[ew]?eb=e_[ew]:em[ew]?eb=Fi:e_["*"]?eb=e_["*"]:em["*"]&&(eb=Fi),eb?ev=ev.concat(eb({key:(ec?`${ec}.`:ec)+eo,value:ed[eo],valueSpec:em[ew]||em["*"],style:eg,styleSpec:ex,object:ed,objectKey:eo},ed)):ev.push(new ri(ec,ed[eo],`unknown property "${eo}"`))}for(let eo in em)e_[eo]||em[eo].required&&void 0===em[eo].default&&void 0===ed[eo]&&ev.push(new ri(ec,ed,`missing required property "${eo}"`));return ev}function ii(eo){let ec=eo.value,ed=eo.valueSpec,em=eo.style,e_=eo.styleSpec,eg=eo.key,ex=eo.arrayElementValidator||Fi;if("array"!==Un(ec))return[new ri(eg,ec,`array expected, ${Un(ec)} found`)];if(ed.length&&ec.length!==ed.length)return[new ri(eg,ec,`array length ${ed.length} expected, length ${ec.length} found`)];if(ed["min-length"]&&ec.length<ed["min-length"])return[new ri(eg,ec,`array length at least ${ed["min-length"]} expected, length ${ec.length} found`)];let ev={type:ed.value,values:ed.values,minimum:ed.minimum,maximum:ed.maximum,function:void 0};e_.$version<7&&(ev.function=ed.function),"object"===Un(ed.value)&&(ev=ed.value);let eb=[];for(let eo=0;eo<ec.length;eo++)eb=eb.concat(ex({array:ec,arrayIndex:eo,value:ec[eo],valueSpec:ev,style:em,styleSpec:e_,key:`${eg}[${eo}]`}));return eb}function si(eo){let ec=eo.key,ed=eo.value,em=eo.valueSpec,e_=Un(ed);if("number"===e_&&ed!=ed&&(e_="NaN"),"number"!==e_)return[new ri(ec,ed,`number expected, ${e_} found`)];if("minimum"in em){let e_=em.minimum;if("array"===Un(em.minimum)&&(e_=em.minimum[eo.arrayIndex]),ed<e_)return[new ri(ec,ed,`${ed} is less than the minimum value ${e_}`)]}if("maximum"in em){let e_=em.maximum;if("array"===Un(em.maximum)&&(e_=em.maximum[eo.arrayIndex]),ed>e_)return[new ri(ec,ed,`${ed} is greater than the maximum value ${e_}`)]}return[]}function ai(eo){let ec=eo.valueSpec,ed=re(eo.value.type),em,e_,eg,ex={},ev="categorical"!==ed&&void 0===eo.value.property,eb="array"===Un(eo.value.stops)&&"array"===Un(eo.value.stops[0])&&"object"===Un(eo.value.stops[0][0]),ew=ni({key:eo.key,value:eo.value,valueSpec:eo.styleSpec.function,style:eo.style,styleSpec:eo.styleSpec,objectElementValidators:{stops:function(eo){if("identity"===ed)return[new ri(eo.key,eo.value,'identity function may not have a "stops" property')];let ec=[],em=eo.value;return ec=ec.concat(ii({key:eo.key,value:em,valueSpec:eo.valueSpec,style:eo.style,styleSpec:eo.styleSpec,arrayElementValidator:h})),"array"===Un(em)&&0===em.length&&ec.push(new ri(eo.key,em,"array must have at least one stop")),ec},default:function(eo){return Fi({key:eo.key,value:eo.value,valueSpec:ec,style:eo.style,styleSpec:eo.styleSpec})}}});return"identity"===ed&&ev&&ew.push(new ri(eo.key,eo.value,'missing required property "property"')),"identity"===ed||eo.value.stops||ew.push(new ri(eo.key,eo.value,'missing required property "stops"')),"exponential"===ed&&eo.valueSpec.expression&&!Rn(eo.valueSpec)&&ew.push(new ri(eo.key,eo.value,"exponential functions not supported")),eo.styleSpec.$version>=8&&(ev||Ln(eo.valueSpec)?ev&&!Fn(eo.valueSpec)&&ew.push(new ri(eo.key,eo.value,"zoom functions not supported")):ew.push(new ri(eo.key,eo.value,"property functions not supported"))),("categorical"===ed||eb)&&void 0===eo.value.property&&ew.push(new ri(eo.key,eo.value,'"property" property is required')),ew;function h(eo){let ed=[],em=eo.value,ev=eo.key;if("array"!==Un(em))return[new ri(ev,em,`array expected, ${Un(em)} found`)];if(2!==em.length)return[new ri(ev,em,`array length 2 expected, length ${em.length} found`)];if(eb){if("object"!==Un(em[0]))return[new ri(ev,em,`object expected, ${Un(em[0])} found`)];if(void 0===em[0].zoom)return[new ri(ev,em,"object stop key must have zoom")];if(void 0===em[0].value)return[new ri(ev,em,"object stop key must have value")];let ec=re(em[0].zoom);if("number"!=typeof ec)return[new ri(ev,em[0].zoom,"stop zoom values must be numbers")];if(eg&&eg>ec)return[new ri(ev,em[0].zoom,"stop zoom values must appear in ascending order")];ec!==eg&&(eg=ec,e_=void 0,ex={}),ed=ed.concat(ni({key:`${ev}[0]`,value:em[0],valueSpec:{zoom:{}},style:eo.style,styleSpec:eo.styleSpec,objectElementValidators:{zoom:si,value:p}}))}else ed=ed.concat(p({key:`${ev}[0]`,value:em[0],valueSpec:{},style:eo.style,styleSpec:eo.styleSpec},em));return Jn(ne(em[1]))?ed.concat([new ri(`${ev}[1]`,em[1],"expressions are not allowed in function stops.")]):ed.concat(Fi({key:`${ev}[1]`,value:em[1],valueSpec:ec,style:eo.style,styleSpec:eo.styleSpec}))}function p(eo,eg){let ev=Un(eo.value),eb=re(eo.value),ew=null!==eo.value?eo.value:eg;if(em){if(ev!==em)return[new ri(eo.key,ew,`${ev} stop domain type must match previous stop domain type ${em}`)]}else em=ev;if("number"!==ev&&"string"!==ev&&"boolean"!==ev&&"number"!=typeof eb&&"string"!=typeof eb&&"boolean"!=typeof eb)return[new ri(eo.key,ew,"stop domain value must be a number, string, or boolean")];if("number"!==ev&&"categorical"!==ed){let em=`number expected, ${ev} found`;return Ln(ec)&&void 0===ed&&(em+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new ri(eo.key,ew,em)]}return"categorical"!==ed||"number"!==ev||"number"==typeof eb&&isFinite(eb)&&Math.floor(eb)===eb?"categorical"!==ed&&"number"===ev&&"number"==typeof eb&&"number"==typeof e_&&void 0!==e_&&eb<e_?[new ri(eo.key,ew,"stop domain values must appear in ascending order")]:(e_=eb,"categorical"===ed&&eb in ex?[new ri(eo.key,ew,"stop domain values must be unique")]:(ex[eb]=!0,[])):[new ri(eo.key,ew,`integer expected, found ${String(eb)}`)]}}function oi(eo){let ec=("property"===eo.expressionContext?Qn:Hn)(ne(eo.value),eo.valueSpec);if("error"===ec.result)return ec.value.map(ec=>new ri(`${eo.key}${ec.key}`,eo.value,ec.message));let ed=ec.value.expression||ec.value._styleExpression.expression;if("property"===eo.expressionContext&&"text-font"===eo.propertyKey&&!ed.outputDefined())return[new ri(eo.key,eo.value,`Invalid data expression for "${eo.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===eo.expressionContext&&"layout"===eo.propertyType&&!wr(ed))return[new ri(eo.key,eo.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===eo.expressionContext)return function li(eo,ec){let ed=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(ec.valueSpec&&ec.valueSpec.expression)for(let eo of ec.valueSpec.expression.parameters)ed.delete(eo);if(0===ed.size)return[];let em=[];return eo instanceof Qe&&ed.has(eo.name)?[new ri(ec.key,ec.value,`["${eo.name}"] expression is not supported in a filter for a ${ec.object.type} layer with id: ${ec.object.id}`)]:(eo.eachChild(eo=>{em.push(...li(eo,ec))}),em)}(ed,eo);if(eo.expressionContext&&0===eo.expressionContext.indexOf("cluster")){if(!_r(ed,["zoom","feature-state"]))return[new ri(eo.key,eo.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===eo.expressionContext&&!br(ed))return[new ri(eo.key,eo.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ui(eo){let ec=eo.key,ed=eo.value,em=eo.valueSpec,e_=[];return Array.isArray(em.values)?-1===em.values.indexOf(re(ed))&&e_.push(new ri(ec,ed,`expected one of [${em.values.join(", ")}], ${JSON.stringify(ed)} found`)):-1===Object.keys(em.values).indexOf(re(ed))&&e_.push(new ri(ec,ed,`expected one of [${Object.keys(em.values).join(", ")}], ${JSON.stringify(ed)} found`)),e_}function ci(eo){if(!0===eo||!1===eo)return!0;if(!Array.isArray(eo)||0===eo.length)return!1;switch(eo[0]){case"has":return eo.length>=2&&"$id"!==eo[1]&&"$type"!==eo[1];case"in":return eo.length>=3&&("string"!=typeof eo[1]||Array.isArray(eo[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==eo.length||Array.isArray(eo[1])||Array.isArray(eo[2]);case"any":case"all":for(let ec of eo.slice(1))if(!ci(ec)&&"boolean"!=typeof ec)return!1;return!0;default:return!0}}function hi(eo,ec="fill"){if(null==eo)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ci(eo)||(eo=function xi(eo){if(!eo)return!0;let ec=eo[0];return eo.length<=1?"any"!==ec:"=="===ec?vi(eo[1],eo[2],"=="):"!="===ec?_i(vi(eo[1],eo[2],"==")):"<"===ec||">"===ec||"<="===ec||">="===ec?vi(eo[1],eo[2],ec):"any"===ec?["any"].concat(eo.slice(1).map(xi)):"all"===ec?["all"].concat(eo.slice(1).map(xi)):"none"===ec?["all"].concat(eo.slice(1).map(xi).map(_i)):"in"===ec?bi(eo[1],eo.slice(2)):"!in"===ec?_i(bi(eo[1],eo.slice(2))):"has"===ec?wi(eo[1]):"!has"===ec?_i(wi(eo[1])):"within"!==ec||eo}(eo));let ed=eo,em=!0;try{em=function(eo){if(!fi(eo))return eo;let ec=ne(eo);return function di(eo){let ec=!1,ed=[];if("case"===eo[0]){for(let em=1;em<eo.length-1;em+=2)ec=ec||fi(eo[em]),ed.push(eo[em+1]);ed.push(eo[eo.length-1])}else if("match"===eo[0]){ec=ec||fi(eo[1]);for(let ec=2;ec<eo.length-1;ec+=2)ed.push(eo[ec+1]);ed.push(eo[eo.length-1])}else if("step"===eo[0]){ec=ec||fi(eo[1]);for(let ec=1;ec<eo.length-1;ec+=2)ed.push(eo[ec+1])}ec&&(eo.length=0,eo.push("any",...ed));for(let ec=1;ec<eo.length;ec++)di(eo[ec])}(ec),ec=function pi(eo){if(!Array.isArray(eo))return eo;let ec=function(eo){if(tH.has(eo[0])){for(let ec=1;ec<eo.length;ec++)if(fi(eo[ec]))return!0}return eo}(eo);return!0===ec?ec:ec.map(eo=>pi(eo))}(ec)}(ed)}catch(eo){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(ed,null,2)}
        `)}let e_=tr[`filter_${ec}`],eg=Hn(em,e_),ex=null;if("error"===eg.result)throw Error(eg.value.map(eo=>`${eo.key}: ${eo.message}`).join(", "));ex=(eo,ec,ed)=>eg.value.evaluate(eo,ec,{},ed);let ev=null,eb=null;if(em!==ed){let eo=Hn(ed,e_);if("error"===eo.result)throw Error(eo.value.map(eo=>`${eo.key}: ${eo.message}`).join(", "));ev=(ec,ed,em,e_,eg)=>eo.value.evaluate(ec,ed,{},em,void 0,void 0,e_,eg),eb=!br(eo.value.expression)}return{filter:ex,dynamicFilter:ev||void 0,needGeometry:function gi(eo){if(!Array.isArray(eo))return!1;if("within"===eo[0])return!0;for(let ec=1;ec<eo.length;ec++)if(gi(eo[ec]))return!0;return!1}(em),needFeature:!!eb}}function fi(eo){var ec;if(!Array.isArray(eo))return!1;if("pitch"===(ec=eo[0])||"distance-from-center"===ec)return!0;for(let ec=1;ec<eo.length;ec++)if(fi(eo[ec]))return!0;return!1}let tH=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function mi(eo,ec){return eo<ec?-1:eo>ec?1:0}function vi(eo,ec,ed){switch(eo){case"$type":return[`filter-type-${ed}`,ec];case"$id":return[`filter-id-${ed}`,ec];default:return[`filter-${ed}`,eo,ec]}}function bi(eo,ec){if(0===ec.length)return!1;switch(eo){case"$type":return["filter-type-in",["literal",ec]];case"$id":return["filter-id-in",["literal",ec]];default:return ec.length>200&&!ec.some(eo=>typeof eo!=typeof ec[0])?["filter-in-large",eo,["literal",ec.sort(mi)]]:["filter-in-small",eo,["literal",ec]]}}function wi(eo){switch(eo){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",eo]}}function _i(eo){return["!",eo]}function Ai(eo){return ci(ne(eo.value))?oi(ee({},eo,{expressionContext:"filter",valueSpec:eo.styleSpec[`filter_${eo.layerType||"fill"}`]})):function Si(eo){let ec=eo.value,ed=eo.key;if("array"!==Un(ec))return[new ri(ed,ec,`array expected, ${Un(ec)} found`)];let em=eo.styleSpec,e_,eg=[];if(ec.length<1)return[new ri(ed,ec,"filter array must have at least 1 element")];switch(eg=eg.concat(ui({key:`${ed}[0]`,value:ec[0],valueSpec:em.filter_operator,style:eo.style,styleSpec:eo.styleSpec})),re(ec[0])){case"<":case"<=":case">":case">=":ec.length>=2&&"$type"===re(ec[1])&&eg.push(new ri(ed,ec,`"$type" cannot be use with operator "${ec[0]}"`));case"==":case"!=":3!==ec.length&&eg.push(new ri(ed,ec,`filter array for operator "${ec[0]}" must have 3 elements`));case"in":case"!in":ec.length>=2&&"string"!==(e_=Un(ec[1]))&&eg.push(new ri(`${ed}[1]`,ec[1],`string expected, ${e_} found`));for(let ex=2;ex<ec.length;ex++)e_=Un(ec[ex]),"$type"===re(ec[1])?eg=eg.concat(ui({key:`${ed}[${ex}]`,value:ec[ex],valueSpec:em.geometry_type,style:eo.style,styleSpec:eo.styleSpec})):"string"!==e_&&"number"!==e_&&"boolean"!==e_&&eg.push(new ri(`${ed}[${ex}]`,ec[ex],`string, number, or boolean expected, ${e_} found`));break;case"any":case"all":case"none":for(let em=1;em<ec.length;em++)eg=eg.concat(Si({key:`${ed}[${em}]`,value:ec[em],style:eo.style,styleSpec:eo.styleSpec}));break;case"has":case"!has":e_=Un(ec[1]),2!==ec.length?eg.push(new ri(ed,ec,`filter array for "${ec[0]}" operator must have 2 elements`)):"string"!==e_&&eg.push(new ri(`${ed}[1]`,ec[1],`string expected, ${e_} found`));break;case"within":e_=Un(ec[1]),2!==ec.length?eg.push(new ri(ed,ec,`filter array for "${ec[0]}" operator must have 2 elements`)):"object"!==e_&&eg.push(new ri(`${ed}[1]`,ec[1],`object expected, ${e_} found`))}return eg}(eo)}function ki(eo,ec){let ed;let em=eo.key,e_=eo.style,eg=eo.styleSpec,ex=eo.value,ev=eo.objectKey,eb=eg[`${ec}_${eo.layerType}`];if(!eb)return[];let ew=ev.match(/^(.*)-transition$/);if("paint"===ec&&ew&&eb[ew[1]]&&eb[ew[1]].transition)return Fi({key:em,value:ex,valueSpec:eg.transition,style:e_,styleSpec:eg});let eT=eo.valueSpec||eb[ev];if(!eT)return[new ri(em,ex,`unknown property "${ev}"`)];if("string"===Un(ex)&&Ln(eT)&&!eT.tokens&&(ed=/^{([^}]+)}$/.exec(ex))){let eo=`\`{ "type": "identity", "property": ${ed?JSON.stringify(ed[1]):'"_"'} }\``;return[new ri(em,ex,`"${ev}" does not support interpolation syntax
Use an identity property function instead: ${eo}.`)]}let eE=[];return"symbol"===eo.layerType&&("text-field"===ev&&e_&&!e_.glyphs&&eE.push(new ri(em,ex,'use of "text-field" requires a style "glyphs" property')),"text-font"===ev&&$n(ne(ex))&&"identity"===re(ex.type)&&eE.push(new ri(em,ex,'"text-font" does not support identity functions'))),eE.concat(Fi({key:eo.key,value:ex,valueSpec:eT,style:e_,styleSpec:eg,expressionContext:"property",propertyType:ec,propertyKey:ev}))}function Ii(eo){return ki(eo,"paint")}function Mi(eo){return ki(eo,"layout")}function Ti(eo){let ec=[],ed=eo.value,em=eo.key,e_=eo.style,eg=eo.styleSpec;ed.type||ed.ref||ec.push(new ri(em,ed,'either "type" or "ref" is required'));let ex=re(ed.type),ev=re(ed.ref);if(ed.id){let eg=re(ed.id);for(let ex=0;ex<eo.arrayIndex;ex++){let eo=e_.layers[ex];re(eo.id)===eg&&ec.push(new ri(em,ed.id,`duplicate layer id "${ed.id}", previously used at line ${eo.id.__line__}`))}}if("ref"in ed){let eo;["type","source","source-layer","filter","layout"].forEach(eo=>{eo in ed&&ec.push(new ri(em,ed[eo],`"${eo}" is prohibited for ref layers`))}),e_.layers.forEach(ec=>{re(ec.id)===ev&&(eo=ec)}),eo?eo.ref?ec.push(new ri(em,ed.ref,"ref cannot reference another ref layer")):ex=re(eo.type):"string"==typeof ev&&ec.push(new ri(em,ed.ref,`ref layer "${ev}" not found`))}else if("background"!==ex&&"sky"!==ex){if(ed.source){let eo=e_.sources&&e_.sources[ed.source],eg=eo&&re(eo.type);eo?"vector"===eg&&"raster"===ex?ec.push(new ri(em,ed.source,`layer "${ed.id}" requires a raster source`)):"raster"===eg&&"raster"!==ex?ec.push(new ri(em,ed.source,`layer "${ed.id}" requires a vector source`)):"vector"!==eg||ed["source-layer"]?"raster-dem"===eg&&"hillshade"!==ex?ec.push(new ri(em,ed.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"===ex&&ed.paint&&(ed.paint["line-gradient"]||ed.paint["line-trim-offset"])&&("geojson"!==eg||!eo.lineMetrics)&&ec.push(new ri(em,ed,`layer "${ed.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):ec.push(new ri(em,ed,`layer "${ed.id}" must specify a "source-layer"`)):ec.push(new ri(em,ed.source,`source "${ed.source}" not found`))}else ec.push(new ri(em,ed,'missing required property "source"'))}return ec=ec.concat(ni({key:em,value:ed,valueSpec:eg.layer,style:eo.style,styleSpec:eo.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Fi({key:`${em}.type`,value:ed.type,valueSpec:eg.layer.type,style:eo.style,styleSpec:eo.styleSpec,object:ed,objectKey:"type"}),filter:eo=>Ai(ee({layerType:ex},eo)),layout:eo=>ni({layer:ed,key:eo.key,value:eo.value,valueSpec:{},style:eo.style,styleSpec:eo.styleSpec,objectElementValidators:{"*":eo=>Mi(ee({layerType:ex},eo))}}),paint:eo=>ni({layer:ed,key:eo.key,value:eo.value,valueSpec:{},style:eo.style,styleSpec:eo.styleSpec,objectElementValidators:{"*":eo=>Ii(ee({layerType:ex},eo))}})}}))}function zi(eo){let ec=eo.value,ed=eo.key,em=Un(ec);return"string"!==em?[new ri(ed,ec,`string expected, ${em} found`)]:[]}let tJ={promoteId:function({key:eo,value:ec}){if("string"===Un(ec))return zi({key:eo,value:ec});{let ed=[];for(let em in ec)ed.push(...zi({key:`${eo}.${em}`,value:ec[em]}));return ed}}};function Ei(eo){let ec;let ed=eo.value,em=eo.key,e_=eo.styleSpec,eg=eo.style;if(!ed.type)return[new ri(em,ed,'"type" is required')];let ex=re(ed.type);switch(ex){case"vector":case"raster":case"raster-dem":return ni({key:em,value:ed,valueSpec:e_[`source_${ex.replace("-","_")}`],style:eo.style,styleSpec:e_,objectElementValidators:tJ});case"geojson":if(ec=ni({key:em,value:ed,valueSpec:e_.source_geojson,style:eg,styleSpec:e_,objectElementValidators:tJ}),ed.cluster)for(let eo in ed.clusterProperties){let[e_,eg]=ed.clusterProperties[eo],ex="string"==typeof e_?[e_,["accumulated"],["get",eo]]:e_;ec.push(...oi({key:`${em}.${eo}.map`,value:eg,expressionContext:"cluster-map"})),ec.push(...oi({key:`${em}.${eo}.reduce`,value:ex,expressionContext:"cluster-reduce"}))}return ec;case"video":return ni({key:em,value:ed,valueSpec:e_.source_video,style:eg,styleSpec:e_});case"image":return ni({key:em,value:ed,valueSpec:e_.source_image,style:eg,styleSpec:e_});case"canvas":return[new ri(em,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ui({key:`${em}.type`,value:ed.type,valueSpec:{values:e_.source.reduce((eo,ec)=>{let ed=e_[ec];return"enum"===ed.type.type&&(eo=eo.concat(Object.keys(ed.type.values))),eo},[])},style:eg,styleSpec:e_})}}function Pi(eo){let ec=eo.value,ed=eo.styleSpec,em=ed.light,e_=eo.style,eg=[],ex=Un(ec);if(void 0===ec)return eg;if("object"!==ex)return eg.concat([new ri("light",ec,`object expected, ${ex} found`)]);for(let eo in ec){let ex=eo.match(/^(.*)-transition$/);eg=eg.concat(ex&&em[ex[1]]&&em[ex[1]].transition?Fi({key:eo,value:ec[eo],valueSpec:ed.transition,style:e_,styleSpec:ed}):em[eo]?Fi({key:eo,value:ec[eo],valueSpec:em[eo],style:e_,styleSpec:ed}):[new ri(eo,ec[eo],`unknown property "${eo}"`)])}return eg}function Di(eo){let ec=eo.value,ed=eo.key,em=eo.style,e_=eo.styleSpec,eg=e_.terrain,ex=[],ev=Un(ec);if(void 0===ec)return ex;if("object"!==ev)return ex.concat([new ri("terrain",ec,`object expected, ${ev} found`)]);for(let eo in ec){let ed=eo.match(/^(.*)-transition$/);ex=ex.concat(ed&&eg[ed[1]]&&eg[ed[1]].transition?Fi({key:eo,value:ec[eo],valueSpec:e_.transition,style:em,styleSpec:e_}):eg[eo]?Fi({key:eo,value:ec[eo],valueSpec:eg[eo],style:em,styleSpec:e_}):[new ri(eo,ec[eo],`unknown property "${eo}"`)])}if(ec.source){let eo=em.sources&&em.sources[ec.source],e_=eo&&re(eo.type);eo?"raster-dem"!==e_&&ex.push(new ri(ed,ec.source,`terrain cannot be used with a source of type ${String(e_)}, it only be used with a "raster-dem" source type`)):ex.push(new ri(ed,ec.source,`source "${ec.source}" not found`))}else ex.push(new ri(ed,ec,'terrain is missing required property "source"'));return ex}function Vi(eo){let ec=eo.value,ed=eo.style,em=eo.styleSpec,e_=em.fog,eg=[],ex=Un(ec);if(void 0===ec)return eg;if("object"!==ex)return eg.concat([new ri("fog",ec,`object expected, ${ex} found`)]);for(let eo in ec){let ex=eo.match(/^(.*)-transition$/);eg=eg.concat(ex&&e_[ex[1]]&&e_[ex[1]].transition?Fi({key:eo,value:ec[eo],valueSpec:em.transition,style:ed,styleSpec:em}):e_[eo]?Fi({key:eo,value:ec[eo],valueSpec:e_[eo],style:ed,styleSpec:em}):[new ri(eo,ec[eo],`unknown property "${eo}"`)])}return eg}let tY={"*":()=>[],array:ii,boolean:function(eo){let ec=eo.value,ed=eo.key,em=Un(ec);return"boolean"!==em?[new ri(ed,ec,`boolean expected, ${em} found`)]:[]},number:si,color:function(eo){let ec=eo.key,ed=eo.value,em=Un(ed);return"string"!==em?[new ri(ec,ed,`color expected, ${em} found`)]:null===tE(ed)?[new ri(ec,ed,`color expected, "${ed}" found`)]:[]},enum:ui,filter:Ai,function:ai,layer:Ti,object:ni,source:Ei,light:Pi,terrain:Di,fog:Vi,string:zi,formatted:function(eo){return 0===zi(eo).length?[]:oi(eo)},resolvedImage:function(eo){return 0===zi(eo).length?[]:oi(eo)},projection:function(eo){let ec=eo.value,ed=eo.styleSpec,em=ed.projection,e_=eo.style,eg=[],ex=Un(ec);if("object"===ex)for(let eo in ec)eg=eg.concat(Fi({key:eo,value:ec[eo],valueSpec:em[eo],style:e_,styleSpec:ed}));else"string"!==ex&&(eg=eg.concat([new ri("projection",ec,`object or string expected, ${ex} found`)]));return eg}};function Fi(eo){let ec=eo.value,ed=eo.valueSpec,em=eo.styleSpec;return ed.expression&&$n(re(ec))?ai(eo):ed.expression&&Jn(ne(ec))?oi(eo):ed.type&&tY[ed.type]?tY[ed.type](eo):ni(ee({},eo,{valueSpec:ed.type?em[ed.type]:ed}))}function Ri(eo){let ec=eo.value,ed=eo.key,em=zi(eo);return em.length||(-1===ec.indexOf("{fontstack}")&&em.push(new ri(ed,ec,'"glyphs" url must include a "{fontstack}" token')),-1===ec.indexOf("{range}")&&em.push(new ri(ed,ec,'"glyphs" url must include a "{range}" token'))),em}function Ui(eo,ec=tr){return Oi(Fi({key:"",value:eo,valueSpec:ec.$root,styleSpec:ec,style:eo,objectElementValidators:{glyphs:Ri,"*":()=>[]}}))}let $i=eo=>Oi(Ii(eo)),ji=eo=>Oi(Mi(eo));function Oi(eo){return eo.slice().sort((eo,ec)=>eo.line&&ec.line?eo.line-ec.line:0)}function qi(eo,ec){let ed=!1;if(ec&&ec.length)for(let em of ec)eo.fire(new Wt(Error(em.message))),ed=!0;return ed}function Zi(eo,ec,ed){var em=this.cells=[];if(eo instanceof ArrayBuffer){this.arrayBuffer=eo;var e_=new Int32Array(this.arrayBuffer);eo=e_[0],this.d=(ec=e_[1])+2*(ed=e_[2]);for(var eg=0;eg<this.d*this.d;eg++){var ex=e_[3+eg],ev=e_[3+eg+1];em.push(ex===ev?null:e_.subarray(ex,ev))}var eb=e_[3+em.length+1];this.keys=e_.subarray(e_[3+em.length],eb),this.bboxes=e_.subarray(eb),this.insert=this._insertReadonly}else{this.d=ec+2*ed;for(var ew=0;ew<this.d*this.d;ew++)em.push([]);this.keys=[],this.bboxes=[]}this.n=ec,this.extent=eo,this.padding=ed,this.scale=ec/eo,this.uid=0;var eT=ed/ec*eo;this.min=-eT,this.max=eo+eT}Zi.prototype.insert=function(eo,ec,ed,em,e_){this._forEachCell(ec,ed,em,e_,this._insertCell,this.uid++),this.keys.push(eo),this.bboxes.push(ec),this.bboxes.push(ed),this.bboxes.push(em),this.bboxes.push(e_)},Zi.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Zi.prototype._insertCell=function(eo,ec,ed,em,e_,eg){this.cells[e_].push(eg)},Zi.prototype.query=function(eo,ec,ed,em,e_){var eg=this.min,ex=this.max;if(eo<=eg&&ec<=eg&&ex<=ed&&ex<=em&&!e_)return Array.prototype.slice.call(this.keys);var ev=[];return this._forEachCell(eo,ec,ed,em,this._queryCell,ev,{},e_),ev},Zi.prototype._queryCell=function(eo,ec,ed,em,e_,eg,ex,ev){var eb=this.cells[e_];if(null!==eb)for(var ew=this.keys,eT=this.bboxes,eE=0;eE<eb.length;eE++){var eM=eb[eE];if(void 0===ex[eM]){var eS=4*eM;(ev?ev(eT[eS+0],eT[eS+1],eT[eS+2],eT[eS+3]):eo<=eT[eS+2]&&ec<=eT[eS+3]&&ed>=eT[eS+0]&&em>=eT[eS+1])?(ex[eM]=!0,eg.push(ew[eM])):ex[eM]=!1}}},Zi.prototype._forEachCell=function(eo,ec,ed,em,e_,eg,ex,ev){for(var eb=this._convertToCellCoord(eo),ew=this._convertToCellCoord(ec),eT=this._convertToCellCoord(ed),eE=this._convertToCellCoord(em),eM=eb;eM<=eT;eM++)for(var eS=ew;eS<=eE;eS++){var eA=this.d*eS+eM;if((!ev||ev(this._convertFromCellCoord(eM),this._convertFromCellCoord(eS),this._convertFromCellCoord(eM+1),this._convertFromCellCoord(eS+1)))&&e_.call(this,eo,ec,ed,em,eA,eg,ex,ev))return}},Zi.prototype._convertFromCellCoord=function(eo){return(eo-this.padding)/this.scale},Zi.prototype._convertToCellCoord=function(eo){return Math.max(0,Math.min(this.d-1,Math.floor(eo*this.scale)+this.padding))},Zi.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var eo=this.cells,ec=3+this.cells.length+1+1,ed=0,em=0;em<this.cells.length;em++)ed+=this.cells[em].length;var e_=new Int32Array(ec+ed+this.keys.length+this.bboxes.length);e_[0]=this.extent,e_[1]=this.n,e_[2]=this.padding;for(var eg=ec,ex=0;ex<eo.length;ex++){var ev=eo[ex];e_[3+ex]=eg,e_.set(ev,eg),eg+=ev.length}return e_[3+eo.length]=eg,e_.set(this.keys,eg),e_[3+eo.length+1]=eg+=this.keys.length,e_.set(this.bboxes,eg),eg+=this.bboxes.length,e_.buffer};var tK=p(Zi);let tQ={};function Ji(eo,ec,ed={}){Object.defineProperty(eo,"_classRegistryKey",{value:ec,writeable:!1}),tQ[ec]={klass:eo,omit:ed.omit||[]}}for(let eo in Ji(Object,"Object"),tK.serialize=function(eo,ec){let ed=eo.toArrayBuffer();return ec&&ec.push(ed),{buffer:ed}},tK.deserialize=function(eo){return new tK(eo.buffer)},Object.defineProperty(tK,"name",{value:"Grid"}),Ji(tK,"Grid"),Ji(Be,"Color"),Ji(Error,"Error"),Ji(ut,"AJAXError"),Ji(Ve,"ResolvedImage"),Ji(ti,"StylePropertyFunction"),Ji(Xn,"StyleExpression",{omit:["_evaluator"]}),Ji(Wn,"ZoomDependentExpression"),Ji(Yn,"ZoomConstantExpression"),Ji(Qe,"CompoundExpression",{omit:["_evaluate"]}),tW)tQ[tW[eo]._classRegistryKey]||Ji(tW[eo],`Expression${eo}`);function Hi(eo){return eo&&"undefined"!=typeof ArrayBuffer&&(eo instanceof ArrayBuffer||eo.constructor&&"ArrayBuffer"===eo.constructor.name)}function Yi(eo){return eM.ImageBitmap&&eo instanceof eM.ImageBitmap}function Wi(eo,ec){if(null==eo||"boolean"==typeof eo||"number"==typeof eo||"string"==typeof eo||eo instanceof Boolean||eo instanceof Number||eo instanceof String||eo instanceof Date||eo instanceof RegExp)return eo;if(Hi(eo)||Yi(eo))return ec&&ec.push(eo),eo;if(ArrayBuffer.isView(eo))return ec&&ec.push(eo.buffer),eo;if(eo instanceof eM.ImageData)return ec&&ec.push(eo.data.buffer),eo;if(Array.isArray(eo)){let ed=[];for(let em of eo)ed.push(Wi(em,ec));return ed}if("object"==typeof eo){let ed=eo.constructor,em=ed._classRegistryKey;if(!em)throw Error(`can't serialize object of unregistered class ${em}`);let e_=ed.serialize?ed.serialize(eo,ec):{};if(!ed.serialize){for(let ed in eo)eo.hasOwnProperty(ed)&&(tQ[em].omit.indexOf(ed)>=0||(e_[ed]=Wi(eo[ed],ec)));eo instanceof Error&&(e_.message=eo.message)}if(e_.$name)throw Error("$name property is reserved for worker serialization logic.");return"Object"!==em&&(e_.$name=em),e_}throw Error("can't serialize object of type "+typeof eo)}function Qi(eo){if(null==eo||"boolean"==typeof eo||"number"==typeof eo||"string"==typeof eo||eo instanceof Boolean||eo instanceof Number||eo instanceof String||eo instanceof Date||eo instanceof RegExp||Hi(eo)||Yi(eo)||ArrayBuffer.isView(eo)||eo instanceof eM.ImageData)return eo;if(Array.isArray(eo))return eo.map(Qi);if("object"==typeof eo){let ec=eo.$name||"Object",{klass:ed}=tQ[ec];if(!ed)throw Error(`can't deserialize unregistered class ${ec}`);if(ed.deserialize)return ed.deserialize(eo);let em=Object.create(ed.prototype);for(let ec of Object.keys(eo))"$name"!==ec&&(em[ec]=Qi(eo[ec]));return em}throw Error("can't deserialize object of type "+typeof eo)}let t0={"Latin-1 Supplement":eo=>eo>=128&&eo<=255,Arabic:eo=>eo>=1536&&eo<=1791,"Arabic Supplement":eo=>eo>=1872&&eo<=1919,"Arabic Extended-A":eo=>eo>=2208&&eo<=2303,"Hangul Jamo":eo=>eo>=4352&&eo<=4607,"Unified Canadian Aboriginal Syllabics":eo=>eo>=5120&&eo<=5759,Khmer:eo=>eo>=6016&&eo<=6143,"Unified Canadian Aboriginal Syllabics Extended":eo=>eo>=6320&&eo<=6399,"General Punctuation":eo=>eo>=8192&&eo<=8303,"Letterlike Symbols":eo=>eo>=8448&&eo<=8527,"Number Forms":eo=>eo>=8528&&eo<=8591,"Miscellaneous Technical":eo=>eo>=8960&&eo<=9215,"Control Pictures":eo=>eo>=9216&&eo<=9279,"Optical Character Recognition":eo=>eo>=9280&&eo<=9311,"Enclosed Alphanumerics":eo=>eo>=9312&&eo<=9471,"Geometric Shapes":eo=>eo>=9632&&eo<=9727,"Miscellaneous Symbols":eo=>eo>=9728&&eo<=9983,"Miscellaneous Symbols and Arrows":eo=>eo>=11008&&eo<=11263,"CJK Radicals Supplement":eo=>eo>=11904&&eo<=12031,"Kangxi Radicals":eo=>eo>=12032&&eo<=12255,"Ideographic Description Characters":eo=>eo>=12272&&eo<=12287,"CJK Symbols and Punctuation":eo=>eo>=12288&&eo<=12351,Hiragana:eo=>eo>=12352&&eo<=12447,Katakana:eo=>eo>=12448&&eo<=12543,Bopomofo:eo=>eo>=12544&&eo<=12591,"Hangul Compatibility Jamo":eo=>eo>=12592&&eo<=12687,Kanbun:eo=>eo>=12688&&eo<=12703,"Bopomofo Extended":eo=>eo>=12704&&eo<=12735,"CJK Strokes":eo=>eo>=12736&&eo<=12783,"Katakana Phonetic Extensions":eo=>eo>=12784&&eo<=12799,"Enclosed CJK Letters and Months":eo=>eo>=12800&&eo<=13055,"CJK Compatibility":eo=>eo>=13056&&eo<=13311,"CJK Unified Ideographs Extension A":eo=>eo>=13312&&eo<=19903,"Yijing Hexagram Symbols":eo=>eo>=19904&&eo<=19967,"CJK Unified Ideographs":eo=>eo>=19968&&eo<=40959,"Yi Syllables":eo=>eo>=40960&&eo<=42127,"Yi Radicals":eo=>eo>=42128&&eo<=42191,"Hangul Jamo Extended-A":eo=>eo>=43360&&eo<=43391,"Hangul Syllables":eo=>eo>=44032&&eo<=55215,"Hangul Jamo Extended-B":eo=>eo>=55216&&eo<=55295,"Private Use Area":eo=>eo>=57344&&eo<=63743,"CJK Compatibility Ideographs":eo=>eo>=63744&&eo<=64255,"Arabic Presentation Forms-A":eo=>eo>=64336&&eo<=65023,"Vertical Forms":eo=>eo>=65040&&eo<=65055,"CJK Compatibility Forms":eo=>eo>=65072&&eo<=65103,"Small Form Variants":eo=>eo>=65104&&eo<=65135,"Arabic Presentation Forms-B":eo=>eo>=65136&&eo<=65279,"Halfwidth and Fullwidth Forms":eo=>eo>=65280&&eo<=65519};function es(eo){for(let ec of eo)if(is(ec.charCodeAt(0)))return!0;return!1}function is(eo){return!(746!==eo&&747!==eo&&(eo<4352||!(t0["Bopomofo Extended"](eo)||t0.Bopomofo(eo)||t0["CJK Compatibility Forms"](eo)&&!(eo>=65097&&eo<=65103)||t0["CJK Compatibility Ideographs"](eo)||t0["CJK Compatibility"](eo)||t0["CJK Radicals Supplement"](eo)||t0["CJK Strokes"](eo)||!(!t0["CJK Symbols and Punctuation"](eo)||eo>=12296&&eo<=12305||eo>=12308&&eo<=12319||12336===eo)||t0["CJK Unified Ideographs Extension A"](eo)||t0["CJK Unified Ideographs"](eo)||t0["Enclosed CJK Letters and Months"](eo)||t0["Hangul Compatibility Jamo"](eo)||t0["Hangul Jamo Extended-A"](eo)||t0["Hangul Jamo Extended-B"](eo)||t0["Hangul Jamo"](eo)||t0["Hangul Syllables"](eo)||t0.Hiragana(eo)||t0["Ideographic Description Characters"](eo)||t0.Kanbun(eo)||t0["Kangxi Radicals"](eo)||t0["Katakana Phonetic Extensions"](eo)||t0.Katakana(eo)&&12540!==eo||!(!t0["Halfwidth and Fullwidth Forms"](eo)||65288===eo||65289===eo||65293===eo||eo>=65306&&eo<=65310||65339===eo||65341===eo||65343===eo||eo>=65371&&eo<=65503||65507===eo||eo>=65512&&eo<=65519)||!(!t0["Small Form Variants"](eo)||eo>=65112&&eo<=65118||eo>=65123&&eo<=65126)||t0["Unified Canadian Aboriginal Syllabics"](eo)||t0["Unified Canadian Aboriginal Syllabics Extended"](eo)||t0["Vertical Forms"](eo)||t0["Yijing Hexagram Symbols"](eo)||t0["Yi Syllables"](eo)||t0["Yi Radicals"](eo))))}function ss(eo){return!(is(eo)||t0["Latin-1 Supplement"](eo)&&(167===eo||169===eo||174===eo||177===eo||188===eo||189===eo||190===eo||215===eo||247===eo)||t0["General Punctuation"](eo)&&(8214===eo||8224===eo||8225===eo||8240===eo||8241===eo||8251===eo||8252===eo||8258===eo||8263===eo||8264===eo||8265===eo||8273===eo)||t0["Letterlike Symbols"](eo)||t0["Number Forms"](eo)||t0["Miscellaneous Technical"](eo)&&(eo>=8960&&eo<=8967||eo>=8972&&eo<=8991||eo>=8996&&eo<=9e3||9003===eo||eo>=9085&&eo<=9114||eo>=9150&&eo<=9165||9167===eo||eo>=9169&&eo<=9179||eo>=9186&&eo<=9215)||t0["Control Pictures"](eo)&&9251!==eo||t0["Optical Character Recognition"](eo)||t0["Enclosed Alphanumerics"](eo)||t0["Geometric Shapes"](eo)||t0["Miscellaneous Symbols"](eo)&&!(eo>=9754&&eo<=9759)||t0["Miscellaneous Symbols and Arrows"](eo)&&(eo>=11026&&eo<=11055||eo>=11088&&eo<=11097||eo>=11192&&eo<=11243)||t0["CJK Symbols and Punctuation"](eo)||t0.Katakana(eo)||t0["Private Use Area"](eo)||t0["CJK Compatibility Forms"](eo)||t0["Small Form Variants"](eo)||t0["Halfwidth and Fullwidth Forms"](eo)||8734===eo||8756===eo||8757===eo||eo>=9984&&eo<=10087||eo>=10102&&eo<=10131||65532===eo||65533===eo)}function as(eo){return eo>=1424&&eo<=2303||t0["Arabic Presentation Forms-A"](eo)||t0["Arabic Presentation Forms-B"](eo)}let t1="deferred",t2="loading",t3="loaded",t5=null,t4="unavailable",t6=null,ys=function(eo){eo&&"string"==typeof eo&&eo.indexOf("NetworkError")>-1&&(t4="error"),t5&&t5(eo)};function ms(){t8.fire(new Yt("pluginStateChange",{pluginStatus:t4,pluginURL:t6}))}let t8=new Qt,xs=function(){return t4},vs=function(){if(t4!==t1||!t6)throw Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");t4=t2,ms(),t6&&pt({url:t6},eo=>{eo?ys(eo):(t4=t3,ms())})},t9={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>t4===t3||null!=t9.applyArabicShaping,isLoading:()=>t4===t2,setState(eo){t4=eo.pluginStatus,t6=eo.pluginURL},isParsed:()=>null!=t9.applyArabicShaping&&null!=t9.processBidirectionalText&&null!=t9.processStyledBidirectionalText,getPluginURL:()=>t6};let ws=class ws{constructor(eo,ec){this.zoom=eo,ec?(this.now=ec.now,this.fadeDuration=ec.fadeDuration,this.transition=ec.transition,this.pitch=ec.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(eo){return function(eo,ec){for(let em of eo){var ed;if(ed=em.charCodeAt(0),!ec&&as(ed)||ed>=2304&&ed<=3583||ed>=3840&&ed<=4255||t0.Khmer(ed))return!1}return!0}(eo,t9.isLoaded())}};let _s=class _s{constructor(eo,ec){this.property=eo,this.value=ec,this.expression=function(eo,ec){if($n(eo))return new ti(eo,ec);if(Jn(eo)){let ed=Qn(eo,ec);if("error"===ed.result)throw Error(ed.value.map(eo=>`${eo.key}: ${eo.message}`).join(", "));return ed.value}{let ed=eo;return"string"==typeof eo&&"color"===ec.type&&(ed=Be.parse(eo)),{kind:"constant",evaluate:()=>ed}}}(void 0===ec?eo.specification.default:ec,eo.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(eo,ec,ed){return this.property.possiblyEvaluate(this,eo,ec,ed)}};let As=class As{constructor(eo){this.property=eo,this.value=new _s(eo,void 0)}transitioned(eo,ec){return new ks(this.property,this.value,ec,C({},eo.transition,this.transition),eo.now)}untransitioned(){return new ks(this.property,this.value,null,{},0)}};let Ss=class Ss{constructor(eo){this._properties=eo,this._values=Object.create(eo.defaultTransitionablePropertyValues)}getValue(eo){return O(this._values[eo].value.value)}setValue(eo,ec){this._values.hasOwnProperty(eo)||(this._values[eo]=new As(this._values[eo].property)),this._values[eo].value=new _s(this._values[eo].property,null===ec?void 0:O(ec))}getTransition(eo){return O(this._values[eo].transition)}setTransition(eo,ec){this._values.hasOwnProperty(eo)||(this._values[eo]=new As(this._values[eo].property)),this._values[eo].transition=O(ec)||void 0}serialize(){let eo={};for(let ec of Object.keys(this._values)){let ed=this.getValue(ec);void 0!==ed&&(eo[ec]=ed);let em=this.getTransition(ec);void 0!==em&&(eo[`${ec}-transition`]=em)}return eo}transitioned(eo,ec){let ed=new Is(this._properties);for(let em of Object.keys(this._values))ed._values[em]=this._values[em].transitioned(eo,ec._values[em]);return ed}untransitioned(){let eo=new Is(this._properties);for(let ec of Object.keys(this._values))eo._values[ec]=this._values[ec].untransitioned();return eo}};let ks=class ks{constructor(eo,ec,ed,em,e_){let eg=em.delay||0,ex=em.duration||0;e_=e_||0,this.property=eo,this.value=ec,this.begin=e_+eg,this.end=this.begin+ex,eo.specification.transition&&(em.delay||em.duration)&&(this.prior=ed)}possiblyEvaluate(eo,ec,ed){let em=eo.now||0,e_=this.value.possiblyEvaluate(eo,ec,ed),eg=this.prior;if(eg){if(em>this.end||this.value.isDataDriven())return this.prior=null,e_;if(em<this.begin)return eg.possiblyEvaluate(eo,ec,ed);{let ex=(em-this.begin)/(this.end-this.begin);return this.property.interpolate(eg.possiblyEvaluate(eo,ec,ed),e_,S(ex))}}return e_}};let Is=class Is{constructor(eo){this._properties=eo,this._values=Object.create(eo.defaultTransitioningPropertyValues)}possiblyEvaluate(eo,ec,ed){let em=new zs(this._properties);for(let e_ of Object.keys(this._values))em._values[e_]=this._values[e_].possiblyEvaluate(eo,ec,ed);return em}hasTransition(){for(let eo of Object.keys(this._values))if(this._values[eo].prior)return!0;return!1}};let Ms=class Ms{constructor(eo){this._properties=eo,this._values=Object.create(eo.defaultPropertyValues)}getValue(eo){return O(this._values[eo].value)}setValue(eo,ec){this._values[eo]=new _s(this._values[eo].property,null===ec?void 0:O(ec))}serialize(){let eo={};for(let ec of Object.keys(this._values)){let ed=this.getValue(ec);void 0!==ed&&(eo[ec]=ed)}return eo}possiblyEvaluate(eo,ec,ed){let em=new zs(this._properties);for(let e_ of Object.keys(this._values))em._values[e_]=this._values[e_].possiblyEvaluate(eo,ec,ed);return em}};let Ts=class Ts{constructor(eo,ec,ed){this.property=eo,this.value=ec,this.parameters=ed}isConstant(){return"constant"===this.value.kind}constantOr(eo){return"constant"===this.value.kind?this.value.value:eo}evaluate(eo,ec,ed,em){return this.property.evaluate(this.value,this.parameters,eo,ec,ed,em)}};let zs=class zs{constructor(eo){this._properties=eo,this._values=Object.create(eo.defaultPossiblyEvaluatedValues)}get(eo){return this._values[eo]}};let Bs=class Bs{constructor(eo){this.specification=eo}possiblyEvaluate(eo,ec){return eo.expression.evaluate(ec)}interpolate(eo,ec,ed){let em=tD[this.specification.type];return em?em(eo,ec,ed):eo}};let Es=class Es{constructor(eo,ec){this.specification=eo,this.overrides=ec}possiblyEvaluate(eo,ec,ed,em){return new Ts(this,"constant"===eo.expression.kind||"camera"===eo.expression.kind?{kind:"constant",value:eo.expression.evaluate(ec,null,{},ed,em)}:eo.expression,ec)}interpolate(eo,ec,ed){if("constant"!==eo.value.kind||"constant"!==ec.value.kind)return eo;if(void 0===eo.value.value||void 0===ec.value.value)return new Ts(this,{kind:"constant",value:void 0},eo.parameters);let em=tD[this.specification.type];return em?new Ts(this,{kind:"constant",value:em(eo.value.value,ec.value.value,ed)},eo.parameters):eo}evaluate(eo,ec,ed,em,e_,eg){return"constant"===eo.kind?eo.value:eo.evaluate(ec,ed,em,e_,eg)}};let Cs=class Cs{constructor(eo){this.specification=eo}possiblyEvaluate(eo,ec,ed,em){return!!eo.expression.evaluate(ec,null,{},ed,em)}interpolate(){return!1}};let Ps=class Ps{constructor(eo){this.properties=eo,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let ec=new ws(0,{});for(let ed in eo){let em=eo[ed];em.specification.overridable&&this.overridableProperties.push(ed);let e_=this.defaultPropertyValues[ed]=new _s(em,void 0),eg=this.defaultTransitionablePropertyValues[ed]=new As(em);this.defaultTransitioningPropertyValues[ed]=eg.untransitioned(),this.defaultPossiblyEvaluatedValues[ed]=e_.possiblyEvaluate(ec)}}};function Ds(eo,ec){return 256*(eo=M(Math.floor(eo),0,255))+M(Math.floor(ec),0,255)}Ji(Es,"DataDrivenProperty"),Ji(Bs,"DataConstantProperty"),Ji(Cs,"ColorRampProperty");let t7={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};let Ls=class Ls{constructor(eo,ec){this._structArray=eo,this._pos1=ec*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}};let Fs=class Fs{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(eo,ec){return eo._trim(),ec&&(eo.isTransferred=!0,ec.push(eo.arrayBuffer)),{length:eo.length,arrayBuffer:eo.arrayBuffer}}static deserialize(eo){let ec=Object.create(this.prototype);return ec.arrayBuffer=eo.arrayBuffer,ec.length=eo.length,ec.capacity=eo.arrayBuffer.byteLength/ec.bytesPerElement,ec._refreshViews(),ec}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(eo){this.reserve(eo),this.length=eo}reserve(eo){if(eo>this.capacity){this.capacity=Math.max(eo,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let ec=this.uint8;this._refreshViews(),ec&&this.uint8.set(ec)}}_refreshViews(){throw Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}};function Rs(eo,ec=1){let ed=0,em=0;return{members:eo.map(eo=>{let e_=t7[eo.type].BYTES_PER_ELEMENT,eg=ed=Us(ed,Math.max(ec,e_)),ex=eo.components||1;return em=Math.max(em,e_),ed+=e_*ex,{name:eo.name,type:eo.type,components:ex,offset:eg}}),size:Us(ed,Math.max(em,ec)),alignment:ec}}function Us(eo,ec){return Math.ceil(eo/ec)*ec}let $s=class $s extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(eo,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,eo,ec)}emplace(eo,ec,ed){let em=2*eo;return this.int16[em+0]=ec,this.int16[em+1]=ed,eo}};$s.prototype.bytesPerElement=4,Ji($s,"StructArrayLayout2i4");let js=class js extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed){let em=this.length;return this.resize(em+1),this.emplace(em,eo,ec,ed)}emplace(eo,ec,ed,em){let e_=3*eo;return this.int16[e_+0]=ec,this.int16[e_+1]=ed,this.int16[e_+2]=em,eo}};js.prototype.bytesPerElement=6,Ji(js,"StructArrayLayout3i6");let Os=class Os extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em){let e_=this.length;return this.resize(e_+1),this.emplace(e_,eo,ec,ed,em)}emplace(eo,ec,ed,em,e_){let eg=4*eo;return this.int16[eg+0]=ec,this.int16[eg+1]=ed,this.int16[eg+2]=em,this.int16[eg+3]=e_,eo}};Os.prototype.bytesPerElement=8,Ji(Os,"StructArrayLayout4i8");let qs=class qs extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg,ex){let ev=this.length;return this.resize(ev+1),this.emplace(ev,eo,ec,ed,em,e_,eg,ex)}emplace(eo,ec,ed,em,e_,eg,ex,ev){let eb=6*eo,ew=12*eo;return this.int16[eb+0]=ec,this.int16[eb+1]=ed,this.uint8[ew+4]=em,this.uint8[ew+5]=e_,this.uint8[ew+6]=eg,this.uint8[ew+7]=ex,this.float32[3*eo+2]=ev,eo}};qs.prototype.bytesPerElement=12,Ji(qs,"StructArrayLayout2i4ub1f12");let Ns=class Ns extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em){let e_=this.length;return this.resize(e_+1),this.emplace(e_,eo,ec,ed,em)}emplace(eo,ec,ed,em,e_){let eg=4*eo;return this.float32[eg+0]=ec,this.float32[eg+1]=ed,this.float32[eg+2]=em,this.float32[eg+3]=e_,eo}};Ns.prototype.bytesPerElement=16,Ji(Ns,"StructArrayLayout4f16");let Gs=class Gs extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_){let eg=this.length;return this.resize(eg+1),this.emplace(eg,eo,ec,ed,em,e_)}emplace(eo,ec,ed,em,e_,eg){let ex=6*eo;return this.uint16[ex+0]=ec,this.uint16[ex+1]=ed,this.uint16[ex+2]=em,this.uint16[ex+3]=e_,this.float32[3*eo+2]=eg,eo}};Gs.prototype.bytesPerElement=12,Ji(Gs,"StructArrayLayout4ui1f12");let Zs=class Zs extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em){let e_=this.length;return this.resize(e_+1),this.emplace(e_,eo,ec,ed,em)}emplace(eo,ec,ed,em,e_){let eg=4*eo;return this.uint16[eg+0]=ec,this.uint16[eg+1]=ed,this.uint16[eg+2]=em,this.uint16[eg+3]=e_,eo}};Zs.prototype.bytesPerElement=8,Ji(Zs,"StructArrayLayout4ui8");let Ks=class Ks extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg){let ex=this.length;return this.resize(ex+1),this.emplace(ex,eo,ec,ed,em,e_,eg)}emplace(eo,ec,ed,em,e_,eg,ex){let ev=6*eo;return this.int16[ev+0]=ec,this.int16[ev+1]=ed,this.int16[ev+2]=em,this.int16[ev+3]=e_,this.int16[ev+4]=eg,this.int16[ev+5]=ex,eo}};Ks.prototype.bytesPerElement=12,Ji(Ks,"StructArrayLayout6i12");let Xs=class Xs extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE){let eM=this.length;return this.resize(eM+1),this.emplace(eM,eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE)}emplace(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM){let eS=12*eo;return this.int16[eS+0]=ec,this.int16[eS+1]=ed,this.int16[eS+2]=em,this.int16[eS+3]=e_,this.uint16[eS+4]=eg,this.uint16[eS+5]=ex,this.uint16[eS+6]=ev,this.uint16[eS+7]=eb,this.int16[eS+8]=ew,this.int16[eS+9]=eT,this.int16[eS+10]=eE,this.int16[eS+11]=eM,eo}};Xs.prototype.bytesPerElement=24,Ji(Xs,"StructArrayLayout4i4ui4i24");let Js=class Js extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg){let ex=this.length;return this.resize(ex+1),this.emplace(ex,eo,ec,ed,em,e_,eg)}emplace(eo,ec,ed,em,e_,eg,ex){let ev=10*eo,eb=5*eo;return this.int16[ev+0]=ec,this.int16[ev+1]=ed,this.int16[ev+2]=em,this.float32[eb+2]=e_,this.float32[eb+3]=eg,this.float32[eb+4]=ex,eo}};Js.prototype.bytesPerElement=20,Ji(Js,"StructArrayLayout3i3f20");let Hs=class Hs extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(eo){let ec=this.length;return this.resize(ec+1),this.emplace(ec,eo)}emplace(eo,ec){return this.uint32[1*eo+0]=ec,eo}};Hs.prototype.bytesPerElement=4,Ji(Hs,"StructArrayLayout1ul4");let Ys=class Ys extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM){let eS=this.length;return this.resize(eS+1),this.emplace(eS,eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM)}emplace(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS){let eA=20*eo,eI=10*eo;return this.int16[eA+0]=ec,this.int16[eA+1]=ed,this.int16[eA+2]=em,this.int16[eA+3]=e_,this.int16[eA+4]=eg,this.float32[eI+3]=ex,this.float32[eI+4]=ev,this.float32[eI+5]=eb,this.float32[eI+6]=ew,this.int16[eA+14]=eT,this.uint32[eI+8]=eE,this.uint16[eA+18]=eM,this.uint16[eA+19]=eS,eo}};Ys.prototype.bytesPerElement=40,Ji(Ys,"StructArrayLayout5i4f1i1ul2ui40");let Ws=class Ws extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg,ex){let ev=this.length;return this.resize(ev+1),this.emplace(ev,eo,ec,ed,em,e_,eg,ex)}emplace(eo,ec,ed,em,e_,eg,ex,ev){let eb=8*eo;return this.int16[eb+0]=ec,this.int16[eb+1]=ed,this.int16[eb+2]=em,this.int16[eb+4]=e_,this.int16[eb+5]=eg,this.int16[eb+6]=ex,this.int16[eb+7]=ev,eo}};Ws.prototype.bytesPerElement=16,Ji(Ws,"StructArrayLayout3i2i2i16");let Qs=class Qs extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_){let eg=this.length;return this.resize(eg+1),this.emplace(eg,eo,ec,ed,em,e_)}emplace(eo,ec,ed,em,e_,eg){let ex=4*eo,ev=8*eo;return this.float32[ex+0]=ec,this.float32[ex+1]=ed,this.float32[ex+2]=em,this.int16[ev+6]=e_,this.int16[ev+7]=eg,eo}};Qs.prototype.bytesPerElement=16,Ji(Qs,"StructArrayLayout2f1f2i16");let ta=class ta extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em){let e_=this.length;return this.resize(e_+1),this.emplace(e_,eo,ec,ed,em)}emplace(eo,ec,ed,em,e_){let eg=12*eo,ex=3*eo;return this.uint8[eg+0]=ec,this.uint8[eg+1]=ed,this.float32[ex+1]=em,this.float32[ex+2]=e_,eo}};ta.prototype.bytesPerElement=12,Ji(ta,"StructArrayLayout2ub2f12");let ea=class ea extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed){let em=this.length;return this.resize(em+1),this.emplace(em,eo,ec,ed)}emplace(eo,ec,ed,em){let e_=3*eo;return this.float32[e_+0]=ec,this.float32[e_+1]=ed,this.float32[e_+2]=em,eo}};ea.prototype.bytesPerElement=12,Ji(ea,"StructArrayLayout3f12");let ra=class ra extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed){let em=this.length;return this.resize(em+1),this.emplace(em,eo,ec,ed)}emplace(eo,ec,ed,em){let e_=3*eo;return this.uint16[e_+0]=ec,this.uint16[e_+1]=ed,this.uint16[e_+2]=em,eo}};ra.prototype.bytesPerElement=6,Ji(ra,"StructArrayLayout3ui6");let na=class na extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez,eD,ek){let eL=this.length;return this.resize(eL+1),this.emplace(eL,eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez,eD,ek)}emplace(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez,eD,ek,eL){let eR=30*eo,eB=15*eo,eF=60*eo;return this.int16[eR+0]=ec,this.int16[eR+1]=ed,this.int16[eR+2]=em,this.float32[eB+2]=e_,this.float32[eB+3]=eg,this.uint16[eR+8]=ex,this.uint16[eR+9]=ev,this.uint32[eB+5]=eb,this.uint32[eB+6]=ew,this.uint32[eB+7]=eT,this.uint16[eR+16]=eE,this.uint16[eR+17]=eM,this.uint16[eR+18]=eS,this.float32[eB+10]=eA,this.float32[eB+11]=eI,this.uint8[eF+48]=eC,this.uint8[eF+49]=eP,this.uint8[eF+50]=ez,this.uint32[eB+13]=eD,this.int16[eR+28]=ek,this.uint8[eF+58]=eL,eo}};na.prototype.bytesPerElement=60,Ji(na,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");let ia=class ia extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez,eD,ek,eL,eR,eB,eF,eO,eU,eN,eV,ej){let eG=this.length;return this.resize(eG+1),this.emplace(eG,eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez,eD,ek,eL,eR,eB,eF,eO,eU,eN,eV,ej)}emplace(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez,eD,ek,eL,eR,eB,eF,eO,eU,eN,eV,ej,eG){let eZ=38*eo,e$=19*eo;return this.int16[eZ+0]=ec,this.int16[eZ+1]=ed,this.int16[eZ+2]=em,this.float32[e$+2]=e_,this.float32[e$+3]=eg,this.int16[eZ+8]=ex,this.int16[eZ+9]=ev,this.int16[eZ+10]=eb,this.int16[eZ+11]=ew,this.int16[eZ+12]=eT,this.int16[eZ+13]=eE,this.uint16[eZ+14]=eM,this.uint16[eZ+15]=eS,this.uint16[eZ+16]=eA,this.uint16[eZ+17]=eI,this.uint16[eZ+18]=eC,this.uint16[eZ+19]=eP,this.uint16[eZ+20]=ez,this.uint16[eZ+21]=eD,this.uint16[eZ+22]=ek,this.uint16[eZ+23]=eL,this.uint16[eZ+24]=eR,this.uint16[eZ+25]=eB,this.uint16[eZ+26]=eF,this.uint16[eZ+27]=eO,this.uint16[eZ+28]=eU,this.uint32[e$+15]=eN,this.float32[e$+16]=eV,this.float32[e$+17]=ej,this.float32[e$+18]=eG,eo}};ia.prototype.bytesPerElement=76,Ji(ia,"StructArrayLayout3i2f6i15ui1ul3f76");let sa=class sa extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo){let ec=this.length;return this.resize(ec+1),this.emplace(ec,eo)}emplace(eo,ec){return this.float32[1*eo+0]=ec,eo}};sa.prototype.bytesPerElement=4,Ji(sa,"StructArrayLayout1f4");let aa=class aa extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em,e_){let eg=this.length;return this.resize(eg+1),this.emplace(eg,eo,ec,ed,em,e_)}emplace(eo,ec,ed,em,e_,eg){let ex=5*eo;return this.float32[ex+0]=ec,this.float32[ex+1]=ed,this.float32[ex+2]=em,this.float32[ex+3]=e_,this.float32[ex+4]=eg,eo}};aa.prototype.bytesPerElement=20,Ji(aa,"StructArrayLayout5f20");let oa=class oa extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(eo,ec,ed,em){let e_=this.length;return this.resize(e_+1),this.emplace(e_,eo,ec,ed,em)}emplace(eo,ec,ed,em,e_){let eg=6*eo;return this.uint32[3*eo+0]=ec,this.uint16[eg+2]=ed,this.uint16[eg+3]=em,this.uint16[eg+4]=e_,eo}};oa.prototype.bytesPerElement=12,Ji(oa,"StructArrayLayout1ul3ui12");let la=class la extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(eo,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,eo,ec)}emplace(eo,ec,ed){let em=2*eo;return this.uint16[em+0]=ec,this.uint16[em+1]=ed,eo}};la.prototype.bytesPerElement=4,Ji(la,"StructArrayLayout2ui4");let ua=class ua extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(eo){let ec=this.length;return this.resize(ec+1),this.emplace(ec,eo)}emplace(eo,ec){return this.uint16[1*eo+0]=ec,eo}};ua.prototype.bytesPerElement=2,Ji(ua,"StructArrayLayout1ui2");let ca=class ca extends Fs{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(eo,ec){let ed=this.length;return this.resize(ed+1),this.emplace(ed,eo,ec)}emplace(eo,ec,ed){let em=2*eo;return this.float32[em+0]=ec,this.float32[em+1]=ed,eo}};ca.prototype.bytesPerElement=8,Ji(ca,"StructArrayLayout2f8");let ha=class ha extends Ls{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}};ha.prototype.size=40;let pa=class pa extends Ys{get(eo){return new ha(this,eo)}};Ji(pa,"CollisionBoxArray");let da=class da extends Ls{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(eo){this._structArray.uint8[this._pos1+49]=eo}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(eo){this._structArray.uint8[this._pos1+50]=eo}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(eo){this._structArray.uint32[this._pos4+13]=eo}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(eo){this._structArray.uint8[this._pos1+58]=eo}};da.prototype.size=60;let fa=class fa extends na{get(eo){return new da(this,eo)}};Ji(fa,"PlacedSymbolArray");let ya=class ya extends Ls{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(eo){this._structArray.uint32[this._pos4+15]=eo}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}};ya.prototype.size=76;let ma=class ma extends ia{get(eo){return new ya(this,eo)}};Ji(ma,"SymbolInstanceArray");let ga=class ga extends sa{getoffsetX(eo){return this.float32[1*eo+0]}};Ji(ga,"GlyphOffsetArray");let xa=class xa extends $s{getx(eo){return this.int16[2*eo+0]}gety(eo){return this.int16[2*eo+1]}};Ji(xa,"SymbolLineVertexArray");let va=class va extends Ls{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}};va.prototype.size=12;let ba=class ba extends oa{get(eo){return new va(this,eo)}};Ji(ba,"FeatureIndexArray");let wa=class wa extends la{geta_centroid_pos0(eo){return this.uint16[2*eo+0]}geta_centroid_pos1(eo){return this.uint16[2*eo+1]}};Ji(wa,"FillExtrusionCentroidArray");let iu=Rs([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ic=Rs([{name:"a_dash",components:4,type:"Uint16"}]);var im={exports:{}},i_={exports:{}};i_.exports=function(eo,ec){var ed,em,e_,eg,ex,ev;for(em=eo.length-(ed=3&eo.length),e_=ec,ev=0;ev<em;)ex=255&eo.charCodeAt(ev)|(255&eo.charCodeAt(++ev))<<8|(255&eo.charCodeAt(++ev))<<16|(255&eo.charCodeAt(++ev))<<24,++ev,e_=27492+(65535&(eg=5*(65535&(e_=(e_^=ex=(65535&(ex=(ex=(65535&ex)*3432918353+(((ex>>>16)*3432918353&65535)<<16)&4294967295)<<15|ex>>>17))*461845907+(((ex>>>16)*461845907&65535)<<16)&4294967295)<<13|e_>>>19))+((5*(e_>>>16)&65535)<<16)&4294967295))+((58964+(eg>>>16)&65535)<<16);switch(ex=0,ed){case 3:ex^=(255&eo.charCodeAt(ev+2))<<16;case 2:ex^=(255&eo.charCodeAt(ev+1))<<8;case 1:e_^=ex=(65535&(ex=(ex=(65535&(ex^=255&eo.charCodeAt(ev)))*3432918353+(((ex>>>16)*3432918353&65535)<<16)&4294967295)<<15|ex>>>17))*461845907+(((ex>>>16)*461845907&65535)<<16)&4294967295}return e_^=eo.length,e_=2246822507*(65535&(e_^=e_>>>16))+((2246822507*(e_>>>16)&65535)<<16)&4294967295,e_=3266489909*(65535&(e_^=e_>>>13))+((3266489909*(e_>>>16)&65535)<<16)&4294967295,(e_^=e_>>>16)>>>0};var ig=i_.exports,ix={exports:{}};ix.exports=function(eo,ec){for(var ed,em=eo.length,e_=ec^em,eg=0;em>=4;)ed=1540483477*(65535&(ed=255&eo.charCodeAt(eg)|(255&eo.charCodeAt(++eg))<<8|(255&eo.charCodeAt(++eg))<<16|(255&eo.charCodeAt(++eg))<<24))+((1540483477*(ed>>>16)&65535)<<16),e_=1540483477*(65535&e_)+((1540483477*(e_>>>16)&65535)<<16)^(ed=1540483477*(65535&(ed^=ed>>>24))+((1540483477*(ed>>>16)&65535)<<16)),em-=4,++eg;switch(em){case 3:e_^=(255&eo.charCodeAt(eg+2))<<16;case 2:e_^=(255&eo.charCodeAt(eg+1))<<8;case 1:e_=1540483477*(65535&(e_^=255&eo.charCodeAt(eg)))+((1540483477*(e_>>>16)&65535)<<16)}return e_=1540483477*(65535&(e_^=e_>>>13))+((1540483477*(e_>>>16)&65535)<<16),(e_^=e_>>>15)>>>0};var iv=ix.exports;im.exports=ig,im.exports.murmur3=ig,im.exports.murmur2=iv;var ib=p(im.exports);let Ea=class Ea{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(eo,ec,ed,em){this.ids.push(Ca(eo)),this.positions.push(ec,ed,em)}getPositions(eo){let ec=Ca(eo),ed=0,em=this.ids.length-1;for(;ed<em;){let eo=ed+em>>1;this.ids[eo]>=ec?em=eo:ed=eo+1}let e_=[];for(;this.ids[ed]===ec;)e_.push({index:this.positions[3*ed],start:this.positions[3*ed+1],end:this.positions[3*ed+2]}),ed++;return e_}static serialize(eo,ec){let ed=new Float64Array(eo.ids),em=new Uint32Array(eo.positions);return function Pa(eo,ec,ed,em){for(;ed<em;){let e_=eo[ed+em>>1],eg=ed-1,ex=em+1;for(;;){do eg++;while(eo[eg]<e_);do ex--;while(eo[ex]>e_);if(eg>=ex)break;Da(eo,eg,ex),Da(ec,3*eg,3*ex),Da(ec,3*eg+1,3*ex+1),Da(ec,3*eg+2,3*ex+2)}ex-ed<em-ex?(Pa(eo,ec,ed,ex),ed=ex+1):(Pa(eo,ec,ex+1,em),em=ex)}}(ed,em,0,ed.length-1),ec&&ec.push(ed.buffer,em.buffer),{ids:ed,positions:em}}static deserialize(eo){let ec=new Ea;return ec.ids=eo.ids,ec.positions=eo.positions,ec.indexed=!0,ec}};function Ca(eo){let ec=+eo;return!isNaN(ec)&&Number.MIN_SAFE_INTEGER<=ec&&ec<=Number.MAX_SAFE_INTEGER?ec:ib(String(eo))}function Da(eo,ec,ed){let em=eo[ec];eo[ec]=eo[ed],eo[ed]=em}Ji(Ea,"FeaturePositionMap");let Va=class Va{constructor(eo){this.gl=eo.gl,this.initialized=!1}fetchUniformLocation(eo,ec){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(eo,ec),this.initialized=!0),!!this.location}};let La=class La extends Va{constructor(eo){super(eo),this.current=0}set(eo,ec,ed){this.fetchUniformLocation(eo,ec)&&this.current!==ed&&(this.current=ed,this.gl.uniform1f(this.location,ed))}};let Fa=class Fa extends Va{constructor(eo){super(eo),this.current=[0,0,0,0]}set(eo,ec,ed){this.fetchUniformLocation(eo,ec)&&(ed[0]===this.current[0]&&ed[1]===this.current[1]&&ed[2]===this.current[2]&&ed[3]===this.current[3]||(this.current=ed,this.gl.uniform4f(this.location,ed[0],ed[1],ed[2],ed[3])))}};let Ra=class Ra extends Va{constructor(eo){super(eo),this.current=Be.transparent}set(eo,ec,ed){this.fetchUniformLocation(eo,ec)&&(ed.r===this.current.r&&ed.g===this.current.g&&ed.b===this.current.b&&ed.a===this.current.a||(this.current=ed,this.gl.uniform4f(this.location,ed.r,ed.g,ed.b,ed.a)))}};let iw=new Float32Array(16),iT=new Float32Array(9),iE=new Float32Array(4);function Oa(eo){return[Ds(255*eo.r,255*eo.g),Ds(255*eo.b,255*eo.a)]}let qa=class qa{constructor(eo,ec,ed){this.value=eo,this.uniformNames=ec.map(eo=>`u_${eo}`),this.type=ed}setUniform(eo,ec,ed,em,e_){ec.set(eo,e_,em.constantOr(this.value))}getBinding(eo,ec){return"color"===this.type?new Ra(eo):new La(eo)}};let Na=class Na{constructor(eo,ec){this.uniformNames=ec.map(eo=>`u_${eo}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(eo){this.pixelRatio=eo.pixelRatio||1,this.pattern=eo.tl.concat(eo.br)}setUniform(eo,ec,ed,em,e_){let eg="u_pattern"===e_||"u_dash"===e_?this.pattern:"u_pixel_ratio"===e_?this.pixelRatio:null;eg&&ec.set(eo,e_,eg)}getBinding(eo,ec){return"u_pattern"===ec||"u_dash"===ec?new Fa(eo):new La(eo)}};let Ga=class Ga{constructor(eo,ec,ed,em){this.expression=eo,this.type=ed,this.maxValue=0,this.paintVertexAttributes=ec.map(eo=>({name:`a_${eo}`,type:"Float32",components:"color"===ed?2:1,offset:0})),this.paintVertexArray=new em}populatePaintArray(eo,ec,ed,em,e_,eg){let ex=this.paintVertexArray.length,ev=this.expression.evaluate(new ws(0),ec,{},e_,em,eg);this.paintVertexArray.resize(eo),this._setPaintValue(ex,eo,ev)}updatePaintArray(eo,ec,ed,em,e_){let eg=this.expression.evaluate({zoom:0},ed,em,void 0,e_);this._setPaintValue(eo,ec,eg)}_setPaintValue(eo,ec,ed){if("color"===this.type){let em=Oa(ed);for(let ed=eo;ed<ec;ed++)this.paintVertexArray.emplace(ed,em[0],em[1])}else{for(let em=eo;em<ec;em++)this.paintVertexArray.emplace(em,ed);this.maxValue=Math.max(this.maxValue,Math.abs(ed))}}upload(eo){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=eo.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}};let Za=class Za{constructor(eo,ec,ed,em,e_,eg){this.expression=eo,this.uniformNames=ec.map(eo=>`u_${eo}_t`),this.type=ed,this.useIntegerZoom=em,this.zoom=e_,this.maxValue=0,this.paintVertexAttributes=ec.map(eo=>({name:`a_${eo}`,type:"Float32",components:"color"===ed?4:2,offset:0})),this.paintVertexArray=new eg}populatePaintArray(eo,ec,ed,em,e_,eg){let ex=this.expression.evaluate(new ws(this.zoom),ec,{},e_,em,eg),ev=this.expression.evaluate(new ws(this.zoom+1),ec,{},e_,em,eg),eb=this.paintVertexArray.length;this.paintVertexArray.resize(eo),this._setPaintValue(eb,eo,ex,ev)}updatePaintArray(eo,ec,ed,em,e_){let eg=this.expression.evaluate({zoom:this.zoom},ed,em,void 0,e_),ex=this.expression.evaluate({zoom:this.zoom+1},ed,em,void 0,e_);this._setPaintValue(eo,ec,eg,ex)}_setPaintValue(eo,ec,ed,em){if("color"===this.type){let e_=Oa(ed),eg=Oa(em);for(let ed=eo;ed<ec;ed++)this.paintVertexArray.emplace(ed,e_[0],e_[1],eg[0],eg[1])}else{for(let e_=eo;e_<ec;e_++)this.paintVertexArray.emplace(e_,ed,em);this.maxValue=Math.max(this.maxValue,Math.abs(ed),Math.abs(em))}}upload(eo){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=eo.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(eo,ec,ed,em,e_){let eg=this.useIntegerZoom?Math.floor(ed.zoom):ed.zoom,ex=M(this.expression.interpolationFactor(eg,this.zoom,this.zoom+1),0,1);ec.set(eo,e_,ex)}getBinding(eo,ec){return new La(eo)}};let Ka=class Ka{constructor(eo,ec,ed,em,e_){this.expression=eo,this.layerId=e_,this.paintVertexAttributes=("array"===ed?ic:iu).members;for(let eo=0;eo<ec.length;++eo);this.paintVertexArray=new em}populatePaintArray(eo,ec,ed){let em=this.paintVertexArray.length;this.paintVertexArray.resize(eo),this._setPaintValues(em,eo,ec.patterns&&ec.patterns[this.layerId],ed)}updatePaintArray(eo,ec,ed,em,e_,eg){this._setPaintValues(eo,ec,ed.patterns&&ed.patterns[this.layerId],eg)}_setPaintValues(eo,ec,ed,em){if(!em||!ed)return;let e_=em[ed];if(!e_)return;let{tl:eg,br:ex,pixelRatio:ev}=e_;for(let ed=eo;ed<ec;ed++)this.paintVertexArray.emplace(ed,eg[0],eg[1],ex[0],ex[1],ev)}upload(eo){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=eo.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}};let Xa=class Xa{constructor(eo,ec,ed=()=>!0){this.binders={},this._buffers=[];let em=[];for(let eg in eo.paint._values){var e_;if(!ed(eg))continue;let ex=eo.paint.get(eg);if(!(ex instanceof Ts&&Ln(ex.property.specification)))continue;let ev=(e_=eo.type,iM[eg]||[eg.replace(`${e_}-`,"").replace(/-/g,"_")]),eb=ex.value,ew=ex.property.specification.type,eT=!!ex.property.useIntegerZoom,eE="line-dasharray"===eg||eg.endsWith("pattern"),eM="line-dasharray"===eg&&"constant"!==eo.layout.get("line-cap").value.kind;if("constant"!==eb.kind||eM){if("source"===eb.kind||eM||eE){let ec=to(eg,ew,"source");this.binders[eg]=eE?new Ka(eb,ev,ew,ec,eo.id):new Ga(eb,ev,ew,ec),em.push(`/a_${eg}`)}else{let eo=to(eg,ew,"composite");this.binders[eg]=new Za(eb,ev,ew,eT,ec,eo),em.push(`/z_${eg}`)}}else this.binders[eg]=eE?new Na(eb.value,ev):new qa(eb.value,ev,ew),em.push(`/u_${eg}`)}this.cacheKey=em.sort().join("")}getMaxValue(eo){let ec=this.binders[eo];return ec instanceof Ga||ec instanceof Za?ec.maxValue:0}populatePaintArrays(eo,ec,ed,em,e_,eg){for(let ex in this.binders){let ev=this.binders[ex];(ev instanceof Ga||ev instanceof Za||ev instanceof Ka)&&ev.populatePaintArray(eo,ec,ed,em,e_,eg)}}setConstantPatternPositions(eo){for(let ec in this.binders){let ed=this.binders[ec];ed instanceof Na&&ed.setConstantPatternPositions(eo)}}updatePaintArrays(eo,ec,ed,em,e_,eg){let ex=!1;for(let ev in eo){let eb=ec.getPositions(ev);for(let ec of eb){let eb=ed.feature(ec.index);for(let ed in this.binders){let ew=this.binders[ed];if((ew instanceof Ga||ew instanceof Za||ew instanceof Ka)&&!0===ew.expression.isStateDependent){let eT=em.paint.get(ed);ew.expression=eT.value,ew.updatePaintArray(ec.start,ec.end,eb,eo[ev],e_,eg),ex=!0}}}}return ex}defines(){let eo=[];for(let ec in this.binders){let ed=this.binders[ec];(ed instanceof qa||ed instanceof Na)&&eo.push(...ed.uniformNames.map(eo=>`#define HAS_UNIFORM_${eo}`))}return eo}getBinderAttributes(){let eo=[];for(let ec in this.binders){let ed=this.binders[ec];if(ed instanceof Ga||ed instanceof Za||ed instanceof Ka)for(let ec=0;ec<ed.paintVertexAttributes.length;ec++)eo.push(ed.paintVertexAttributes[ec].name)}return eo}getBinderUniforms(){let eo=[];for(let ec in this.binders){let ed=this.binders[ec];if(ed instanceof qa||ed instanceof Na||ed instanceof Za)for(let ec of ed.uniformNames)eo.push(ec)}return eo}getPaintVertexBuffers(){return this._buffers}getUniforms(eo){let ec=[];for(let ed in this.binders){let em=this.binders[ed];if(em instanceof qa||em instanceof Na||em instanceof Za)for(let e_ of em.uniformNames)ec.push({name:e_,property:ed,binding:em.getBinding(eo,e_)})}return ec}setUniforms(eo,ec,ed,em,e_){for(let{name:ec,property:eg,binding:ex}of ed)this.binders[eg].setUniform(eo,ex,e_,em.get(eg),ec)}updatePaintBuffers(){for(let eo in this._buffers=[],this.binders){let ec=this.binders[eo];(ec instanceof Ga||ec instanceof Za||ec instanceof Ka)&&ec.paintVertexBuffer&&this._buffers.push(ec.paintVertexBuffer)}}upload(eo){for(let ec in this.binders){let ed=this.binders[ec];(ed instanceof Ga||ed instanceof Za||ed instanceof Ka)&&ed.upload(eo)}this.updatePaintBuffers()}destroy(){for(let eo in this.binders){let ec=this.binders[eo];(ec instanceof Ga||ec instanceof Za||ec instanceof Ka)&&ec.destroy()}}};let Ja=class Ja{constructor(eo,ec,ed=()=>!0){for(let em of(this.programConfigurations={},eo))this.programConfigurations[em.id]=new Xa(em,ec,ed);this.needsUpload=!1,this._featureMap=new Ea,this._bufferOffset=0}populatePaintArrays(eo,ec,ed,em,e_,eg,ex){for(let ed in this.programConfigurations)this.programConfigurations[ed].populatePaintArrays(eo,ec,em,e_,eg,ex);void 0!==ec.id&&this._featureMap.add(ec.id,ed,this._bufferOffset,eo),this._bufferOffset=eo,this.needsUpload=!0}updatePaintArrays(eo,ec,ed,em,e_){for(let eg of ed)this.needsUpload=this.programConfigurations[eg.id].updatePaintArrays(eo,this._featureMap,ec,eg,em,e_)||this.needsUpload}get(eo){return this.programConfigurations[eo]}upload(eo){if(this.needsUpload){for(let ec in this.programConfigurations)this.programConfigurations[ec].upload(eo);this.needsUpload=!1}}destroy(){for(let eo in this.programConfigurations)this.programConfigurations[eo].destroy()}};let iM={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]},iS={"line-pattern":{source:Gs,composite:Gs},"fill-pattern":{source:Gs,composite:Gs},"fill-extrusion-pattern":{source:Gs,composite:Gs},"line-dasharray":{source:Zs,composite:Zs}},iA={color:{source:ca,composite:Ns},number:{source:sa,composite:ca}};function to(eo,ec,ed){let em=iS[eo];return em&&em[ed]||iA[ec][ed]}Ji(qa,"ConstantBinder"),Ji(Na,"PatternConstantBinder"),Ji(Ga,"SourceExpressionBinder"),Ji(Ka,"PatternCompositeBinder"),Ji(Za,"CompositeExpressionBinder"),Ji(Xa,"ProgramConfiguration",{omit:["_buffers"]}),Ji(Ja,"ProgramConfigurationSet");let iI="-transition";let ro=class ro extends Qt{constructor(eo,ec){if(super(),this.id=eo.id,this.type=eo.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==eo.type&&(this.metadata=eo.metadata,this.minzoom=eo.minzoom,this.maxzoom=eo.maxzoom,"background"!==eo.type&&"sky"!==eo.type&&(this.source=eo.source,this.sourceLayer=eo["source-layer"],this.filter=eo.filter),ec.layout&&(this._unevaluatedLayout=new Ms(ec.layout)),ec.paint)){for(let ed in this._transitionablePaint=new Ss(ec.paint),eo.paint)this.setPaintProperty(ed,eo.paint[ed],{validate:!1});for(let ec in eo.layout)this.setLayoutProperty(ec,eo.layout[ec],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new zs(ec.paint)}}getLayoutProperty(eo){return"visibility"===eo?this.visibility:this._unevaluatedLayout.getValue(eo)}setLayoutProperty(eo,ec,ed={}){null!=ec&&this._validate(ji,`layers.${this.id}.layout.${eo}`,eo,ec,ed)||("visibility"!==eo?this._unevaluatedLayout.setValue(eo,ec):this.visibility=ec)}getPaintProperty(eo){return U(eo,iI)?this._transitionablePaint.getTransition(eo.slice(0,-11)):this._transitionablePaint.getValue(eo)}setPaintProperty(eo,ec,ed={}){if(null!=ec&&this._validate($i,`layers.${this.id}.paint.${eo}`,eo,ec,ed))return!1;if(U(eo,iI))return this._transitionablePaint.setTransition(eo.slice(0,-11),ec||void 0),!1;{let ed=this._transitionablePaint._values[eo],em=ed.value.isDataDriven(),e_=ed.value;this._transitionablePaint.setValue(eo,ec),this._handleSpecialPaintPropertyUpdate(eo);let eg=this._transitionablePaint._values[eo].value,ex=eg.isDataDriven(),ev=U(eo,"pattern")||"line-dasharray"===eo;return ex||em||ev||this._handleOverridablePaintPropertyUpdate(eo,e_,eg)}}_handleSpecialPaintPropertyUpdate(eo){}getProgramIds(){return null}getProgramConfiguration(eo){return null}_handleOverridablePaintPropertyUpdate(eo,ec,ed){return!1}isHidden(eo){return!!(this.minzoom&&eo<this.minzoom)||!!(this.maxzoom&&eo>=this.maxzoom)||"none"===this.visibility}updateTransitions(eo){this._transitioningPaint=this._transitionablePaint.transitioned(eo,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(eo,ec){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(eo,void 0,ec)),this.paint=this._transitioningPaint.possiblyEvaluate(eo,void 0,ec)}serialize(){let eo={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(eo.layout=eo.layout||{},eo.layout.visibility=this.visibility),j(eo,(eo,ec)=>!(void 0===eo||"layout"===ec&&!Object.keys(eo).length||"paint"===ec&&!Object.keys(eo).length))}_validate(eo,ec,ed,em,e_={}){return(!e_||!1!==e_.validate)&&qi(this,eo.call(Ui,{key:ec,layerType:this.type,objectKey:ed,value:em,styleSpec:tr,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(let eo in this.paint._values){let ec=this.paint.get(eo);if(ec instanceof Ts&&Ln(ec.property.specification)&&("source"===ec.value.kind||"composite"===ec.value.kind)&&ec.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=hi(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}};let iC=Rs([{name:"a_pos",components:2,type:"Int16"}],4),iP=Rs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);let so=class so{constructor(eo=[]){this.segments=eo}prepareSegment(eo,ec,ed,em){let e_=this.segments[this.segments.length-1];return eo>so.MAX_VERTEX_ARRAY_LENGTH&&N(`Max vertices per segment is ${so.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${eo}`),(!e_||e_.vertexLength+eo>so.MAX_VERTEX_ARRAY_LENGTH||e_.sortKey!==em)&&(e_={vertexOffset:ec.length,primitiveOffset:ed.length,vertexLength:0,primitiveLength:0},void 0!==em&&(e_.sortKey=em),this.segments.push(e_)),e_}get(){return this.segments}destroy(){for(let eo of this.segments)for(let ec in eo.vaos)eo.vaos[ec].destroy()}static simpleSegment(eo,ec,ed,em){return new so([{vertexOffset:eo,primitiveOffset:ec,vertexLength:ed,primitiveLength:em,vaos:{},sortKey:0}])}};so.MAX_VERTEX_ARRAY_LENGTH=65535,Ji(so,"SegmentVector");let oo=class oo{constructor(eo,ec){eo&&(ec?this.setSouthWest(eo).setNorthEast(ec):4===eo.length?this.setSouthWest([eo[0],eo[1]]).setNorthEast([eo[2],eo[3]]):this.setSouthWest(eo[0]).setNorthEast(eo[1]))}setNorthEast(eo){return this._ne=eo instanceof iq?new iq(eo.lng,eo.lat):iq.convert(eo),this}setSouthWest(eo){return this._sw=eo instanceof iq?new iq(eo.lng,eo.lat):iq.convert(eo),this}extend(eo){let ec,ed;let em=this._sw,e_=this._ne;if(eo instanceof iq)ec=eo,ed=eo;else{if(!(eo instanceof oo))return Array.isArray(eo)?4===eo.length||eo.every(Array.isArray)?this.extend(oo.convert(eo)):this.extend(iq.convert(eo)):"object"==typeof eo&&null!==eo&&eo.hasOwnProperty("lat")&&(eo.hasOwnProperty("lon")||eo.hasOwnProperty("lng"))?this.extend(iq.convert(eo)):this;if(ec=eo._sw,ed=eo._ne,!ec||!ed)return this}return em||e_?(em.lng=Math.min(ec.lng,em.lng),em.lat=Math.min(ec.lat,em.lat),e_.lng=Math.max(ed.lng,e_.lng),e_.lat=Math.max(ed.lat,e_.lat)):(this._sw=new iq(ec.lng,ec.lat),this._ne=new iq(ed.lng,ed.lat)),this}getCenter(){return new iq((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new iq(this.getWest(),this.getNorth())}getSouthEast(){return new iq(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(eo){let{lng:ec,lat:ed}=iq.convert(eo),em=this._sw.lng<=ec&&ec<=this._ne.lng;return this._sw.lng>this._ne.lng&&(em=this._sw.lng>=ec&&ec>=this._ne.lng),this._sw.lat<=ed&&ed<=this._ne.lat&&em}static convert(eo){return!eo||eo instanceof oo?eo:new oo(eo)}};var iz="undefined"!=typeof Float32Array?Float32Array:Array;function co(){var eo=new iz(9);return iz!=Float32Array&&(eo[1]=0,eo[2]=0,eo[3]=0,eo[5]=0,eo[6]=0,eo[7]=0),eo[0]=1,eo[4]=1,eo[8]=1,eo}function ho(eo,ec,ed){var em=ec[0],e_=ec[1],eg=ec[2],ex=ec[3],ev=ec[4],eb=ec[5],ew=ec[6],eT=ec[7],eE=ec[8],eM=ed[0],eS=ed[1],eA=ed[2],eI=ed[3],eC=ed[4],eP=ed[5],ez=ed[6],eD=ed[7],ek=ed[8];return eo[0]=eM*em+eS*ex+eA*ew,eo[1]=eM*e_+eS*ev+eA*eT,eo[2]=eM*eg+eS*eb+eA*eE,eo[3]=eI*em+eC*ex+eP*ew,eo[4]=eI*e_+eC*ev+eP*eT,eo[5]=eI*eg+eC*eb+eP*eE,eo[6]=ez*em+eD*ex+ek*ew,eo[7]=ez*e_+eD*ev+ek*eT,eo[8]=ez*eg+eD*eb+ek*eE,eo}function po(eo){return eo[0]=1,eo[1]=0,eo[2]=0,eo[3]=0,eo[4]=0,eo[5]=1,eo[6]=0,eo[7]=0,eo[8]=0,eo[9]=0,eo[10]=1,eo[11]=0,eo[12]=0,eo[13]=0,eo[14]=0,eo[15]=1,eo}function fo(eo,ec){var ed=ec[0],em=ec[1],e_=ec[2],eg=ec[3],ex=ec[4],ev=ec[5],eb=ec[6],ew=ec[7],eT=ec[8],eE=ec[9],eM=ec[10],eS=ec[11],eA=ec[12],eI=ec[13],eC=ec[14],eP=ec[15],ez=ed*ev-em*ex,eD=ed*eb-e_*ex,ek=ed*ew-eg*ex,eL=em*eb-e_*ev,eR=em*ew-eg*ev,eB=e_*ew-eg*eb,eF=eT*eI-eE*eA,eO=eT*eC-eM*eA,eU=eT*eP-eS*eA,eN=eE*eC-eM*eI,eV=eE*eP-eS*eI,ej=eM*eP-eS*eC,eG=ez*ej-eD*eV+ek*eN+eL*eU-eR*eO+eB*eF;return eG?(eo[0]=(ev*ej-eb*eV+ew*eN)*(eG=1/eG),eo[1]=(e_*eV-em*ej-eg*eN)*eG,eo[2]=(eI*eB-eC*eR+eP*eL)*eG,eo[3]=(eM*eR-eE*eB-eS*eL)*eG,eo[4]=(eb*eU-ex*ej-ew*eO)*eG,eo[5]=(ed*ej-e_*eU+eg*eO)*eG,eo[6]=(eC*ek-eA*eB-eP*eD)*eG,eo[7]=(eT*eB-eM*ek+eS*eD)*eG,eo[8]=(ex*eV-ev*eU+ew*eF)*eG,eo[9]=(em*eU-ed*eV-eg*eF)*eG,eo[10]=(eA*eR-eI*ek+eP*ez)*eG,eo[11]=(eE*ek-eT*eR-eS*ez)*eG,eo[12]=(ev*eO-ex*eN-eb*eF)*eG,eo[13]=(ed*eN-em*eO+e_*eF)*eG,eo[14]=(eI*eD-eA*eL-eC*ez)*eG,eo[15]=(eT*eL-eE*eD+eM*ez)*eG,eo):null}function yo(eo,ec,ed){var em=ec[0],e_=ec[1],eg=ec[2],ex=ec[3],ev=ec[4],eb=ec[5],ew=ec[6],eT=ec[7],eE=ec[8],eM=ec[9],eS=ec[10],eA=ec[11],eI=ec[12],eC=ec[13],eP=ec[14],ez=ec[15],eD=ed[0],ek=ed[1],eL=ed[2],eR=ed[3];return eo[0]=eD*em+ek*ev+eL*eE+eR*eI,eo[1]=eD*e_+ek*eb+eL*eM+eR*eC,eo[2]=eD*eg+ek*ew+eL*eS+eR*eP,eo[3]=eD*ex+ek*eT+eL*eA+eR*ez,eo[4]=(eD=ed[4])*em+(ek=ed[5])*ev+(eL=ed[6])*eE+(eR=ed[7])*eI,eo[5]=eD*e_+ek*eb+eL*eM+eR*eC,eo[6]=eD*eg+ek*ew+eL*eS+eR*eP,eo[7]=eD*ex+ek*eT+eL*eA+eR*ez,eo[8]=(eD=ed[8])*em+(ek=ed[9])*ev+(eL=ed[10])*eE+(eR=ed[11])*eI,eo[9]=eD*e_+ek*eb+eL*eM+eR*eC,eo[10]=eD*eg+ek*ew+eL*eS+eR*eP,eo[11]=eD*ex+ek*eT+eL*eA+eR*ez,eo[12]=(eD=ed[12])*em+(ek=ed[13])*ev+(eL=ed[14])*eE+(eR=ed[15])*eI,eo[13]=eD*e_+ek*eb+eL*eM+eR*eC,eo[14]=eD*eg+ek*ew+eL*eS+eR*eP,eo[15]=eD*ex+ek*eT+eL*eA+eR*ez,eo}function mo(eo,ec,ed){var em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI=ed[0],eC=ed[1],eP=ed[2];return ec===eo?(eo[12]=ec[0]*eI+ec[4]*eC+ec[8]*eP+ec[12],eo[13]=ec[1]*eI+ec[5]*eC+ec[9]*eP+ec[13],eo[14]=ec[2]*eI+ec[6]*eC+ec[10]*eP+ec[14],eo[15]=ec[3]*eI+ec[7]*eC+ec[11]*eP+ec[15]):(e_=ec[1],eg=ec[2],ex=ec[3],ev=ec[4],eb=ec[5],ew=ec[6],eT=ec[7],eE=ec[8],eM=ec[9],eS=ec[10],eA=ec[11],eo[0]=em=ec[0],eo[1]=e_,eo[2]=eg,eo[3]=ex,eo[4]=ev,eo[5]=eb,eo[6]=ew,eo[7]=eT,eo[8]=eE,eo[9]=eM,eo[10]=eS,eo[11]=eA,eo[12]=em*eI+ev*eC+eE*eP+ec[12],eo[13]=e_*eI+eb*eC+eM*eP+ec[13],eo[14]=eg*eI+ew*eC+eS*eP+ec[14],eo[15]=ex*eI+eT*eC+eA*eP+ec[15]),eo}function go(eo,ec,ed){var em=ed[0],e_=ed[1],eg=ed[2];return eo[0]=ec[0]*em,eo[1]=ec[1]*em,eo[2]=ec[2]*em,eo[3]=ec[3]*em,eo[4]=ec[4]*e_,eo[5]=ec[5]*e_,eo[6]=ec[6]*e_,eo[7]=ec[7]*e_,eo[8]=ec[8]*eg,eo[9]=ec[9]*eg,eo[10]=ec[10]*eg,eo[11]=ec[11]*eg,eo[12]=ec[12],eo[13]=ec[13],eo[14]=ec[14],eo[15]=ec[15],eo}function xo(eo,ec,ed){var em=Math.sin(ed),e_=Math.cos(ed),eg=ec[4],ex=ec[5],ev=ec[6],eb=ec[7],ew=ec[8],eT=ec[9],eE=ec[10],eM=ec[11];return ec!==eo&&(eo[0]=ec[0],eo[1]=ec[1],eo[2]=ec[2],eo[3]=ec[3],eo[12]=ec[12],eo[13]=ec[13],eo[14]=ec[14],eo[15]=ec[15]),eo[4]=eg*e_+ew*em,eo[5]=ex*e_+eT*em,eo[6]=ev*e_+eE*em,eo[7]=eb*e_+eM*em,eo[8]=ew*e_-eg*em,eo[9]=eT*e_-ex*em,eo[10]=eE*e_-ev*em,eo[11]=eM*e_-eb*em,eo}function vo(eo,ec,ed){var em=Math.sin(ed),e_=Math.cos(ed),eg=ec[0],ex=ec[1],ev=ec[2],eb=ec[3],ew=ec[8],eT=ec[9],eE=ec[10],eM=ec[11];return ec!==eo&&(eo[4]=ec[4],eo[5]=ec[5],eo[6]=ec[6],eo[7]=ec[7],eo[12]=ec[12],eo[13]=ec[13],eo[14]=ec[14],eo[15]=ec[15]),eo[0]=eg*e_-ew*em,eo[1]=ex*e_-eT*em,eo[2]=ev*e_-eE*em,eo[3]=eb*e_-eM*em,eo[8]=eg*em+ew*e_,eo[9]=ex*em+eT*e_,eo[10]=ev*em+eE*e_,eo[11]=eb*em+eM*e_,eo}function bo(eo,ec){return eo[0]=ec[0],eo[1]=0,eo[2]=0,eo[3]=0,eo[4]=0,eo[5]=ec[1],eo[6]=0,eo[7]=0,eo[8]=0,eo[9]=0,eo[10]=ec[2],eo[11]=0,eo[12]=0,eo[13]=0,eo[14]=0,eo[15]=1,eo}function wo(eo,ec,ed){var em,e_,eg,ex=ed[0],ev=ed[1],eb=ed[2],ew=Math.hypot(ex,ev,eb);return ew<1e-6?null:(ex*=ew=1/ew,ev*=ew,eb*=ew,em=Math.sin(ec),e_=Math.cos(ec),eo[0]=ex*ex*(eg=1-e_)+e_,eo[1]=ev*ex*eg+eb*em,eo[2]=eb*ex*eg-ev*em,eo[3]=0,eo[4]=ex*ev*eg-eb*em,eo[5]=ev*ev*eg+e_,eo[6]=eb*ev*eg+ex*em,eo[7]=0,eo[8]=ex*eb*eg+ev*em,eo[9]=ev*eb*eg-ex*em,eo[10]=eb*eb*eg+e_,eo[11]=0,eo[12]=0,eo[13]=0,eo[14]=0,eo[15]=1,eo)}function Ao(){var eo=new iz(3);return iz!=Float32Array&&(eo[0]=0,eo[1]=0,eo[2]=0),eo}function So(eo){var ec=new iz(3);return ec[0]=eo[0],ec[1]=eo[1],ec[2]=eo[2],ec}function ko(eo){return Math.hypot(eo[0],eo[1],eo[2])}function Io(eo,ec,ed){var em=new iz(3);return em[0]=eo,em[1]=ec,em[2]=ed,em}function Mo(eo,ec,ed){return eo[0]=ec[0]+ed[0],eo[1]=ec[1]+ed[1],eo[2]=ec[2]+ed[2],eo}function To(eo,ec,ed){return eo[0]=ec[0]-ed[0],eo[1]=ec[1]-ed[1],eo[2]=ec[2]-ed[2],eo}function zo(eo,ec,ed){return eo[0]=ec[0]*ed[0],eo[1]=ec[1]*ed[1],eo[2]=ec[2]*ed[2],eo}function Bo(eo,ec,ed){return eo[0]=Math.min(ec[0],ed[0]),eo[1]=Math.min(ec[1],ed[1]),eo[2]=Math.min(ec[2],ed[2]),eo}function Eo(eo,ec,ed){return eo[0]=Math.max(ec[0],ed[0]),eo[1]=Math.max(ec[1],ed[1]),eo[2]=Math.max(ec[2],ed[2]),eo}function Co(eo,ec,ed){return eo[0]=ec[0]*ed,eo[1]=ec[1]*ed,eo[2]=ec[2]*ed,eo}function Po(eo,ec,ed,em){return eo[0]=ec[0]+ed[0]*em,eo[1]=ec[1]+ed[1]*em,eo[2]=ec[2]+ed[2]*em,eo}function Do(eo,ec){var ed=ec[0],em=ec[1],e_=ec[2],eg=ed*ed+em*em+e_*e_;return eg>0&&(eg=1/Math.sqrt(eg)),eo[0]=ec[0]*eg,eo[1]=ec[1]*eg,eo[2]=ec[2]*eg,eo}function Vo(eo,ec){return eo[0]*ec[0]+eo[1]*ec[1]+eo[2]*ec[2]}function Lo(eo,ec,ed){var em=ec[0],e_=ec[1],eg=ec[2],ex=ed[0],ev=ed[1],eb=ed[2];return eo[0]=e_*eb-eg*ev,eo[1]=eg*ex-em*eb,eo[2]=em*ev-e_*ex,eo}function Fo(eo,ec,ed){var em=ec[0],e_=ec[1],eg=ec[2],ex=ed[3]*em+ed[7]*e_+ed[11]*eg+ed[15];return eo[0]=(ed[0]*em+ed[4]*e_+ed[8]*eg+ed[12])/(ex=ex||1),eo[1]=(ed[1]*em+ed[5]*e_+ed[9]*eg+ed[13])/ex,eo[2]=(ed[2]*em+ed[6]*e_+ed[10]*eg+ed[14])/ex,eo}function Ro(eo,ec,ed){var em=ed[0],e_=ed[1],eg=ed[2],ex=ec[0],ev=ec[1],eb=ec[2],ew=e_*eb-eg*ev,eT=eg*ex-em*eb,eE=em*ev-e_*ex,eM=e_*eE-eg*eT,eS=eg*ew-em*eE,eA=em*eT-e_*ew,eI=2*ed[3];return eT*=eI,eE*=eI,eS*=2,eA*=2,eo[0]=ex+(ew*=eI)+(eM*=2),eo[1]=ev+eT+eS,eo[2]=eb+eE+eA,eo}function qo(eo,ec,ed){return eo[0]=ec[0]*ed,eo[1]=ec[1]*ed,eo[2]=ec[2]*ed,eo[3]=ec[3]*ed,eo}function No(eo,ec){var ed=ec[0],em=ec[1],e_=ec[2],eg=ec[3],ex=ed*ed+em*em+e_*e_+eg*eg;return ex>0&&(ex=1/Math.sqrt(ex)),eo[0]=ed*ex,eo[1]=em*ex,eo[2]=e_*ex,eo[3]=eg*ex,eo}function Go(eo,ec,ed){var em=ec[0],e_=ec[1],eg=ec[2],ex=ec[3];return eo[0]=ed[0]*em+ed[4]*e_+ed[8]*eg+ed[12]*ex,eo[1]=ed[1]*em+ed[5]*e_+ed[9]*eg+ed[13]*ex,eo[2]=ed[2]*em+ed[6]*e_+ed[10]*eg+ed[14]*ex,eo[3]=ed[3]*em+ed[7]*e_+ed[11]*eg+ed[15]*ex,eo}function Zo(){var eo=new iz(4);return iz!=Float32Array&&(eo[0]=0,eo[1]=0,eo[2]=0),eo[3]=1,eo}function Ko(eo){return eo[0]=0,eo[1]=0,eo[2]=0,eo[3]=1,eo}function Xo(eo,ec,ed){ed*=.5;var em=ec[0],e_=ec[1],eg=ec[2],ex=ec[3],ev=Math.sin(ed),eb=Math.cos(ed);return eo[0]=em*eb+ex*ev,eo[1]=e_*eb+eg*ev,eo[2]=eg*eb-e_*ev,eo[3]=ex*eb-em*ev,eo}function Jo(eo,ec,ed){ed*=.5;var em=ec[0],e_=ec[1],eg=ec[2],ex=ec[3],ev=Math.sin(ed),eb=Math.cos(ed);return eo[0]=em*eb-eg*ev,eo[1]=e_*eb+ex*ev,eo[2]=eg*eb+em*ev,eo[3]=ex*eb-e_*ev,eo}Math.hypot||(Math.hypot=function(){for(var eo=0,ec=arguments.length;ec--;)eo+=arguments[ec]*arguments[ec];return Math.sqrt(eo)}),Ao(),eE=new iz(4),iz!=Float32Array&&(eE[0]=0,eE[1]=0,eE[2]=0,eE[3]=0),Ao(),Io(1,0,0),Io(0,1,0),Zo(),Zo(),co();let iD=Rs([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:ik}=iD,iL=Rs([{name:"a_pos_3",components:3,type:"Int16"}]);var iR=Rs([{name:"a_pos",type:"Int16",components:2}]);let el=class el{constructor(eo,ec){this.pos=eo,this.dir=ec}intersectsPlane(eo,ec,ed){let em=Vo(ec,this.dir);if(1e-6>Math.abs(em))return!1;let e_=((eo[0]-this.pos[0])*ec[0]+(eo[1]-this.pos[1])*ec[1]+(eo[2]-this.pos[2])*ec[2])/em;return ed[0]=this.pos[0]+this.dir[0]*e_,ed[1]=this.pos[1]+this.dir[1]*e_,ed[2]=this.pos[2]+this.dir[2]*e_,!0}closestPointOnSphere(eo,ec,ed){var em,e_,eg,ex,ev,eb,ew;if(e_=(em=this.pos)[0],eg=em[1],ex=em[2],ev=eo[0],eb=eo[1],ew=eo[2],Math.abs(e_-ev)<=1e-6*Math.max(1,Math.abs(e_),Math.abs(ev))&&Math.abs(eg-eb)<=1e-6*Math.max(1,Math.abs(eg),Math.abs(eb))&&Math.abs(ex-ew)<=1e-6*Math.max(1,Math.abs(ex),Math.abs(ew))||0===ec)return ed[0]=ed[1]=ed[2]=0,!1;let[eT,eE,eM]=this.dir,eS=this.pos[0]-eo[0],eA=this.pos[1]-eo[1],eI=this.pos[2]-eo[2],eC=eT*eT+eE*eE+eM*eM,eP=2*(eS*eT+eA*eE+eI*eM),ez=eP*eP-4*eC*(eS*eS+eA*eA+eI*eI-ec*ec);if(ez<0){let eo=Math.max(-eP/2,0),em=eS+eT*eo,e_=eA+eE*eo,eg=eI+eM*eo,ex=Math.hypot(em,e_,eg);return ed[0]=em*ec/ex,ed[1]=e_*ec/ex,ed[2]=eg*ec/ex,!1}{let eo=(-eP-Math.sqrt(ez))/(2*eC);if(eo<0){let eo=Math.hypot(eS,eA,eI);return ed[0]=eS*ec/eo,ed[1]=eA*ec/eo,ed[2]=eI*ec/eo,!1}return ed[0]=eS+eT*eo,ed[1]=eA+eE*eo,ed[2]=eI+eM*eo,!0}}};let rl=class rl{constructor(eo,ec,ed,em,e_){this.TL=eo,this.TR=ec,this.BR=ed,this.BL=em,this.horizon=e_}static fromInvProjectionMatrix(eo,ec,ed){let em=[-1,1,1],e_=[1,1,1],eg=[1,-1,1],ex=[-1,-1,1],ev=Fo(em,em,eo),eb=Fo(e_,e_,eo),ew=Fo(eg,eg,eo),eT=Fo(ex,ex,eo);return new rl(ev,eb,ew,eT,ec/ed)}};let nl=class nl{constructor(eo,ec){this.points=eo,this.planes=ec}static fromInvProjectionMatrix(eo,ec,ed,em){let e_=Math.pow(2,ed),eg=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(ed=>{var eg;let ex=Go([],ed,eo),ev=1/ex[3]/ec*e_;return eg=[ev,ev,em?1/ex[3]:ev,ev],ex[0]=ex[0]*eg[0],ex[1]=ex[1]*eg[1],ex[2]=ex[2]*eg[2],ex[3]=ex[3]*eg[3],ex}),ex=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(eo=>{let ec=Do([],Lo([],To([],eg[eo[0]],eg[eo[1]]),To([],eg[eo[2]],eg[eo[1]]))),ed=-Vo(ec,eg[eo[1]]);return ec.concat(ed)});return new nl(eg,ex)}};let il=class il{static fromPoints(eo){let ec=[1/0,1/0,1/0],ed=[-1/0,-1/0,-1/0];for(let em of eo)Bo(ec,ec,em),Eo(ed,ed,em);return new il(ec,ed)}static applyTransform(eo,ec){let ed=eo.getCorners();for(let eo=0;eo<ed.length;++eo)Fo(ed[eo],ed[eo],ec);return il.fromPoints(ed)}constructor(eo,ec){this.min=eo,this.max=ec,this.center=Co([],Mo([],this.min,this.max),.5)}quadrant(eo){let ec=[eo%2==0,eo<2],ed=So(this.min),em=So(this.max);for(let eo=0;eo<ec.length;eo++)ed[eo]=ec[eo]?this.min[eo]:this.center[eo],em[eo]=ec[eo]?this.center[eo]:this.max[eo];return em[2]=this.max[2],new il(ed,em)}distanceX(eo){return Math.max(Math.min(this.max[0],eo[0]),this.min[0])-eo[0]}distanceY(eo){return Math.max(Math.min(this.max[1],eo[1]),this.min[1])-eo[1]}distanceZ(eo){return Math.max(Math.min(this.max[2],eo[2]),this.min[2])-eo[2]}getCorners(){let eo=this.min,ec=this.max;return[[eo[0],eo[1],eo[2]],[ec[0],eo[1],eo[2]],[ec[0],ec[1],eo[2]],[eo[0],ec[1],eo[2]],[eo[0],eo[1],ec[2]],[ec[0],eo[1],ec[2]],[ec[0],ec[1],ec[2]],[eo[0],ec[1],ec[2]]]}intersects(eo){let ec=this.getCorners(),ed=!0;for(let em=0;em<eo.planes.length;em++){let e_=eo.planes[em],eg=0;for(let eo=0;eo<ec.length;eo++)eg+=Vo(e_,ec[eo])+e_[3]>=0;if(0===eg)return 0;eg!==ec.length&&(ed=!1)}if(ed)return 2;for(let ec=0;ec<3;ec++){let ed=Number.MAX_VALUE,em=-Number.MAX_VALUE;for(let e_=0;e_<eo.points.length;e_++){let eg=eo.points[e_][ec]-this.min[ec];ed=Math.min(ed,eg),em=Math.max(em,eg)}if(em<0||ed>this.max[ec]-this.min[ec])return 0}return 1}};let iB=8192/Math.PI/2,iF=[64,32,16],iO=-iB,iU=[new il([iO,iO,iO],[iB,iB,iB]),new il([iO,iO,iO],[0,0,iB]),new il([0,iO,iO],[iB,0,iB]),new il([iO,0,iO],[0,iB,iB]),new il([0,0,iO],[iB,iB,iB])];function fl(eo){return eo*iB/iZ}function yl(eo,ec,ed,em=!0){let e_=Co([],eo._camera.position,eo.worldSize),eg=[ec,ed,1,1];Go(eg,eg,eo.pixelMatrixInverse),qo(eg,eg,1/eg[3]);let ex=Do([],To([],eg,e_)),ev=eo.globeMatrix,eb=[ev[12],ev[13],ev[14]],ew=To([],eb,e_),eT=ko(ew),eE=Do([],ew),eM=eo.worldSize/(2*Math.PI),eS=Vo(eE,ex),eA=Math.asin(eM/eT);if(eA<Math.acos(eS)){if(!em)return null;let eo=[],ec=[];Co(eo,ex,eT/eS),Do(ec,To(ec,eo,ew)),Do(ex,Mo(ex,ew,Co(ex,ec,Math.tan(eA)*eT)))}let eI=[];new el(e_,ex).closestPointOnSphere(eb,eM,eI);let eC=Do([],W(ev,0)),eP=Do([],W(ev,1)),ez=Do([],W(ev,2)),eD=Vo(eC,eI),ek=Vo(eP,eI),eL=Vo(ez,eI),eR=Math.asin(-ek/eM)*eB,eF=Math.atan2(eD,eL)*eB;eF=eo.center.lng+function(eo,ec){let ed=(ec-eo+180)%360-180;return ed<-180?ed+360:ed}(eo.center.lng,eF);let eO=Nl(eF),eU=M(Gl(eR),0,1);return new Wl(eO,eU)}let ml=class ml{constructor(eo,ec,ed){this.a=To([],eo,ed),this.b=To([],ec,ed),this.center=ed;let em=Do([],this.a),e_=Do([],this.b);this.angle=Math.acos(Vo(em,e_))}};function gl(eo,ec){let ed;return 0===eo.angle?null:(ed=0===eo.a[ec]?1/eo.angle*.5*Math.PI:1/eo.angle*Math.atan(eo.b[ec]/eo.a[ec]/Math.sin(eo.angle)-1/Math.tan(eo.angle)))<0||ed>1?null:function(eo,ec,ed,em){let e_=Math.sin(ed);return eo*(Math.sin((1-em)*ed)/e_)+ec*(Math.sin(em*ed)/e_)}(eo.a[ec],eo.b[ec],eo.angle,M(ed,0,1))+eo.center[ec]}function xl(eo){if(eo.z<=1)return iU[eo.z+2*eo.y+eo.x];let ec=Sl(Al(eo));return il.fromPoints(ec)}function vl(eo,ec,ed){return Co(eo,eo,1-ed),Po(eo,eo,ec,ed)}function bl(eo,ec){let ed=Pl(ec.zoom);if(0===ed)return xl(eo);let em=Al(eo),e_=Sl(em),eg=Nl(em.getWest())*ec.worldSize,ex=Nl(em.getEast())*ec.worldSize,ev=Gl(em.getNorth())*ec.worldSize,eb=Gl(em.getSouth())*ec.worldSize,ew=[eg,ev,0],eT=[ex,ev,0],eE=[eg,eb,0],eM=[ex,eb,0],eS=fo([],ec.globeMatrix);return Fo(ew,ew,eS),Fo(eT,eT,eS),Fo(eE,eE,eS),Fo(eM,eM,eS),e_[0]=vl(e_[0],eE,ed),e_[1]=vl(e_[1],eM,ed),e_[2]=vl(e_[2],eT,ed),e_[3]=vl(e_[3],ew,ed),il.fromPoints(e_)}function wl(eo,ec,ed){for(let em of eo)Fo(em,em,ec),Co(em,em,ed)}function Al({x:eo,y:ec,z:ed}){let em=1/(1<<ed),e_=new iq(Kl(eo*em),Xl((ec+1)*em)),eg=new iq(Kl((eo+1)*em),Xl(ec*em));return new oo(e_,eg)}function Sl(eo){let ec=eo.getNorth()*eR,ed=eo.getSouth()*eR,em=Math.cos(ec),e_=Math.cos(ed),eg=Math.sin(ec),ex=Math.sin(ed),ev=eo.getWest(),eb=eo.getEast();return[kl(e_,ex,ev),kl(e_,ex,eb),kl(em,eg,eb),kl(em,eg,ev)]}function kl(eo,ec,ed,em=iB){return[eo*Math.sin(ed*=eR)*em,-ec*em,eo*Math.cos(ed)*em]}function Il(eo,ec,ed){return kl(Math.cos(eo*eR),Math.sin(eo*eR),ec,ed)}function Ml(eo,ec,ed,em){let e_=1<<ed.z,eg=(eo/8192+ed.x)/e_;return Il(Xl((ec/8192+ed.y)/e_),Kl(eg),em)}function Tl({min:eo,max:ec}){return 16383/Math.max(ec[0]-eo[0],ec[1]-eo[1],ec[2]-eo[2])}let iN=new Float64Array(16);function Bl(eo){var ec,ed;let em=Tl(eo),e_=bo(iN,[em,em,em]);return mo(e_,e_,((ec=[])[0]=-(ed=eo.min)[0],ec[1]=-ed[1],ec[2]=-ed[2],ec))}function El(eo){var ec;let ed=(ec=eo.min,iN[0]=1,iN[1]=0,iN[2]=0,iN[3]=0,iN[4]=0,iN[5]=1,iN[6]=0,iN[7]=0,iN[8]=0,iN[9]=0,iN[10]=1,iN[11]=0,iN[12]=ec[0],iN[13]=ec[1],iN[14]=ec[2],iN[15]=1,iN),em=1/Tl(eo);return go(ed,ed,[em,em,em])}function Cl(eo,ec,ed,em,e_){let eg=function(eo){let ec=8192/(2*Math.PI);return eo/(2*Math.PI)/ec}(ed),ex=[eo,ec,-ed/(2*Math.PI)],ev=po(new Float64Array(16));return mo(ev,ev,ex),go(ev,ev,[eg,eg,eg]),xo(ev,ev,-e_*eR),vo(ev,ev,-em*eR),ev}function Pl(eo){return T(5,6,eo)}function Dl(eo,ec){var ed,em,e_,eg,ex,ev,eb,ew;let eT=Il(ec.lat,ec.lng),eE=function(eo){let ec=Il(eo._center.lat,eo._center.lng),ed=Lo([],Io(0,1,0),ec),em=wo([],-eo.angle,ec);ed=Fo(ed,ed,em),wo(em,-eo._pitch,ed);let e_=Do([],ec);return Co(e_,e_,fl(eo.cameraToCenterDistance/eo.pixelsPerMeter)),Fo(e_,e_,em),Mo([],ec,e_)}(eo);return em=(ed=To([],eE,eT))[0],e_=ed[1],eg=ed[2],Math.acos(Math.min(Math.max((ew=Math.sqrt(em*em+e_*e_+eg*eg)*Math.sqrt((ex=eT[0])*ex+(ev=eT[1])*ev+(eb=eT[2])*eb))&&Vo(ed,eT)/ew,-1),1))}function Vl(eo,ec){return Dl(eo,ec)>Math.PI/2*1.01}let iV=85*eR,ij=Math.cos(iV),iG=Math.sin(iV),iZ=6371008.8,i$=2*Math.PI*iZ;let jl=class jl{constructor(eo,ec){if(isNaN(eo)||isNaN(ec))throw Error(`Invalid LngLat object: (${eo}, ${ec})`);if(this.lng=+eo,this.lat=+ec,this.lat>90||this.lat<-90)throw Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new jl(z(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(eo){let ec=Math.PI/180,ed=this.lat*ec,em=eo.lat*ec,e_=Math.sin(ed)*Math.sin(em)+Math.cos(ed)*Math.cos(em)*Math.cos((eo.lng-this.lng)*ec);return iZ*Math.acos(Math.min(e_,1))}toBounds(eo=0){let ec=360*eo/40075017,ed=ec/Math.cos(Math.PI/180*this.lat);return new oo(new jl(this.lng-ed,this.lat-ec),new jl(this.lng+ed,this.lat+ec))}toEcef(eo){let ec=fl(eo);return Il(this.lat,this.lng,iB+ec)}static convert(eo){if(eo instanceof jl)return eo;if(Array.isArray(eo)&&(2===eo.length||3===eo.length))return new jl(Number(eo[0]),Number(eo[1]));if(!Array.isArray(eo)&&"object"==typeof eo&&null!==eo)return new jl(Number("lng"in eo?eo.lng:eo.lon),Number(eo.lat));throw Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}};var iq=jl;function ql(eo){return i$*Math.cos(eo*Math.PI/180)}function Nl(eo){return(180+eo)/360}function Gl(eo){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+eo*Math.PI/360)))/360}function Kl(eo){return 360*eo-180}function Xl(eo){return 360/Math.PI*Math.atan(Math.exp((180-360*eo)*Math.PI/180))-90}function Yl(eo){return 1/Math.cos(eo*Math.PI/180)}let Wl=class Wl{constructor(eo,ec,ed=0){this.x=+eo,this.y=+ec,this.z=+ed}static fromLngLat(eo,ec=0){let ed=iq.convert(eo);return new Wl(Nl(ed.lng),Gl(ed.lat),ec/ql(ed.lat))}toLngLat(){return new iq(Kl(this.x),Xl(this.y))}toAltitude(){return this.z*ql(Xl(this.y))}meterInMercatorCoordinateUnits(){return 1/i$*Yl(Xl(this.y))}};function tu(eo,ec,ed){let em=eo[0],e_=em.x,eg=em.y;ec(em);let ex=[em];for(let ev=1;ev<eo.length;ev++){let eb=eo[ev],{x:ew,y:eT}=eb;ec(eb),function Ql(eo,ec,ed,em,e_,eg,ex,ev,eb){let ew=(ec+em)/2,eT=(ed+e_)/2,eE=new eL(ew,eT);ev(eE),function(eo,ec,ed,em,e_,eg){let ex=ed-e_,ev=em-eg;return Math.abs((em-ec)*ex-(ed-eo)*ev)/Math.hypot(ex,ev)}(eE.x,eE.y,eg.x,eg.y,ex.x,ex.y)>=eb?(Ql(eo,ec,ed,ew,eT,eg,eE,ev,eb),Ql(eo,ew,eT,em,e_,eE,ex,ev,eb)):eo.push(ex)}(ex,e_,eg,ew,eT,em,eb,ec,ed),e_=ew,eg=eT,em=eb}return ex}let iX=-16383-1;function au(eo,ec,ed){let em=eo.loadGeometry(),e_=eo.extent,eg=8192/e_;if(ec&&ed&&ed.projection.isReprojectedInTileSpace){let eg=1<<ec.z,{scale:ex,x:ev,y:eb,projection:ew}=ed,c=eo=>{let ed=Kl((ec.x+eo.x/e_)/eg),em=Xl((ec.y+eo.y/e_)/eg),eT=ew.project(ed,em);eo.x=(eT.x*ex-ev)*e_,eo.y=(eT.y*ex-eb)*e_};for(let ec=0;ec<em.length;ec++)if(1!==eo.type)em[ec]=tu(em[ec],c,1);else{let eo=[];for(let ed of em[ec])ed.x<0||ed.x>=e_||ed.y<0||ed.y>=e_||(c(ed),eo.push(ed));em[ec]=eo}}for(let eo of em)for(let ec of eo)!function(eo,ec){let ed=Math.round(eo.x*ec),em=Math.round(eo.y*ec);eo.x=M(ed,iX,16383),eo.y=M(em,iX,16383),(ed<eo.x||ed>eo.x+1||em<eo.y||em>eo.y+1)&&N("Geometry exceeds allowed extent, reduce your vector tile buffer size")}(ec,eg);return em}function ou(eo,ec){return{type:eo.type,id:eo.id,properties:eo.properties,geometry:ec?au(eo):[]}}function lu(eo,ec,ed,em,e_){eo.emplaceBack(2*ec+(em+1)/2,2*ed+(e_+1)/2)}function uu(eo,ec,ed){eo.emplaceBack(ec.x,ec.y,ec.z,16384*ed[0],16384*ed[1],16384*ed[2])}let cu=class cu{constructor(eo){this.zoom=eo.zoom,this.overscaling=eo.overscaling,this.layers=eo.layers,this.layerIds=this.layers.map(eo=>eo.id),this.index=eo.index,this.hasPattern=!1,this.projection=eo.projection,this.layoutVertexArray=new $s,this.indexArray=new ra,this.segments=new so,this.programConfigurations=new Ja(eo.layers,eo.zoom),this.stateDependentLayerIds=this.layers.filter(eo=>eo.isStateDependent()).map(eo=>eo.id)}populate(eo,ec,ed,em){let e_=this.layers[0],eg=[],ex=null;for(let{feature:ec,id:ev,index:eb,sourceLayerIndex:ew}of("circle"===e_.type&&(ex=e_.layout.get("circle-sort-key")),eo)){let eo=this.layers[0]._featureFilter.needGeometry,e_=ou(ec,eo);if(!this.layers[0]._featureFilter.filter(new ws(this.zoom),e_,ed))continue;let eT=ex?ex.evaluate(e_,{},ed):void 0,eE={id:ev,properties:ec.properties,type:ec.type,sourceLayerIndex:ew,index:eb,geometry:eo?e_.geometry:au(ec,ed,em),patterns:{},sortKey:eT};eg.push(eE)}ex&&eg.sort((eo,ec)=>eo.sortKey-ec.sortKey);let ev=null;for(let e_ of("globe"===em.projection.name&&(this.globeExtVertexArray=new Ks,ev=em.projection),eg)){let{geometry:em,index:eg,sourceLayerIndex:ex}=e_,eb=eo[eg].feature;this.addFeature(e_,em,eg,ec.availableImages,ed,ev),ec.featureIndex.insert(eb,em,eg,ex,this.index)}}update(eo,ec,ed,em){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(eo,ec,this.stateDependentLayers,ed,em)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(eo){this.uploaded||(this.layoutVertexBuffer=eo.createVertexBuffer(this.layoutVertexArray,iC.members),this.indexBuffer=eo.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=eo.createVertexBuffer(this.globeExtVertexArray,iP.members))),this.programConfigurations.upload(eo),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(eo,ec,ed,em,e_,eg){for(let ed of ec)for(let ec of ed){let ed=ec.x,em=ec.y;if(ed<0||ed>=8192||em<0||em>=8192)continue;if(eg){let eo=eg.projectTilePoint(ed,em,e_),ec=eg.upVector(e_,ed,em),ex=this.globeExtVertexArray;uu(ex,eo,ec),uu(ex,eo,ec),uu(ex,eo,ec),uu(ex,eo,ec)}let ex=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,eo.sortKey),ev=ex.vertexLength;lu(this.layoutVertexArray,ed,em,-1,-1),lu(this.layoutVertexArray,ed,em,1,-1),lu(this.layoutVertexArray,ed,em,1,1),lu(this.layoutVertexArray,ed,em,-1,1),this.indexArray.emplaceBack(ev,ev+1,ev+2),this.indexArray.emplaceBack(ev,ev+2,ev+3),ex.vertexLength+=4,ex.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,eo,ed,{},em,e_)}};function hu(eo,ec){for(let ed=0;ed<eo.length;ed++)if(bu(ec,eo[ed]))return!0;for(let ed=0;ed<ec.length;ed++)if(bu(eo,ec[ed]))return!0;return!!yu(eo,ec)}function du(eo,ec){if(1===eo.length)return vu(ec,eo[0]);for(let ed=0;ed<ec.length;ed++){let em=ec[ed];for(let ec=0;ec<em.length;ec++)if(bu(eo,em[ec]))return!0}for(let ed=0;ed<eo.length;ed++)if(vu(ec,eo[ed]))return!0;for(let ed=0;ed<ec.length;ed++)if(yu(eo,ec[ed]))return!0;return!1}function yu(eo,ec){if(0===eo.length||0===ec.length)return!1;for(let e_=0;e_<eo.length-1;e_++){let eg=eo[e_],ex=eo[e_+1];for(let eo=0;eo<ec.length-1;eo++){var ed,em;if(G(eg,ed=ec[eo],em=ec[eo+1])!==G(ex,ed,em)&&G(eg,ex,ed)!==G(eg,ex,em))return!0}}return!1}function gu(eo,ec,ed){let em=ed*ed;if(1===ec.length)return eo.distSqr(ec[0])<em;for(let ed=1;ed<ec.length;ed++)if(xu(eo,ec[ed-1],ec[ed])<em)return!0;return!1}function xu(eo,ec,ed){let em=ec.distSqr(ed);if(0===em)return eo.distSqr(ec);let e_=((eo.x-ec.x)*(ed.x-ec.x)+(eo.y-ec.y)*(ed.y-ec.y))/em;return eo.distSqr(e_<0?ec:e_>1?ed:ed.sub(ec)._mult(e_)._add(ec))}function vu(eo,ec){let ed,em,e_,eg=!1;for(let ex=0;ex<eo.length;ex++){ed=eo[ex];for(let eo=0,ex=ed.length-1;eo<ed.length;ex=eo++)em=ed[eo],e_=ed[ex],em.y>ec.y!=e_.y>ec.y&&ec.x<(e_.x-em.x)*(ec.y-em.y)/(e_.y-em.y)+em.x&&(eg=!eg)}return eg}function bu(eo,ec){let ed=!1;for(let em=0,e_=eo.length-1;em<eo.length;e_=em++){let eg=eo[em],ex=eo[e_];eg.y>ec.y!=ex.y>ec.y&&ec.x<(ex.x-eg.x)*(ec.y-eg.y)/(ex.y-eg.y)+eg.x&&(ed=!ed)}return ed}function wu(eo,ec,ed,em,e_){for(let eg of eo)if(ec<=eg.x&&ed<=eg.y&&em>=eg.x&&e_>=eg.y)return!0;let eg=[new eL(ec,ed),new eL(ec,e_),new eL(em,e_),new eL(em,ed)];if(eo.length>2){for(let ec of eg)if(bu(eo,ec))return!0}for(let ec=0;ec<eo.length-1;ec++)if(function(eo,ec,ed){let em=ed[0],e_=ed[2];if(eo.x<em.x&&ec.x<em.x||eo.x>e_.x&&ec.x>e_.x||eo.y<em.y&&ec.y<em.y||eo.y>e_.y&&ec.y>e_.y)return!1;let eg=G(eo,ec,ed[0]);return eg!==G(eo,ec,ed[1])||eg!==G(eo,ec,ed[2])||eg!==G(eo,ec,ed[3])}(eo[ec],eo[ec+1],eg))return!0;return!1}function Au(eo,ec,ed){let em=ec.paint.get(eo).value;return"constant"===em.kind?em.value:ed.programConfigurations.get(ec.id).getMaxValue(eo)}function Su(eo){return Math.sqrt(eo[0]*eo[0]+eo[1]*eo[1])}function ku(eo,ec,ed,em,e_){if(!ec[0]&&!ec[1])return eo;let eg=eL.convert(ec)._mult(e_);"viewport"===ed&&eg._rotate(-em);let ex=[];for(let ec=0;ec<eo.length;ec++)ex.push(eo[ec].sub(eg));return ex}function Iu(eo,ec,ed,em){let e_=eL.convert(eo)._mult(em);return"viewport"===ec&&e_._rotate(-ed),e_}Ji(cu,"CircleBucket",{omit:["layers"]});let iW=new Ps({"circle-sort-key":new Es(tr.layout_circle["circle-sort-key"])});var iH={paint:new Ps({"circle-radius":new Es(tr.paint_circle["circle-radius"]),"circle-color":new Es(tr.paint_circle["circle-color"]),"circle-blur":new Es(tr.paint_circle["circle-blur"]),"circle-opacity":new Es(tr.paint_circle["circle-opacity"]),"circle-translate":new Bs(tr.paint_circle["circle-translate"]),"circle-translate-anchor":new Bs(tr.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bs(tr.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bs(tr.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Es(tr.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Es(tr.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Es(tr.paint_circle["circle-stroke-opacity"])}),layout:iW};function zu(eo,ec,ed,em,e_,eg,ex,ev,eb){if(eg&&eo.queryGeometry.isAboveHorizon)return!1;eg&&(eb*=eo.pixelToTileUnitsFactor);let ew=eo.tileID.canonical,eT=ed.projection.upVectorScale(ew,ed.center.lat,ed.worldSize).metersToTile;for(let eM of ec)for(let ec of eM){var eE;let eM=ec.add(ev),eS=e_&&ed.elevation?ed.elevation.exaggeration()*e_.getElevationAt(eM.x,eM.y,!0):0,eA=ed.projection.projectTilePoint(eM.x,eM.y,ew);if(eS>0){let eo=ed.projection.upVector(ew,eM.x,eM.y);eA.x+=eo[0]*eT*eS,eA.y+=eo[1]*eT*eS,eA.z+=eo[2]*eT*eS}let eI=eg?eM:function(eo,ec,ed,em){let e_=Go([],[eo,ec,ed,1],em);return new eL(e_[0]/e_[3],e_[1]/e_[3])}(eA.x,eA.y,eA.z,em),eC=eg?eo.tilespaceRays.map(eo=>(function(eo,ec){let ed=Ao();return iJ[2]=ec,eo.intersectsPlane(iJ,iY,ed),new eL(ed[0],ed[1])})(eo,eS)):eo.queryGeometry.screenGeometry,eP=Go([],[eA.x,eA.y,eA.z,1],em);if(!ex&&eg?eb*=eP[3]/ed.cameraToCenterDistance:ex&&!eg&&(eb*=ed.cameraToCenterDistance/eP[3]),eg){let eo=Xl((ec.y/8192+ew.y)/(1<<ew.z));eb/=ed.projection.pixelsPerMeter(eo,1)/(1/ql(eo))}if(eE=eb,bu(eC,eI)||gu(eI,eC,eE))return!0}return!1}let iJ=Io(0,0,0),iY=Io(0,0,1);let Du=class Du extends cu{};function Vu(eo,{width:ec,height:ed},em,e_){if(e_){if(e_ instanceof Uint8ClampedArray)e_=new Uint8Array(e_.buffer);else if(e_.length!==ec*ed*em)throw RangeError("mismatched image size")}else e_=new Uint8Array(ec*ed*em);return eo.width=ec,eo.height=ed,eo.data=e_,eo}function Lu(eo,ec,ed){let{width:em,height:e_}=ec;em===eo.width&&e_===eo.height||(Fu(eo,ec,{x:0,y:0},{x:0,y:0},{width:Math.min(eo.width,em),height:Math.min(eo.height,e_)},ed),eo.width=em,eo.height=e_,eo.data=ec.data)}function Fu(eo,ec,ed,em,e_,eg){if(0===e_.width||0===e_.height)return ec;if(e_.width>eo.width||e_.height>eo.height||ed.x>eo.width-e_.width||ed.y>eo.height-e_.height)throw RangeError("out of range source coordinates for image copy");if(e_.width>ec.width||e_.height>ec.height||em.x>ec.width-e_.width||em.y>ec.height-e_.height)throw RangeError("out of range destination coordinates for image copy");let ex=eo.data,ev=ec.data;for(let eb=0;eb<e_.height;eb++){let ew=((ed.y+eb)*eo.width+ed.x)*eg,eT=((em.y+eb)*ec.width+em.x)*eg;for(let eo=0;eo<e_.width*eg;eo++)ev[eT+eo]=ex[ew+eo]}return ec}Ji(Du,"HeatmapBucket",{omit:["layers"]});let Ru=class Ru{constructor(eo,ec){Vu(this,eo,1,ec)}resize(eo){Lu(this,new Ru(eo),1)}clone(){return new Ru({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(eo,ec,ed,em,e_){Fu(eo,ec,ed,em,e_,1)}};let Uu=class Uu{constructor(eo,ec){Vu(this,eo,4,ec)}resize(eo){Lu(this,new Uu(eo),4)}replace(eo,ec){ec?this.data.set(eo):this.data=eo instanceof Uint8ClampedArray?new Uint8Array(eo.buffer):eo}clone(){return new Uu({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(eo,ec,ed,em,e_){Fu(eo,ec,ed,em,e_,4)}};Ji(Ru,"AlphaImage"),Ji(Uu,"RGBAImage");var iK={paint:new Ps({"heatmap-radius":new Es(tr.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Es(tr.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bs(tr.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cs(tr.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bs(tr.paint_heatmap["heatmap-opacity"])})};function ju(eo){let ec={},ed=eo.resolution||256,em=eo.clips?eo.clips.length:1,e_=eo.image||new Uu({width:ed,height:em}),s=(ed,em,eg)=>{ec[eo.evaluationKey]=eg;let ex=eo.expression.evaluate(ec);e_.data[ed+em+0]=Math.floor(255*ex.r/ex.a),e_.data[ed+em+1]=Math.floor(255*ex.g/ex.a),e_.data[ed+em+2]=Math.floor(255*ex.b/ex.a),e_.data[ed+em+3]=Math.floor(255*ex.a)};if(eo.clips)for(let ec=0,e_=0;ec<em;++ec,e_+=4*ed)for(let em=0,eg=0;em<ed;em++,eg+=4){let ex=em/(ed-1),{start:ev,end:eb}=eo.clips[ec];s(e_,eg,ev*(1-ex)+eb*ex)}else for(let eo=0,ec=0;eo<ed;eo++,ec+=4)s(0,ec,eo/(ed-1));return e_}var iQ={paint:new Ps({"hillshade-illumination-direction":new Bs(tr.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bs(tr.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bs(tr.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bs(tr.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bs(tr.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bs(tr.paint_hillshade["hillshade-accent-color"])})};let i0=Rs([{name:"a_pos",components:2,type:"Int16"}],4),{members:i1}=i0;var i2={exports:{}};function Zu(eo,ec,ed){ed=ed||2;var em,e_,eg,ex,ev,eb,ew,eT=ec&&ec.length,eE=eT?ec[0]*ed:eo.length,eM=Ku(eo,0,eE,ed,!0),eS=[];if(!eM||eM.next===eM.prev)return eS;if(eT&&(eM=function(eo,ec,ed,em){var e_,eg,ex,ev=[];for(e_=0,eg=ec.length;e_<eg;e_++)(ex=Ku(eo,ec[e_]*em,e_<eg-1?ec[e_+1]*em:eo.length,em,!1))===ex.next&&(ex.steiner=!0),ev.push(function(eo){var ec=eo,ed=eo;do(ec.x<ed.x||ec.x===ed.x&&ec.y<ed.y)&&(ed=ec),ec=ec.next;while(ec!==eo);return ed}(ex));for(ev.sort(tc),e_=0;e_<ev.length;e_++)ed=function(eo,ec){var ed=function(eo,ec){var ed,em,e_,eg=ec,ex=eo.x,ev=eo.y,eb=-1/0;do{if(ev<=eg.y&&ev>=eg.next.y&&eg.next.y!==eg.y){var ew=eg.x+(ev-eg.y)*(eg.next.x-eg.x)/(eg.next.y-eg.y);if(ew<=ex&&ew>eb&&(eb=ew,e_=eg.x<eg.next.x?eg:eg.next,ew===ex))return e_}eg=eg.next}while(eg!==ec);if(!e_)return null;var eT,eE=e_,eM=e_.x,eS=e_.y,eA=1/0;eg=e_;do ex>=eg.x&&eg.x>=eM&&ex!==eg.x&&sc(ev<eS?ex:eb,ev,eM,eS,ev<eS?eb:ex,ev,eg.x,eg.y)&&(eT=Math.abs(ev-eg.y)/(ex-eg.x),pc(eg,eo)&&(eT<eA||eT===eA&&(eg.x>e_.x||eg.x===e_.x&&(ed=e_,em=eg,0>oc(ed.prev,ed,em.prev)&&0>oc(em.next,ed,ed.next))))&&(e_=eg,eA=eT)),eg=eg.next;while(eg!==eE);return e_}(eo,ec);if(!ed)return ec;var em=dc(ed,eo);return Xu(em,em.next),Xu(ed,ed.next)}(ev[e_],ed);return ed}(eo,ec,eM,ed)),eo.length>80*ed){em=eg=eo[0],e_=ex=eo[1];for(var eA=ed;eA<eE;eA+=ed)(ev=eo[eA])<em&&(em=ev),(eb=eo[eA+1])<e_&&(e_=eb),ev>eg&&(eg=ev),eb>ex&&(ex=eb);ew=0!==(ew=Math.max(eg-em,ex-e_))?32767/ew:0}return function Ju(eo,ec,ed,em,e_,eg,ex){if(eo){!ex&&eg&&function(eo,ec,ed,em){var e_=eo;do 0===e_.z&&(e_.z=nc(e_.x,e_.y,ec,ed,em)),e_.prevZ=e_.prev,e_.nextZ=e_.next,e_=e_.next;while(e_!==eo);e_.prevZ.nextZ=null,e_.prevZ=null,function(eo){var ec,ed,em,e_,eg,ex,ev,eb,ew=1;do{for(ed=eo,eo=null,eg=null,ex=0;ed;){for(ex++,em=ed,ev=0,ec=0;ec<ew&&(ev++,em=em.nextZ);ec++);for(eb=ew;ev>0||eb>0&&em;)0!==ev&&(0===eb||!em||ed.z<=em.z)?(e_=ed,ed=ed.nextZ,ev--):(e_=em,em=em.nextZ,eb--),eg?eg.nextZ=e_:eo=e_,e_.prevZ=eg,eg=e_;ed=em}eg.nextZ=null,ew*=2}while(ex>1)}(e_)}(eo,em,e_,eg);for(var ev,eb,ew=eo;eo.prev!==eo.next;)if(ev=eo.prev,eb=eo.next,eg?function(eo,ec,ed,em){var e_=eo.prev,eg=eo.next;if(oc(e_,eo,eg)>=0)return!1;for(var ex=e_.x,ev=eo.x,eb=eg.x,ew=e_.y,eT=eo.y,eE=eg.y,eM=ex<ev?ex<eb?ex:eb:ev<eb?ev:eb,eS=ew<eT?ew<eE?ew:eE:eT<eE?eT:eE,eA=ex>ev?ex>eb?ex:eb:ev>eb?ev:eb,eI=ew>eT?ew>eE?ew:eE:eT>eE?eT:eE,eC=nc(eM,eS,ec,ed,em),eP=nc(eA,eI,ec,ed,em),ez=eo.prevZ,eD=eo.nextZ;ez&&ez.z>=eC&&eD&&eD.z<=eP;){if(ez.x>=eM&&ez.x<=eA&&ez.y>=eS&&ez.y<=eI&&ez!==e_&&ez!==eg&&sc(ex,ew,ev,eT,eb,eE,ez.x,ez.y)&&oc(ez.prev,ez,ez.next)>=0||(ez=ez.prevZ,eD.x>=eM&&eD.x<=eA&&eD.y>=eS&&eD.y<=eI&&eD!==e_&&eD!==eg&&sc(ex,ew,ev,eT,eb,eE,eD.x,eD.y)&&oc(eD.prev,eD,eD.next)>=0))return!1;eD=eD.nextZ}for(;ez&&ez.z>=eC;){if(ez.x>=eM&&ez.x<=eA&&ez.y>=eS&&ez.y<=eI&&ez!==e_&&ez!==eg&&sc(ex,ew,ev,eT,eb,eE,ez.x,ez.y)&&oc(ez.prev,ez,ez.next)>=0)return!1;ez=ez.prevZ}for(;eD&&eD.z<=eP;){if(eD.x>=eM&&eD.x<=eA&&eD.y>=eS&&eD.y<=eI&&eD!==e_&&eD!==eg&&sc(ex,ew,ev,eT,eb,eE,eD.x,eD.y)&&oc(eD.prev,eD,eD.next)>=0)return!1;eD=eD.nextZ}return!0}(eo,em,e_,eg):function(eo){var ec=eo.prev,ed=eo.next;if(oc(ec,eo,ed)>=0)return!1;for(var em=ec.x,e_=eo.x,eg=ed.x,ex=ec.y,ev=eo.y,eb=ed.y,ew=em<e_?em<eg?em:eg:e_<eg?e_:eg,eT=ex<ev?ex<eb?ex:eb:ev<eb?ev:eb,eE=em>e_?em>eg?em:eg:e_>eg?e_:eg,eM=ex>ev?ex>eb?ex:eb:ev>eb?ev:eb,eS=ed.next;eS!==ec;){if(eS.x>=ew&&eS.x<=eE&&eS.y>=eT&&eS.y<=eM&&sc(em,ex,e_,ev,eg,eb,eS.x,eS.y)&&oc(eS.prev,eS,eS.next)>=0)return!1;eS=eS.next}return!0}(eo))ec.push(ev.i/ed|0),ec.push(eo.i/ed|0),ec.push(eb.i/ed|0),yc(eo),eo=eb.next,ew=eb.next;else if((eo=eb)===ew){ex?1===ex?Ju(eo=function(eo,ec,ed){var em=eo;do{var e_=em.prev,eg=em.next.next;!lc(e_,eg)&&uc(e_,em,em.next,eg)&&pc(e_,eg)&&pc(eg,e_)&&(ec.push(e_.i/ed|0),ec.push(em.i/ed|0),ec.push(eg.i/ed|0),yc(em),yc(em.next),em=eo=eg),em=em.next}while(em!==eo);return Xu(em)}(Xu(eo),ec,ed),ec,ed,em,e_,eg,2):2===ex&&function(eo,ec,ed,em,e_,eg){var ex=eo;do{for(var ev,eb,ew=ex.next.next;ew!==ex.prev;){if(ex.i!==ew.i&&(ev=ex,eb=ew,ev.next.i!==eb.i&&ev.prev.i!==eb.i&&!function(eo,ec){var ed=eo;do{if(ed.i!==eo.i&&ed.next.i!==eo.i&&ed.i!==ec.i&&ed.next.i!==ec.i&&uc(ed,ed.next,eo,ec))return!0;ed=ed.next}while(ed!==eo);return!1}(ev,eb)&&(pc(ev,eb)&&pc(eb,ev)&&function(eo,ec){var ed=eo,em=!1,e_=(eo.x+ec.x)/2,eg=(eo.y+ec.y)/2;do ed.y>eg!=ed.next.y>eg&&ed.next.y!==ed.y&&e_<(ed.next.x-ed.x)*(eg-ed.y)/(ed.next.y-ed.y)+ed.x&&(em=!em),ed=ed.next;while(ed!==eo);return em}(ev,eb)&&(oc(ev.prev,ev,eb.prev)||oc(ev,eb.prev,eb))||lc(ev,eb)&&oc(ev.prev,ev,ev.next)>0&&oc(eb.prev,eb,eb.next)>0))){var eT=dc(ex,ew);return ex=Xu(ex,ex.next),eT=Xu(eT,eT.next),Ju(ex,ec,ed,em,e_,eg,0),void Ju(eT,ec,ed,em,e_,eg,0)}ew=ew.next}ex=ex.next}while(ex!==eo)}(eo,ec,ed,em,e_,eg):Ju(Xu(eo),ec,ed,em,e_,eg,1);break}}}(eM,eS,ed,em,e_,ew,0),eS}function Ku(eo,ec,ed,em,e_){var eg,ex;if(e_===gc(eo,ec,ed,em)>0)for(eg=ec;eg<ed;eg+=em)ex=fc(eg,eo[eg],eo[eg+1],ex);else for(eg=ed-em;eg>=ec;eg-=em)ex=fc(eg,eo[eg],eo[eg+1],ex);return ex&&lc(ex,ex.next)&&(yc(ex),ex=ex.next),ex}function Xu(eo,ec){if(!eo)return eo;ec||(ec=eo);var ed,em=eo;do if(ed=!1,em.steiner||!lc(em,em.next)&&0!==oc(em.prev,em,em.next))em=em.next;else{if(yc(em),(em=ec=em.prev)===em.next)break;ed=!0}while(ed||em!==ec);return ec}function tc(eo,ec){return eo.x-ec.x}function nc(eo,ec,ed,em,e_){return(eo=1431655765&((eo=858993459&((eo=252645135&((eo=16711935&((eo=(eo-ed)*e_|0)|eo<<8))|eo<<4))|eo<<2))|eo<<1))|(ec=1431655765&((ec=858993459&((ec=252645135&((ec=16711935&((ec=(ec-em)*e_|0)|ec<<8))|ec<<4))|ec<<2))|ec<<1))<<1}function sc(eo,ec,ed,em,e_,eg,ex,ev){return(e_-ex)*(ec-ev)>=(eo-ex)*(eg-ev)&&(eo-ex)*(em-ev)>=(ed-ex)*(ec-ev)&&(ed-ex)*(eg-ev)>=(e_-ex)*(em-ev)}function oc(eo,ec,ed){return(ec.y-eo.y)*(ed.x-ec.x)-(ec.x-eo.x)*(ed.y-ec.y)}function lc(eo,ec){return eo.x===ec.x&&eo.y===ec.y}function uc(eo,ec,ed,em){var e_=hc(oc(eo,ec,ed)),eg=hc(oc(eo,ec,em)),ex=hc(oc(ed,em,eo)),ev=hc(oc(ed,em,ec));return e_!==eg&&ex!==ev||!(0!==e_||!cc(eo,ed,ec))||!(0!==eg||!cc(eo,em,ec))||!(0!==ex||!cc(ed,eo,em))||!(0!==ev||!cc(ed,ec,em))}function cc(eo,ec,ed){return ec.x<=Math.max(eo.x,ed.x)&&ec.x>=Math.min(eo.x,ed.x)&&ec.y<=Math.max(eo.y,ed.y)&&ec.y>=Math.min(eo.y,ed.y)}function hc(eo){return eo>0?1:eo<0?-1:0}function pc(eo,ec){return 0>oc(eo.prev,eo,eo.next)?oc(eo,ec,eo.next)>=0&&oc(eo,eo.prev,ec)>=0:0>oc(eo,ec,eo.prev)||0>oc(eo,eo.next,ec)}function dc(eo,ec){var ed=new mc(eo.i,eo.x,eo.y),em=new mc(ec.i,ec.x,ec.y),e_=eo.next,eg=ec.prev;return eo.next=ec,ec.prev=eo,ed.next=e_,e_.prev=ed,em.next=ed,ed.prev=em,eg.next=em,em.prev=eg,em}function fc(eo,ec,ed,em){var e_=new mc(eo,ec,ed);return em?(e_.next=em.next,e_.prev=em,em.next.prev=e_,em.next=e_):(e_.prev=e_,e_.next=e_),e_}function yc(eo){eo.next.prev=eo.prev,eo.prev.next=eo.next,eo.prevZ&&(eo.prevZ.nextZ=eo.nextZ),eo.nextZ&&(eo.nextZ.prevZ=eo.prevZ)}function mc(eo,ec,ed){this.i=eo,this.x=ec,this.y=ed,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function gc(eo,ec,ed,em){for(var e_=0,eg=ec,ex=ed-em;eg<ed;eg+=em)e_+=(eo[ex]-eo[eg])*(eo[eg+1]+eo[ex+1]),ex=eg;return e_}i2.exports=Zu,i2.exports.default=Zu,Zu.deviation=function(eo,ec,ed,em){var e_=ec&&ec.length,eg=Math.abs(gc(eo,0,e_?ec[0]*ed:eo.length,ed));if(e_)for(var ex=0,ev=ec.length;ex<ev;ex++)eg-=Math.abs(gc(eo,ec[ex]*ed,ex<ev-1?ec[ex+1]*ed:eo.length,ed));var eb=0;for(ex=0;ex<em.length;ex+=3){var ew=em[ex]*ed,eT=em[ex+1]*ed,eE=em[ex+2]*ed;eb+=Math.abs((eo[ew]-eo[eE])*(eo[eT+1]-eo[ew+1])-(eo[ew]-eo[eT])*(eo[eE+1]-eo[ew+1]))}return 0===eg&&0===eb?0:Math.abs((eb-eg)/eg)},Zu.flatten=function(eo){for(var ec=eo[0][0].length,ed={vertices:[],holes:[],dimensions:ec},em=0,e_=0;e_<eo.length;e_++){for(var eg=0;eg<eo[e_].length;eg++)for(var ex=0;ex<ec;ex++)ed.vertices.push(eo[e_][eg][ex]);e_>0&&ed.holes.push(em+=eo[e_-1].length)}return ed};var i3=p(i2.exports);function wc(eo,ec,ed){var em=eo[ec];eo[ec]=eo[ed],eo[ed]=em}function _c(eo,ec){return eo<ec?-1:eo>ec?1:0}function Ac(eo,ec){let ed,em;let e_=eo.length;if(e_<=1)return[eo];let eg=[];for(let ec=0;ec<e_;ec++){let e_=function(eo){let ec=0;for(let ed,em,e_=0,eg=eo.length,ex=eg-1;e_<eg;ex=e_++)ed=eo[e_],ec+=((em=eo[ex]).x-ed.x)*(ed.y+em.y);return ec}(eo[ec]);0!==e_&&(eo[ec].area=Math.abs(e_),void 0===em&&(em=e_<0),em===e_<0?(ed&&eg.push(ed),ed=[eo[ec]]):ed.push(eo[ec]))}if(ed&&eg.push(ed),ec>1)for(let eo=0;eo<eg.length;eo++){var ex;eg[eo].length<=ec||(function bc(eo,ec,ed,em,e_){for(;em>ed;){if(em-ed>600){var eg=em-ed+1,ex=ec-ed+1,ev=Math.log(eg),eb=.5*Math.exp(2*ev/3),ew=.5*Math.sqrt(ev*eb*(eg-eb)/eg)*(ex-eg/2<0?-1:1);bc(eo,ec,Math.max(ed,Math.floor(ec-ex*eb/eg+ew)),Math.min(em,Math.floor(ec+(eg-ex)*eb/eg+ew)),e_)}var eT=eo[ec],eE=ed,eM=em;for(wc(eo,ed,ec),e_(eo[em],eT)>0&&wc(eo,ed,em);eE<eM;){for(wc(eo,eE,eM),eE++,eM--;0>e_(eo[eE],eT);)eE++;for(;e_(eo[eM],eT)>0;)eM--}0===e_(eo[ed],eT)?wc(eo,ed,eM):wc(eo,++eM,em),eM<=ec&&(ed=eM+1),ec<=eM&&(em=eM-1)}}(ex=eg[eo],ec,1,eg[eo].length-1||ex.length-1,Sc||_c),eg[eo]=eg[eo].slice(0,ec))}return eg}function Sc(eo,ec){return ec.area-eo.area}function kc(eo,ec,ed){let em=ed.patternDependencies,e_=!1;for(let ed of ec){let ec=ed.paint.get(`${eo}-pattern`);ec.isConstant()||(e_=!0);let eg=ec.constantOr(null);eg&&(e_=!0,em[eg]=!0)}return e_}function Ic(eo,ec,ed,em,e_){let eg=e_.patternDependencies;for(let ex of ec){let ec=ex.paint.get(`${eo}-pattern`).value;if("constant"!==ec.kind){let eo=ec.evaluate({zoom:em},ed,{},e_.availableImages);eg[eo=eo&&eo.name?eo.name:eo]=!0,ed.patterns[ex.id]=eo}}return ed}let Mc=class Mc{constructor(eo){this.zoom=eo.zoom,this.overscaling=eo.overscaling,this.layers=eo.layers,this.layerIds=this.layers.map(eo=>eo.id),this.index=eo.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $s,this.indexArray=new ra,this.indexArray2=new la,this.programConfigurations=new Ja(eo.layers,eo.zoom),this.segments=new so,this.segments2=new so,this.stateDependentLayerIds=this.layers.filter(eo=>eo.isStateDependent()).map(eo=>eo.id),this.projection=eo.projection}populate(eo,ec,ed,em){this.hasPattern=kc("fill",this.layers,ec);let e_=this.layers[0].layout.get("fill-sort-key"),eg=[];for(let{feature:ex,id:ev,index:eb,sourceLayerIndex:ew}of eo){let eo=this.layers[0]._featureFilter.needGeometry,eT=ou(ex,eo);if(!this.layers[0]._featureFilter.filter(new ws(this.zoom),eT,ed))continue;let eE=e_?e_.evaluate(eT,{},ed,ec.availableImages):void 0,eM={id:ev,properties:ex.properties,type:ex.type,sourceLayerIndex:ew,index:eb,geometry:eo?eT.geometry:au(ex,ed,em),patterns:{},sortKey:eE};eg.push(eM)}for(let em of(e_&&eg.sort((eo,ec)=>eo.sortKey-ec.sortKey),eg)){let{geometry:e_,index:eg,sourceLayerIndex:ex}=em;if(this.hasPattern){let eo=Ic("fill",this.layers,em,this.zoom,ec);this.patternFeatures.push(eo)}else this.addFeature(em,e_,eg,ed,{},ec.availableImages);ec.featureIndex.insert(eo[eg].feature,e_,eg,ex,this.index)}}update(eo,ec,ed,em){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(eo,ec,this.stateDependentLayers,ed,em)}addFeatures(eo,ec,ed,em,e_){for(let eo of this.patternFeatures)this.addFeature(eo,eo.geometry,eo.index,ec,ed,em)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(eo){this.uploaded||(this.layoutVertexBuffer=eo.createVertexBuffer(this.layoutVertexArray,i1),this.indexBuffer=eo.createIndexBuffer(this.indexArray),this.indexBuffer2=eo.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(eo),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(eo,ec,ed,em,e_,eg=[]){for(let eo of Ac(ec,500)){let ec=0;for(let ed of eo)ec+=ed.length;let ed=this.segments.prepareSegment(ec,this.layoutVertexArray,this.indexArray),em=ed.vertexLength,e_=[],eg=[];for(let ec of eo){if(0===ec.length)continue;ec!==eo[0]&&eg.push(e_.length/2);let ed=this.segments2.prepareSegment(ec.length,this.layoutVertexArray,this.indexArray2),em=ed.vertexLength;this.layoutVertexArray.emplaceBack(ec[0].x,ec[0].y),this.indexArray2.emplaceBack(em+ec.length-1,em),e_.push(ec[0].x),e_.push(ec[0].y);for(let eo=1;eo<ec.length;eo++)this.layoutVertexArray.emplaceBack(ec[eo].x,ec[eo].y),this.indexArray2.emplaceBack(em+eo-1,em+eo),e_.push(ec[eo].x),e_.push(ec[eo].y);ed.vertexLength+=ec.length,ed.primitiveLength+=ec.length}let ex=i3(e_,eg);for(let eo=0;eo<ex.length;eo+=3)this.indexArray.emplaceBack(em+ex[eo],em+ex[eo+1],em+ex[eo+2]);ed.vertexLength+=ec,ed.primitiveLength+=ex.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,eo,ed,e_,eg,em)}};Ji(Mc,"FillBucket",{omit:["layers","patternFeatures"]});let i5=new Ps({"fill-sort-key":new Es(tr.layout_fill["fill-sort-key"])});var i4={paint:new Ps({"fill-antialias":new Bs(tr.paint_fill["fill-antialias"]),"fill-opacity":new Es(tr.paint_fill["fill-opacity"]),"fill-color":new Es(tr.paint_fill["fill-color"]),"fill-outline-color":new Es(tr.paint_fill["fill-outline-color"]),"fill-translate":new Bs(tr.paint_fill["fill-translate"]),"fill-translate-anchor":new Bs(tr.paint_fill["fill-translate-anchor"]),"fill-pattern":new Es(tr.paint_fill["fill-pattern"])}),layout:i5};let i6=Rs([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),i8=Rs([{name:"a_centroid_pos",components:2,type:"Uint16"}]),i9=Rs([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:i7}=i6;var rs={};function Fc(eo,ec,ed,em,e_){this.properties={},this.extent=ed,this.type=0,this._pbf=eo,this._geometry=-1,this._keys=em,this._values=e_,eo.readFields(Rc,this,ec)}function Rc(eo,ec,ed){1==eo?ec.id=ed.readVarint():2==eo?function(eo,ec){for(var ed=eo.readVarint()+eo.pos;eo.pos<ed;){var em=ec._keys[eo.readVarint()],e_=ec._values[eo.readVarint()];ec.properties[em]=e_}}(ed,ec):3==eo?ec.type=ed.readVarint():4==eo&&(ec._geometry=ed.pos)}function Oc(eo,ec){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=eo,this._keys=[],this._values=[],this._features=[],eo.readFields(qc,this,ec),this.length=this._features.length}function qc(eo,ec,ed){15===eo?ec.version=ed.readVarint():1===eo?ec.name=ed.readString():5===eo?ec.extent=ed.readVarint():2===eo?ec._features.push(ed.pos):3===eo?ec._keys.push(ed.readString()):4===eo&&ec._values.push(function(eo){for(var ec=null,ed=eo.readVarint()+eo.pos;eo.pos<ed;){var em=eo.readVarint()>>3;ec=1===em?eo.readString():2===em?eo.readFloat():3===em?eo.readDouble():4===em?eo.readVarint64():5===em?eo.readVarint():6===em?eo.readSVarint():7===em?eo.readBoolean():null}return ec}(ed))}function Gc(eo,ec,ed){if(3===eo){var em=new Oc(ed,ed.readVarint()+ed.pos);em.length&&(ec[em.name]=em)}}Fc.types=["Unknown","Point","LineString","Polygon"],Fc.prototype.loadGeometry=function(){var eo=this._pbf;eo.pos=this._geometry;for(var ec,ed=eo.readVarint()+eo.pos,em=1,e_=0,eg=0,ex=0,ev=[];eo.pos<ed;){if(e_<=0){var eb=eo.readVarint();em=7&eb,e_=eb>>3}if(e_--,1===em||2===em)eg+=eo.readSVarint(),ex+=eo.readSVarint(),1===em&&(ec&&ev.push(ec),ec=[]),ec.push(new g(eg,ex));else{if(7!==em)throw Error("unknown command "+em);ec&&ec.push(ec[0].clone())}}return ec&&ev.push(ec),ev},Fc.prototype.bbox=function(){var eo=this._pbf;eo.pos=this._geometry;for(var ec=eo.readVarint()+eo.pos,ed=1,em=0,e_=0,eg=0,ex=1/0,ev=-1/0,eb=1/0,ew=-1/0;eo.pos<ec;){if(em<=0){var eT=eo.readVarint();ed=7&eT,em=eT>>3}if(em--,1===ed||2===ed)(e_+=eo.readSVarint())<ex&&(ex=e_),e_>ev&&(ev=e_),(eg+=eo.readSVarint())<eb&&(eb=eg),eg>ew&&(ew=eg);else if(7!==ed)throw Error("unknown command "+ed)}return[ex,eb,ev,ew]},Fc.prototype.toGeoJSON=function(eo,ec,ed){var em,e_,eg=this.extent*Math.pow(2,ed),ex=this.extent*eo,ev=this.extent*ec,eb=this.loadGeometry(),ew=Fc.types[this.type];function c(eo){for(var ec=0;ec<eo.length;ec++){var ed=eo[ec];eo[ec]=[360*(ed.x+ex)/eg-180,360/Math.PI*Math.atan(Math.exp((180-360*(ed.y+ev)/eg)*Math.PI/180))-90]}}switch(this.type){case 1:var eT=[];for(em=0;em<eb.length;em++)eT[em]=eb[em][0];c(eb=eT);break;case 2:for(em=0;em<eb.length;em++)c(eb[em]);break;case 3:for(eb=function(eo){var ec=eo.length;if(ec<=1)return[eo];for(var ed,em,e_=[],eg=0;eg<ec;eg++){var ex=function(eo){for(var ec,ed,em=0,e_=0,eg=eo.length,ex=eg-1;e_<eg;ex=e_++)em+=((ed=eo[ex]).x-(ec=eo[e_]).x)*(ec.y+ed.y);return em}(eo[eg]);0!==ex&&(void 0===em&&(em=ex<0),em===ex<0?(ed&&e_.push(ed),ed=[eo[eg]]):ed.push(eo[eg]))}return ed&&e_.push(ed),e_}(eb),em=0;em<eb.length;em++)for(e_=0;e_<eb[em].length;e_++)c(eb[em][e_])}1===eb.length?eb=eb[0]:ew="Multi"+ew;var eE={type:"Feature",geometry:{type:ew,coordinates:eb},properties:this.properties};return"id"in this&&(eE.id=this.id),eE},Oc.prototype.feature=function(eo){if(eo<0||eo>=this._features.length)throw Error("feature index out of bounds");this._pbf.pos=this._features[eo];var ec=this._pbf.readVarint()+this._pbf.pos;return new Fc(this._pbf,ec,this.extent,this._keys,this._values)};var rh=rs.VectorTile=function(eo,ec){this.layers=eo.readFields(Gc,{},ec)},ru=rs.VectorTileFeature=Fc;function Xc(eo,ec,ed,em){let e_=[],eg=0===em?(eo,ec,ed,em,e_,eg)=>{eo.push(new eL(eg,ed+(eg-ec)/(em-ec)*(e_-ed)))}:(eo,ec,ed,em,e_,eg)=>{eo.push(new eL(ec+(eg-ed)/(e_-ed)*(em-ec),eg))};for(let ex of eo){let eo=[];for(let e_ of ex){if(e_.length<=2)continue;let ex=[];for(let eo=0;eo<e_.length-1;eo++){let ev=e_[eo].x,eb=e_[eo].y,ew=e_[eo+1].x,eT=e_[eo+1].y,eE=0===em?ev:eb,eM=0===em?ew:eT;eE<ec?eM>ec&&eg(ex,ev,eb,ew,eT,ec):eE>ed?eM<ed&&eg(ex,ev,eb,ew,eT,ed):ex.push(e_[eo]),eM<ec&&eE>=ec&&eg(ex,ev,eb,ew,eT,ec),eM>ed&&eE<=ed&&eg(ex,ev,eb,ew,eT,ed)}let ev=e_[e_.length-1],eb=0===em?ev.x:ev.y;eb>=ec&&eb<=ed&&ex.push(ev),ex.length&&(ev=ex[ex.length-1],ex[0].x===ev.x&&ex[0].y===ev.y||ex.push(ex[0]),eo.push(ex))}eo.length&&e_.push(eo)}return e_}rs.VectorTileLayer=Oc;let rc=ru.types;function Yc(eo,ec,ed,em,e_,eg,ex,ev){eo.emplaceBack((ec<<1)+ex,(ed<<1)+eg,(Math.floor(8192*em)<<1)+e_,Math.round(ev))}function Wc(eo,ec,ed){eo.emplaceBack(ec.x,ec.y,ec.z,16384*ed[0],16384*ed[1],16384*ed[2])}let Qc=class Qc{constructor(){this.acc=new eL(0,0),this.polyCount=[]}startRing(eo){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new eL(eo.x,eo.y),this.max=new eL(eo.x,eo.y))}append(eo,ec){this.currentPolyCount.edges++,this.acc._add(eo);let ed=this.min,em=this.max;eo.x<ed.x?ed.x=eo.x:eo.x>em.x&&(em.x=eo.x),eo.y<ed.y?ed.y=eo.y:eo.y>em.y&&(em.y=eo.y),((0===eo.x||8192===eo.x)&&eo.x===ec.x)!=((0===eo.y||8192===eo.y)&&eo.y===ec.y)&&this.processBorderOverlap(eo,ec),ec.x<0!=eo.x<0&&this.addBorderIntersection(0,Er(ec.y,eo.y,(0-ec.x)/(eo.x-ec.x))),ec.x>8192!=eo.x>8192&&this.addBorderIntersection(1,Er(ec.y,eo.y,(8192-ec.x)/(eo.x-ec.x))),ec.y<0!=eo.y<0&&this.addBorderIntersection(2,Er(ec.x,eo.x,(0-ec.y)/(eo.y-ec.y))),ec.y>8192!=eo.y>8192&&this.addBorderIntersection(3,Er(ec.x,eo.x,(8192-ec.y)/(eo.y-ec.y)))}addBorderIntersection(eo,ec){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let ed=this.borders[eo];ec<ed[0]&&(ed[0]=ec),ec>ed[1]&&(ed[1]=ec)}processBorderOverlap(eo,ec){if(eo.x===ec.x){if(eo.y===ec.y)return;let ed=0===eo.x?0:1;this.addBorderIntersection(ed,ec.y),this.addBorderIntersection(ed,eo.y)}else{let ed=0===eo.y?2:3;this.addBorderIntersection(ed,ec.x),this.addBorderIntersection(ed,eo.x)}}centroid(){let eo=this.polyCount.reduce((eo,ec)=>eo+ec.edges,0);return 0!==eo?this.acc.div(eo)._round():new eL(0,0)}span(){return new eL(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((eo,ec)=>eo+ +(ec[0]!==Number.MAX_VALUE),0)}};let th=class th{constructor(eo){this.zoom=eo.zoom,this.canonical=eo.canonical,this.overscaling=eo.overscaling,this.layers=eo.layers,this.layerIds=this.layers.map(eo=>eo.id),this.index=eo.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=eo.projection,this.layoutVertexArray=new Os,this.centroidVertexArray=new wa,this.indexArray=new ra,this.programConfigurations=new Ja(eo.layers,eo.zoom),this.segments=new so,this.stateDependentLayerIds=this.layers.filter(eo=>eo.isStateDependent()).map(eo=>eo.id),this.enableTerrain=eo.enableTerrain}populate(eo,ec,ed,em){for(let{feature:e_,id:eg,index:ex,sourceLayerIndex:ev}of(this.features=[],this.hasPattern=kc("fill-extrusion",this.layers,ec),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(eo){let ec=Math.exp(Math.PI*(1-eo.y/(1<<eo.z)*2));return 80150034*ec/(ec*ec+1)/8192/(1<<eo.z)}(ed),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,eo)){let eo=this.layers[0]._featureFilter.needGeometry,eb=ou(e_,eo);if(!this.layers[0]._featureFilter.filter(new ws(this.zoom),eb,ed))continue;let ew={id:eg,sourceLayerIndex:ev,index:ex,geometry:eo?eb.geometry:au(e_,ed,em),properties:e_.properties,type:e_.type,patterns:{}},eT=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ic("fill-extrusion",this.layers,ew,this.zoom,ec)):this.addFeature(ew,ew.geometry,ex,ed,{},ec.availableImages,em),ec.featureIndex.insert(e_,ew.geometry,ex,ev,this.index,eT)}this.sortBorders()}addFeatures(eo,ec,ed,em,e_){for(let eo of this.features){let{geometry:eg}=eo;this.addFeature(eo,eg,eo.index,ec,ed,em,e_)}this.sortBorders()}update(eo,ec,ed,em){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(eo,ec,this.stateDependentLayers,ed,em)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(eo){this.uploaded||(this.layoutVertexBuffer=eo.createVertexBuffer(this.layoutVertexArray,i7),this.indexBuffer=eo.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=eo.createVertexBuffer(this.layoutVertexExtArray,i9.members,!0))),this.programConfigurations.upload(eo),this.uploaded=!0}uploadCentroid(eo){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=eo.createVertexBuffer(this.centroidVertexArray,i8.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(eo,ec,ed,em,e_,eg,ex){var ev;let eb;let ew=[new eL(0,0),new eL(8192,8192)],eT=ex.projection,eE="globe"===eT.name,eM=this.enableTerrain&&!eE?new Qc:null,eS="Polygon"===rc[eo.type];eE&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ks);let eA=Ac(ec,500);for(let eo=eA.length-1;eo>=0;eo--){let ec=eA[eo];(0===ec.length||(ev=ec[0]).every(eo=>eo.x<=0)||ev.every(eo=>eo.x>=8192)||ev.every(eo=>eo.y<=0)||ev.every(eo=>eo.y>=8192))&&eA.splice(eo,1)}if(eE)eb=lh(eA,ew,em);else for(let eo of(eb=[],eA))eb.push({polygon:eo,bounds:ew});let eI=eS?this.edgeRadius:0;for(let{polygon:eo,bounds:ec}of eb){let ed=0,e_=0;for(let ec of eo)eS&&!ec[0].equals(ec[ec.length-1])&&ec.push(ec[0]),e_+=eS?ec.length-1:ec.length;let eg=this.segments.prepareSegment((eS?5:4)*e_,this.layoutVertexArray,this.indexArray);if(eS){let ec=[],e_=[];for(let ex of(ed=eg.vertexLength,eo)){let ed,ev;ex.length&&ex!==eo[0]&&e_.push(ec.length/2),ed=ex[1].sub(ex[0])._perp()._unit();for(let eo=1;eo<ex.length;eo++){let e_=ex[eo],eb=ex[eo===ex.length-1?1:eo+1],{x:ew,y:eM}=e_;if(eI){ev=eb.sub(e_)._perp()._unit();let eo=ed.add(ev)._unit(),ec=eI*Math.min(4,1/(ed.x*eo.x+ed.y*eo.y));ew+=ec*eo.x,eM+=ec*eo.y,ed=ev}Yc(this.layoutVertexArray,ew,eM,0,0,1,1,0),eg.vertexLength++,ec.push(e_.x,e_.y),eE&&Wc(this.layoutVertexExtArray,eT.projectTilePoint(ew,eM,em),eT.upVector(em,ew,eM))}}let ex=i3(ec,e_);for(let eo=0;eo<ex.length;eo+=3)this.indexArray.emplaceBack(ed+ex[eo],ed+ex[eo+2],ed+ex[eo+1]),eg.primitiveLength++}for(let e_ of eo){eM&&e_.length&&eM.startRing(e_[0]);let eo,ex,ev,eb=e_.length>4&&sh(e_[e_.length-2],e_[0],e_[1]),ew=eI?function(eo,ec,ed,em){let e_=ec.sub(eo)._perp()._unit(),eg=ed.sub(ec)._perp()._unit();return nh(eo,ec,ed,eh(e_,eg),em)}(e_[e_.length-2],e_[0],e_[1],eI):0;ex=e_[1].sub(e_[0])._perp()._unit();let eA=!0;for(let eC=1,eP=0;eC<e_.length;eC++){let ez=e_[eC-1],eD=e_[eC],ek=e_[eC===e_.length-1?1:eC+1];if(eM&&eS&&eM.currentPolyCount.top++,ih(eD,ez,ec)){eI&&(ex=ek.sub(eD)._perp()._unit(),eA=!eA);continue}eM&&eM.append(eD,ez);let eL=eD.sub(ez)._perp(),eR=eL.x/(Math.abs(eL.x)+Math.abs(eL.y)),eB=eL.y>0?1:0,eF=ez.dist(eD);if(eP+eF>32768&&(eP=0),eI){ev=ek.sub(eD)._perp()._unit();let eo=nh(ez,eD,ek,eh(ex,ev),eI);isNaN(eo)&&(eo=0);let ec=eD.sub(ez)._unit();ez=ez.add(ec.mult(ew))._round(),eD=eD.add(ec.mult(-eo))._round(),ew=eo,ex=ev}let eO=eg.vertexLength,eU=e_.length>4&&sh(ez,eD,ek),eN=ah(eP,eb,eA);if(Yc(this.layoutVertexArray,ez.x,ez.y,eR,eB,0,0,eN),Yc(this.layoutVertexArray,ez.x,ez.y,eR,eB,0,1,eN),eP+=eF,eN=ah(eP,eU,!eA),eb=eU,Yc(this.layoutVertexArray,eD.x,eD.y,eR,eB,0,0,eN),Yc(this.layoutVertexArray,eD.x,eD.y,eR,eB,0,1,eN),eg.vertexLength+=4,this.indexArray.emplaceBack(eO+0,eO+1,eO+2),this.indexArray.emplaceBack(eO+1,eO+3,eO+2),eg.primitiveLength+=2,eI){let em=ed+(1===eC?e_.length-2:eC-2),ex=1===eC?ed:em+1;if(this.indexArray.emplaceBack(eO+1,em,eO+3),this.indexArray.emplaceBack(em,ex,eO+3),eg.primitiveLength+=2,void 0===eo&&(eo=eO),!ih(ek,e_[eC],ec)){let ec=eC===e_.length-1?eo:eg.vertexLength;this.indexArray.emplaceBack(eO+2,eO+3,ec),this.indexArray.emplaceBack(eO+3,ec+1,ec),this.indexArray.emplaceBack(eO+3,ex,ec+1),eg.primitiveLength+=3}eA=!eA}if(eE){let eo=this.layoutVertexExtArray,ec=eT.projectTilePoint(ez.x,ez.y,em),ed=eT.projectTilePoint(eD.x,eD.y,em),e_=eT.upVector(em,ez.x,ez.y),eg=eT.upVector(em,eD.x,eD.y);Wc(eo,ec,e_),Wc(eo,ec,e_),Wc(eo,ed,eg),Wc(eo,ed,eg)}}eS&&(ed+=e_.length-1)}}if(eM&&eM.polyCount.length>0){if(eM.borders){eM.vertexArrayOffset=this.centroidVertexArray.length;let eo=eM.borders,ec=this.featuresOnBorder.push(eM)-1;for(let ed=0;ed<4;ed++)eo[ed][0]!==Number.MAX_VALUE&&this.borders[ed].push(ec)}this.encodeCentroid(eM.borders?void 0:eM.centroid(),eM)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,eo,ed,e_,eg,em)}sortBorders(){for(let eo=0;eo<4;eo++)this.borders[eo].sort((ec,ed)=>this.featuresOnBorder[ec].borders[eo][0]-this.featuresOnBorder[ed].borders[eo][0])}encodeCentroid(eo,ec,ed=!0){let em,e_;if(eo){if(0!==eo.y){let ed=ec.span()._mult(this.tileToMeter);em=(Math.max(eo.x,1)<<3)+Math.min(7,Math.round(ed.x/10)),e_=(Math.max(eo.y,1)<<3)+Math.min(7,Math.round(ed.y/10))}else em=Math.ceil(7*(eo.x+450)),e_=0}else em=0,e_=+ed;let eg=ed?this.centroidVertexArray.length:ec.vertexArrayOffset;for(let eo of ec.polyCount){ed&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*eo.edges+eo.top);for(let ec=0;ec<eo.top;ec++)this.centroidVertexArray.emplace(eg++,em,e_);for(let ec=0;ec<2*eo.edges;ec++)this.centroidVertexArray.emplace(eg++,0,e_),this.centroidVertexArray.emplace(eg++,em,e_)}}};function eh(eo,ec){let ed=eo.add(ec)._unit();return eo.x*ed.x+eo.y*ed.y}function nh(eo,ec,ed,em,e_){let eg=Math.sqrt(1-em*em);return Math.min(eo.dist(ec)/3,ec.dist(ed)/3,e_*eg/em)}function ih(eo,ec,ed){return eo.x<ed[0].x&&ec.x<ed[0].x||eo.x>ed[1].x&&ec.x>ed[1].x||eo.y<ed[0].y&&ec.y<ed[0].y||eo.y>ed[1].y&&ec.y>ed[1].y}function sh(eo,ec,ed){if(eo.x<0||eo.x>=8192||ec.x<0||ec.x>=8192||ed.x<0||ed.x>=8192)return!1;let em=ed.sub(ec),e_=em.perp(),eg=eo.sub(ec);return(em.x*eg.x+em.y*eg.y)/Math.sqrt((em.x*em.x+em.y*em.y)*(eg.x*eg.x+eg.y*eg.y))>-.866&&e_.x*eg.x+e_.y*eg.y<0}function ah(eo,ec,ed){let em=ec?2|eo:-3&eo;return ed?1|em:-2&em}function oh(){let eo=Math.PI/32,ec=Math.tan(eo);return iZ*Math.sqrt(1+2*ec*ec)-iZ}function lh(eo,ec,ed){let em=1<<ed.z,e_=Kl(ed.x/em),eg=Kl((ed.x+1)/em),ex=Xl(ed.y/em),ev=Xl((ed.y+1)/em);return function(eo,ec,ed,em,e_=0,eg){let ex=[];if(!eo.length||!ed||!em)return ex;let o=(eo,ec)=>{for(let ed of eo)ex.push({polygon:ed,bounds:ec})},ev=Math.ceil(Math.log2(ed)),eb=Math.ceil(Math.log2(em)),ew=ev-eb,eT=[];for(let eo=0;eo<Math.abs(ew);eo++)eT.push(ew>0?0:1);for(let eo=0;eo<Math.min(ev,eb);eo++)eT.push(0),eT.push(1);let eE=eo;if(eE=Xc(eE,ec[0].y-e_,ec[1].y+e_,1),!(eE=Xc(eE,ec[0].x-e_,ec[1].x+e_,0)).length)return ex;let eM=[];for(eT.length?eM.push({polygons:eE,bounds:ec,depth:0}):o(eE,ec);eM.length;){let eo=eM.pop(),ec=eo.depth,ed=eT[ec],em=eo.bounds[0],ex=eo.bounds[1],ev=0===ed?em.x:em.y,eb=0===ed?ex.x:ex.y,ew=eg?eg(ed,ev,eb):.5*(ev+eb),eE=Xc(eo.polygons,ev-e_,ew+e_,ed),eS=Xc(eo.polygons,ew-e_,eb+e_,ed);if(eE.length){let eo=[em,new eL(0===ed?ew:ex.x,1===ed?ew:ex.y)];eT.length>ec+1?eM.push({polygons:eE,bounds:eo,depth:ec+1}):o(eE,eo)}if(eS.length){let eo=[new eL(0===ed?ew:em.x,1===ed?ew:em.y),ex];eT.length>ec+1?eM.push({polygons:eS,bounds:eo,depth:ec+1}):o(eS,eo)}}return ex}(eo,ec,Math.ceil((eg-e_)/11.25),Math.ceil((ex-ev)/11.25),1,(eo,ec,e_)=>{if(0===eo)return .5*(ec+e_);{let eo=Xl((ed.y+ec/8192)/em);return(Gl(.5*(Xl((ed.y+e_/8192)/em)+eo))*em-ed.y)*8192}})}Ji(th,"FillExtrusionBucket",{omit:["layers","features"]}),Ji(Qc,"PartMetadata");let rp=new Ps({"fill-extrusion-edge-radius":new Bs(tr["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var rm={paint:new Ps({"fill-extrusion-opacity":new Bs(tr["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Es(tr["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bs(tr["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bs(tr["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Es(tr["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Es(tr["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Es(tr["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bs(tr["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Bs(tr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Bs(tr["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Bs(tr["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:rp};function hh(eo,ec,ed){var em=2*Math.PI*6378137/256/Math.pow(2,ed);return[eo*em-2*Math.PI*6378137/2,ec*em-2*Math.PI*6378137/2]}let ph=class ph{constructor(eo,ec,ed){this.z=eo,this.x=ec,this.y=ed,this.key=yh(0,eo,eo,ec,ed)}equals(eo){return this.z===eo.z&&this.x===eo.x&&this.y===eo.y}url(eo,ec){var ed,em,e_,eg,ex;let ev=(ed=this.x,em=this.y,eg=hh(256*ed,256*(em=Math.pow(2,e_=this.z)-em-1),e_),ex=hh(256*(ed+1),256*(em+1),e_),eg[0]+","+eg[1]+","+ex[0]+","+ex[1]),eb=function(eo,ec,ed){let em,e_="";for(let eg=eo;eg>0;eg--)e_+=(ec&(em=1<<eg-1)?1:0)+(ed&em?2:0);return e_}(this.z,this.x,this.y);return eo[(this.x+this.y)%eo.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===ec?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",eb).replace("{bbox-epsg-3857}",ev)}toString(){return`${this.z}/${this.x}/${this.y}`}};let dh=class dh{constructor(eo,ec){this.wrap=eo,this.canonical=ec,this.key=yh(eo,ec.z,ec.z,ec.x,ec.y)}};let fh=class fh{constructor(eo,ec,ed,em,e_){this.overscaledZ=eo,this.wrap=ec,this.canonical=new ph(ed,+em,+e_),this.key=0===ec&&eo===ed?this.canonical.key:yh(ec,eo,ed,em,e_)}equals(eo){return this.overscaledZ===eo.overscaledZ&&this.wrap===eo.wrap&&this.canonical.equals(eo.canonical)}scaledTo(eo){let ec=this.canonical.z-eo;return eo>this.canonical.z?new fh(eo,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new fh(eo,this.wrap,eo,this.canonical.x>>ec,this.canonical.y>>ec)}calculateScaledKey(eo,ec=!0){if(this.overscaledZ===eo&&ec)return this.key;if(eo>this.canonical.z)return yh(this.wrap*+ec,eo,this.canonical.z,this.canonical.x,this.canonical.y);{let ed=this.canonical.z-eo;return yh(this.wrap*+ec,eo,eo,this.canonical.x>>ed,this.canonical.y>>ed)}}isChildOf(eo){if(eo.wrap!==this.wrap)return!1;let ec=this.canonical.z-eo.canonical.z;return 0===eo.overscaledZ||eo.overscaledZ<this.overscaledZ&&eo.canonical.x===this.canonical.x>>ec&&eo.canonical.y===this.canonical.y>>ec}children(eo){if(this.overscaledZ>=eo)return[new fh(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let ec=this.canonical.z+1,ed=2*this.canonical.x,em=2*this.canonical.y;return[new fh(ec,this.wrap,ec,ed,em),new fh(ec,this.wrap,ec,ed+1,em),new fh(ec,this.wrap,ec,ed,em+1),new fh(ec,this.wrap,ec,ed+1,em+1)]}isLessThan(eo){return this.wrap<eo.wrap||!(this.wrap>eo.wrap)&&(this.overscaledZ<eo.overscaledZ||!(this.overscaledZ>eo.overscaledZ)&&(this.canonical.x<eo.canonical.x||!(this.canonical.x>eo.canonical.x)&&this.canonical.y<eo.canonical.y))}wrapped(){return new fh(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(eo){return new fh(this.overscaledZ,eo,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new dh(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}};function yh(eo,ec,ed,em,e_){let eg=1<<Math.min(ed,22),ex=eg*(e_%eg)+em%eg;return eo&&ed<22&&(ex+=eg*eg*((eo<0?-2*eo-1:2*eo)%(1<<2*(22-ed)))),16*(32*ex+ed)+(ec-ed)}Ji(ph,"CanonicalTileID"),Ji(fh,"OverscaledTileID",{omit:["projMatrix"]});let mh=class mh extends eL{constructor(eo,ec,ed){super(eo,ec),this.z=ed}};function gh(eo,ec){return eo.x*ec.x+eo.y*ec.y}function xh(eo,ec){if(1===eo.length){let ed,em=0,e_=ec[em++];for(;!ed||e_.equals(ed);)if(!(ed=ec[em++]))return 1/0;for(;em<ec.length;em++){let eg=ec[em],ex=eo[0],ev=ed.sub(e_),eb=eg.sub(e_),ew=ex.sub(e_),eT=gh(ev,ev),eE=gh(ev,eb),eM=gh(eb,eb),eS=gh(ew,ev),eA=gh(ew,eb),eI=eT*eM-eE*eE,eC=(eM*eS-eE*eA)/eI,eP=(eT*eA-eE*eS)/eI,ez=e_.z*(1-eC-eP)+ed.z*eC+eg.z*eP;if(isFinite(ez))return ez}return 1/0}{let eo=1/0;for(let ed of ec)eo=Math.min(eo,ed.z);return eo}}function vh(eo,ec,ed,em,e_,eg,ex,ev){let eb=ex*e_.getElevationAt(eo,ec,!0,!0),ew=0!==eg[0],eT=ew?0===eg[1]?ex*(eg[0]/7-450):ex*function(eo,ec,ed){var em,e_;let eg=Math.floor(ec[0]/8),ex=Math.floor(ec[1]/8),ev=10*(ec[0]-8*eg),eb=10*(ec[1]-8*ex),ew=eo.getElevationAt(eg,ex,!0,!0),eT=eo.getMeterToDEM(ed),eE=Math.floor(.5*(ev*eT-1)),eM=Math.floor(.5*(eb*eT-1)),eS=eo.tileCoordToPixel(eg,ex),eA=2*eE+1,eI=2*eM+1,eC=(em=eS.x-eE,e_=eS.y-eM,[eo.getElevationAtPixel(em,e_,!0),eo.getElevationAtPixel(em+eI,e_,!0),eo.getElevationAtPixel(em,e_+eI,!0),eo.getElevationAtPixel(em+eA,e_+eI,!0)]),eP=Math.abs(eC[0]-eC[1]),ez=Math.abs(eC[2]-eC[3]),eD=Math.abs(eC[0]-eC[2])+Math.abs(eC[1]-eC[3]),ek=Math.min(.25,.5*eT*(eP+ez)/eA),eL=Math.min(.25,.5*eT*eD/eI);return ew+Math.max(ek*ev,eL*eb)}(e_,eg,ev):eb;return{base:eb+(0===ed)?-1:ed,top:ew?Math.max(eT+em,eb+ed+2):eb+em}}let r_=Rs([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:rg}=r_,rx=Rs([{name:"a_packed",components:4,type:"Float32"}]),{members:rv}=rx,rb=ru.types,rw=Math.cos(Math.PI/180*37.5);let Ih=class Ih{constructor(eo){this.zoom=eo.zoom,this.overscaling=eo.overscaling,this.layers=eo.layers,this.layerIds=this.layers.map(eo=>eo.id),this.index=eo.index,this.projection=eo.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(eo=>{this.gradients[eo.id]={}}),this.layoutVertexArray=new qs,this.layoutVertexArray2=new Ns,this.indexArray=new ra,this.programConfigurations=new Ja(eo.layers,eo.zoom),this.segments=new so,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(eo=>eo.isStateDependent()).map(eo=>eo.id)}populate(eo,ec,ed,em){this.hasPattern=kc("line",this.layers,ec);let e_=this.layers[0].layout.get("line-sort-key"),eg=[];for(let{feature:ec,id:ex,index:ev,sourceLayerIndex:eb}of eo){let eo=this.layers[0]._featureFilter.needGeometry,ew=ou(ec,eo);if(!this.layers[0]._featureFilter.filter(new ws(this.zoom),ew,ed))continue;let eT=e_?e_.evaluate(ew,{},ed):void 0,eE={id:ex,properties:ec.properties,type:ec.type,sourceLayerIndex:eb,index:ev,geometry:eo?ew.geometry:au(ec,ed,em),patterns:{},sortKey:eT};eg.push(eE)}e_&&eg.sort((eo,ec)=>eo.sortKey-ec.sortKey);let{lineAtlas:ex,featureIndex:ev}=ec,eb=this.addConstantDashes(ex);for(let em of eg){let{geometry:e_,index:eg,sourceLayerIndex:ew}=em;if(eb&&this.addFeatureDashes(em,ex),this.hasPattern){let eo=Ic("line",this.layers,em,this.zoom,ec);this.patternFeatures.push(eo)}else this.addFeature(em,e_,eg,ed,ex.positions,ec.availableImages);ev.insert(eo[eg].feature,e_,eg,ew,this.index)}}addConstantDashes(eo){let ec=!1;for(let ed of this.layers){let em=ed.paint.get("line-dasharray").value,e_=ed.layout.get("line-cap").value;if("constant"!==em.kind||"constant"!==e_.kind)ec=!0;else{let ec=e_.value,ed=em.value;if(!ed)continue;eo.addDash(ed,ec)}}return ec}addFeatureDashes(eo,ec){let ed=this.zoom;for(let em of this.layers){let e_,eg;let ex=em.paint.get("line-dasharray").value,ev=em.layout.get("line-cap").value;if("constant"!==ex.kind||"constant"!==ev.kind){if("constant"===ex.kind){if(!(e_=ex.value))continue}else e_=ex.evaluate({zoom:ed},eo);eg="constant"===ev.kind?ev.value:ev.evaluate({zoom:ed},eo),ec.addDash(e_,eg),eo.patterns[em.id]=ec.getKey(e_,eg)}}}update(eo,ec,ed,em){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(eo,ec,this.stateDependentLayers,ed,em)}addFeatures(eo,ec,ed,em,e_){for(let eo of this.patternFeatures)this.addFeature(eo,eo.geometry,eo.index,ec,ed,em)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(eo){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=eo.createVertexBuffer(this.layoutVertexArray2,rv)),this.layoutVertexBuffer=eo.createVertexBuffer(this.layoutVertexArray,rg),this.indexBuffer=eo.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(eo),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(eo){if(eo.properties&&eo.properties.hasOwnProperty("mapbox_clip_start")&&eo.properties.hasOwnProperty("mapbox_clip_end"))return{start:+eo.properties.mapbox_clip_start,end:+eo.properties.mapbox_clip_end}}addFeature(eo,ec,ed,em,e_,eg){let ex=this.layers[0].layout,ev=ex.get("line-join").evaluate(eo,{}),eb=ex.get("line-cap").evaluate(eo,{}),ew=ex.get("line-miter-limit"),eT=ex.get("line-round-limit");for(let ed of(this.lineClips=this.lineFeatureClips(eo),ec))this.addLine(ed,eo,ev,eb,ew,eT);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,eo,ed,e_,eg,em)}addLine(eo,ec,ed,em,e_,eg){let ex,ev,eb,ew,eT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ec=0;ec<eo.length-1;ec++)this.totalDistance+=eo[ec].dist(eo[ec+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let eE="Polygon"===rb[ec.type],eM=eo.length;for(;eM>=2&&eo[eM-1].equals(eo[eM-2]);)eM--;let eS=0;for(;eS<eM-1&&eo[eS].equals(eo[eS+1]);)eS++;if(eM<(eE?3:2))return;"bevel"===ed&&(e_=1.05);let eA=this.overscaling<=16?122880/(512*this.overscaling):0,eI=this.segments.prepareSegment(10*eM,this.layoutVertexArray,this.indexArray);this.e1=this.e2=-1,eE&&(ex=eo[eM-2],eT=eo[eS].sub(ex)._unit()._perp());for(let ec=eS;ec<eM;ec++){if((eb=ec===eM-1?eE?eo[eS+1]:void 0:eo[ec+1])&&eo[ec].equals(eb))continue;eT&&(ew=eT),ex&&(ev=ex),ex=eo[ec],eT=eb?eb.sub(ex)._unit()._perp():ew;let eC=(ew=ew||eT).add(eT);0===eC.x&&0===eC.y||eC._unit();let eP=ew.x*eT.x+ew.y*eT.y,ez=eC.x*eT.x+eC.y*eT.y,eD=0!==ez?1/ez:1/0,ek=2*Math.sqrt(2-2*ez),eL=ez<rw&&ev&&eb,eR=ew.x*eT.y-ew.y*eT.x>0;if(eL&&ec>eS){let eo=ex.dist(ev);if(eo>2*eA){let ec=ex.sub(ex.sub(ev)._mult(eA/eo)._round());this.updateDistance(ev,ec),this.addCurrentVertex(ec,ew,0,0,eI),ev=ec}}let eB=ev&&eb,eF=eB?ed:eE?"butt":em;if(eB&&"round"===eF&&(eD<eg?eF="miter":eD<=2&&(eF="fakeround")),"miter"===eF&&eD>e_&&(eF="bevel"),"bevel"===eF&&(eD>2&&(eF="flipbevel"),eD<e_&&(eF="miter")),ev&&this.updateDistance(ev,ex),"miter"===eF)eC._mult(eD),this.addCurrentVertex(ex,eC,0,0,eI);else if("flipbevel"===eF){if(eD>100)eC=eT.mult(-1);else{let eo=eD*ew.add(eT).mag()/ew.sub(eT).mag();eC._perp()._mult(eo*(eR?-1:1))}this.addCurrentVertex(ex,eC,0,0,eI),this.addCurrentVertex(ex,eC.mult(-1),0,0,eI)}else if("bevel"===eF||"fakeround"===eF){let eo=-Math.sqrt(eD*eD-1),ec=eR?eo:0,ed=eR?0:eo;if(ev&&this.addCurrentVertex(ex,ew,ec,ed,eI),"fakeround"===eF){let eo=Math.round(180*ek/Math.PI/20);for(let ec=1;ec<eo;ec++){let ed=ec/eo;if(.5!==ed){let eo=ed-.5;ed+=ed*eo*(ed-1)*((1.0904+eP*(eP*(3.55645-1.43519*eP)-3.2452))*eo*eo+(.848013+eP*(.215638*eP-1.06021)))}let em=eT.sub(ew)._mult(ed)._add(ew)._unit()._mult(eR?-1:1);this.addHalfVertex(ex,em.x,em.y,!1,eR,0,eI)}}eb&&this.addCurrentVertex(ex,eT,-ec,-ed,eI)}else if("butt"===eF)this.addCurrentVertex(ex,eC,0,0,eI);else if("square"===eF){let eo=ev?1:-1;ev||this.addCurrentVertex(ex,eC,eo,eo,eI),this.addCurrentVertex(ex,eC,0,0,eI),ev&&this.addCurrentVertex(ex,eC,eo,eo,eI)}else"round"===eF&&(ev&&(this.addCurrentVertex(ex,ew,0,0,eI),this.addCurrentVertex(ex,ew,1,1,eI,!0)),eb&&(this.addCurrentVertex(ex,eT,-1,-1,eI,!0),this.addCurrentVertex(ex,eT,0,0,eI)));if(eL&&ec<eM-1){let eo=ex.dist(eb);if(eo>2*eA){let ec=ex.add(eb.sub(ex)._mult(eA/eo)._round());this.updateDistance(ex,ec),this.addCurrentVertex(ec,eT,0,0,eI),ex=ec}}}}addCurrentVertex(eo,ec,ed,em,e_,eg=!1){let ex=ec.y*em-ec.x,ev=-ec.y-ec.x*em;this.addHalfVertex(eo,ec.x+ec.y*ed,ec.y-ec.x*ed,eg,!1,ed,e_),this.addHalfVertex(eo,ex,ev,eg,!0,-em,e_)}addHalfVertex({x:eo,y:ec},ed,em,e_,eg,ex,ev){this.layoutVertexArray.emplaceBack((eo<<1)+(e_?1:0),(ec<<1)+(eg?1:0),Math.round(63*ed)+128,Math.round(63*em)+128,1+(0===ex?0:ex<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let eb=ev.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,eb),ev.primitiveLength++),eg?this.e2=eb:this.e1=eb}updateScaledDistance(){if(this.lineClips){let eo=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=eo*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(eo,ec){this.distance+=eo.dist(ec),this.updateScaledDistance()}};Ji(Ih,"LineBucket",{omit:["layers","patternFeatures"]});let rT=new Ps({"line-cap":new Es(tr.layout_line["line-cap"]),"line-join":new Es(tr.layout_line["line-join"]),"line-miter-limit":new Bs(tr.layout_line["line-miter-limit"]),"line-round-limit":new Bs(tr.layout_line["line-round-limit"]),"line-sort-key":new Es(tr.layout_line["line-sort-key"])});var rE={paint:new Ps({"line-opacity":new Es(tr.paint_line["line-opacity"]),"line-color":new Es(tr.paint_line["line-color"]),"line-translate":new Bs(tr.paint_line["line-translate"]),"line-translate-anchor":new Bs(tr.paint_line["line-translate-anchor"]),"line-width":new Es(tr.paint_line["line-width"]),"line-gap-width":new Es(tr.paint_line["line-gap-width"]),"line-offset":new Es(tr.paint_line["line-offset"]),"line-blur":new Es(tr.paint_line["line-blur"]),"line-dasharray":new Es(tr.paint_line["line-dasharray"]),"line-pattern":new Es(tr.paint_line["line-pattern"]),"line-gradient":new Cs(tr.paint_line["line-gradient"]),"line-trim-offset":new Bs(tr.paint_line["line-trim-offset"])}),layout:rT};let rM=new class extends Es{possiblyEvaluate(eo,ec){return ec=new ws(Math.floor(ec.zoom),{now:ec.now,fadeDuration:ec.fadeDuration,transition:ec.transition}),super.possiblyEvaluate(eo,ec)}evaluate(eo,ec,ed,em){return ec=C({},ec,{zoom:Math.floor(ec.zoom)}),super.evaluate(eo,ec,ed,em)}}(rE.paint.properties["line-width"].specification);rM.useIntegerZoom=!0;let rS=Rs([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),rA=Rs([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),rI=Rs([{name:"a_projected_pos",components:4,type:"Float32"}],4);Rs([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let rC=Rs([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),rP=Rs([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Rs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let rz=Rs([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),rD=Rs([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function $h(eo,ec){let{expression:ed}=ec;if("constant"===ed.kind)return{kind:"constant",layoutSize:ed.evaluate(new ws(eo+1))};if("source"===ed.kind)return{kind:"source"};{let{zoomStops:ec,interpolationType:em}=ed,e_=0;for(;e_<ec.length&&ec[e_]<=eo;)e_++;let eg=e_=Math.max(0,e_-1);for(;eg<ec.length&&ec[eg]<eo+1;)eg++;eg=Math.min(ec.length-1,eg);let ex=ec[e_],ev=ec[eg];return"composite"===ed.kind?{kind:"composite",minZoom:ex,maxZoom:ev,interpolationType:em}:{kind:"camera",minZoom:ex,maxZoom:ev,minSize:ed.evaluate(new ws(ex)),maxSize:ed.evaluate(new ws(ev)),interpolationType:em}}}function jh(eo,{uSize:ec,uSizeT:ed},{lowerSize:em,upperSize:e_}){return"source"===eo.kind?em/128:"composite"===eo.kind?Er(em/128,e_/128,ed):ec}function Oh(eo,ec){let ed=0,em=0;if("constant"===eo.kind)em=eo.layoutSize;else if("source"!==eo.kind){let{interpolationType:e_,minZoom:eg,maxZoom:ex}=eo,ev=e_?M(Yr.interpolationFactor(e_,ec,eg,ex),0,1):0;"camera"===eo.kind?em=Er(eo.minSize,eo.maxSize,ev):ed=ev}return{uSizeT:ed,uSize:em}}Rs([{name:"triangle",components:3,type:"Uint16"}]),Rs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rs([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Rs([{type:"Float32",name:"offsetX"}]),Rs([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var rk=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:128,evaluateSizeForFeature:jh,evaluateSizeForZoom:Oh,getSizeData:$h});let rL={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","\xa2":"￠","\xa3":"￡","\xa5":"￥","\xa6":"￤","\xac":"￢","\xaf":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};var Jh=function(eo,ec,ed,em,e_){var eg,ex,ev=8*e_-em-1,eb=(1<<ev)-1,ew=eb>>1,eT=-7,eE=ed?e_-1:0,eM=ed?-1:1,eS=eo[ec+eE];for(eE+=eM,eg=eS&(1<<-eT)-1,eS>>=-eT,eT+=ev;eT>0;eg=256*eg+eo[ec+eE],eE+=eM,eT-=8);for(ex=eg&(1<<-eT)-1,eg>>=-eT,eT+=em;eT>0;ex=256*ex+eo[ec+eE],eE+=eM,eT-=8);if(0===eg)eg=1-ew;else{if(eg===eb)return ex?NaN:1/0*(eS?-1:1);ex+=Math.pow(2,em),eg-=ew}return(eS?-1:1)*ex*Math.pow(2,eg-em)},Hh=function(eo,ec,ed,em,e_,eg){var ex,ev,eb,ew=8*eg-e_-1,eT=(1<<ew)-1,eE=eT>>1,eM=23===e_?5960464477539062e-23:0,eS=em?0:eg-1,eA=em?1:-1,eI=ec<0||0===ec&&1/ec<0?1:0;for(isNaN(ec=Math.abs(ec))||ec===1/0?(ev=isNaN(ec)?1:0,ex=eT):(ex=Math.floor(Math.log(ec)/Math.LN2),ec*(eb=Math.pow(2,-ex))<1&&(ex--,eb*=2),(ec+=ex+eE>=1?eM/eb:eM*Math.pow(2,1-eE))*eb>=2&&(ex++,eb/=2),ex+eE>=eT?(ev=0,ex=eT):ex+eE>=1?(ev=(ec*eb-1)*Math.pow(2,e_),ex+=eE):(ev=ec*Math.pow(2,eE-1)*Math.pow(2,e_),ex=0));e_>=8;eo[ed+eS]=255&ev,eS+=eA,ev/=256,e_-=8);for(ex=ex<<e_|ev,ew+=e_;ew>0;eo[ed+eS]=255&ex,eS+=eA,ex/=256,ew-=8);eo[ed+eS-eA]|=128*eI};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Yh(eo){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(eo)?eo:new Uint8Array(eo||0),this.pos=0,this.type=0,this.length=this.buf.length}Yh.Varint=0,Yh.Fixed64=1,Yh.Bytes=2,Yh.Fixed32=5;var rR="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function ep(eo){return eo.type===Yh.Bytes?eo.readVarint()+eo.pos:eo.pos+1}function np(eo,ec,ed){var em=ec<=16383?1:ec<=2097151?2:ec<=268435455?3:Math.floor(Math.log(ec)/(7*Math.LN2));ed.realloc(em);for(var e_=ed.pos-1;e_>=eo;e_--)ed.buf[e_+em]=ed.buf[e_]}function ip(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeVarint(eo[ed])}function sp(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeSVarint(eo[ed])}function ap(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeFloat(eo[ed])}function op(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeDouble(eo[ed])}function lp(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeBoolean(eo[ed])}function up(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeFixed32(eo[ed])}function cp(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeSFixed32(eo[ed])}function hp(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeFixed64(eo[ed])}function pp(eo,ec){for(var ed=0;ed<eo.length;ed++)ec.writeSFixed64(eo[ed])}function dp(eo,ec){return(eo[ec]|eo[ec+1]<<8|eo[ec+2]<<16)+16777216*eo[ec+3]}function fp(eo,ec,ed){eo[ed]=ec,eo[ed+1]=ec>>>8,eo[ed+2]=ec>>>16,eo[ed+3]=ec>>>24}function yp(eo,ec){return(eo[ec]|eo[ec+1]<<8|eo[ec+2]<<16)+(eo[ec+3]<<24)}Yh.prototype={destroy:function(){this.buf=null},readFields:function(eo,ec,ed){for(ed=ed||this.length;this.pos<ed;){var em=this.readVarint(),e_=em>>3,eg=this.pos;this.type=7&em,eo(e_,ec,this),this.pos===eg&&this.skip(em)}return ec},readMessage:function(eo,ec){return this.readFields(eo,ec,this.readVarint()+this.pos)},readFixed32:function(){var eo=dp(this.buf,this.pos);return this.pos+=4,eo},readSFixed32:function(){var eo=yp(this.buf,this.pos);return this.pos+=4,eo},readFixed64:function(){var eo=dp(this.buf,this.pos)+4294967296*dp(this.buf,this.pos+4);return this.pos+=8,eo},readSFixed64:function(){var eo=dp(this.buf,this.pos)+4294967296*yp(this.buf,this.pos+4);return this.pos+=8,eo},readFloat:function(){var eo=Jh(this.buf,this.pos,!0,23,4);return this.pos+=4,eo},readDouble:function(){var eo=Jh(this.buf,this.pos,!0,52,8);return this.pos+=8,eo},readVarint:function(eo){var ec,ed,em=this.buf;return ec=127&(ed=em[this.pos++]),ed<128?ec:(ec|=(127&(ed=em[this.pos++]))<<7,ed<128?ec:(ec|=(127&(ed=em[this.pos++]))<<14,ed<128?ec:(ec|=(127&(ed=em[this.pos++]))<<21,ed<128?ec:function(eo,ec,ed){var em,e_,eg,ex=ed.buf;if(e_=(112&(eg=ex[ed.pos++]))>>4,eg<128||(e_|=(127&(eg=ex[ed.pos++]))<<3,eg<128)||(e_|=(127&(eg=ex[ed.pos++]))<<10,eg<128)||(e_|=(127&(eg=ex[ed.pos++]))<<17,eg<128)||(e_|=(127&(eg=ex[ed.pos++]))<<24,eg<128)||(e_|=(1&(eg=ex[ed.pos++]))<<31,eg<128))return em=e_,ec?4294967296*em+(eo>>>0):4294967296*(em>>>0)+(eo>>>0);throw Error("Expected varint not more than 10 bytes")}(ec|=(15&(ed=em[this.pos]))<<28,eo,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var eo=this.readVarint();return eo%2==1?-((eo+1)/2):eo/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var eo,ec=this.readVarint()+this.pos,ed=this.pos;return this.pos=ec,ec-ed>=12&&rR?(eo=this.buf,rR.decode(eo.subarray(ed,ec))):function(eo,ec,ed){for(var em="",e_=ec;e_<ed;){var eg,ex,ev,eb=eo[e_],ew=null,eT=eb>239?4:eb>223?3:eb>191?2:1;if(e_+eT>ed)break;1===eT?eb<128&&(ew=eb):2===eT?128==(192&(eg=eo[e_+1]))&&(ew=(31&eb)<<6|63&eg)<=127&&(ew=null):3===eT?(ex=eo[e_+2],128==(192&(eg=eo[e_+1]))&&128==(192&ex)&&((ew=(15&eb)<<12|(63&eg)<<6|63&ex)<=2047||ew>=55296&&ew<=57343)&&(ew=null)):4===eT&&(ex=eo[e_+2],ev=eo[e_+3],128==(192&(eg=eo[e_+1]))&&128==(192&ex)&&128==(192&ev)&&((ew=(15&eb)<<18|(63&eg)<<12|(63&ex)<<6|63&ev)<=65535||ew>=1114112)&&(ew=null)),null===ew?(ew=65533,eT=1):ew>65535&&(ew-=65536,em+=String.fromCharCode(ew>>>10&1023|55296),ew=56320|1023&ew),em+=String.fromCharCode(ew),e_+=eT}return em}(this.buf,ed,ec)},readBytes:function(){var eo=this.readVarint()+this.pos,ec=this.buf.subarray(this.pos,eo);return this.pos=eo,ec},readPackedVarint:function(eo,ec){if(this.type!==Yh.Bytes)return eo.push(this.readVarint(ec));var ed=ep(this);for(eo=eo||[];this.pos<ed;)eo.push(this.readVarint(ec));return eo},readPackedSVarint:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readSVarint());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readSVarint());return eo},readPackedBoolean:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readBoolean());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readBoolean());return eo},readPackedFloat:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readFloat());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readFloat());return eo},readPackedDouble:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readDouble());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readDouble());return eo},readPackedFixed32:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readFixed32());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readFixed32());return eo},readPackedSFixed32:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readSFixed32());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readSFixed32());return eo},readPackedFixed64:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readFixed64());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readFixed64());return eo},readPackedSFixed64:function(eo){if(this.type!==Yh.Bytes)return eo.push(this.readSFixed64());var ec=ep(this);for(eo=eo||[];this.pos<ec;)eo.push(this.readSFixed64());return eo},skip:function(eo){var ec=7&eo;if(ec===Yh.Varint)for(;this.buf[this.pos++]>127;);else if(ec===Yh.Bytes)this.pos=this.readVarint()+this.pos;else if(ec===Yh.Fixed32)this.pos+=4;else{if(ec!==Yh.Fixed64)throw Error("Unimplemented type: "+ec);this.pos+=8}},writeTag:function(eo,ec){this.writeVarint(eo<<3|ec)},realloc:function(eo){for(var ec=this.length||16;ec<this.pos+eo;)ec*=2;if(ec!==this.length){var ed=new Uint8Array(ec);ed.set(this.buf),this.buf=ed,this.length=ec}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(eo){this.realloc(4),fp(this.buf,eo,this.pos),this.pos+=4},writeSFixed32:function(eo){this.realloc(4),fp(this.buf,eo,this.pos),this.pos+=4},writeFixed64:function(eo){this.realloc(8),fp(this.buf,-1&eo,this.pos),fp(this.buf,Math.floor(23283064365386963e-26*eo),this.pos+4),this.pos+=8},writeSFixed64:function(eo){this.realloc(8),fp(this.buf,-1&eo,this.pos),fp(this.buf,Math.floor(23283064365386963e-26*eo),this.pos+4),this.pos+=8},writeVarint:function(eo){(eo=+eo||0)>268435455||eo<0?function(eo,ec){var ed,em,e_,eg,ex;if(eo>=0?(ed=eo%4294967296|0,em=eo/4294967296|0):(em=~(-eo/4294967296),4294967295^(ed=~(-eo%4294967296))?ed=ed+1|0:(ed=0,em=em+1|0)),eo>=18446744073709552e3||eo<-18446744073709552e3)throw Error("Given varint doesn't fit into 10 bytes");ec.realloc(10),e_=ed,ec.buf[ec.pos++]=127&e_|128,e_>>>=7,ec.buf[ec.pos++]=127&e_|128,e_>>>=7,ec.buf[ec.pos++]=127&e_|128,e_>>>=7,ec.buf[ec.pos++]=127&e_|128,ec.buf[ec.pos]=127&(e_>>>=7),ex=(7&(eg=em))<<4,ec.buf[ec.pos++]|=ex|((eg>>>=3)?128:0),eg&&(ec.buf[ec.pos++]=127&eg|((eg>>>=7)?128:0),eg&&(ec.buf[ec.pos++]=127&eg|((eg>>>=7)?128:0),eg&&(ec.buf[ec.pos++]=127&eg|((eg>>>=7)?128:0),eg&&(ec.buf[ec.pos++]=127&eg|((eg>>>=7)?128:0),eg&&(ec.buf[ec.pos++]=127&eg)))))}(eo,this):(this.realloc(4),this.buf[this.pos++]=127&eo|(eo>127?128:0),eo<=127||(this.buf[this.pos++]=127&(eo>>>=7)|(eo>127?128:0),eo<=127||(this.buf[this.pos++]=127&(eo>>>=7)|(eo>127?128:0),eo<=127||(this.buf[this.pos++]=eo>>>7&127))))},writeSVarint:function(eo){this.writeVarint(eo<0?-(2*eo)-1:2*eo)},writeBoolean:function(eo){this.writeVarint(!!eo)},writeString:function(eo){eo=String(eo),this.realloc(4*eo.length),this.pos++;var ec=this.pos;this.pos=function(eo,ec,ed){for(var em,e_,eg=0;eg<ec.length;eg++){if((em=ec.charCodeAt(eg))>55295&&em<57344){if(!e_){em>56319||eg+1===ec.length?(eo[ed++]=239,eo[ed++]=191,eo[ed++]=189):e_=em;continue}if(em<56320){eo[ed++]=239,eo[ed++]=191,eo[ed++]=189,e_=em;continue}em=e_-55296<<10|em-56320|65536,e_=null}else e_&&(eo[ed++]=239,eo[ed++]=191,eo[ed++]=189,e_=null);em<128?eo[ed++]=em:(em<2048?eo[ed++]=em>>6|192:(em<65536?eo[ed++]=em>>12|224:(eo[ed++]=em>>18|240,eo[ed++]=em>>12&63|128),eo[ed++]=em>>6&63|128),eo[ed++]=63&em|128)}return ed}(this.buf,eo,this.pos);var ed=this.pos-ec;ed>=128&&np(ec,ed,this),this.pos=ec-1,this.writeVarint(ed),this.pos+=ed},writeFloat:function(eo){this.realloc(4),Hh(this.buf,eo,this.pos,!0,23,4),this.pos+=4},writeDouble:function(eo){this.realloc(8),Hh(this.buf,eo,this.pos,!0,52,8),this.pos+=8},writeBytes:function(eo){var ec=eo.length;this.writeVarint(ec),this.realloc(ec);for(var ed=0;ed<ec;ed++)this.buf[this.pos++]=eo[ed]},writeRawMessage:function(eo,ec){this.pos++;var ed=this.pos;eo(ec,this);var em=this.pos-ed;em>=128&&np(ed,em,this),this.pos=ed-1,this.writeVarint(em),this.pos+=em},writeMessage:function(eo,ec,ed){this.writeTag(eo,Yh.Bytes),this.writeRawMessage(ec,ed)},writePackedVarint:function(eo,ec){ec.length&&this.writeMessage(eo,ip,ec)},writePackedSVarint:function(eo,ec){ec.length&&this.writeMessage(eo,sp,ec)},writePackedBoolean:function(eo,ec){ec.length&&this.writeMessage(eo,lp,ec)},writePackedFloat:function(eo,ec){ec.length&&this.writeMessage(eo,ap,ec)},writePackedDouble:function(eo,ec){ec.length&&this.writeMessage(eo,op,ec)},writePackedFixed32:function(eo,ec){ec.length&&this.writeMessage(eo,up,ec)},writePackedSFixed32:function(eo,ec){ec.length&&this.writeMessage(eo,cp,ec)},writePackedFixed64:function(eo,ec){ec.length&&this.writeMessage(eo,hp,ec)},writePackedSFixed64:function(eo,ec){ec.length&&this.writeMessage(eo,pp,ec)},writeBytesField:function(eo,ec){this.writeTag(eo,Yh.Bytes),this.writeBytes(ec)},writeFixed32Field:function(eo,ec){this.writeTag(eo,Yh.Fixed32),this.writeFixed32(ec)},writeSFixed32Field:function(eo,ec){this.writeTag(eo,Yh.Fixed32),this.writeSFixed32(ec)},writeFixed64Field:function(eo,ec){this.writeTag(eo,Yh.Fixed64),this.writeFixed64(ec)},writeSFixed64Field:function(eo,ec){this.writeTag(eo,Yh.Fixed64),this.writeSFixed64(ec)},writeVarintField:function(eo,ec){this.writeTag(eo,Yh.Varint),this.writeVarint(ec)},writeSVarintField:function(eo,ec){this.writeTag(eo,Yh.Varint),this.writeSVarint(ec)},writeStringField:function(eo,ec){this.writeTag(eo,Yh.Bytes),this.writeString(ec)},writeFloatField:function(eo,ec){this.writeTag(eo,Yh.Fixed32),this.writeFloat(ec)},writeDoubleField:function(eo,ec){this.writeTag(eo,Yh.Fixed64),this.writeDouble(ec)},writeBooleanField:function(eo,ec){this.writeVarintField(eo,!!ec)}};var rB=p(Yh);function xp(eo,ec,ed){ec.glyphs=[],1===eo&&ed.readMessage(vp,ec)}function vp(eo,ec,ed){if(3===eo){let{id:eo,bitmap:em,width:e_,height:eg,left:ex,top:ev,advance:eb}=ed.readMessage(bp,{});ec.glyphs.push({id:eo,bitmap:new Ru({width:e_+6,height:eg+6},em),metrics:{width:e_,height:eg,left:ex,top:ev,advance:eb}})}else 4===eo?ec.ascender=ed.readSVarint():5===eo&&(ec.descender=ed.readSVarint())}function bp(eo,ec,ed){1===eo?ec.id=ed.readVarint():2===eo?ec.bitmap=ed.readBytes():3===eo?ec.width=ed.readVarint():4===eo?ec.height=ed.readVarint():5===eo?ec.left=ed.readSVarint():6===eo?ec.top=ed.readSVarint():7===eo&&(ec.advance=ed.readVarint())}function _p(eo){let ec=0,ed=0;for(let em of eo)ec+=em.w*em.h,ed=Math.max(ed,em.w);eo.sort((eo,ec)=>ec.h-eo.h);let em=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(ec/.95)),ed),h:1/0}],e_=0,eg=0;for(let ec of eo)for(let eo=em.length-1;eo>=0;eo--){let ed=em[eo];if(!(ec.w>ed.w||ec.h>ed.h)){if(ec.x=ed.x,ec.y=ed.y,eg=Math.max(eg,ec.y+ec.h),e_=Math.max(e_,ec.x+ec.w),ec.w===ed.w&&ec.h===ed.h){let ec=em.pop();eo<em.length&&(em[eo]=ec)}else ec.h===ed.h?(ed.x+=ec.w,ed.w-=ec.w):(ec.w===ed.w||em.push({x:ed.x+ec.w,y:ed.y,w:ed.w-ec.w,h:ec.h}),ed.y+=ec.h,ed.h-=ec.h);break}}return{w:e_,h:eg,fill:ec/(e_*eg)||0}}let Sp=class Sp{constructor(eo,{pixelRatio:ec,version:ed,stretchX:em,stretchY:e_,content:eg}){this.paddedRect=eo,this.pixelRatio=ec,this.stretchX=em,this.stretchY=e_,this.content=eg,this.version=ed}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}};let kp=class kp{constructor(eo,ec){let ed={},em={};this.haveRenderCallbacks=[];let e_=[];this.addImages(eo,ed,e_),this.addImages(ec,em,e_);let{w:eg,h:ex}=_p(e_),ev=new Uu({width:eg||1,height:ex||1});for(let ec in eo){let em=eo[ec],e_=ed[ec].paddedRect;Uu.copy(em.data,ev,{x:0,y:0},{x:e_.x+1,y:e_.y+1},em.data)}for(let eo in ec){let ed=ec[eo],e_=em[eo].paddedRect,eg=e_.x+1,ex=e_.y+1,eb=ed.data.width,ew=ed.data.height;Uu.copy(ed.data,ev,{x:0,y:0},{x:eg,y:ex},ed.data),Uu.copy(ed.data,ev,{x:0,y:ew-1},{x:eg,y:ex-1},{width:eb,height:1}),Uu.copy(ed.data,ev,{x:0,y:0},{x:eg,y:ex+ew},{width:eb,height:1}),Uu.copy(ed.data,ev,{x:eb-1,y:0},{x:eg-1,y:ex},{width:1,height:ew}),Uu.copy(ed.data,ev,{x:0,y:0},{x:eg+eb,y:ex},{width:1,height:ew})}this.image=ev,this.iconPositions=ed,this.patternPositions=em}addImages(eo,ec,ed){for(let em in eo){let e_=eo[em],eg={x:0,y:0,w:e_.data.width+2,h:e_.data.height+2};ed.push(eg),ec[em]=new Sp(eg,e_),e_.hasRenderCallback&&this.haveRenderCallbacks.push(em)}}patchUpdatedImages(eo,ec){for(let ed in this.haveRenderCallbacks=this.haveRenderCallbacks.filter(ec=>eo.hasImage(ec)),eo.dispatchRenderCallbacks(this.haveRenderCallbacks),eo.updatedImages)this.patchUpdatedImage(this.iconPositions[ed],eo.getImage(ed),ec),this.patchUpdatedImage(this.patternPositions[ed],eo.getImage(ed),ec)}patchUpdatedImage(eo,ec,ed){if(!eo||!ec||eo.version===ec.version)return;eo.version=ec.version;let[em,e_]=eo.tl;ed.update(ec.data,void 0,{x:em,y:e_})}};Ji(Sp,"ImagePosition"),Ji(kp,"ImageAtlas");let rF={horizontal:1,vertical:2,horizontalOnly:3};let Tp=class Tp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(eo,ec){let ed=new Tp;return ed.scale=eo||1,ed.fontStack=ec,ed}static forImage(eo){let ec=new Tp;return ec.imageName=eo,ec}};let zp=class zp{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(eo,ec){let ed=new zp;for(let em=0;em<eo.sections.length;em++){let e_=eo.sections[em];e_.image?ed.addImageSection(e_):ed.addTextSection(e_,ec)}return ed}length(){return this.text.length}getSection(eo){return this.sections[this.sectionIndex[eo]]}getSections(){return this.sections}getSectionIndex(eo){return this.sectionIndex[eo]}getCharCode(eo){return this.text.charCodeAt(eo)}verticalizePunctuation(eo){this.text=function(eo,ec){let ed="";for(let em=0;em<eo.length;em++){let e_=eo.charCodeAt(em+1)||null,eg=eo.charCodeAt(em-1)||null;ed+=!ec&&(e_&&ss(e_)&&!rL[eo[em+1]]||eg&&ss(eg)&&!rL[eo[em-1]])||!rL[eo[em]]?eo[em]:rL[eo[em]]}return ed}(this.text,eo)}trim(){let eo=0;for(let ec=0;ec<this.text.length&&rO[this.text.charCodeAt(ec)];ec++)eo++;let ec=this.text.length;for(let ed=this.text.length-1;ed>=0&&ed>=eo&&rO[this.text.charCodeAt(ed)];ed--)ec--;this.text=this.text.substring(eo,ec),this.sectionIndex=this.sectionIndex.slice(eo,ec)}substring(eo,ec){let ed=new zp;return ed.text=this.text.substring(eo,ec),ed.sectionIndex=this.sectionIndex.slice(eo,ec),ed.sections=this.sections,ed}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((eo,ec)=>Math.max(eo,this.sections[ec].scale),0)}addTextSection(eo,ec){this.text+=eo.text,this.sections.push(Tp.forText(eo.scale,eo.fontStack||ec));let ed=this.sections.length-1;for(let ec=0;ec<eo.text.length;++ec)this.sectionIndex.push(ed)}addImageSection(eo){let ec=eo.image?eo.image.name:"";if(0===ec.length)return void N("Can't add FormattedSection with an empty image.");let ed=this.getNextImageSectionCharCode();ed?(this.text+=String.fromCharCode(ed),this.sections.push(Tp.forImage(ec)),this.sectionIndex.push(this.sections.length-1)):N("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}};function Bp(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA){let eI=zp.fromFeature(eo,e_);eE===rF.vertical&&eI.verticalizePunctuation(eM);let eC=[],eP=function(eo,ec,ed,em,e_,eg){if(!eo)return[];let ex=[],ev=function(eo,ec,ed,em,e_,eg){let ex=0;for(let ed=0;ed<eo.length();ed++){let ev=eo.getSection(ed);ex+=Pp(eo.getCharCode(ed),ev,em,e_,ec,eg)}return ex/Math.max(1,Math.ceil(ex/ed))}(eo,ec,ed,em,e_,eg),eb=eo.text.indexOf("​")>=0,ew=0;for(let ed=0;ed<eo.length();ed++){let eT=eo.getSection(ed),eE=eo.getCharCode(ed);if(rO[eE]||(ew+=Pp(eE,eT,em,e_,ec,eg)),ed<eo.length()-1){let ec=!(eE<11904||!(t0["Bopomofo Extended"](eE)||t0.Bopomofo(eE)||t0["CJK Compatibility Forms"](eE)||t0["CJK Compatibility Ideographs"](eE)||t0["CJK Compatibility"](eE)||t0["CJK Radicals Supplement"](eE)||t0["CJK Strokes"](eE)||t0["CJK Symbols and Punctuation"](eE)||t0["CJK Unified Ideographs Extension A"](eE)||t0["CJK Unified Ideographs"](eE)||t0["Enclosed CJK Letters and Months"](eE)||t0["Halfwidth and Fullwidth Forms"](eE)||t0.Hiragana(eE)||t0["Ideographic Description Characters"](eE)||t0["Kangxi Radicals"](eE)||t0["Katakana Phonetic Extensions"](eE)||t0.Katakana(eE)||t0["Vertical Forms"](eE)||t0["Yi Radicals"](eE)||t0["Yi Syllables"](eE)));(rU[eE]||ec||eT.imageName)&&ex.push(Lp(ed+1,ew,ev,ex,function(eo,ec,ed){let em=0;return 10===eo&&(em-=1e4),ed&&(em+=150),40!==eo&&65288!==eo||(em+=50),41!==ec&&65289!==ec||(em+=50),em}(eE,eo.getCharCode(ed+1),ec&&eb),!1))}}return function Fp(eo){return eo?Fp(eo.priorBreak).concat(eo.index):[]}(Lp(eo.length(),ew,ev,ex,0,!0))}(eI,ew,eg,ec,em,eS),{processBidirectionalText:ez,processStyledBidirectionalText:eD}=t9;if(ez&&1===eI.sections.length){let eo=ez(eI.toString(),eP);for(let ec of eo){let eo=new zp;eo.text=ec,eo.sections=eI.sections;for(let ed=0;ed<ec.length;ed++)eo.sectionIndex.push(0);eC.push(eo)}}else if(eD){let eo=eD(eI.text,eI.sectionIndex,eP);for(let ec of eo){let eo=new zp;eo.text=ec[0],eo.sectionIndex=ec[1],eo.sections=eI.sections,eC.push(eo)}}else eC=function(eo,ec){let ed=[],em=eo.text,e_=0;for(let em of ec)ed.push(eo.substring(e_,em)),e_=em;return e_<em.length&&ed.push(eo.substring(e_,em.length)),ed}(eI,eP);let ek=[],eL={positionedLines:ek,text:eI.toString(),top:eT[1],bottom:eT[1],left:eT[0],right:eT[0],writingMode:eE,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE){let eM=0,eS=0,eA=0,eI="right"===ev?1:"left"===ev?0:.5,eC=!1;for(let eo of e_){let ed=eo.getSections();for(let eo of ed){if(eo.imageName)continue;let ed=ec[eo.fontStack];if(ed&&!(eC=void 0!==ed.ascender&&void 0!==ed.descender))break}if(!eC)break}let eP=0;for(let ex of e_){ex.trim();let e_=ex.getMaxScale(),ev=(e_-1)*24,ez={positionedGlyphs:[],lineOffset:0};eo.positionedLines[eP]=ez;let eD=ez.positionedGlyphs,ek=0;if(!ex.length()){eS+=eg,++eP;continue}let eL=0,eR=0;for(let eg=0;eg<ex.length();eg++){let ev=ex.getSection(eg),eA=ex.getSectionIndex(eg),eI=ex.getCharCode(eg),eP=ev.scale,ez=null,eB=null,eF=null,eO=24,eU=0,eN=!(eb===rF.horizontal||!eT&&!is(eI)||eT&&(rO[eI]||t0.Arabic(eI)||t0["Arabic Supplement"](eI)||t0["Arabic Extended-A"](eI)||t0["Arabic Presentation Forms-A"](eI)||t0["Arabic Presentation Forms-B"](eI)));if(ev.imageName){let ec=em[ev.imageName];if(!ec)continue;eF=ev.imageName,eo.iconsInText=eo.iconsInText||!0,eB=ec.paddedRect;let ed=ec.displaySize;eP=24*eP/eE,ez={width:ed[0],height:ed[1],left:1,top:-3,advance:eN?ed[1]:ed[0],localGlyph:!1},eU=eC?-ez.height*eP:-17+24*e_-ed[1]*eP,eO=ez.advance;let eg=(eN?ed[0]:ed[1])*eP-24*e_;eg>0&&eg>ek&&(ek=eg)}else{let eo=ed[ev.fontStack];if(!eo)continue;eo[eI]&&(eB=eo[eI]);let em=ec[ev.fontStack];if(!em)continue;let eg=em.glyphs[eI];if(!eg)continue;if(ez=eg.metrics,eO=8203!==eI?24:0,eC){let eo=void 0!==em.ascender?Math.abs(em.ascender):0,ec=void 0!==em.descender?Math.abs(em.descender):0,ed=(eo+ec)*eP;eL<ed&&(eL=ed,eR=(eo-ec)/2*eP),eU=-eo*eP}else eU=-17+(e_-eP)*24}eN?(eo.verticalizable=!0,eD.push({glyph:eI,imageName:eF,x:eM,y:eS+eU,vertical:eN,scale:eP,localGlyph:ez.localGlyph,fontStack:ev.fontStack,sectionIndex:eA,metrics:ez,rect:eB}),eM+=eO*eP+ew):(eD.push({glyph:eI,imageName:eF,x:eM,y:eS+eU,vertical:eN,scale:eP,localGlyph:ez.localGlyph,fontStack:ev.fontStack,sectionIndex:eA,metrics:ez,rect:eB}),eM+=ez.advance*eP+ew)}0!==eD.length&&(eA=Math.max(eM-ew,eA),eC?Up(eD,eI,ek,eR,eg*e_/2):Up(eD,eI,ek,0,eg/2)),eM=0;let eB=eg*e_+ek;ez.lineOffset=Math.max(ek,ev),eS+=eB,++eP}let ez=eS,{horizontalAlign:eD,verticalAlign:ek}=Rp(ex);(function(eo,ec,ed,em,e_,eg){let ex=(ec-ed)*e_,ev=-eg*em;for(let ec of eo)for(let eo of ec.positionedGlyphs)eo.x+=ex,eo.y+=ev})(eo.positionedLines,eI,eD,ek,eA,ez),eo.top+=-ek*ez,eo.bottom=eo.top+ez,eo.left+=-eD*eA,eo.right=eo.left+eA,eo.hasBaseline=eC}(eL,ec,ed,em,eC,ex,ev,eb,eE,ew,eM,eA),!function(eo){for(let ec of eo)if(0!==ec.positionedGlyphs.length)return!1;return!0}(ek)&&eL}let rO={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},rU={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Pp(eo,ec,ed,em,e_,eg){if(ec.imageName){let eo=em[ec.imageName];return eo?eo.displaySize[0]*ec.scale*24/eg+e_:0}{let em=ed[ec.fontStack],eg=em&&em.glyphs[eo];return eg?eg.metrics.advance*ec.scale+e_:0}}function Dp(eo,ec,ed,em){let e_=Math.pow(eo-ec,2);return em?eo<ec?e_/2:2*e_:e_+Math.abs(ed)*ed}function Lp(eo,ec,ed,em,e_,eg){let ex=null,ev=Dp(ec,ed,e_,eg);for(let eo of em){let em=Dp(ec-eo.x,ed,e_,eg)+eo.badness;em<=ev&&(ex=eo,ev=em)}return{index:eo,x:ec,priorBreak:ex,badness:ev}}function Rp(eo){let ec=.5,ed=.5;switch(eo){case"right":case"top-right":case"bottom-right":ec=1;break;case"left":case"top-left":case"bottom-left":ec=0}switch(eo){case"bottom":case"bottom-right":case"bottom-left":ed=1;break;case"top":case"top-right":case"top-left":ed=0}return{horizontalAlign:ec,verticalAlign:ed}}function Up(eo,ec,ed,em,e_){if(!(ec||ed||em||e_))return;let eg=eo.length-1,ex=eo[eg],ev=(ex.x+ex.metrics.advance*ex.scale)*ec;for(let ec=0;ec<=eg;ec++)eo[ec].x-=ev,eo[ec].y+=ed+em+e_}function jp(eo,ec,ed,em,e_,eg){let ex,ev,eb,ew,eT;let eE=eo.image;if(eE.content){let eo=eE.content,ec=eE.pixelRatio||1;ex=[eo[0]/ec,eo[1]/ec,eE.displaySize[0]-eo[2]/ec,eE.displaySize[1]-eo[3]/ec]}let eM=ec.left*eg,eS=ec.right*eg;"width"===ed||"both"===ed?(eT=e_[0]+eM-em[3],eb=e_[0]+eS+em[1]):eb=(eT=e_[0]+(eM+eS-eE.displaySize[0])/2)+eE.displaySize[0];let eA=ec.top*eg,eI=ec.bottom*eg;return"height"===ed||"both"===ed?(ev=e_[1]+eA-em[0],ew=e_[1]+eI+em[2]):ew=(ev=e_[1]+(eA+eI-eE.displaySize[1])/2)+eE.displaySize[1],{image:eE,top:ev,right:eb,bottom:ew,left:eT,collisionPadding:ex}}let Op=class Op extends eL{constructor(eo,ec,ed,em,e_){super(eo,ec),this.angle=em,this.z=ed,void 0!==e_&&(this.segment=e_)}clone(){return new Op(this.x,this.y,this.z,this.angle,this.segment)}};function qp(eo,ec,ed,em,e_){if(void 0===ec.segment)return!0;let eg=ec,ex=ec.segment+1,ev=0;for(;ev>-ed/2;){if(--ex<0)return!1;ev-=eo[ex].dist(eg),eg=eo[ex]}ev+=eo[ex].dist(eo[ex+1]),ex++;let eb=[],ew=0;for(;ev<ed/2;){let ec=eo[ex],ed=eo[ex+1];if(!ed)return!1;let eg=eo[ex-1].angleTo(ec)-ec.angleTo(ed);for(eg=Math.abs((eg+3*Math.PI)%(2*Math.PI)-Math.PI),eb.push({distance:ev,angleDelta:eg}),ew+=eg;ev-eb[0].distance>em;)ew-=eb.shift().angleDelta;if(ew>e_)return!1;ex++,ev+=ec.dist(ed)}return!0}function Np(eo){let ec=0;for(let ed=0;ed<eo.length-1;ed++)ec+=eo[ed].dist(eo[ed+1]);return ec}function Zp(eo,ec){return Math.max(eo?eo.right-eo.left:0,ec?ec.right-ec.left:0)}function Hp(eo,ec,ed,em,e_){let eg=[];for(let ex=0;ex<eo.length;ex++){let ev;let eb=eo[ex];for(let eo=0;eo<eb.length-1;eo++){let ex=eb[eo],ew=eb[eo+1];ex.x<ec&&ew.x<ec||(ex.x<ec?ex=new eL(ec,ex.y+(ec-ex.x)/(ew.x-ex.x)*(ew.y-ex.y))._round():ew.x<ec&&(ew=new eL(ec,ex.y+(ec-ex.x)/(ew.x-ex.x)*(ew.y-ex.y))._round()),ex.y<ed&&ew.y<ed||(ex.y<ed?ex=new eL(ex.x+(ed-ex.y)/(ew.y-ex.y)*(ew.x-ex.x),ed)._round():ew.y<ed&&(ew=new eL(ex.x+(ed-ex.y)/(ew.y-ex.y)*(ew.x-ex.x),ed)._round()),ex.x>=em&&ew.x>=em||(ex.x>=em?ex=new eL(em,ex.y+(em-ex.x)/(ew.x-ex.x)*(ew.y-ex.y))._round():ew.x>=em&&(ew=new eL(em,ex.y+(em-ex.x)/(ew.x-ex.x)*(ew.y-ex.y))._round()),ex.y>=e_&&ew.y>=e_||(ex.y>=e_?ex=new eL(ex.x+(e_-ex.y)/(ew.y-ex.y)*(ew.x-ex.x),e_)._round():ew.y>=e_&&(ew=new eL(ex.x+(e_-ex.y)/(ew.y-ex.y)*(ew.x-ex.x),e_)._round()),ev&&ex.equals(ev[ev.length-1])||(ev=[ex],eg.push(ev)),ev.push(ew)))))}}return eg}function Wp(eo,ec,ed,em,e_,eg,ex,ev,eb){for(let ew=ec;ew<ec+em;ew++)Qp(eo,ed*eg+ew,eg,e_,ex,ev,eb);for(let ew=ed;ew<ed+e_;ew++)Qp(eo,ew*eg+ec,1,em,ex,ev,eb)}function Qp(eo,ec,ed,em,e_,eg,ex){eg[0]=0,ex[0]=-1e20,ex[1]=1e20,e_[0]=eo[ec];for(let ev=1,eb=0,ew=0;ev<em;ev++){e_[ev]=eo[ec+ev*ed];let em=ev*ev;do{let eo=eg[eb];ew=(e_[ev]-e_[eo]+em-eo*eo)/(ev-eo)/2}while(ew<=ex[eb]&&--eb>-1);eg[++eb]=ev,ex[eb]=ew,ex[eb+1]=1e20}for(let ev=0,eb=0;ev<em;ev++){for(;ex[eb+1]<ev;)eb++;let em=eg[eb],ew=ev-em;eo[ec+ev*ed]=e_[em]+ew*ew}}Ji(Op,"Anchor");let rN={none:0,ideographs:1,all:2};let rd=class rd{constructor(eo,ec,ed){this.requestManager=eo,this.localGlyphMode=ec,this.localFontFamily=ed,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(eo){this.url=eo}getGlyphs(eo,ec){let ed=[];for(let ec in eo)for(let em of eo[ec])ed.push({stack:ec,id:em});B(ed,({stack:eo,id:ec},ed)=>{let em=this.entries[eo];em||(em=this.entries[eo]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let e_=em.glyphs[ec];if(void 0!==e_)return void ed(null,{stack:eo,id:ec,glyph:e_});if(e_=this._tinySDF(em,eo,ec))return em.glyphs[ec]=e_,void ed(null,{stack:eo,id:ec,glyph:e_});let eg=Math.floor(ec/256);if(256*eg>65535)return void ed(Error("glyphs > 65535 not supported"));if(em.ranges[eg])return void ed(null,{stack:eo,id:ec,glyph:e_});let ex=em.requests[eg];ex||(ex=em.requests[eg]=[],rd.loadGlyphRange(eo,eg,this.url,this.requestManager,(eo,ec)=>{if(ec){for(let eo in em.ascender=ec.ascender,em.descender=ec.descender,ec.glyphs)this._doesCharSupportLocalGlyph(+eo)||(em.glyphs[+eo]=ec.glyphs[+eo]);em.ranges[eg]=!0}for(let ed of ex)ed(eo,ec);delete em.requests[eg]})),ex.push((em,e_)=>{em?ed(em):e_&&ed(null,{stack:eo,id:ec,glyph:e_.glyphs[ec]||null})})},(eo,ed)=>{if(eo)ec(eo);else if(ed){let eo={};for(let{stack:ec,id:em,glyph:e_}of ed)void 0===eo[ec]&&(eo[ec]={}),void 0===eo[ec].glyphs&&(eo[ec].glyphs={}),eo[ec].glyphs[em]=e_&&{id:e_.id,bitmap:e_.bitmap.clone(),metrics:e_.metrics},eo[ec].ascender=this.entries[ec].ascender,eo[ec].descender=this.entries[ec].descender;ec(null,eo)}})}_doesCharSupportLocalGlyph(eo){return this.localGlyphMode!==rN.none&&(this.localGlyphMode===rN.all?!!this.localFontFamily:!!this.localFontFamily&&(t0["CJK Unified Ideographs"](eo)||t0["Hangul Syllables"](eo)||t0.Hiragana(eo)||t0.Katakana(eo)||t0["CJK Symbols and Punctuation"](eo)))}_tinySDF(eo,ec,ed){let em=this.localFontFamily;if(!em||!this._doesCharSupportLocalGlyph(ed))return;let e_=eo.tinySDF;if(!e_){let ed="400";/bold/i.test(ec)?ed="900":/medium/i.test(ec)?ed="500":/light/i.test(ec)&&(ed="200"),(e_=eo.tinySDF=new rd.TinySDF({fontFamily:em,fontWeight:ed,fontSize:48,buffer:6,radius:16})).fontWeight=ed}if(this.localGlyphs[e_.fontWeight][ed])return this.localGlyphs[e_.fontWeight][ed];let eg=String.fromCharCode(ed),{data:ex,width:ev,height:eb,glyphWidth:ew,glyphHeight:eT,glyphLeft:eE,glyphTop:eM,glyphAdvance:eS}=e_.draw(eg);return this.localGlyphs[e_.fontWeight][ed]={id:ed,bitmap:new Ru({width:ev,height:eb},ex),metrics:{width:ew/2,height:eT/2,left:eE/2,top:eM/2-27,advance:eS/2,localGlyph:!0}}}};function id(eo,ec,ed,em){let e_=[],eg=eo.image,ex=eg.pixelRatio,ev=eg.paddedRect.w-2,eb=eg.paddedRect.h-2,ew=eo.right-eo.left,eT=eo.bottom-eo.top,eE=eg.stretchX||[[0,ev]],eM=eg.stretchY||[[0,eb]],d=(eo,ec)=>eo+ec[1]-ec[0],eS=eE.reduce(d,0),eA=eM.reduce(d,0),eI=ev-eS,eC=eb-eA,eP=0,ez=eS,eD=0,ek=eA,eR=0,eB=eI,eF=0,eO=eC;if(eg.content&&em){let eo=eg.content;eP=sd(eE,0,eo[0]),eD=sd(eM,0,eo[1]),ez=sd(eE,eo[0],eo[2]),ek=sd(eM,eo[1],eo[3]),eR=eo[0]-eP,eF=eo[1]-eD,eB=eo[2]-eo[0]-ez,eO=eo[3]-eo[1]-ek}let M=(em,e_,ev,eb)=>{var eE,eM,eI,eC,eU,eN,eV,ej,eG,eZ,e$,eq;let eX=(em.stretch-eP)/ez*ew+eo.left,eW=(eI=em.fixed-eR,eI-eB*em.stretch/eS),eH=(e_.stretch-eD)/ek*eT+eo.top,eJ=(eN=e_.fixed-eF,eN-eO*e_.stretch/eA),eY=(ev.stretch-eP)/ez*ew+eo.left,eK=(eG=ev.fixed-eR,eG-eB*ev.stretch/eS),eQ=(eb.stretch-eD)/ek*eT+eo.top,e0=(eq=eb.fixed-eF,eq-eO*eb.stretch/eA),e1=new eL(eX,eH),e2=new eL(eY,eH),e3=new eL(eY,eQ),e5=new eL(eX,eQ),e4=new eL(eW/ex,eJ/ex),e6=new eL(eK/ex,e0/ex),e8=ec*Math.PI/180;if(e8){let eo=Math.sin(e8),ec=Math.cos(e8),ed=[ec,-eo,eo,ec];e1._matMult(ed),e2._matMult(ed),e5._matMult(ed),e3._matMult(ed)}let e9=em.stretch+em.fixed,e7=e_.stretch+e_.fixed;return{tl:e1,tr:e2,bl:e5,br:e3,tex:{x:eg.paddedRect.x+1+e9,y:eg.paddedRect.y+1+e7,w:ev.stretch+ev.fixed-e9,h:eb.stretch+eb.fixed-e7},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:e4,pixelOffsetBR:e6,minFontScaleX:eB/ex/ew,minFontScaleY:eO/ex/eT,isSDF:ed}};if(em&&(eg.stretchX||eg.stretchY)){let eo=ad(eE,eI,eS),ec=ad(eM,eC,eA);for(let ed=0;ed<eo.length-1;ed++){let em=eo[ed],eg=eo[ed+1];for(let eo=0;eo<ec.length-1;eo++)e_.push(M(em,ec[eo],eg,ec[eo+1]))}}else e_.push(M({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:ev+1},{fixed:0,stretch:eb+1}));return e_}function sd(eo,ec,ed){let em=0;for(let e_ of eo)em+=Math.max(ec,Math.min(ed,e_[1]))-Math.max(ec,Math.min(ed,e_[0]));return em}function ad(eo,ec,ed){let em=[{fixed:-1,stretch:0}];for(let[ec,ed]of eo){let eo=em[em.length-1];em.push({fixed:ec-eo.stretch,stretch:eo.stretch}),em.push({fixed:ec-eo.stretch,stretch:eo.stretch+(ed-ec)})}return em.push({fixed:ec+1,stretch:ed}),em}rd.loadGlyphRange=function(eo,ec,ed,em,e_){let eg=256*ec,ex=eg+255,ev=em.transformRequest(em.normalizeGlyphsURL(ed).replace("{fontstack}",eo).replace("{range}",`${eg}-${ex}`),eq.Glyphs);pt(ev,(eo,ec)=>{if(eo)e_(eo);else if(ec){let eo={},ed=new rB(ec).readFields(xp,{});for(let ec of ed.glyphs)eo[ec.id]=ec;e_(null,{glyphs:eo,ascender:ed.ascender,descender:ed.descender})}})},rd.TinySDF=class{constructor({fontSize:eo=24,buffer:ec=3,radius:ed=8,cutoff:em=.25,fontFamily:e_="sans-serif",fontWeight:eg="normal",fontStyle:ex="normal"}={}){this.buffer=ec,this.cutoff=em,this.radius=ed;let ev=this.size=eo+4*ec,eb=this._createCanvas(ev),ew=this.ctx=eb.getContext("2d",{willReadFrequently:!0});ew.font=`${ex} ${eg} ${eo}px ${e_}`,ew.textBaseline="alphabetic",ew.textAlign="left",ew.fillStyle="black",this.gridOuter=new Float64Array(ev*ev),this.gridInner=new Float64Array(ev*ev),this.f=new Float64Array(ev),this.z=new Float64Array(ev+1),this.v=new Uint16Array(ev)}_createCanvas(eo){let ec=document.createElement("canvas");return ec.width=ec.height=eo,ec}draw(eo){let{width:ec,actualBoundingBoxAscent:ed,actualBoundingBoxDescent:em,actualBoundingBoxLeft:e_,actualBoundingBoxRight:eg}=this.ctx.measureText(eo),ex=Math.ceil(ed),ev=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(eg-e_))),eb=Math.min(this.size-this.buffer,ex+Math.ceil(em)),ew=ev+2*this.buffer,eT=eb+2*this.buffer,eE=Math.max(ew*eT,0),eM=new Uint8ClampedArray(eE),eS={data:eM,width:ew,height:eT,glyphWidth:ev,glyphHeight:eb,glyphTop:ex,glyphLeft:0,glyphAdvance:ec};if(0===ev||0===eb)return eS;let{ctx:eA,buffer:eI,gridInner:eC,gridOuter:eP}=this;eA.clearRect(eI,eI,ev,eb),eA.fillText(eo,eI,eI+ex);let ez=eA.getImageData(eI,eI,ev,eb);eP.fill(1e20,0,eE),eC.fill(0,0,eE);for(let eo=0;eo<eb;eo++)for(let ec=0;ec<ev;ec++){let ed=ez.data[4*(eo*ev+ec)+3]/255;if(0===ed)continue;let em=(eo+eI)*ew+ec+eI;if(1===ed)eP[em]=0,eC[em]=1e20;else{let eo=.5-ed;eP[em]=eo>0?eo*eo:0,eC[em]=eo<0?eo*eo:0}}Wp(eP,0,0,ew,eT,ew,this.f,this.v,this.z),Wp(eC,eI,eI,ev,eb,ew,this.f,this.v,this.z);for(let eo=0;eo<eE;eo++){let ec=Math.sqrt(eP[eo])-Math.sqrt(eC[eo]);eM[eo]=Math.round(255-255*(ec/this.radius+this.cutoff))}return eS}};let cd=class cd{constructor(eo=[],ec=hd){if(this.data=eo,this.length=this.data.length,this.compare=ec,this.length>0)for(let eo=(this.length>>1)-1;eo>=0;eo--)this._down(eo)}push(eo){this.data.push(eo),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let eo=this.data[0],ec=this.data.pop();return this.length--,this.length>0&&(this.data[0]=ec,this._down(0)),eo}peek(){return this.data[0]}_up(eo){let{data:ec,compare:ed}=this,em=ec[eo];for(;eo>0;){let e_=eo-1>>1,eg=ec[e_];if(ed(em,eg)>=0)break;ec[eo]=eg,eo=e_}ec[eo]=em}_down(eo){let{data:ec,compare:ed}=this,em=this.length>>1,e_=ec[eo];for(;eo<em;){let em=1+(eo<<1),eg=ec[em],ex=em+1;if(ex<this.length&&0>ed(ec[ex],eg)&&(em=ex,eg=ec[ex]),ed(eg,e_)>=0)break;ec[eo]=eg,eo=em}ec[eo]=e_}};function hd(eo,ec){return eo<ec?-1:eo>ec?1:0}function dd(eo,ec){return ec.max-eo.max}let fd=class fd{constructor(eo,ec,ed,em){this.p=new eL(eo,ec),this.h=ed,this.d=function(eo,ec){let ed=!1,em=1/0;for(let e_=0;e_<ec.length;e_++){let eg=ec[e_];for(let ec=0,e_=eg.length,ex=e_-1;ec<e_;ex=ec++){let e_=eg[ec],ev=eg[ex];e_.y>eo.y!=ev.y>eo.y&&eo.x<(ev.x-e_.x)*(eo.y-e_.y)/(ev.y-e_.y)+e_.x&&(ed=!ed),em=Math.min(em,xu(eo,e_,ev))}}return(ed?1:-1)*Math.sqrt(em)}(this.p,em),this.max=this.d+this.h*Math.SQRT2}};let rV=Number.POSITIVE_INFINITY,rj=Math.sqrt(2);function xd(eo,[ec,ed]){let em=0,e_=0;if(ed===rV){ec<0&&(ec=0);let ed=ec/rj;switch(eo){case"top-right":case"top-left":e_=ed-7;break;case"bottom-right":case"bottom-left":e_=-ed+7;break;case"bottom":e_=-ec+7;break;case"top":e_=ec-7}switch(eo){case"top-right":case"bottom-right":em=-ed;break;case"top-left":case"bottom-left":em=ed;break;case"left":em=ec;break;case"right":em=-ec}}else{switch(ec=Math.abs(ec),ed=Math.abs(ed),eo){case"top-right":case"top-left":case"top":e_=ed-7;break;case"bottom-right":case"bottom-left":case"bottom":e_=-ed+7}switch(eo){case"top-right":case"bottom-right":case"right":em=-ec;break;case"top-left":case"bottom-left":case"left":em=ec}}return[em,e_]}function bd(eo){switch(eo){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Sd(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC){let eP=function(eo,ec,ed,em,e_,eg,ex,ev){let eb=[];if(0===ec.positionedLines.length)return eb;let ew=em.layout.get("text-rotate").evaluate(eg,{})*Math.PI/180,eT=function(eo){let ec=eo[0],ed=eo[1],em=ec*ed;return em>0?[ec,-ed]:em<0?[-ec,ed]:0===ec?[ed,ec]:[ed,-ec]}(ed),eE=Math.abs(ec.top-ec.bottom);for(let eo of ec.positionedLines)eE-=eo.lineOffset;let eM=ec.positionedLines.length,eS=eE/eM,eA=ec.top-ed[1];for(let eo=0;eo<eM;++eo){let em=ec.positionedLines[eo];for(let eg of(eA=function(eo,ec,ed,em){let e_=ec+eo.positionedLines[em].lineOffset;return 0===em?ed+e_/2:ed+(e_+(ec+eo.positionedLines[em-1].lineOffset))/2}(ec,eS,eA,eo),em.positionedGlyphs)){let eo,em,eE,eM;if(!eg.rect)continue;let eS=eg.rect||{},eI=4,eC=!0,eP=1,ez=0;if(eg.imageName){let eo=ex[eg.imageName];if(!eo)continue;if(eo.sdf){N("SDF images are not supported in formatted text and will be ignored.");continue}eC=!1,eI=1/(eP=eo.pixelRatio)}let eD=(e_||ev)&&eg.vertical,ek=eg.metrics.advance*eg.scale/2,eR=eg.metrics,eB=eg.rect;if(null===eB)continue;ev&&ec.verticalizable&&(ez=eg.imageName?ek-eg.metrics.width*eg.scale/2:0);let eF=e_?[eg.x+ek,eg.y]:[0,0],eO=[0,0],eU=[0,0],eN=!1;e_||(eD?(eU=[eg.x+ek+eT[0],eg.y+eT[1]-ez],eN=!0):eO=[eg.x+ek+ed[0],eg.y+ed[1]-ez]);let eV=eB.w*eg.scale/(eP*(eg.localGlyph?2:1)),ej=eB.h*eg.scale/(eP*(eg.localGlyph?2:1));if(eD){let ec=eg.y-eA,ed=new eL(-ek,ek-ec),e_=-Math.PI/2,ex=new eL(...eU);(eo=new eL(-ek+eO[0],eO[1]))._rotateAround(e_,ed)._add(ex),eo.x+=-ec+ek,eo.y-=(eR.left-eI)*eg.scale;let ev=eg.imageName?eR.advance*eg.scale:24*eg.scale,eb=String.fromCharCode(eg.glyph);"︶"===eb||"﹈"===eb||"︸"===eb||"﹄"===eb||"﹂"===eb||"︾"===eb||"︼"===eb||"︺"===eb||"︘"===eb||"﹀"===eb||"︐"===eb||"︓"===eb||"︔"===eb||"｀"===eb||"￣"===eb||"︑"===eb||"︒"===eb?eo.x+=(1-eI)*eg.scale:"︵"===eb||"﹇"===eb||"︷"===eb||"﹃"===eb||"﹁"===eb||"︽"===eb||"︻"===eb||"︹"===eb||"︗"===eb||"︿"===eb?eo.x+=ev-eR.height*eg.scale+(-eI-1)*eg.scale:eo.x+=eg.imageName||eR.width+2*eI===eB.w&&eR.height+2*eI===eB.h?(ev-ej)/2:(ev-(eR.height+2*eI)*eg.scale)/2,em=new eL(eo.x,eo.y-eV),eE=new eL(eo.x+ej,eo.y),eM=new eL(eo.x+ej,eo.y-eV)}else{let ec=(eR.left-eI)*eg.scale-ek+eO[0],ed=(-eR.top-eI)*eg.scale+eO[1],e_=ec+eV,ex=ed+ej;eo=new eL(ec,ed),em=new eL(e_,ed),eE=new eL(ec,ex),eM=new eL(e_,ex)}if(ew){let ec;ec=e_?new eL(0,0):eN?new eL(eT[0],eT[1]):new eL(ed[0],ed[1]),eo._rotateAround(ew,ec),em._rotateAround(ew,ec),eE._rotateAround(ew,ec),eM._rotateAround(ew,ec)}let eG=new eL(0,0),eZ=new eL(0,0);eb.push({tl:eo,tr:em,bl:eE,br:eM,tex:eS,writingMode:ec.writingMode,glyphOffset:eF,sectionIndex:eg.sectionIndex,isSDF:eC,pixelOffsetTL:eG,pixelOffsetBR:eZ,minFontScaleX:0,minFontScaleY:0})}}return eb}(0,em,eb,eg,ex,ev,e_,eo.allowVerticalPlacement),ez=eo.textSizeData,eD=null;for(let em of("source"===ez.kind?(eD=[128*eg.layout.get("text-size").evaluate(ev,{},eC)])[0]>32640&&N(`${eo.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`):"composite"===ez.kind&&((eD=[128*eA.compositeTextSizes[0].evaluate(ev,{},eC),128*eA.compositeTextSizes[1].evaluate(ev,{},eC)])[0]>32640||eD[1]>32640)&&N(`${eo.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`),eo.addSymbols(eo.text,eP,eD,eb,ex,ev,eT,ec,ed,ew.lineStartIndex,ew.lineLength,eS,eI,eC),eE))eM[em]=eo.text.placedSymbolArray.length-1;return 4*eP.length}function kd(eo){for(let ec in eo)return eo[ec];return null}function Id(eo,ec,ed,em,e_,eg,ex,ev,eb,ew){let eT=ex.top,eE=ex.bottom,eM=ex.left,eS=ex.right,eA=ex.collisionPadding;if(eA&&(eM-=eA[0],eT-=eA[1],eS+=eA[2],eE+=eA[3]),eb){let eo=new eL(eM,eT),ec=new eL(eS,eT),ed=new eL(eM,eE),em=new eL(eS,eE),e_=eb*eR,eg=new eL(0,0);ew&&(eg=new eL(ew[0],ew[1])),eo._rotateAround(e_,eg),ec._rotateAround(e_,eg),ed._rotateAround(e_,eg),em._rotateAround(e_,eg),eM=Math.min(eo.x,ec.x,ed.x,em.x),eS=Math.max(eo.x,ec.x,ed.x,em.x),eT=Math.min(eo.y,ec.y,ed.y,em.y),eE=Math.max(eo.y,ec.y,ed.y,em.y)}return eo.emplaceBack(ec.x,ec.y,ec.z,ed.x,ed.y,eM,eT,eS,eE,ev,em,e_,eg),eo.length-1}function Md(eo){eo.collisionPadding&&(eo.top-=eo.collisionPadding[1],eo.bottom+=eo.collisionPadding[3]);let ec=eo.bottom-eo.top;return ec>0?Math.max(10,ec):null}function zd(eo,ec){let ed=eo.fovAboveCenter,em=eo.elevation?eo.elevation.getMinElevationBelowMSL()*ec:0,e_=(eo._camera.position[2]*eo.worldSize-em)/Math.cos(eo._pitch),eg=Math.sin(ed)*e_/Math.sin(Math.max(Math.PI/2-eo._pitch-ed,.01)),ex=Math.sin(eo._pitch)*eg+e_;return Math.min(1.01*ex,e_*(1/eo._horizonShift))}function Bd(eo,ec){if(!ec.isReprojectedInTileSpace)return{scale:1<<eo.z,x:eo.x,y:eo.y,x2:eo.x+1,y2:eo.y+1,projection:ec};let ed=Math.pow(2,-eo.z),em=eo.x*ed,e_=(eo.x+1)*ed,eg=eo.y*ed,ex=(eo.y+1)*ed,ev=Kl(em),eb=Kl(e_),ew=Xl(eg),eT=Xl(ex),eE=ec.project(ev,ew),eM=ec.project(eb,ew),eS=ec.project(eb,eT),eA=ec.project(ev,eT),eI=Math.min(eE.x,eM.x,eS.x,eA.x),eC=Math.min(eE.y,eM.y,eS.y,eA.y),eP=Math.max(eE.x,eM.x,eS.x,eA.x),ez=Math.max(eE.y,eM.y,eS.y,eA.y),eD=ed/16;function b(eo,ed,em,e_,eg,ex){let ev=(em+eg)/2,eb=(e_+ex)/2,ew=ec.project(Kl(ev),Xl(eb)),eT=Math.max(0,eI-ew.x,eC-ew.y,ew.x-eP,ew.y-ez);eI=Math.min(eI,ew.x),eP=Math.max(eP,ew.x),eC=Math.min(eC,ew.y),ez=Math.max(ez,ew.y),eT>eD&&(b(eo,ew,em,e_,ev,eb),b(ew,ed,ev,eb,eg,ex))}b(eE,eM,em,eg,e_,eg),b(eM,eS,e_,eg,e_,ex),b(eS,eA,e_,ex,em,ex),b(eA,eE,em,ex,em,eg),eI-=eD,eC-=eD,eP+=eD,ez+=eD;let ek=1/Math.max(eP-eI,ez-eC);return{scale:ek,x:eI*ek,y:eC*ek,x2:eP*ek,y2:ez*ek,projection:ec}}let rG=po(new Float32Array(16));let Cd=class Cd{constructor(eo){this.spec=eo,this.name=eo.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(eo,ec){return{x:0,y:0,z:0}}unproject(eo,ec){return new iq(0,0)}projectTilePoint(eo,ec,ed){return{x:eo,y:ec,z:0}}locationPoint(eo,ec,ed=!0){return eo._coordinatePoint(eo.locationCoordinate(ec),ed)}pixelsPerMeter(eo,ec){return 1/ql(eo)*ec}pixelSpaceConversion(eo,ec,ed){return 1}farthestPixelDistance(eo){return zd(eo,eo.pixelsPerMeter)}pointCoordinate(eo,ec,ed,em){let e_=eo.horizonLineFromTop(!1),eg=new eL(ec,Math.max(e_,ed));return eo.rayIntersectionCoordinate(eo.pointRayIntersection(eg,em))}pointCoordinate3D(eo,ec,ed){let em=new eL(ec,ed);if(eo.elevation)return eo.elevation.pointCoordinate(em);{let ec=this.pointCoordinate(eo,em.x,em.y,0);return[ec.x,ec.y,ec.z]}}isPointAboveHorizon(eo,ec){if(eo.elevation)return!this.pointCoordinate3D(eo,ec.x,ec.y);let ed=eo.horizonLineFromTop();return ec.y<ed}createInversionMatrix(eo,ec){return rG}createTileMatrix(eo,ec,ed){let em,e_,eg;let ex=ed.canonical,ev=po(new Float64Array(16));if(this.isReprojectedInTileSpace){let eb=Bd(ex,this);em=1,e_=eb.x+ed.wrap*eb.scale,eg=eb.y,go(ev,ev,[em/eb.scale,em/eb.scale,eo.pixelsPerMeter/ec])}else em=ec/eo.zoomScale(ex.z),e_=(ex.x+Math.pow(2,ex.z)*ed.wrap)*em,eg=ex.y*em;return mo(ev,ev,[e_,eg,0]),go(ev,ev,[em/8192,em/8192,1]),ev}upVector(eo,ec,ed){return[0,0,1]}upVectorScale(eo,ec,ed){return{metersToTile:1}}};let Pd=class Pd extends Cd{constructor(eo){super(eo),this.range=[4,7],this.center=eo.center||[-96,37.5];let[ec,ed]=this.parallels=eo.parallels||[29.5,45.5],em=Math.sin(ec*eR);this.n=(em+Math.sin(ed*eR))/2,this.c=1+em*(2*this.n-em),this.r0=Math.sqrt(this.c)/this.n}project(eo,ec){let{n:ed,c:em,r0:e_}=this,eg=(eo-this.center[0])*eR,ex=ec*eR,ev=Math.sqrt(em-2*ed*Math.sin(ex))/ed;return{x:ev*Math.sin(eg*ed),y:ev*Math.cos(eg*ed)-e_,z:0}}unproject(eo,ec){let{n:ed,c:em,r0:e_}=this,eg=e_+ec,ex=Math.atan2(eo,Math.abs(eg))*Math.sign(eg);eg*ed<0&&(ex-=Math.PI*Math.sign(eo)*Math.sign(eg));let ev=this.center[0]*eR*ed;ex=z(ex,-Math.PI-ev,Math.PI-ev);let eb=M(ex/ed*eB+this.center[0],-180,180),ew=Math.asin(M((em-(eo*eo+eg*eg)*ed*ed)/(2*ed),-1,1)),eT=M(ew*eB,-85.051129,85.051129);return new iq(eb,eT)}};let rZ=Math.sqrt(3)/2;let Ud=class Ud extends Cd{project(eo,ec){ec=ec/180*Math.PI,eo=eo/180*Math.PI;let ed=Math.asin(rZ*Math.sin(ec)),em=ed*ed,e_=em*em*em;return{x:.5*(eo*Math.cos(ed)/(rZ*(1.340264+-.24331799999999998*em+e_*(.0062510000000000005+.034164*em)))/Math.PI+.5),y:1-.5*(ed*(1.340264+-.081106*em+e_*(893e-6+.003796*em))/Math.PI+1),z:0}}unproject(eo,ec){eo=(2*eo-.5)*Math.PI;let ed=ec=(2*(1-ec)-1)*Math.PI,em=ed*ed,e_=em*em*em;for(let eo,eg,ex=0;ex<12&&(eg=ed*(1.340264+-.081106*em+e_*(893e-6+.003796*em))-ec,e_=(em=(ed=M(ed-(eo=eg/(1.340264+-.24331799999999998*em+e_*(.0062510000000000005+.034164*em))),-Math.PI/3,Math.PI/3))*ed)*em*em,!(1e-12>Math.abs(eo)));++ex);let eg=rZ*eo*(1.340264+-.24331799999999998*em+e_*(.0062510000000000005+.034164*em))/Math.cos(ed),ex=Math.asin(Math.sin(ed)/rZ),ev=M(180*eg/Math.PI,-180,180),eb=M(180*ex/Math.PI,-85.051129,85.051129);return new iq(ev,eb)}};let $d=class $d extends Cd{constructor(eo){super(eo),this.wrap=!0,this.supportsWorldCopies=!0}project(eo,ec){return{x:.5+eo/360,y:.5-ec/360,z:0}}unproject(eo,ec){let ed=M(360*(.5-ec),-85.051129,85.051129);return new iq(360*(eo-.5),ed)}};let r$=Math.PI/2;function Od(eo){return Math.tan((r$+eo)/2)}let qd=class qd extends Cd{constructor(eo){super(eo),this.center=eo.center||[0,30];let[ec,ed]=this.parallels=eo.parallels||[30,30],em=ec*eR,e_=ed*eR;this.southernCenter=em+e_<0,this.southernCenter&&(em=-em,e_=-e_);let eg=Math.cos(em),ex=Od(em);this.n=em===e_?Math.sin(em):Math.log(eg/Math.cos(e_))/Math.log(Od(e_)/ex),this.f=eg*Math.pow(Od(em),this.n)/this.n}project(eo,ec){ec*=eR,this.southernCenter&&(ec=-ec),eo=(eo-this.center[0])*eR;let{n:ed,f:em}=this;em>0?ec<-r$+1e-6&&(ec=-r$+1e-6):ec>r$-1e-6&&(ec=r$-1e-6);let e_=em/Math.pow(Od(ec),ed),eg=e_*Math.sin(ed*eo),ex=em-e_*Math.cos(ed*eo);return eg=.5*(eg/Math.PI+.5),ex=.5*(ex/Math.PI+.5),{x:eg,y:this.southernCenter?ex:1-ex,z:0}}unproject(eo,ec){eo=(2*eo-.5)*Math.PI,this.southernCenter&&(ec=1-ec),ec=(2*(1-ec)-.5)*Math.PI;let{n:ed,f:em}=this,e_=em-ec,eg=Math.sign(e_),ex=Math.sign(ed)*Math.sqrt(eo*eo+e_*e_),ev=Math.atan2(eo,Math.abs(e_))*eg;e_*ed<0&&(ev-=Math.PI*Math.sign(eo)*eg);let eb=M(ev/ed*eB+this.center[0],-180,180),ew=M((2*Math.atan(Math.pow(em/ex,1/ed))-r$)*eB,-85.051129,85.051129);return new iq(eb,this.southernCenter?-ew:ew)}};let Nd=class Nd extends Cd{constructor(eo){super(eo),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(eo,ec){return{x:Nl(eo),y:Gl(ec),z:0}}unproject(eo,ec){let ed=Kl(eo),em=Xl(ec);return new iq(ed,em)}};let rq=85.051129*eR;let Zd=class Zd extends Cd{project(eo,ec){let ed=(ec*=eR)*ec,em=ed*ed;return{x:.5*((eo*=eR)*(.8707-.131979*ed+em*(em*(.003971*ed-.001529*em)-.013791))/Math.PI+.5),y:1-.5*(ec*(1.007226+ed*(.015085+em*(.028874*ed-.044475-.005916*em)))/Math.PI+1),z:0}}unproject(eo,ec){eo=(2*eo-.5)*Math.PI;let ed=ec=(2*(1-ec)-1)*Math.PI,em=25,e_=0,eg=ed*ed;do{eg=ed*ed;let eo=eg*eg;e_=(ed*(1.007226+eg*(.015085+eo*(.028874*eg-.044475-.005916*eo)))-ec)/(1.007226+eg*(.045255+eo*(.259866*eg-.311325-.005916*11*eo))),ed=M(ed-e_,-rq,rq)}while(Math.abs(e_)>1e-6&&--em>0);eg=ed*ed;let ex=M(eo/(.8707+eg*(eg*(eg*eg*eg*(.003971-.001529*eg)-.013791)-.131979))*eB,-180,180),ev=ed*eB;return new iq(ex,ev)}};let rX=85.051129*eR;let Xd=class Xd extends Cd{project(eo,ec){ec*=eR,eo*=eR;let ed=Math.cos(ec),em=2/Math.PI,e_=Math.acos(ed*Math.cos(eo/2)),eg=Math.sin(e_)/e_,ex=.5*(eo*em+2*ed*Math.sin(eo/2)/eg)||0,ev=.5*(ec+Math.sin(ec)/eg)||0;return{x:.5*(ex/Math.PI+.5),y:1-.5*(ev/Math.PI+1),z:0}}unproject(eo,ec){let ed=eo=(2*eo-.5)*Math.PI,em=ec=(2*(1-ec)-1)*Math.PI,e_=25,eg=0,ex=0;do{let e_=Math.cos(em),ev=Math.sin(em),eb=2*ev*e_,ew=ev*ev,eT=e_*e_,eE=Math.cos(ed/2),eM=Math.sin(ed/2),eS=2*eE*eM,eA=eM*eM,eI=1-eT*eE*eE,eC=eI?1/eI:0,eP=eI?Math.acos(e_*eE)*Math.sqrt(1/eI):0,ez=.5*(2*eP*e_*eM+2*ed/Math.PI)-eo,eD=.5*(eP*ev+em)-ec,ek=.5*eC*(eT*eA+eP*e_*eE*ew)+1/Math.PI,eL=eC*(eS*eb/4-eP*ev*eM),eR=.125*eC*(eb*eM-eP*ev*eT*eS),eB=.5*eC*(ew*eE+eP*eA*e_)+.5,eF=eL*eR-eB*ek;eg=(eD*eL-ez*eB)/eF,ex=(ez*eR-eD*ek)/eF,ed=M(ed-eg,-Math.PI,Math.PI),em=M(em-ex,-rX,rX)}while((Math.abs(eg)>1e-6||Math.abs(ex)>1e-6)&&--e_>0);return new iq(ed*eB,em*eB)}};let Jd=class Jd extends Cd{constructor(eo){super(eo),this.center=eo.center||[0,0],this.parallels=eo.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(this.parallels[0]*eR)),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(eo,ec){let{scale:ed,cosPhi:em}=this;return{x:eo*eR*em*ed+.5,y:-Math.sin(ec*eR)/em*ed+.5,z:0}}unproject(eo,ec){let{scale:ed,cosPhi:em}=this,e_=-(ec-.5)/ed,eg=M((eo-.5)/ed*eB/em,-180,180),ex=Math.asin(M(e_*em,-1,1)),ev=M(ex*eB,-85.051129,85.051129);return new iq(eg,ev)}};let Hd=class Hd extends Nd{constructor(eo){super(eo),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(eo,ec,ed){let em=Ml(eo,ec,ed);return Fo(em,em,Bl(xl(ed))),{x:em[0],y:em[1],z:em[2]}}locationPoint(eo,ec){let ed=Il(ec.lat,ec.lng),em=Do([],ed),e_=eo.elevation?eo.elevation.getAtPointOrZero(eo.locationCoordinate(ec),eo._centerAltitude):eo._centerAltitude;Po(ed,ed,em,1/ql(0)*8192*e_);let eg=po(new Float64Array(16));return yo(eg,eo.pixelMatrix,eo.globeMatrix),Fo(ed,ed,eg),new eL(ed[0],ed[1])}pixelsPerMeter(eo,ec){return 1/ql(0)*ec}pixelSpaceConversion(eo,ec,ed){let em=1/ql(eo)*ec,e_=Er(1/ql(45)*ec,em,ed);return this.pixelsPerMeter(eo,ec)/e_}createTileMatrix(eo,ec,ed){let em=El(xl(ed.canonical));return yo(new Float64Array(16),eo.globeMatrix,em)}createInversionMatrix(eo,ec){let{center:ed}=eo,em=Bl(xl(ec));return vo(em,em,ed.lng*eR),xo(em,em,ed.lat*eR),go(em,em,[eo._pixelsPerMercatorPixel,eo._pixelsPerMercatorPixel,1]),Float32Array.from(em)}pointCoordinate(eo,ec,ed,em){return yl(eo,ec,ed,!0)||new Wl(0,0)}pointCoordinate3D(eo,ec,ed){let em=this.pointCoordinate(eo,ec,ed,0);return[em.x,em.y,em.z]}isPointAboveHorizon(eo,ec){return!yl(eo,ec.x,ec.y,!1)}farthestPixelDistance(eo){let ec=function(eo,ec){let ed;let em=eo.cameraToCenterDistance,e_=eo._centerAltitude*ec,eg=eo._camera,ex=eo._camera.forward(),ev=Mo([],Co([],ex,-em),[0,0,e_]),eb=eo.worldSize/(2*Math.PI),ew=[0,0,-eb],eT=eo.width/eo.height,eE=Math.tan(eo.fovAboveCenter),eM=Co([],eg.up(),eE),eS=Co([],eg.right(),eE*eT),eA=Do([],Mo([],Mo([],ex,eM),eS)),eI=[];if(new el(ev,eA).closestPointOnSphere(ew,eb,eI)){let ec=Mo([],eI,ew),em=To([],ec,ev);ed=Math.cos(eo.fovAboveCenter)*ko(em)}else{let eo=To([],ev,ew),ec=To([],ew,ev);Do(ec,ec);let em=ko(eo)-eb;ed=Math.sqrt(em*(em+2*eb));let e_=Math.acos(ed/(eb+em))-Math.acos(Vo(ex,ec));ed*=Math.cos(e_)}return 1.01*ed}(eo,this.pixelsPerMeter(eo.center.lat,eo.worldSize)),ed=Pl(eo.zoom);if(ed>0){let em=zd(eo,1/ql(eo.center.lat)*eo.worldSize),e_=eo.worldSize/(2*Math.PI),eg=Math.max(eo.width,eo.height)/eo.worldSize*Math.PI;return Er(ec,em+e_*(1-Math.cos(eg)),Math.pow(ed,10))}return ec}upVector(eo,ec,ed){return Ml(ec,ed,eo,1)}upVectorScale(eo){return{metersToTile:fl(Tl(xl(eo)))}}};function Yd(eo){let ec=eo.parallels,ed=!!ec&&.01>Math.abs(ec[0]+ec[1]);switch(eo.name){case"mercator":return new Nd(eo);case"equirectangular":return new $d(eo);case"naturalEarth":return new Zd(eo);case"equalEarth":return new Ud(eo);case"winkelTripel":return new Xd(eo);case"albers":return ed?new Jd(eo):new Pd(eo);case"lambertConformalConic":return ed?new Jd(eo):new qd(eo);case"globe":return new Hd(eo)}throw Error(`Invalid projection name: ${eo.name}`)}let rW=ru.types,rH=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tf(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM){let eS=ev?Math.min(32640,Math.round(ev[0])):0,eA=ev?Math.min(32640,Math.round(ev[1])):0;eo.emplaceBack(ec,ed,Math.round(32*em),Math.round(32*e_),eg,ex,(eS<<1)+(eb?1:0),eA,16*ew,16*eT,256*eE,256*eM)}function ef(eo,ec,ed,em,e_,eg,ex){eo.emplaceBack(ec,ed,em,e_,eg,ex)}function rf(eo,ec,ed,em,e_){eo.emplaceBack(ec,ed,em,e_),eo.emplaceBack(ec,ed,em,e_),eo.emplaceBack(ec,ed,em,e_),eo.emplaceBack(ec,ed,em,e_)}let sf=class sf{constructor(eo){this.layoutVertexArray=new Xs,this.indexArray=new ra,this.programConfigurations=eo,this.segments=new so,this.dynamicLayoutVertexArray=new Ns,this.opacityVertexArray=new Hs,this.placedSymbolArray=new fa,this.globeExtVertexArray=new Js}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(eo,ec,ed,em){this.isEmpty()||(ed&&(this.layoutVertexBuffer=eo.createVertexBuffer(this.layoutVertexArray,rS.members),this.indexBuffer=eo.createIndexBuffer(this.indexArray,ec),this.dynamicLayoutVertexBuffer=eo.createVertexBuffer(this.dynamicLayoutVertexArray,rI.members,!0),this.opacityVertexBuffer=eo.createVertexBuffer(this.opacityVertexArray,rH,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=eo.createVertexBuffer(this.globeExtVertexArray,rA.members,!0)),this.opacityVertexBuffer.itemSize=1),(ed||em)&&this.programConfigurations.upload(eo))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}};Ji(sf,"SymbolBuffers");let af=class af{constructor(eo,ec,ed){this.layoutVertexArray=new eo,this.layoutAttributes=ec,this.indexArray=new ed,this.segments=new so,this.collisionVertexArray=new ta,this.collisionVertexArrayExt=new ea}upload(eo){this.layoutVertexBuffer=eo.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=eo.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=eo.createVertexBuffer(this.collisionVertexArray,rC.members,!0),this.collisionVertexBufferExt=eo.createVertexBuffer(this.collisionVertexArrayExt,rP.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}};Ji(af,"CollisionBuffers");let of=class of{constructor(eo){this.collisionBoxArray=eo.collisionBoxArray,this.zoom=eo.zoom,this.overscaling=eo.overscaling,this.layers=eo.layers,this.layerIds=this.layers.map(eo=>eo.id),this.index=eo.index,this.pixelRatio=eo.pixelRatio,this.sourceLayerIndex=eo.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=po([]),this.placementViewportMatrix=po([]);let ec=this.layers[0]._unevaluatedLayout._values;this.textSizeData=$h(this.zoom,ec["text-size"]),this.iconSizeData=$h(this.zoom,ec["icon-size"]);let ed=this.layers[0].layout,em=ed.get("symbol-sort-key"),e_=ed.get("symbol-z-order");this.canOverlap=ed.get("text-allow-overlap")||ed.get("icon-allow-overlap")||ed.get("text-ignore-placement")||ed.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==e_&&void 0!==em.constantOr(1),this.sortFeaturesByY=("viewport-y"===e_||"auto"===e_&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=ed.get("text-writing-mode").map(eo=>rF[eo]),this.stateDependentLayerIds=this.layers.filter(eo=>eo.isStateDependent()).map(eo=>eo.id),this.sourceID=eo.sourceID,this.projection=eo.projection}createArrays(){this.text=new sf(new Ja(this.layers,this.zoom,eo=>/^text/.test(eo))),this.icon=new sf(new Ja(this.layers,this.zoom,eo=>/^icon/.test(eo))),this.glyphOffsetArray=new ga,this.lineVertexArray=new xa,this.symbolInstances=new ma}calculateGlyphDependencies(eo,ec,ed,em,e_){for(let ed=0;ed<eo.length;ed++)if(ec[eo.charCodeAt(ed)]=!0,em&&e_){let em=rL[eo.charAt(ed)];em&&(ec[em.charCodeAt(0)]=!0)}}populate(eo,ec,ed,em){let e_=this.layers[0],eg=e_.layout,ex="globe"===this.projection.name,ev=eg.get("text-font"),eb=eg.get("text-field"),ew=eg.get("icon-image"),eT=("constant"!==eb.value.kind||eb.value.value instanceof De&&!eb.value.value.isEmpty()||eb.value.value.toString().length>0)&&("constant"!==ev.value.kind||ev.value.value.length>0),eE="constant"!==ew.value.kind||!!ew.value.value||Object.keys(ew.parameters).length>0,eM=eg.get("symbol-sort-key");if(this.features=[],!eT&&!eE)return;let eS=ec.iconDependencies,eA=ec.glyphDependencies,eI=ec.availableImages,eC=new ws(this.zoom);for(let{feature:ec,id:eb,index:ew,sourceLayerIndex:eP}of eo){let eo,ez;let eD=e_._featureFilter.needGeometry,ek=ou(ec,eD);if(!e_._featureFilter.filter(eC,ek,ed))continue;if(eD||(ek.geometry=au(ec,ed,em)),ex&&1!==ec.type&&ed.z<=5){let eo=ek.geometry,n=(eo,ec)=>.98078528056>Vo(Ml(eo.x,eo.y,ed,1),Ml(ec.x,ec.y,ed,1));for(let ec=0;ec<eo.length;ec++)eo[ec]=function(eo,ec){let ed=eo[0],em=[ed];for(let e_=1;e_<eo.length;e_++){let eg=eo[e_];(function eu(eo,ec,ed,em){if(em(ec,ed)){let e_=ec.add(ed)._mult(.5);eu(eo,ec,e_,em),eu(eo,e_,ed,em)}else eo.push(ed)})(em,ed,eg,ec),ed=eg}return em}(eo[ec],n)}if(eT){let ec=e_.getValueAndResolveTokens("text-field",ek,ed,eI),em=De.factory(ec);(function(eo){for(let ec of eo.sections)if(function(eo){for(let ec of eo)if(as(ec.charCodeAt(0)))return!0;return!1}(ec.text))return!0;return!1})(em)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===xs()||this.hasRTLText&&t9.isParsed())&&(eo=function(eo,ec,ed){return eo.sections.forEach(eo=>{eo.text=function(eo,ec,ed){let em=ec.layout.get("text-transform").evaluate(ed,{});return"uppercase"===em?eo=eo.toLocaleUpperCase():"lowercase"===em&&(eo=eo.toLocaleLowerCase()),t9.applyArabicShaping&&(eo=t9.applyArabicShaping(eo)),eo}(eo.text,ec,ed)}),eo}(em,e_,ek))}if(eE){let eo=e_.getValueAndResolveTokens("icon-image",ek,ed,eI);ez=eo instanceof Ve?eo:Ve.fromString(eo)}if(!eo&&!ez)continue;let eL=this.sortFeaturesByKey?eM.evaluate(ek,{},ed):void 0;if(this.features.push({id:eb,text:eo,icon:ez,index:ew,sourceLayerIndex:eP,geometry:ek.geometry,properties:ec.properties,type:rW[ec.type],sortKey:eL}),ez&&(eS[ez.name]=!0),eo){let ec=ev.evaluate(ek,{},ed).join(","),em="map"===eg.get("text-rotation-alignment")&&"point"!==eg.get("symbol-placement");for(let ed of(this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(rF.vertical)>=0,eo.sections))if(ed.image)eS[ed.image.name]=!0;else{let e_=es(eo.toString()),eg=ed.fontStack||ec,ex=eA[eg]=eA[eg]||{};this.calculateGlyphDependencies(ed.text,ex,em,this.allowVerticalPlacement,e_)}}}"line"===eg.get("symbol-placement")&&(this.features=function(eo){let ec={},ed={},em=[],e_=0;function s(ec){em.push(eo[ec]),e_++}function a(eo,ec,e_){let eg=ed[eo];return delete ed[eo],ed[ec]=eg,em[eg].geometry[0].pop(),em[eg].geometry[0]=em[eg].geometry[0].concat(e_[0]),eg}function o(eo,ed,e_){let eg=ec[ed];return delete ec[ed],ec[eo]=eg,em[eg].geometry[0].shift(),em[eg].geometry[0]=e_[0].concat(em[eg].geometry[0]),eg}function l(eo,ec,ed){let em=ed?ec[0][ec[0].length-1]:ec[0][0];return`${eo}:${em.x}:${em.y}`}for(let eg=0;eg<eo.length;eg++){let ex=eo[eg],ev=ex.geometry,eb=ex.text?ex.text.toString():null;if(!eb){s(eg);continue}let ew=l(eb,ev),eT=l(eb,ev,!0);if(ew in ed&&eT in ec&&ed[ew]!==ec[eT]){let eo=o(ew,eT,ev),e_=a(ew,eT,em[eo].geometry);delete ec[ew],delete ed[eT],ed[l(eb,em[e_].geometry,!0)]=e_,em[eo].geometry=null}else ew in ed?a(ew,eT,ev):eT in ec?o(ew,eT,ev):(s(eg),ec[ew]=e_-1,ed[eT]=e_-1)}return em.filter(eo=>eo.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((eo,ec)=>eo.sortKey-ec.sortKey)}update(eo,ec,ed,em){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(eo,ec,this.layers,ed,em),this.icon.programConfigurations.updatePaintArrays(eo,ec,this.layers,ed,em))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(eo){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(eo),this.iconCollisionBox.upload(eo)),this.text.upload(eo,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(eo,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Yd(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(eo,ec){let ed=this.lineVertexArray.length;if(void 0!==eo.segment)for(let{x:eo,y:ed}of ec)this.lineVertexArray.emplaceBack(eo,ed);return{lineStartIndex:ed,lineLength:this.lineVertexArray.length-ed}}addSymbols(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS){let eA=eo.indexArray,eI=eo.layoutVertexArray,eC=eo.globeExtVertexArray,eP=eo.segments.prepareSegment(4*ec.length,eI,eA,this.canOverlap?eg.sortKey:void 0),ez=this.glyphOffsetArray.length,eD=eP.vertexLength,ek=this.allowVerticalPlacement&&ex===rF.vertical?Math.PI/2:0,eL=eg.text&&eg.text.sections;for(let em=0;em<ec.length;em++){let{tl:e_,tr:ex,bl:ew,br:eT,tex:eE,pixelOffsetTL:ez,pixelOffsetBR:eD,minFontScaleX:eR,minFontScaleY:eB,glyphOffset:eF,isSDF:eO,sectionIndex:eU}=ec[em],eN=eP.vertexLength,eV=eF[1];if(tf(eI,eb.x,eb.y,e_.x,eV+e_.y,eE.x,eE.y,ed,eO,ez.x,ez.y,eR,eB),tf(eI,eb.x,eb.y,ex.x,eV+ex.y,eE.x+eE.w,eE.y,ed,eO,eD.x,ez.y,eR,eB),tf(eI,eb.x,eb.y,ew.x,eV+ew.y,eE.x,eE.y+eE.h,ed,eO,ez.x,eD.y,eR,eB),tf(eI,eb.x,eb.y,eT.x,eV+eT.y,eE.x+eE.w,eE.y+eE.h,ed,eO,eD.x,eD.y,eR,eB),ev){let{x:ec,y:ed,z:em}=ev.anchor,[e_,eg,ex]=ev.up;ef(eC,ec,ed,em,e_,eg,ex),ef(eC,ec,ed,em,e_,eg,ex),ef(eC,ec,ed,em,e_,eg,ex),ef(eC,ec,ed,em,e_,eg,ex),rf(eo.dynamicLayoutVertexArray,ec,ed,em,ek)}else rf(eo.dynamicLayoutVertexArray,eb.x,eb.y,eb.z,ek);eA.emplaceBack(eN,eN+1,eN+2),eA.emplaceBack(eN+1,eN+2,eN+3),eP.vertexLength+=4,eP.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(eF[0]),em!==ec.length-1&&eU===ec[em+1].sectionIndex||eo.programConfigurations.populatePaintArrays(eI.length,eg,eg.index,{},eM,eS,eL&&eL[eU])}let eR=ev?ev.anchor:eb;eo.placedSymbolArray.emplaceBack(eR.x,eR.y,eR.z,eb.x,eb.y,ez,this.glyphOffsetArray.length-ez,eD,ew,eT,eb.segment,ed?ed[0]:0,ed?ed[1]:0,em[0],em[1],ex,0,!1,0,eE,0)}_commitLayoutVertex(eo,ec,ed,em,e_,eg,ex){eo.emplaceBack(ec,ed,em,e_,eg,Math.round(ex.x),Math.round(ex.y))}_addCollisionDebugVertices(eo,ec,ed,em,e_,eg,ex){let ev=ed.segments.prepareSegment(4,ed.layoutVertexArray,ed.indexArray),eb=ev.vertexLength,ew=ex.tileAnchorX,eT=ex.tileAnchorY;for(let eo=0;eo<4;eo++)ed.collisionVertexArray.emplaceBack(0,0,0,0);ed.collisionVertexArrayExt.emplaceBack(ec,-eo.padding,-eo.padding),ed.collisionVertexArrayExt.emplaceBack(ec,eo.padding,-eo.padding),ed.collisionVertexArrayExt.emplaceBack(ec,eo.padding,eo.padding),ed.collisionVertexArrayExt.emplaceBack(ec,-eo.padding,eo.padding),this._commitLayoutVertex(ed.layoutVertexArray,em,e_,eg,ew,eT,new eL(eo.x1,eo.y1)),this._commitLayoutVertex(ed.layoutVertexArray,em,e_,eg,ew,eT,new eL(eo.x2,eo.y1)),this._commitLayoutVertex(ed.layoutVertexArray,em,e_,eg,ew,eT,new eL(eo.x2,eo.y2)),this._commitLayoutVertex(ed.layoutVertexArray,em,e_,eg,ew,eT,new eL(eo.x1,eo.y2)),ev.vertexLength+=4;let eE=ed.indexArray;eE.emplaceBack(eb,eb+1),eE.emplaceBack(eb+1,eb+2),eE.emplaceBack(eb+2,eb+3),eE.emplaceBack(eb+3,eb),ev.primitiveLength+=4}_addTextDebugCollisionBoxes(eo,ec,ed,em,e_,eg){for(let ex=em;ex<e_;ex++){let em=ed.get(ex),e_=this.getSymbolInstanceTextSize(eo,eg,ec,ex);this._addCollisionDebugVertices(em,e_,this.textCollisionBox,em.projectedAnchorX,em.projectedAnchorY,em.projectedAnchorZ,eg)}}_addIconDebugCollisionBoxes(eo,ec,ed,em,e_,eg){for(let ex=em;ex<e_;ex++){let em=ed.get(ex),e_=this.getSymbolInstanceIconSize(eo,ec,eg.placedIconSymbolIndex);this._addCollisionDebugVertices(em,e_,this.iconCollisionBox,em.projectedAnchorX,em.projectedAnchorY,em.projectedAnchorZ,eg)}}generateCollisionDebugBuffers(eo,ec){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new af(Ws,rz.members,la),this.iconCollisionBox=new af(Ws,rz.members,la);let ed=Oh(this.iconSizeData,eo),em=Oh(this.textSizeData,eo);for(let e_=0;e_<this.symbolInstances.length;e_++){let eg=this.symbolInstances.get(e_);this._addTextDebugCollisionBoxes(em,eo,ec,eg.textBoxStartIndex,eg.textBoxEndIndex,eg),this._addTextDebugCollisionBoxes(em,eo,ec,eg.verticalTextBoxStartIndex,eg.verticalTextBoxEndIndex,eg),this._addIconDebugCollisionBoxes(ed,eo,ec,eg.iconBoxStartIndex,eg.iconBoxEndIndex,eg),this._addIconDebugCollisionBoxes(ed,eo,ec,eg.verticalIconBoxStartIndex,eg.verticalIconBoxEndIndex,eg)}}getSymbolInstanceTextSize(eo,ec,ed,em){let e_=this.text.placedSymbolArray.get(ec.rightJustifiedTextSymbolIndex>=0?ec.rightJustifiedTextSymbolIndex:ec.centerJustifiedTextSymbolIndex>=0?ec.centerJustifiedTextSymbolIndex:ec.leftJustifiedTextSymbolIndex>=0?ec.leftJustifiedTextSymbolIndex:ec.verticalPlacedTextSymbolIndex>=0?ec.verticalPlacedTextSymbolIndex:em),eg=jh(this.textSizeData,eo,e_)/24;return this.tilePixelRatio*eg}getSymbolInstanceIconSize(eo,ec,ed){let em=this.icon.placedSymbolArray.get(ed),e_=jh(this.iconSizeData,eo,em);return this.tilePixelRatio*e_}_commitDebugCollisionVertexUpdate(eo,ec,ed){eo.emplaceBack(ec,-ed,-ed),eo.emplaceBack(ec,ed,-ed),eo.emplaceBack(ec,ed,ed),eo.emplaceBack(ec,-ed,ed)}_updateTextDebugCollisionBoxes(eo,ec,ed,em,e_,eg){for(let ex=em;ex<e_;ex++){let em=ed.get(ex),e_=this.getSymbolInstanceTextSize(eo,eg,ec,ex);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,e_,em.padding)}}_updateIconDebugCollisionBoxes(eo,ec,ed,em,e_,eg){for(let ex=em;ex<e_;ex++){let em=ed.get(ex),e_=this.getSymbolInstanceIconSize(eo,ec,eg);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,e_,em.padding)}}updateCollisionDebugBuffers(eo,ec){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let ed=Oh(this.iconSizeData,eo),em=Oh(this.textSizeData,eo);for(let e_=0;e_<this.symbolInstances.length;e_++){let eg=this.symbolInstances.get(e_);this._updateTextDebugCollisionBoxes(em,eo,ec,eg.textBoxStartIndex,eg.textBoxEndIndex,eg),this._updateTextDebugCollisionBoxes(em,eo,ec,eg.verticalTextBoxStartIndex,eg.verticalTextBoxEndIndex,eg),this._updateIconDebugCollisionBoxes(ed,eo,ec,eg.iconBoxStartIndex,eg.iconBoxEndIndex,eg.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(ed,eo,ec,eg.verticalIconBoxStartIndex,eg.verticalIconBoxEndIndex,eg.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(eo,ec,ed,em,e_,eg,ex,ev,eb){let ew={};if(ec<ed){let{x1:ed,y1:em,x2:e_,y2:eg,padding:ex,projectedAnchorX:ev,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM,featureIndex:eS}=eo.get(ec);ew.textBox={x1:ed,y1:em,x2:e_,y2:eg,padding:ex,projectedAnchorX:ev,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM},ew.textFeatureIndex=eS}if(em<e_){let{x1:ec,y1:ed,x2:e_,y2:eg,padding:ex,projectedAnchorX:ev,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM,featureIndex:eS}=eo.get(em);ew.verticalTextBox={x1:ec,y1:ed,x2:e_,y2:eg,padding:ex,projectedAnchorX:ev,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM},ew.verticalTextFeatureIndex=eS}if(eg<ex){let{x1:ec,y1:ed,x2:em,y2:e_,padding:ex,projectedAnchorX:ev,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM,featureIndex:eS}=eo.get(eg);ew.iconBox={x1:ec,y1:ed,x2:em,y2:e_,padding:ex,projectedAnchorX:ev,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM},ew.iconFeatureIndex=eS}if(ev<eb){let{x1:ec,y1:ed,x2:em,y2:e_,padding:eg,projectedAnchorX:ex,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM,featureIndex:eS}=eo.get(ev);ew.verticalIconBox={x1:ec,y1:ed,x2:em,y2:e_,padding:eg,projectedAnchorX:ex,projectedAnchorY:eb,projectedAnchorZ:eT,tileAnchorX:eE,tileAnchorY:eM},ew.verticalIconFeatureIndex=eS}return ew}deserializeCollisionBoxes(eo){this.collisionArrays=[];for(let ec=0;ec<this.symbolInstances.length;ec++){let ed=this.symbolInstances.get(ec);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(eo,ed.textBoxStartIndex,ed.textBoxEndIndex,ed.verticalTextBoxStartIndex,ed.verticalTextBoxEndIndex,ed.iconBoxStartIndex,ed.iconBoxEndIndex,ed.verticalIconBoxStartIndex,ed.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(eo,ec){let ed=eo.placedSymbolArray.get(ec),em=ed.vertexStartIndex+4*ed.numGlyphs;for(let ec=ed.vertexStartIndex;ec<em;ec+=4)eo.indexArray.emplaceBack(ec,ec+1,ec+2),eo.indexArray.emplaceBack(ec+1,ec+2,ec+3)}getSortedSymbolIndexes(eo){if(this.sortedAngle===eo&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;let ec=Math.sin(eo),ed=Math.cos(eo),em=[],e_=[],eg=[];for(let eo=0;eo<this.symbolInstances.length;++eo){eg.push(eo);let ex=this.symbolInstances.get(eo);em.push(0|Math.round(ec*ex.tileAnchorX+ed*ex.tileAnchorY)),e_.push(ex.featureIndex)}return eg.sort((eo,ec)=>em[eo]-em[ec]||e_[ec]-e_[eo]),eg}addToSortKeyRanges(eo,ec){let ed=this.sortKeyRanges[this.sortKeyRanges.length-1];ed&&ed.sortKey===ec?ed.symbolInstanceEnd=eo+1:this.sortKeyRanges.push({sortKey:ec,symbolInstanceStart:eo,symbolInstanceEnd:eo+1})}sortFeatures(eo){if(this.sortFeaturesByY&&this.sortedAngle!==eo&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){for(let ec of(this.symbolInstanceIndexes=this.getSortedSymbolIndexes(eo),this.sortedAngle=eo,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[],this.symbolInstanceIndexes)){let eo=this.symbolInstances.get(ec);this.featureSortOrder.push(eo.featureIndex);let{rightJustifiedTextSymbolIndex:ed,centerJustifiedTextSymbolIndex:em,leftJustifiedTextSymbolIndex:e_,verticalPlacedTextSymbolIndex:eg,placedIconSymbolIndex:ex,verticalPlacedIconSymbolIndex:ev}=eo;ed>=0&&this.addIndicesForPlacedSymbol(this.text,ed),em>=0&&em!==ed&&this.addIndicesForPlacedSymbol(this.text,em),e_>=0&&e_!==em&&e_!==ed&&this.addIndicesForPlacedSymbol(this.text,e_),eg>=0&&this.addIndicesForPlacedSymbol(this.text,eg),ex>=0&&this.addIndicesForPlacedSymbol(this.icon,ex),ev>=0&&this.addIndicesForPlacedSymbol(this.icon,ev)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}};Ji(of,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),of.MAX_GLYPHS=65535,of.addDynamicAttributes=rf;let rJ=new Ps({"symbol-placement":new Bs(tr.layout_symbol["symbol-placement"]),"symbol-spacing":new Bs(tr.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bs(tr.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Es(tr.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bs(tr.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bs(tr.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Bs(tr.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bs(tr.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bs(tr.layout_symbol["icon-rotation-alignment"]),"icon-size":new Es(tr.layout_symbol["icon-size"]),"icon-text-fit":new Bs(tr.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bs(tr.layout_symbol["icon-text-fit-padding"]),"icon-image":new Es(tr.layout_symbol["icon-image"]),"icon-rotate":new Es(tr.layout_symbol["icon-rotate"]),"icon-padding":new Bs(tr.layout_symbol["icon-padding"]),"icon-keep-upright":new Bs(tr.layout_symbol["icon-keep-upright"]),"icon-offset":new Es(tr.layout_symbol["icon-offset"]),"icon-anchor":new Es(tr.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bs(tr.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bs(tr.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bs(tr.layout_symbol["text-rotation-alignment"]),"text-field":new Es(tr.layout_symbol["text-field"]),"text-font":new Es(tr.layout_symbol["text-font"]),"text-size":new Es(tr.layout_symbol["text-size"]),"text-max-width":new Es(tr.layout_symbol["text-max-width"]),"text-line-height":new Es(tr.layout_symbol["text-line-height"]),"text-letter-spacing":new Es(tr.layout_symbol["text-letter-spacing"]),"text-justify":new Es(tr.layout_symbol["text-justify"]),"text-radial-offset":new Es(tr.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bs(tr.layout_symbol["text-variable-anchor"]),"text-anchor":new Es(tr.layout_symbol["text-anchor"]),"text-max-angle":new Bs(tr.layout_symbol["text-max-angle"]),"text-writing-mode":new Bs(tr.layout_symbol["text-writing-mode"]),"text-rotate":new Es(tr.layout_symbol["text-rotate"]),"text-padding":new Bs(tr.layout_symbol["text-padding"]),"text-keep-upright":new Bs(tr.layout_symbol["text-keep-upright"]),"text-transform":new Es(tr.layout_symbol["text-transform"]),"text-offset":new Es(tr.layout_symbol["text-offset"]),"text-allow-overlap":new Bs(tr.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Bs(tr.layout_symbol["text-ignore-placement"]),"text-optional":new Bs(tr.layout_symbol["text-optional"])});var rY={paint:new Ps({"icon-opacity":new Es(tr.paint_symbol["icon-opacity"]),"icon-color":new Es(tr.paint_symbol["icon-color"]),"icon-halo-color":new Es(tr.paint_symbol["icon-halo-color"]),"icon-halo-width":new Es(tr.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Es(tr.paint_symbol["icon-halo-blur"]),"icon-translate":new Bs(tr.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bs(tr.paint_symbol["icon-translate-anchor"]),"text-opacity":new Es(tr.paint_symbol["text-opacity"]),"text-color":new Es(tr.paint_symbol["text-color"],{runtimeType:t_,getOverride:eo=>eo.textColor,hasOverride:eo=>!!eo.textColor}),"text-halo-color":new Es(tr.paint_symbol["text-halo-color"]),"text-halo-width":new Es(tr.paint_symbol["text-halo-width"]),"text-halo-blur":new Es(tr.paint_symbol["text-halo-blur"]),"text-translate":new Bs(tr.paint_symbol["text-translate"]),"text-translate-anchor":new Bs(tr.paint_symbol["text-translate-anchor"])}),layout:rJ};let cf=class cf{constructor(eo){this.type=eo.property.overrides?eo.property.overrides.runtimeType:tl,this.defaultValue=eo}evaluate(eo){if(eo.formattedSection){let ec=this.defaultValue.property.overrides;if(ec&&ec.hasOverride(eo.formattedSection))return ec.getOverride(eo.formattedSection)}return eo.feature&&eo.featureState?this.defaultValue.evaluate(eo.feature,eo.featureState):this.defaultValue.property.specification.default}eachChild(eo){this.defaultValue.isConstant()||eo(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}};Ji(cf,"FormatSectionOverride",{omit:["defaultValue"]});let hf=class hf extends ro{constructor(eo){super(eo,rY)}recalculate(eo,ec){super.recalculate(eo,ec),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let ed=this.layout.get("text-writing-mode");if(ed){let eo=[];for(let ec of ed)0>eo.indexOf(ec)&&eo.push(ec);this.layout._values["text-writing-mode"]=eo}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(eo,ec,ed,em){var e_;let eg=this.layout.get(eo).evaluate(ec,{},ed,em),ex=this._unevaluatedLayout._values[eo];return ex.isDataDriven()||Jn(ex.value)||!eg?eg:(e_=ec.properties,eg.replace(/{([^{}]+)}/g,(eo,ec)=>ec in e_?String(e_[ec]):""))}createBucket(eo){return new of(eo)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let eo of rY.paint.overridableProperties){if(!hf.hasPaintOverride(this.layout,eo))continue;let ec=this.paint.get(eo),ed=new cf(ec),em=new Xn(ed,ec.property.specification),e_=null;e_="constant"===ec.value.kind||"source"===ec.value.kind?new Yn("source",em):new Wn("composite",em,ec.value.zoomStops,ec.value._interpolationType),this.paint._values[eo]=new Ts(ec.property,e_,ec.parameters)}}_handleOverridablePaintPropertyUpdate(eo,ec,ed){return!(!this.layout||ec.isDataDriven()||ed.isDataDriven())&&hf.hasPaintOverride(this.layout,eo)}static hasPaintOverride(eo,ec){let ed=eo.get("text-field"),em=rY.paint.properties[ec],e_=!1,s=eo=>{for(let ec of eo)if(em.overrides&&em.overrides.hasOverride(ec))return void(e_=!0)};if("constant"===ed.value.kind&&ed.value.value instanceof De)s(ed.value.value.sections);else if("source"===ed.value.kind){let t=eo=>{e_||(eo instanceof $e&&Re(eo.value)===tb?s(eo.value.sections):eo instanceof Ze?s(eo.sections):eo.eachChild(t))},eo=ed.value;eo._styleExpression&&t(eo._styleExpression.expression)}return e_}getProgramConfiguration(eo){return new Xa(this,eo)}};var rK={paint:new Ps({"background-color":new Bs(tr.paint_background["background-color"]),"background-pattern":new Bs(tr.paint_background["background-pattern"]),"background-opacity":new Bs(tr.paint_background["background-opacity"])})},rQ={paint:new Ps({"raster-opacity":new Bs(tr.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bs(tr.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bs(tr.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bs(tr.paint_raster["raster-brightness-max"]),"raster-saturation":new Bs(tr.paint_raster["raster-saturation"]),"raster-contrast":new Bs(tr.paint_raster["raster-contrast"]),"raster-resampling":new Bs(tr.paint_raster["raster-resampling"]),"raster-fade-duration":new Bs(tr.paint_raster["raster-fade-duration"])})};let ff=class ff extends ro{constructor(eo){super(eo,{}),this.implementation=eo}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(eo){this.implementation.onAdd&&this.implementation.onAdd(eo,eo.painter.context.gl)}onRemove(eo){this.implementation.onRemove&&this.implementation.onRemove(eo,eo.painter.context.gl)}};var r0={paint:new Ps({"sky-type":new Bs(tr.paint_sky["sky-type"]),"sky-atmosphere-sun":new Bs(tr.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Bs(tr.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Bs(tr.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Bs(tr.paint_sky["sky-gradient-radius"]),"sky-gradient":new Cs(tr.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Bs(tr.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Bs(tr.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Bs(tr.paint_sky["sky-opacity"])})};function mf(eo,ec,ed){let em=[0,0,1],e_=Ko([]);return Jo(e_,e_,ed?-(eo*eR)+Math.PI:eo*eR),Xo(e_,e_,-(ec*eR)),Ro(em,em,e_),Do(em,em)}let r1={circle:class extends ro{constructor(eo){super(eo,iH)}createBucket(eo){return new cu(eo)}queryRadius(eo){return Au("circle-radius",this,eo)+Au("circle-stroke-width",this,eo)+Su(this.paint.get("circle-translate"))}queryIntersectsFeature(eo,ec,ed,em,e_,eg,ex,ev){let eb=Iu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),eg.angle,eo.pixelToTileUnitsFactor),ew=this.paint.get("circle-radius").evaluate(ec,ed)+this.paint.get("circle-stroke-width").evaluate(ec,ed);return zu(eo,em,eg,ex,ev,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),eb,ew)}getProgramIds(){return["circle"]}getProgramConfiguration(eo){return new Xa(this,eo)}},heatmap:class extends ro{createBucket(eo){return new Du(eo)}constructor(eo){super(eo,iK),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(eo){"heatmap-color"===eo&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=ju({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(eo){return Au("heatmap-radius",this,eo)}queryIntersectsFeature(eo,ec,ed,em,e_,eg,ex,ev){let eb=this.paint.get("heatmap-radius").evaluate(ec,ed);return zu(eo,em,eg,ex,ev,!0,!0,new eL(0,0),eb)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(eo){return new Xa(this,eo)}},hillshade:class extends ro{constructor(eo){super(eo,iQ)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends ro{constructor(eo){super(eo,i4)}getProgramIds(){let eo=this.paint.get("fill-pattern"),ec=eo&&eo.constantOr(1),ed=[ec?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&ed.push(ec&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),ed}getProgramConfiguration(eo){return new Xa(this,eo)}recalculate(eo,ec){super.recalculate(eo,ec);let ed=this.paint._values["fill-outline-color"];"constant"===ed.value.kind&&void 0===ed.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(eo){return new Mc(eo)}queryRadius(){return Su(this.paint.get("fill-translate"))}queryIntersectsFeature(eo,ec,ed,em,e_,eg){return!eo.queryGeometry.isAboveHorizon&&du(ku(eo.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),eg.angle,eo.pixelToTileUnitsFactor),em)}isTileClipped(){return!0}},"fill-extrusion":class extends ro{constructor(eo){super(eo,rm)}createBucket(eo){return new th(eo)}queryRadius(){return Su(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(eo){return new Xa(this,eo)}queryIntersectsFeature(eo,ec,ed,em,e_,eg,ex,ev,eb){var ew,eT,eE,eM;let eS=Iu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),eg.angle,eo.pixelToTileUnitsFactor),eA=this.paint.get("fill-extrusion-height").evaluate(ec,ed),eI=this.paint.get("fill-extrusion-base").evaluate(ec,ed),eC=[0,0],eP=ev&&eg.elevation,ez=eg.elevation?eg.elevation.exaggeration():1,eD=eo.tile.getBucket(this);if(eP&&eD instanceof th){let eo=eD.centroidVertexArray,ec=eb+1;ec<eo.length&&(eC[0]=eo.geta_centroid_pos0(ec),eC[1]=eo.geta_centroid_pos1(ec))}if(0===eC[0]&&1===eC[1])return!1;"globe"===eg.projection.name&&(em=lh([em],[new eL(0,0),new eL(8192,8192)],eo.tileID.canonical).map(eo=>eo.polygon).flat());let[ek,eR]=(ew=em,eT=eP?ev:null,eE=eg.center.lat,eM=eo.tileID.canonical,"globe"===eg.projection.name?function(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT){let eE=[],eM=[],eS=eo.projection.upVectorScale(eT,eo.center.lat,eo.worldSize).metersToTile,eA=[0,0,0,1],eI=[0,0,0,1],m=(eo,ec,ed,em)=>{eo[0]=ec,eo[1]=ed,eo[2]=em,eo[3]=1},eC=oh();for(let eP of(ed>0&&(ed+=eC),em+=eC,ec)){let ec=[],eC=[];for(let eE of eP){let eM=eE.x+e_.x,eP=eE.y+e_.y,ez=eo.projection.projectTilePoint(eM,eP,eT),eD=eo.projection.upVector(eT,eE.x,eE.y),ek=ed,eL=em;if(ex){let eo=vh(eM,eP,ed,em,ex,ev,eb,ew);ek+=eo.base,eL+=eo.top}0!==ed?m(eA,ez.x+eD[0]*eS*ek,ez.y+eD[1]*eS*ek,ez.z+eD[2]*eS*ek):m(eA,ez.x,ez.y,ez.z),m(eI,ez.x+eD[0]*eS*eL,ez.y+eD[1]*eS*eL,ez.z+eD[2]*eS*eL),Fo(eA,eA,eg),Fo(eI,eI,eg),ec.push(new mh(eA[0],eA[1],eA[2])),eC.push(new mh(eI[0],eI[1],eI[2]))}eE.push(ec),eM.push(eC)}return[eE,eM]}(eg,ew,eI,eA,eS,ex,eT,eC,ez,eE,eM):eT?function(eo,ec,ed,em,e_,eg,ex,ev,eb){let ew=[],eT=[],eE=[0,0,0,1];for(let eM of eo){let eo=[],eS=[];for(let ew of eM){let eT=ew.x+em.x,eM=ew.y+em.y,eA=vh(eT,eM,ec,ed,eg,ex,ev,eb);eE[0]=eT,eE[1]=eM,eE[2]=eA.base,eE[3]=1,Go(eE,eE,e_),eE[3]=Math.max(eE[3],1e-5);let eI=new mh(eE[0]/eE[3],eE[1]/eE[3],eE[2]/eE[3]);eE[0]=eT,eE[1]=eM,eE[2]=eA.top,eE[3]=1,Go(eE,eE,e_),eE[3]=Math.max(eE[3],1e-5);let eC=new mh(eE[0]/eE[3],eE[1]/eE[3],eE[2]/eE[3]);eo.push(eI),eS.push(eC)}ew.push(eo),eT.push(eS)}return[ew,eT]}(ew,eI,eA,eS,ex,eT,eC,ez,eE):function(eo,ec,ed,em,e_){let eg=[],ex=[],ev=e_[8]*ec,eb=e_[9]*ec,ew=e_[10]*ec,eT=e_[11]*ec,eE=e_[8]*ed,eM=e_[9]*ed,eS=e_[10]*ed,eA=e_[11]*ed;for(let ec of eo){let eo=[],ed=[];for(let eg of ec){let ec=eg.x+em.x,ex=eg.y+em.y,eI=e_[0]*ec+e_[4]*ex+e_[12],eC=e_[1]*ec+e_[5]*ex+e_[13],eP=e_[2]*ec+e_[6]*ex+e_[14],ez=e_[3]*ec+e_[7]*ex+e_[15],eD=eI+ev,ek=eC+eb,eL=eP+ew,eR=Math.max(ez+eT,1e-5),eB=eI+eE,eF=eC+eM,eO=eP+eS,eU=Math.max(ez+eA,1e-5);eo.push(new mh(eD/eR,ek/eR,eL/eR)),ed.push(new mh(eB/eU,eF/eU,eO/eU))}eg.push(eo),ex.push(ed)}return[eg,ex]}(ew,eI,eA,eS,ex)),eB=eo.queryGeometry;return function(eo,ec,ed){let em=1/0;du(ed,ec)&&(em=xh(ed,ec[0]));for(let e_=0;e_<ec.length;e_++){let eg=ec[e_],ex=eo[e_];for(let eo=0;eo<eg.length-1;eo++){let ec=eg[eo],e_=[ec,eg[eo+1],ex[eo+1],ex[eo],ec];hu(ed,e_)&&(em=Math.min(em,xh(ed,e_)))}}return em!==1/0&&em}(ek,eR,eB.isPointQuery()?eB.screenBounds:eB.screenGeometry)}},line:class extends ro{constructor(eo){super(eo,rE),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(eo){if("line-gradient"===eo){let eo=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=eo._styleExpression&&eo._styleExpression.expression instanceof zr,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(eo,ec){super.recalculate(eo,ec),this.paint._values["line-floorwidth"]=rM.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,eo)}createBucket(eo){return new Ih(eo)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(eo){return new Xa(this,eo)}queryRadius(eo){var ec,ed;let em=(ec=Au("line-width",this,eo),(ed=Au("line-gap-width",this,eo))>0?ed+2*ec:ec),e_=Au("line-offset",this,eo);return em/2+Math.abs(e_)+Su(this.paint.get("line-translate"))}queryIntersectsFeature(eo,ec,ed,em,e_,eg){var ex,ev;if(eo.queryGeometry.isAboveHorizon)return!1;let eb=ku(eo.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),eg.angle,eo.pixelToTileUnitsFactor),ew=eo.pixelToTileUnitsFactor/2*(ex=this.paint.get("line-width").evaluate(ec,ed),(ev=this.paint.get("line-gap-width").evaluate(ec,ed))>0?ev+2*ex:ex),eT=this.paint.get("line-offset").evaluate(ec,ed);return eT&&(em=function(eo,ec){let ed=[],em=new eL(0,0);for(let e_=0;e_<eo.length;e_++){let eg=eo[e_],ex=[];for(let eo=0;eo<eg.length;eo++){let ed=eg[eo],e_=eg[eo+1],ev=0===eo?em:ed.sub(eg[eo-1])._unit()._perp(),eb=eo===eg.length-1?em:e_.sub(ed)._unit()._perp(),ew=ev._add(eb)._unit();ew._mult(1/(ew.x*eb.x+ew.y*eb.y)),ex.push(ew._mult(ec)._add(ed))}ed.push(ex)}return ed}(em,eT*eo.pixelToTileUnitsFactor)),function(eo,ec,ed){for(let em=0;em<ec.length;em++){let e_=ec[em];if(eo.length>=3){for(let ec=0;ec<e_.length;ec++)if(bu(eo,e_[ec]))return!0}if(function(eo,ec,ed){if(eo.length>1){if(yu(eo,ec))return!0;for(let em=0;em<ec.length;em++)if(gu(ec[em],eo,ed))return!0}for(let em=0;em<eo.length;em++)if(gu(eo[em],ec,ed))return!0;return!1}(eo,e_,ed))return!0}return!1}(eb,em,ew)}isTileClipped(){return!0}},symbol:hf,background:class extends ro{constructor(eo){super(eo,rK)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends ro{constructor(eo){super(eo,rQ)}getProgramIds(){return["raster"]}},sky:class extends ro{constructor(eo){super(eo,r0),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(eo){"sky-gradient"===eo?this._updateColorRamp():"sky-atmosphere-sun"!==eo&&"sky-atmosphere-halo-color"!==eo&&"sky-atmosphere-color"!==eo&&"sky-atmosphere-sun-intensity"!==eo||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=ju({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(eo){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let ec=eo.style.light.properties.get("position");return this._lightPosition.azimuthal!==ec.azimuthal||this._lightPosition.polar!==ec.polar}return!1}getCenter(eo,ec){if("atmosphere"===this.paint.get("sky-type")){let ed=this.paint.get("sky-atmosphere-sun"),em=!ed,e_=eo.style.light,eg=e_.properties.get("position");return em&&"viewport"===e_.properties.get("anchor")&&N("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),em?mf(eg.azimuthal,90-eg.polar,ec):mf(ed[0],90-ed[1],ec)}let ed=this.paint.get("sky-gradient-center");return mf(ed[0],90-ed[1],ec)}is3D(){return!1}isSky(){return!0}markSkyboxValid(eo){this._skyboxInvalidated=!1,this._lightPosition=eo.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let eo=this.paint.get("sky-type");return"atmosphere"===eo?["skyboxCapture","skybox"]:"gradient"===eo?["skyboxGradient"]:null}}};let xf=class xf{constructor(eo,ec,ed,em){this.context=eo,this.format=ed,this.texture=eo.gl.createTexture(),this.update(ec,em)}update(eo,ec,ed){let{width:em,height:e_}=eo,{context:eg}=this,{gl:ex}=eg,{HTMLImageElement:ev,HTMLCanvasElement:eb,HTMLVideoElement:ew,ImageData:eT,ImageBitmap:eE}=eM;if(ex.bindTexture(ex.TEXTURE_2D,this.texture),eg.pixelStoreUnpackFlipY.set(!1),eg.pixelStoreUnpack.set(1),eg.pixelStoreUnpackPremultiplyAlpha.set(this.format===ex.RGBA&&(!ec||!1!==ec.premultiply)),ed||this.size&&this.size[0]===em&&this.size[1]===e_){let{x:ec,y:eg}=ed||{x:0,y:0};eo instanceof ev||eo instanceof eb||eo instanceof ew||eo instanceof eT||eE&&eo instanceof eE?ex.texSubImage2D(ex.TEXTURE_2D,0,ec,eg,ex.RGBA,ex.UNSIGNED_BYTE,eo):ex.texSubImage2D(ex.TEXTURE_2D,0,ec,eg,em,e_,ex.RGBA,ex.UNSIGNED_BYTE,eo.data)}else this.size=[em,e_],eo instanceof ev||eo instanceof eb||eo instanceof ew||eo instanceof eT||eE&&eo instanceof eE?ex.texImage2D(ex.TEXTURE_2D,0,this.format,this.format,ex.UNSIGNED_BYTE,eo):ex.texImage2D(ex.TEXTURE_2D,0,this.format,em,e_,0,this.format,ex.UNSIGNED_BYTE,eo.data);this.useMipmap=!!(ec&&ec.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&ex.generateMipmap(ex.TEXTURE_2D)}bind(eo,ec){let{context:ed}=this,{gl:em}=ed;em.bindTexture(em.TEXTURE_2D,this.texture),eo!==this.filter&&(em.texParameteri(em.TEXTURE_2D,em.TEXTURE_MAG_FILTER,eo),em.texParameteri(em.TEXTURE_2D,em.TEXTURE_MIN_FILTER,this.useMipmap?eo===em.NEAREST?em.NEAREST_MIPMAP_NEAREST:em.LINEAR_MIPMAP_NEAREST:eo),this.filter=eo),ec!==this.wrap&&(em.texParameteri(em.TEXTURE_2D,em.TEXTURE_WRAP_S,ec),em.texParameteri(em.TEXTURE_2D,em.TEXTURE_WRAP_T,ec),this.wrap=ec)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){let{gl:eo}=this.context;eo.deleteTexture(this.texture),this.texture=null}};let vf=class vf{constructor(eo){this._callback=eo,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}};let bf=class bf{constructor(){this.tasks={},this.taskQueue=[],R(["process"],this),this.invoker=new vf(this.process),this.nextId=0}add(eo,ec){let ed=this.nextId++,em=function({type:eo,isSymbolTile:ec,zoom:ed}){return ed=ed||0,"message"===eo?0:"maybePrepare"!==eo||ec?"parseTile"!==eo||ec?"parseTile"===eo&&ec?300-ed:"maybePrepare"===eo&&ec?400-ed:500:200-ed:100-ed}(ec);return 0===em?(K(),eo(),{cancel:()=>{}}):(this.tasks[ed]={fn:eo,metadata:ec,priority:em,id:ed},this.taskQueue.push(ed),this.invoker.trigger(),{cancel:()=>{delete this.tasks[ed]}})}process(){K();{if(this.taskQueue=this.taskQueue.filter(eo=>!!this.tasks[eo]),!this.taskQueue.length)return;let eo=this.pick();if(null===eo)return;let ec=this.tasks[eo];if(delete this.tasks[eo],this.taskQueue.length&&this.invoker.trigger(),!ec)return;ec.fn()}}pick(){let eo=null,ec=1/0;for(let ed=0;ed<this.taskQueue.length;ed++){let em=this.tasks[this.taskQueue[ed]];em.priority<ec&&(ec=em.priority,eo=ed)}if(null===eo)return null;let ed=this.taskQueue[eo];return this.taskQueue.splice(eo,1),ed}remove(){this.invoker.remove()}};let wf=class wf{constructor(eo){this._stringToNumber={},this._numberToString=[];for(let ec=0;ec<eo.length;ec++){let ed=eo[ec];this._stringToNumber[ed]=ec,this._numberToString[ec]=ed}}encode(eo){return this._stringToNumber[eo]}decode(eo){return this._numberToString[eo]}};let r2=["tile","layer","source","sourceLayer","state"];let Af=class Af{constructor(eo,ec,ed,em,e_){this.type="Feature",this._vectorTileFeature=eo,this._z=ec,this._x=ed,this._y=em,this.properties=eo.properties,this.id=e_}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(eo){this._geometry=eo}toJSON(){let eo={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(let ec of(void 0!==this.id&&(eo.id=this.id),r2))void 0!==this[ec]&&(eo[ec]=this[ec]);return eo}};let r3=new Uint16Array(8184);for(let eo=0;eo<2046;eo++){let ec=eo+2,ed=0,em=0,e_=0,eg=0,ex=0,ev=0;for(1&ec?e_=eg=ex=32:ed=em=ev=32;(ec>>=1)>1;){let eo=ed+e_>>1,eb=em+eg>>1;1&ec?(e_=ed,eg=em,ed=ex,em=ev):(ed=e_,em=eg,e_=ex,eg=ev),ex=eo,ev=eb}let eb=4*eo;r3[eb+0]=ed,r3[eb+1]=em,r3[eb+2]=e_,r3[eb+3]=eg}let r5=new Uint16Array(2178),r4=new Uint8Array(1089),r6=new Uint16Array(1089);function Bf(eo){return 0===eo?-.03125:32===eo?.03125:0}var r8=Rs([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let r9={type:2,extent:8192,loadGeometry:()=>[[new eL(0,0),new eL(8193,0),new eL(8193,8193),new eL(0,8193),new eL(0,0)]]};let Pf=class Pf{constructor(eo,ec,ed,em,e_){this.tileID=eo,this.uid=D(),this.uses=0,this.tileSize=ec,this.tileZoom=ed,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=e_,this.expiredRequestCount=0,this.state="loading",em&&em.transform&&(this.projection=em.transform.projection)}registerFadeDuration(eo){let ec=eo+this.timeAdded;ec<e7.now()||this.fadeEndTime&&ec<this.fadeEndTime||(this.fadeEndTime=ec)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Bd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(eo,ec,ed){if(this.unloadVectorData(),this.state="loaded",eo){for(let em in eo.featureIndex&&(this.latestFeatureIndex=eo.featureIndex,eo.rawTileData?(this.latestRawTileData=eo.rawTileData,this.latestFeatureIndex.rawTileData=eo.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=eo.collisionBoxArray,this.buckets=function(eo,ec){let ed={};if(!ec)return ed;for(let em of eo){let eo=em.layerIds.map(eo=>ec.getLayer(eo)).filter(Boolean);if(0!==eo.length)for(let ec of(em.layers=eo,em.stateDependentLayerIds&&(em.stateDependentLayers=em.stateDependentLayerIds.map(ec=>eo.filter(eo=>eo.id===ec)[0])),eo))ed[ec.id]=em}return ed}(eo.buckets,ec.style),this.hasSymbolBuckets=!1,this.buckets){let eo=this.buckets[em];if(eo instanceof of){if(this.hasSymbolBuckets=!0,!ed)break;eo.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let eo in this.buckets){let ec=this.buckets[eo];if(ec instanceof of&&ec.hasRTLText){this.hasRTLText=!0,t9.isLoading()||t9.isLoaded()||"deferred"!==xs()||vs();break}}for(let eo in this.queryPadding=0,this.buckets){let ed=this.buckets[eo];this.queryPadding=Math.max(this.queryPadding,ec.style.getLayer(eo).queryRadius(ed))}eo.imageAtlas&&(this.imageAtlas=eo.imageAtlas),eo.glyphAtlasImage&&(this.glyphAtlasImage=eo.glyphAtlasImage),eo.lineAtlas&&(this.lineAtlas=eo.lineAtlas)}else this.collisionBoxArray=new pa}unloadVectorData(){if(this.hasData()){for(let eo in this.buckets)this.buckets[eo].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(eo){return this.buckets[eo.id]}upload(eo){for(let ec in this.buckets){let ed=this.buckets[ec];ed.uploadPending()&&ed.upload(eo)}let ec=eo.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new xf(eo,this.imageAtlas.image,ec.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new xf(eo,this.glyphAtlasImage,ec.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new xf(eo,this.lineAtlas.image,ec.ALPHA),this.lineAtlas.uploaded=!0)}prepare(eo){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(eo,this.imageAtlasTexture)}queryRenderedFeatures(eo,ec,ed,em,e_,eg,ex,ev){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:em,pixelPosMatrix:ex,transform:eg,params:e_,tileTransform:this.tileTransform},eo,ec,ed):{}}querySourceFeatures(eo,ec){let ed=this.latestFeatureIndex;if(!ed||!ed.rawTileData)return;let em=ed.loadVTLayers(),e_=ec?ec.sourceLayer:"",eg=em._geojsonTileLayer||em[e_];if(!eg)return;let ex=hi(ec&&ec.filter),{z:ev,x:eb,y:ew}=this.tileID.canonical,eT={z:ev,x:eb,y:ew};for(let ec=0;ec<eg.length;ec++){let em=eg.feature(ec);if(ex.needGeometry){let eo=ou(em,!0);if(!ex.filter(new ws(this.tileID.overscaledZ),eo,this.tileID.canonical))continue}else if(!ex.filter(new ws(this.tileID.overscaledZ),em))continue;let eE=ed.getId(em,e_),eM=new Af(em,ev,eb,ew,eE);eM.tile=eT,eo.push(eM)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(eo){let ec=this.expirationTime;if(eo.cacheControl){let ec=X(eo.cacheControl);ec["max-age"]&&(this.expirationTime=Date.now()+1e3*ec["max-age"])}else eo.expires&&(this.expirationTime=new Date(eo.expires).getTime());if(this.expirationTime){let eo=Date.now(),ed=!1;if(this.expirationTime>eo)ed=!1;else if(ec){if(this.expirationTime<ec)ed=!0;else{let em=this.expirationTime-ec;em?this.expirationTime=eo+Math.max(em,3e4):ed=!0}}else ed=!0;ed?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),2147483647)}setFeatureState(eo,ec){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(eo).length||!ec)return;let ed=this.latestFeatureIndex.loadVTLayers(),em=ec.style.listImages();for(let e_ in this.buckets){if(!ec.style.hasLayer(e_))continue;let eg=this.buckets[e_],ex=eg.layers[0].sourceLayer||"_geojsonTileLayer",ev=ed[ex],eb=eo[ex];if(!ev||!eb||0===Object.keys(eb).length)continue;if(eg.update(eb,ev,em,this.imageAtlas&&this.imageAtlas.patternPositions||{}),eg instanceof Ih||eg instanceof Mc){let eo=ec.style._getSourceCache(eg.layers[0].source);ec._terrain&&ec._terrain.enabled&&eo&&eg.programConfigurations.needsUpload&&ec._terrain._clearRenderCacheForTile(eo.id,this.tileID)}let ew=ec&&ec.style&&ec.style.getLayer(e_);ew&&(this.queryPadding=Math.max(this.queryPadding,ew.queryRadius(eg)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e7.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(eo){this.symbolFadeHoldUntil=e7.now()+eo}setTexture(eo,ec){let ed=ec.context,em=ed.gl;this.texture=this.texture||ec.getTileTexture(eo.width),this.texture?this.texture.update(eo,{useMipmap:!0}):(this.texture=new xf(ed,eo,em.RGBA,{useMipmap:!0}),this.texture.bind(em.LINEAR,em.CLAMP_TO_EDGE))}setDependencies(eo,ec){let ed={};for(let eo of ec)ed[eo]=!0;this.dependencies[eo]=ed}hasDependency(eo,ec){for(let ed of eo){let eo=this.dependencies[ed];if(eo){for(let ed of ec)if(eo[ed])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(eo,ec){if(!ec||"mercator"===ec.name||this._tileDebugBuffer)return;let ed=au(r9,this.tileID.canonical,this.tileTransform)[0],em=new $s,e_=new ua;for(let eo=0;eo<ed.length;eo++){let{x:ec,y:eg}=ed[eo];em.emplaceBack(ec,eg),e_.emplaceBack(eo)}e_.emplaceBack(0),this._tileDebugIndexBuffer=eo.createIndexBuffer(e_),this._tileDebugBuffer=eo.createVertexBuffer(em,iR.members),this._tileDebugSegments=so.simpleSegment(0,0,em.length,e_.length)}_makeTileBoundsBuffers(eo,ec){let ed,em;if(this._tileBoundsBuffer||!ec||"mercator"===ec.name)return;let e_=au(r9,this.tileID.canonical,this.tileTransform)[0];if(this.isRaster){let eo=function(eo,ec){let ed=Bd(eo,ec),em=Math.pow(2,eo.z);for(let e_=0;e_<33;e_++)for(let eg=0;eg<33;eg++){let ex=Kl((eo.x+(eg+Bf(eg))/32)/em),ev=Xl((eo.y+(e_+Bf(e_))/32)/em),eb=ec.project(ex,ev),ew=33*e_+eg;r5[2*ew+0]=Math.round((eb.x*ed.scale-ed.x)*8192),r5[2*ew+1]=Math.round((eb.y*ed.scale-ed.y)*8192)}r4.fill(0),r6.fill(0);for(let eo=2045;eo>=0;eo--){let ec=4*eo,ed=r3[ec+0],em=r3[ec+1],e_=r3[ec+2],eg=r3[ec+3],ex=ed+e_>>1,ev=em+eg>>1,eb=ex+ev-em,ew=ev+ed-ex,eT=33*em+ed,eE=33*eg+e_,eM=33*ev+ex,eS=Math.hypot((r5[2*eT+0]+r5[2*eE+0])/2-r5[2*eM+0],(r5[2*eT+1]+r5[2*eE+1])/2-r5[2*eM+1])>=16;r4[eM]=r4[eM]||(eS?1:0),eo<1022&&(r4[eM]=r4[eM]||r4[(em+ew>>1)*33+(ed+eb>>1)]||r4[(eg+ew>>1)*33+(e_+eb>>1)])}let e_=new Os,eg=new ra,ex=0;function o(eo,ec){let ed=33*ec+eo;return 0===r6[ed]&&(e_.emplaceBack(r5[2*ed+0],r5[2*ed+1],8192*eo/32,8192*ec/32),r6[ed]=++ex),r6[ed]-1}function l(eo,ec,ed,em,e_,ex){let ev=eo+ed>>1,eb=ec+em>>1;if(Math.abs(eo-e_)+Math.abs(ec-ex)>1&&r4[33*eb+ev])l(e_,ex,eo,ec,ev,eb),l(ed,em,e_,ex,ev,eb);else{let ev=o(eo,ec),eb=o(ed,em),ew=o(e_,ex);eg.emplaceBack(ev,eb,ew)}}return l(0,0,32,32,32,0),l(32,32,0,0,0,32),{vertices:e_,indices:eg}}(this.tileID.canonical,ec);ed=eo.vertices,em=eo.indices}else{for(let{x:eo,y:ec}of(ed=new Os,em=new ra,e_))ed.emplaceBack(eo,ec,0,0);let eo=i3(ed.int16,void 0,4);for(let ec=0;ec<eo.length;ec+=3)em.emplaceBack(eo[ec],eo[ec+1],eo[ec+2])}this._tileBoundsBuffer=eo.createVertexBuffer(ed,r8.members),this._tileBoundsIndexBuffer=eo.createIndexBuffer(em),this._tileBoundsSegments=so.simpleSegment(0,0,ed.length,em.length)}_makeGlobeTileDebugBuffers(eo,ec){let ed;let em=ec.projection;if(!em||"globe"!==em.name||ec.freezeTileCoverage)return;let e_=this.tileID.canonical,eg=Bl(bl(e_,ec)),ex=Pl(ec.zoom);ex>0&&(ed=fo(new Float64Array(16),ec.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(eo,e_,ec,eg,ed,ex),this._makeGlobeTileDebugTextBuffer(eo,e_,ec,eg,ed,ex)}_globePoint(eo,ec,ed,em,e_,eg,ex){let ev=Ml(eo,ec,ed);if(eg){let e_=1<<ed.z,eb=Nl(em.center.lng),ew=Gl(em.center.lat),eT=(ed.x+.5)/e_-eb,eE=0;eT>.5?eE=-1:eT<-.5&&(eE=1);let eM=(eo/8192+ed.x)/e_+eE,eS=(ec/8192+ed.y)/e_;eM=(eM-eb)*em._pixelsPerMercatorPixel+eb,eS=(eS-ew)*em._pixelsPerMercatorPixel+ew;let eA=[eM*em.worldSize,eS*em.worldSize,0];Fo(eA,eA,eg),ev=vl(ev,eA,ex)}return Fo(ev,ev,e_)}_makeGlobeTileDebugBorderBuffer(eo,ec,ed,em,e_,eg){let ex=new $s,ev=new ua,eb=new js,u=(eo,ew,eT,eE,eM)=>{let eS=(eT-eo)/(eM-1),eA=(eE-ew)/(eM-1),eI=ex.length;for(let eT=0;eT<eM;eT++){let eE=eo+eT*eS,eM=ew+eT*eA;ex.emplaceBack(eE,eM);let eC=this._globePoint(eE,eM,ec,ed,em,e_,eg);eb.emplaceBack(eC[0],eC[1],eC[2]),ev.emplaceBack(eI+eT)}};u(0,0,8192,0,16),u(8192,0,8192,8192,16),u(8192,8192,0,8192,16),u(0,8192,0,0,16),this._tileDebugIndexBuffer=eo.createIndexBuffer(ev),this._tileDebugBuffer=eo.createVertexBuffer(ex,iR.members),this._globeTileDebugBorderBuffer=eo.createVertexBuffer(eb,iL.members),this._tileDebugSegments=so.simpleSegment(0,0,ex.length,ev.length)}_makeGlobeTileDebugTextBuffer(eo,ec,ed,em,e_,eg){let ex=new $s,ev=new ra,eb=new js;ev.reserve(32),ex.reserve(25),eb.reserve(25);let h=(eo,ec)=>25*eo+ec;for(let eo=0;eo<25;eo++){let ev=2048*eo;for(let eo=0;eo<25;eo++){let ew=2048*eo;ex.emplaceBack(ew,ev);let eT=this._globePoint(ew,ev,ec,ed,em,e_,eg);eb.emplaceBack(eT[0],eT[1],eT[2])}}for(let eo=0;eo<4;eo++)for(let ec=0;ec<4;ec++){let ed=h(eo,ec),em=h(eo,ec+1),e_=h(eo+1,ec),eg=h(eo+1,ec+1);ev.emplaceBack(ed,em,e_),ev.emplaceBack(e_,em,eg)}this._tileDebugTextIndexBuffer=eo.createIndexBuffer(ev),this._tileDebugTextBuffer=eo.createVertexBuffer(ex,iR.members),this._globeTileDebugTextBuffer=eo.createVertexBuffer(eb,iL.members),this._tileDebugTextSegments=so.simpleSegment(0,0,25,32)}};let Df=class Df{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(eo,ec,ed){let em=String(ec);if(this.stateChanges[eo]=this.stateChanges[eo]||{},this.stateChanges[eo][em]=this.stateChanges[eo][em]||{},C(this.stateChanges[eo][em],ed),null===this.deletedStates[eo])for(let ec in this.deletedStates[eo]={},this.state[eo])ec!==em&&(this.deletedStates[eo][ec]=null);else if(this.deletedStates[eo]&&null===this.deletedStates[eo][em])for(let ec in this.deletedStates[eo][em]={},this.state[eo][em])ed[ec]||(this.deletedStates[eo][em][ec]=null);else for(let ec in ed)this.deletedStates[eo]&&this.deletedStates[eo][em]&&null===this.deletedStates[eo][em][ec]&&delete this.deletedStates[eo][em][ec]}removeFeatureState(eo,ec,ed){if(null===this.deletedStates[eo])return;let em=String(ec);if(this.deletedStates[eo]=this.deletedStates[eo]||{},ed&&void 0!==ec)null!==this.deletedStates[eo][em]&&(this.deletedStates[eo][em]=this.deletedStates[eo][em]||{},this.deletedStates[eo][em][ed]=null);else if(void 0!==ec){if(this.stateChanges[eo]&&this.stateChanges[eo][em])for(ed in this.deletedStates[eo][em]={},this.stateChanges[eo][em])this.deletedStates[eo][em][ed]=null;else this.deletedStates[eo][em]=null}else this.deletedStates[eo]=null}getState(eo,ec){let ed=String(ec),em=C({},(this.state[eo]||{})[ed],(this.stateChanges[eo]||{})[ed]);if(null===this.deletedStates[eo])return{};if(this.deletedStates[eo]){let ed=this.deletedStates[eo][ec];if(null===ed)return{};for(let eo in ed)delete em[eo]}return em}initializeTileState(eo,ec){eo.setFeatureState(this.state,ec)}coalesceChanges(eo,ec){let ed={};for(let eo in this.stateChanges){this.state[eo]=this.state[eo]||{};let ec={};for(let ed in this.stateChanges[eo])this.state[eo][ed]||(this.state[eo][ed]={}),C(this.state[eo][ed],this.stateChanges[eo][ed]),ec[ed]=this.state[eo][ed];ed[eo]=ec}for(let eo in this.deletedStates){this.state[eo]=this.state[eo]||{};let ec={};if(null===this.deletedStates[eo])for(let ed in this.state[eo])ec[ed]={},this.state[eo][ed]={};else for(let ed in this.deletedStates[eo]){if(null===this.deletedStates[eo][ed])this.state[eo][ed]={};else if(this.state[eo][ed])for(let ec of Object.keys(this.deletedStates[eo][ed]))delete this.state[eo][ed][ec];ec[ed]=this.state[eo][ed]}ed[eo]=ed[eo]||{},C(ed[eo],ec)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(ed).length)for(let em in eo)eo[em].setFeatureState(ed,ec)}};let Vf=class Vf{constructor(eo){this.size=eo,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(eo,ec){let ed=this.toIdx(eo,ec);return{min:this.minimums[ed],max:this.maximums[ed]}}isLeaf(eo,ec){return this.leaves[this.toIdx(eo,ec)]}toIdx(eo,ec){return ec*this.size+eo}};function Lf(eo,ec,ed,em){let e_=0,eg=Number.MAX_VALUE;for(let ex=0;ex<3;ex++)if(1e-15>Math.abs(em[ex])){if(ed[ex]<eo[ex]||ed[ex]>ec[ex])return null}else{let ev=1/em[ex],eb=(eo[ex]-ed[ex])*ev,ew=(ec[ex]-ed[ex])*ev;if(eb>ew){let eo=eb;eb=ew,ew=eo}if(eb>e_&&(e_=eb),ew<eg&&(eg=ew),e_>eg)return null}return e_}function Ff(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT){let eE=em-eo,eM=e_-ec,eS=eg-ed,eA=ex-eo,eI=ev-ec,eC=eb-ed,eP=eT[1]*eC-eT[2]*eI,ez=eT[2]*eA-eT[0]*eC,eD=eT[0]*eI-eT[1]*eA,ek=eE*eP+eM*ez+eS*eD;if(1e-15>Math.abs(ek))return null;let eL=1/ek,eR=ew[0]-eo,eB=ew[1]-ec,eF=ew[2]-ed,eO=(eR*eP+eB*ez+eF*eD)*eL;if(eO<0||eO>1)return null;let eU=eB*eS-eF*eM,eN=eF*eE-eR*eS,eV=eR*eM-eB*eE,ej=(eT[0]*eU+eT[1]*eN+eT[2]*eV)*eL;return ej<0||eO+ej>1?null:(eA*eU+eI*eN+eC*eV)*eL}function Uf(eo,ec,ed,em,e_,eg,ex,ev,eb){let ew=1<<ed,eT=eg-em,eE=ex-e_;ev[0]=(eo+0)/ew*eT+em,ev[1]=(ec+0)/ew*eE+e_,eb[0]=(eo+1)/ew*eT+em,eb[1]=(ec+1)/ew*eE+e_}let $f=class $f{constructor(eo){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=eo,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let ec=function(eo){let ec=Math.ceil(Math.log2(eo.dim/8)),ed=[],em=Math.ceil(Math.pow(2,ec)),e_=1/em,s=(eo,ec,ed,em,e_)=>{let eg=em?1:0;e_[0]=eo*ed,e_[1]=ec*ed,e_[2]=(eo+1)*ed-eg,e_[3]=(ec+1)*ed-eg},eg=new Vf(em),ex=[];for(let ec=0;ec<em*em;ec++){s(ec%em,Math.floor(ec/em),e_,!1,ex);let ed=Of(ex[0],ex[1],eo),ev=Of(ex[2],ex[1],eo),eb=Of(ex[2],ex[3],eo),ew=Of(ex[0],ex[3],eo);eg.minimums.push(Math.min(ed,ev,eb,ew)),eg.maximums.push(Math.max(ed,ev,eb,ew)),eg.leaves.push(1)}for(ed.push(eg),em/=2;em>=1;em/=2){let eo=ed[ed.length-1];eg=new Vf(em);for(let ec=0;ec<em*em;ec++){s(ec%em,Math.floor(ec/em),2,!0,ex);let ed=eo.getElevation(ex[0],ex[1]),e_=eo.getElevation(ex[2],ex[1]),ev=eo.getElevation(ex[2],ex[3]),eb=eo.getElevation(ex[0],ex[3]),ew=eo.isLeaf(ex[0],ex[1]),eT=eo.isLeaf(ex[2],ex[1]),eE=eo.isLeaf(ex[2],ex[3]),eM=eo.isLeaf(ex[0],ex[3]),eS=Math.min(ed.min,e_.min,ev.min,eb.min),eA=Math.max(ed.max,e_.max,ev.max,eb.max),eI=ew&&eT&&eE&&eM;eg.maximums.push(eA),eg.minimums.push(eS),eg.leaves.push(eA-eS<=5&&eI?1:0)}ed.push(eg)}return ed}(this.dem),ed=ec.length-1,em=ec[ed];this._addNode(em.minimums[0],em.maximums[0],em.leaves[0]),this._construct(ec,0,0,ed,0)}raycastRoot(eo,ec,ed,em,e_,eg,ex=1){return Lf([eo,ec,-100],[ed,em,this.maximums[0]*ex],e_,eg)}raycast(eo,ec,ed,em,e_,eg,ex=1){if(!this.nodeCount)return null;let ev=this.raycastRoot(eo,ec,ed,em,e_,eg,ex);if(null==ev)return null;let eb=[],ew=[],eT=[],eE=[],eM=[{idx:0,t:ev,nodex:0,nodey:0,depth:0}];for(;eM.length>0;){let{idx:ev,t:eI,nodex:eC,nodey:eP,depth:ez}=eM.pop();if(this.leaves[ev]){Uf(eC,eP,ez,eo,ec,ed,em,eT,eE);let ev=1<<ez,eb=(eC+0)/ev,ew=(eC+1)/ev,eM=(eP+0)/ev,eD=(eP+1)/ev,ek=Of(eb,eM,this.dem)*ex,eL=Of(ew,eM,this.dem)*ex,eR=Of(ew,eD,this.dem)*ex,eB=Of(eb,eD,this.dem)*ex,eF=Ff(eT[0],eT[1],ek,eE[0],eT[1],eL,eE[0],eE[1],eR,e_,eg),eO=Ff(eE[0],eE[1],eR,eT[0],eE[1],eB,eT[0],eT[1],ek,e_,eg),eU=Math.min(null!==eF?eF:Number.MAX_VALUE,null!==eO?eO:Number.MAX_VALUE);if(eU!==Number.MAX_VALUE)return eU;{var eS,eA;let eo=Po([],e_,eg,eI);if(jf(ek,eL,eB,eR,(eo[0]-(eS=eT[0]))/(eE[0]-eS),(eo[1]-(eA=eT[1]))/(eE[1]-eA))>=eo[2])return eI}continue}let eD=0;for(let eM=0;eM<this._siblingOffset.length;eM++){Uf((eC<<1)+this._siblingOffset[eM][0],(eP<<1)+this._siblingOffset[eM][1],ez+1,eo,ec,ed,em,eT,eE),eT[2]=-100,eE[2]=this.maximums[this.childOffsets[ev]+eM]*ex;let eS=Lf(eT,eE,e_,eg);if(null!=eS){eb[eM]=eS;let eo=!1;for(let ec=0;ec<eD&&!eo;ec++)eS>=eb[ew[ec]]&&(ew.splice(ec,0,eM),eo=!0);eo||(ew[eD]=eM),eD++}}for(let eo=0;eo<eD;eo++){let ec=ew[eo];eM.push({idx:this.childOffsets[ev]+ec,t:eb[ec],nodex:(eC<<1)+this._siblingOffset[ec][0],nodey:(eP<<1)+this._siblingOffset[ec][1],depth:ez+1})}}return null}_addNode(eo,ec,ed){return this.minimums.push(eo),this.maximums.push(ec),this.leaves.push(ed),this.childOffsets.push(0),this.nodeCount++}_construct(eo,ec,ed,em,e_){if(1===eo[em].isLeaf(ec,ed))return;this.childOffsets[e_]||(this.childOffsets[e_]=this.nodeCount);let eg=em-1,ex=eo[eg],ev=0,eb=0;for(let eo=0;eo<this._siblingOffset.length;eo++){let em=2*ec+this._siblingOffset[eo][0],e_=2*ed+this._siblingOffset[eo][1],eg=ex.getElevation(em,e_),ew=ex.isLeaf(em,e_),eT=this._addNode(eg.min,eg.max,ew);ew&&(ev|=1<<eo),eb||(eb=eT)}for(let em=0;em<this._siblingOffset.length;em++)ev&1<<em||this._construct(eo,2*ec+this._siblingOffset[em][0],2*ed+this._siblingOffset[em][1],eg,eb+em)}};function jf(eo,ec,ed,em,e_,eg){return Er(Er(eo,ed,eg),Er(ec,em,eg),e_)}function Of(eo,ec,ed){let em=ed.dim,e_=M(eo*em-.5,0,em-1),eg=M(ec*em-.5,0,em-1),ex=Math.floor(e_),ev=Math.floor(eg),eb=Math.min(ex+1,em-1),ew=Math.min(ev+1,em-1);return jf(ed.get(ex,ev),ed.get(eb,ev),ed.get(ex,ew),ed.get(eb,ew),e_-ex,eg-ev)}let r7={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};let Zf=class Zf{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(eo,ec,ed,em=!1,e_=!1){if(this.uid=eo,ec.height!==ec.width)throw RangeError("DEM tiles must be square");if(ed&&"mapbox"!==ed&&"terrarium"!==ed)return N(`"${ed}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=ec.height;let eg=this.dim=ec.height-2,ex=new Uint32Array(ec.data.buffer);if(this.pixels=new Uint8Array(ec.data.buffer),this.encoding=ed||"mapbox",this.borderReady=em,!em){for(let eo=0;eo<eg;eo++)ex[this._idx(-1,eo)]=ex[this._idx(0,eo)],ex[this._idx(eg,eo)]=ex[this._idx(eg-1,eo)],ex[this._idx(eo,-1)]=ex[this._idx(eo,0)],ex[this._idx(eo,eg)]=ex[this._idx(eo,eg-1)];ex[this._idx(-1,-1)]=ex[this._idx(0,0)],ex[this._idx(eg,-1)]=ex[this._idx(eg-1,0)],ex[this._idx(-1,eg)]=ex[this._idx(0,eg-1)],ex[this._idx(eg,eg)]=ex[this._idx(eg-1,eg-1)],e_&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new $f(this)}get(eo,ec,ed=!1){ed&&(eo=M(eo,-1,this.dim),ec=M(ec,-1,this.dim));let em=4*this._idx(eo,ec);return("terrarium"===this.encoding?function(eo,ec,ed){return 256*eo+ec+ed/256-32768}:function(eo,ec,ed){return(256*eo*256+256*ec+ed)/10-1e4})(this.pixels[em],this.pixels[em+1],this.pixels[em+2])}static getUnpackVector(eo){return r7[eo]}get unpackVector(){return r7[this.encoding]}_idx(eo,ec){if(eo<-1||eo>=this.dim+1||ec<-1||ec>=this.dim+1)throw RangeError("out of range source coordinates for DEM data");return(ec+1)*this.stride+(eo+1)}static pack(eo,ec){let ed=[0,0,0,0],em=Zf.getUnpackVector(ec),e_=Math.floor((eo+em[3])/em[2]);return ed[2]=e_%256,e_=Math.floor(e_/256),ed[1]=e_%256,e_=Math.floor(e_/256),ed[0]=e_,ed}getPixels(){return new Uu({width:this.stride,height:this.stride},this.pixels)}backfillBorder(eo,ec,ed){if(this.dim!==eo.dim)throw Error("dem dimension mismatch");let em=ec*this.dim,e_=ec*this.dim+this.dim,eg=ed*this.dim,ex=ed*this.dim+this.dim;switch(ec){case -1:em=e_-1;break;case 1:e_=em+1}switch(ed){case -1:eg=ex-1;break;case 1:ex=eg+1}let ev=-ec*this.dim,eb=-ed*this.dim;for(let ec=eg;ec<ex;ec++)for(let ed=em;ed<e_;ed++){let em=4*this._idx(ed,ec),e_=4*this._idx(ed+ev,ec+eb);this.pixels[em+0]=eo.pixels[e_+0],this.pixels[em+1]=eo.pixels[e_+1],this.pixels[em+2]=eo.pixels[e_+2],this.pixels[em+3]=eo.pixels[e_+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}};Ji(Zf,"DEMData"),Ji($f,"DemMinMaxQuadTree",{omit:["dem"]});let Kf=class Kf{constructor(eo,ec){this.max=eo,this.onRemove=ec,this.reset()}reset(){for(let eo in this.data)for(let ec of this.data[eo])ec.timeout&&clearTimeout(ec.timeout),this.onRemove(ec.value);return this.data={},this.order=[],this}add(eo,ec,ed){let em=eo.wrapped().key;void 0===this.data[em]&&(this.data[em]=[]);let e_={value:ec,timeout:void 0};if(void 0!==ed&&(e_.timeout=setTimeout(()=>{this.remove(eo,e_)},ed)),this.data[em].push(e_),this.order.push(em),this.order.length>this.max){let eo=this._getAndRemoveByKey(this.order[0]);eo&&this.onRemove(eo)}return this}has(eo){return eo.wrapped().key in this.data}getAndRemove(eo){return this.has(eo)?this._getAndRemoveByKey(eo.wrapped().key):null}_getAndRemoveByKey(eo){let ec=this.data[eo].shift();return ec.timeout&&clearTimeout(ec.timeout),0===this.data[eo].length&&delete this.data[eo],this.order.splice(this.order.indexOf(eo),1),ec.value}getByKey(eo){let ec=this.data[eo];return ec?ec[0].value:null}get(eo){return this.has(eo)?this.data[eo.wrapped().key][0].value:null}remove(eo,ec){if(!this.has(eo))return this;let ed=eo.wrapped().key,em=void 0===ec?0:this.data[ed].indexOf(ec),e_=this.data[ed][em];return this.data[ed].splice(em,1),e_.timeout&&clearTimeout(e_.timeout),0===this.data[ed].length&&delete this.data[ed],this.onRemove(e_.value),this.order.splice(this.order.indexOf(ed),1),this}setMaxSize(eo){for(this.max=eo;this.order.length>this.max;){let eo=this._getAndRemoveByKey(this.order[0]);eo&&this.onRemove(eo)}return this}filter(eo){let ec=[];for(let ed in this.data)for(let em of this.data[ed])eo(em.value)||ec.push(em);for(let eo of ec)this.remove(eo.value.tileID,eo)}};let Xf=class Xf{constructor(eo,ec,ed){this.func=eo,this.mask=ec,this.range=ed}};Xf.ReadOnly=!1,Xf.ReadWrite=!0,Xf.disabled=new Xf(519,Xf.ReadOnly,[0,1]);let Hf=class Hf{constructor(eo,ec,ed,em,e_,eg){this.test=eo,this.ref=ec,this.mask=ed,this.fail=em,this.depthFail=e_,this.pass=eg}};Hf.disabled=new Hf({func:519,mask:0},0,0,7680,7680,7680);let Yf=class Yf{constructor(eo,ec,ed){this.blendFunction=eo,this.blendColor=ec,this.mask=ed}};Yf.Replace=[1,0],Yf.disabled=new Yf(Yf.Replace,Be.transparent,[!1,!1,!1,!1]),Yf.unblended=new Yf(Yf.Replace,Be.transparent,[!0,!0,!0,!0]),Yf.alphaBlended=new Yf([1,771],Be.transparent,[!0,!0,!0,!0]);let ty=class ty{constructor(eo,ec,ed){this.enable=eo,this.mode=ec,this.frontFace=ed}};ty.disabled=new ty(!1,1029,2305),ty.backCCW=new ty(!0,1029,2305),ty.backCW=new ty(!0,1029,2304),ty.frontCW=new ty(!0,1028,2304),ty.frontCCW=new ty(!0,1028,2305);let ey=class ey extends Qt{constructor(eo,ec,ed){super(),this.id=eo,this._onlySymbols=ed,ec.on("data",eo=>{"source"===eo.dataType&&"metadata"===eo.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===eo.dataType&&"content"===eo.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),ec.on("error",()=>{this._sourceErrored=!0}),this._source=ec,this._tiles={},this._cache=new Kf(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=ec.minTileCacheSize,this._maxTileCacheSize=ec.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new Df,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(eo){this.map=eo,this._minTileCacheSize=void 0===this._minTileCacheSize&&eo?eo._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&eo?eo._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let eo in this._tiles){let ec=this._tiles[eo];if("loaded"!==ec.state&&"errored"!==ec.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let eo=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,eo&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(eo,ec){return eo.isSymbolTile=this._onlySymbols,this._source.loadTile(eo,ec)}_unloadTile(eo){if(this._source.unloadTile)return this._source.unloadTile(eo,()=>{})}_abortTile(eo){if(this._source.abortTile)return this._source.abortTile(eo,()=>{})}serialize(){return this._source.serialize()}prepare(eo){for(let ec in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){let ed=this._tiles[ec];ed.upload(eo),ed.prepare(this.map.style.imageManager)}}getIds(){return E(this._tiles).map(eo=>eo.tileID).sort(ry).map(eo=>eo.key)}getRenderableIds(eo){let ec=[];for(let ed in this._tiles)this._isIdRenderable(+ed,eo)&&ec.push(this._tiles[ed]);return eo?ec.sort((eo,ec)=>{let ed=eo.tileID,em=ec.tileID,e_=new eL(ed.canonical.x,ed.canonical.y)._rotate(this.transform.angle),eg=new eL(em.canonical.x,em.canonical.y)._rotate(this.transform.angle);return ed.overscaledZ-em.overscaledZ||eg.y-e_.y||eg.x-e_.x}).map(eo=>eo.tileID.key):ec.map(eo=>eo.tileID).sort(ry).map(eo=>eo.key)}hasRenderableParent(eo){let ec=this.findLoadedParent(eo,0);return!!ec&&this._isIdRenderable(ec.tileID.key)}_isIdRenderable(eo,ec){return this._tiles[eo]&&this._tiles[eo].hasData()&&!this._coveredTiles[eo]&&(ec||!this._tiles[eo].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else for(let eo in this._cache.reset(),this._tiles)"errored"!==this._tiles[eo].state&&this._reloadTile(+eo,"reloading")}_reloadTile(eo,ec){let ed=this._tiles[eo];ed&&("loading"!==ed.state&&(ed.state=ec),this._loadTile(ed,this._tileLoaded.bind(this,ed,eo,ec)))}_tileLoaded(eo,ec,ed,em){if(em){if(eo.state="errored",404!==em.status)this._source.fire(new Wt(em,{tile:eo}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){let eo=this.map.painter.terrain;this.update(this.transform,eo.getScaledDemTileSize(),!0),eo.resetTileLookupCache(this.id)}else this.update(this.transform)}else eo.timeAdded=e7.now(),"expired"===ed&&(eo.refreshedUponExpiration=!0),this._setTileReloadTimer(ec,eo),"raster-dem"===this._source.type&&eo.dem&&this._backfillDEM(eo),this._state.initializeTileState(eo,this.map?this.map.painter:null),this._source.fire(new Yt("data",{dataType:"source",tile:eo,coord:eo.tileID,sourceCacheId:this.id}))}_backfillDEM(eo){let ec=this.getRenderableIds();for(let ed=0;ed<ec.length;ed++){let em=ec[ed];if(eo.neighboringTiles&&eo.neighboringTiles[em]){let ec=this.getTileByID(em);r(eo,ec),r(ec,eo)}}function r(eo,ec){if(!eo.dem||eo.dem.borderReady)return;eo.needsHillshadePrepare=!0,eo.needsDEMTextureUpload=!0;let ed=ec.tileID.canonical.x-eo.tileID.canonical.x,em=ec.tileID.canonical.y-eo.tileID.canonical.y,e_=Math.pow(2,eo.tileID.canonical.z),eg=ec.tileID.key;0===ed&&0===em||Math.abs(em)>1||(Math.abs(ed)>1&&(1===Math.abs(ed+e_)?ed+=e_:1===Math.abs(ed-e_)&&(ed-=e_)),ec.dem&&eo.dem&&(eo.dem.backfillBorder(ec.dem,ed,em),eo.neighboringTiles&&eo.neighboringTiles[eg]&&(eo.neighboringTiles[eg].backfilled=!0)))}}getTile(eo){return this.getTileByID(eo.key)}getTileByID(eo){return this._tiles[eo]}_retainLoadedChildren(eo,ec,ed,em){for(let e_ in this._tiles){let eg=this._tiles[e_];if(em[e_]||!eg.hasData()||eg.tileID.overscaledZ<=ec||eg.tileID.overscaledZ>ed)continue;let ex=eg.tileID;for(;eg&&eg.tileID.overscaledZ>ec+1;){let eo=eg.tileID.scaledTo(eg.tileID.overscaledZ-1);(eg=this._tiles[eo.key])&&eg.hasData()&&(ex=eo)}let ev=ex;for(;ev.overscaledZ>ec;)if(eo[(ev=ev.scaledTo(ev.overscaledZ-1)).key]){em[ex.key]=ex;break}}}findLoadedParent(eo,ec){if(eo.key in this._loadedParentTiles){let ed=this._loadedParentTiles[eo.key];return ed&&ed.tileID.overscaledZ>=ec?ed:null}for(let ed=eo.overscaledZ-1;ed>=ec;ed--){let ec=eo.scaledTo(ed),em=this._getLoadedTile(ec);if(em)return em}}_getLoadedTile(eo){let ec=this._tiles[eo.key];return ec&&ec.hasData()?ec:this._cache.getByKey(this._source.reparseOverscaled?eo.wrapped().key:eo.canonical.key)}updateCacheSize(eo,ec){ec=ec||this._source.tileSize;let ed=Math.ceil(eo.width/ec)+1,em=Math.ceil(eo.height/ec)+1,e_=Math.floor(ed*em*5),eg="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,e_):e_,ex="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,eg):eg;this._cache.setMaxSize(ex)}handleWrapJump(eo){let ec=Math.round((eo-(void 0===this._prevLng?eo:this._prevLng))/360);if(this._prevLng=eo,ec){let eo={};for(let ed in this._tiles){let em=this._tiles[ed];em.tileID=em.tileID.unwrapTo(em.tileID.wrap+ec),eo[em.tileID.key]=em}for(let ec in this._tiles=eo,this._timers)clearTimeout(this._timers[ec]),delete this._timers[ec];for(let eo in this._tiles)this._setTileReloadTimer(+eo,this._tiles[eo])}}update(eo,ec,ed){let em;if(this.transform=eo,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!ed)return;this.updateCacheSize(eo,ec),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?em=eo.getVisibleUnwrappedCoordinates(this._source.tileID).map(eo=>new fh(eo.canonical.z,eo.wrap,eo.canonical.z,eo.canonical.x,eo.canonical.y)):(em=eo.coveringTiles({tileSize:ec||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!ed,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(em=em.filter(eo=>this._source.hasTile(eo)))):em=[];let e_=this._updateRetainedTiles(em);if(ny(this._source.type)&&0!==em.length){let eo={},ec={},ed=Object.keys(e_);for(let em of ed){let ed=e_[em],eg=this._tiles[em];if(!eg||eg.fadeEndTime&&eg.fadeEndTime<=e7.now())continue;let ex=this.findLoadedParent(ed,Math.max(ed.overscaledZ-ey.maxOverzooming,this._source.minzoom));ex&&(this._addTile(ex.tileID),eo[ex.tileID.key]=ex.tileID),ec[em]=ed}let eg=em[em.length-1].overscaledZ;for(let eo in this._tiles){let ed=this._tiles[eo];if(e_[eo]||!ed.hasData())continue;let em=ed.tileID;for(;em.overscaledZ>eg;){em=em.scaledTo(em.overscaledZ-1);let eg=this._tiles[em.key];if(eg&&eg.hasData()&&ec[em.key]){e_[eo]=ed.tileID;break}}}for(let ec in eo)e_[ec]||(this._coveredTiles[ec]=!0,e_[ec]=eo[ec])}for(let eo in e_)this._tiles[eo].clearFadeHold();let eg=function(eo,ec){let ed=[];for(let em in eo)em in ec||ed.push(em);return ed}(this._tiles,e_);for(let eo of eg){let ec=this._tiles[eo];ec.hasSymbolBuckets&&!ec.holdingForFade()?ec.setHoldDuration(this.map._fadeDuration):ec.hasSymbolBuckets&&!ec.symbolFadeFinished()||this._removeTile(+eo)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let eo in this._tiles)this._tiles[eo].holdingForFade()&&this._removeTile(+eo)}_updateRetainedTiles(eo){let ec={};if(0===eo.length)return ec;let ed={},em=eo.reduce((eo,ec)=>Math.min(eo,ec.overscaledZ),1/0),e_=eo[0].overscaledZ,eg=Math.max(e_-ey.maxOverzooming,this._source.minzoom),ex=Math.max(e_+ey.maxUnderzooming,this._source.minzoom),ev={};for(let ed of eo){let eo=this._addTile(ed);ec[ed.key]=ed,eo.hasData()||em<this._source.maxzoom&&(ev[ed.key]=ed)}for(let e_ of(this._retainLoadedChildren(ev,em,ex,ec),eo)){let eo=this._tiles[e_.key];if(eo.hasData())continue;if(e_.canonical.z>=this._source.maxzoom){let eo=e_.children(this._source.maxzoom)[0],ed=this.getTile(eo);if(ed&&ed.hasData()){ec[eo.key]=eo;continue}}else{let eo=e_.children(this._source.maxzoom);if(ec[eo[0].key]&&ec[eo[1].key]&&ec[eo[2].key]&&ec[eo[3].key])continue}let em=eo.wasRequested();for(let ex=e_.overscaledZ-1;ex>=eg;--ex){let eg=e_.scaledTo(ex);if(ed[eg.key]||(ed[eg.key]=!0,(eo=this.getTile(eg))||!em||(eo=this._addTile(eg)),eo&&(ec[eg.key]=eg,em=eo.wasRequested(),eo.hasData())))break}}return ec}_updateLoadedParentTileCache(){for(let eo in this._loadedParentTiles={},this._tiles){let ec=[],ed,em=this._tiles[eo].tileID;for(;em.overscaledZ>0;){if(em.key in this._loadedParentTiles){ed=this._loadedParentTiles[em.key];break}ec.push(em.key);let eo=em.scaledTo(em.overscaledZ-1);if(ed=this._getLoadedTile(eo))break;em=eo}for(let eo of ec)this._loadedParentTiles[eo]=ed}}_addTile(eo){let ec=this._tiles[eo.key];if(ec)return ec;(ec=this._cache.getAndRemove(eo))&&(this._setTileReloadTimer(eo.key,ec),ec.tileID=eo,this._state.initializeTileState(ec,this.map?this.map.painter:null),this._cacheTimers[eo.key]&&(clearTimeout(this._cacheTimers[eo.key]),delete this._cacheTimers[eo.key],this._setTileReloadTimer(eo.key,ec)));let ed=!!ec;if(!ed){let ed=this.map?this.map.painter:null;ec=new Pf(eo,this._source.tileSize*eo.overscaleFactor(),this.transform.tileZoom,ed,this._isRaster),this._loadTile(ec,this._tileLoaded.bind(this,ec,eo.key,ec.state))}return ec?(ec.uses++,this._tiles[eo.key]=ec,ed||this._source.fire(new Yt("dataloading",{tile:ec,coord:ec.tileID,dataType:"source"})),ec):null}_setTileReloadTimer(eo,ec){eo in this._timers&&(clearTimeout(this._timers[eo]),delete this._timers[eo]);let ed=ec.getExpiryTimeout();ed&&(this._timers[eo]=setTimeout(()=>{this._reloadTile(eo,"expired"),delete this._timers[eo]},ed))}_removeTile(eo){let ec=this._tiles[eo];ec&&(ec.uses--,delete this._tiles[eo],this._timers[eo]&&(clearTimeout(this._timers[eo]),delete this._timers[eo]),ec.uses>0||(ec.hasData()&&"reloading"!==ec.state?this._cache.add(ec.tileID,ec,ec.getExpiryTimeout()):(ec.aborted=!0,this._abortTile(ec),this._unloadTile(ec))))}clearTiles(){for(let eo in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(+eo);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(eo,ec,ed){let em=[],e_=this.transform;if(!e_)return em;let eg="globe"===e_.projection.name,ex=Nl(e_.center.lng);for(let ev in this._tiles){let eb;let ew=this._tiles[ev];if(ed&&ew.clearQueryDebugViz(),!ew.holdingForFade()){if(eg){let eo=ew.tileID.canonical;if(0===eo.z){let ec=[Math.abs(M(ex,...iy(eo,-1))-ex),Math.abs(M(ex,...iy(eo,1))-ex)];eb=[0,2*ec.indexOf(Math.min(...ec))-1]}else{let ec=[Math.abs(M(ex,...iy(eo,-1))-ex),Math.abs(M(ex,...iy(eo,0))-ex),Math.abs(M(ex,...iy(eo,1))-ex)];eb=[ec.indexOf(Math.min(...ec))-1]}}else eb=[0];for(let ed of eb){let eg=eo.containsTile(ew,e_,ec,ed);eg&&em.push(eg)}}}return em}getVisibleCoordinates(eo){let ec=this.getRenderableIds(eo).map(eo=>this._tiles[eo].tileID);for(let eo of ec)eo.projMatrix=this.transform.calculateProjMatrix(eo.toUnwrapped());return ec}hasTransition(){if(this._source.hasTransition())return!0;if(ny(this._source.type))for(let eo in this._tiles){let ec=this._tiles[eo];if(void 0!==ec.fadeEndTime&&ec.fadeEndTime>=e7.now())return!0}return!1}setFeatureState(eo,ec,ed){this._state.updateState(eo=eo||"_geojsonTileLayer",ec,ed)}removeFeatureState(eo,ec,ed){this._state.removeFeatureState(eo=eo||"_geojsonTileLayer",ec,ed)}getFeatureState(eo,ec){return this._state.getState(eo=eo||"_geojsonTileLayer",ec)}setDependencies(eo,ec,ed){let em=this._tiles[eo];em&&em.setDependencies(ec,ed)}reloadTilesForDependencies(eo,ec){for(let ed in this._tiles)this._tiles[ed].hasDependency(eo,ec)&&this._reloadTile(+ed,"reloading");this._cache.filter(ed=>!ed.hasDependency(eo,ec))}_preloadTiles(eo,ec){if(!this._sourceLoaded){let r=()=>{this._sourceLoaded&&(this._source.off("data",r),this._preloadTiles(eo,ec))};return void this._source.on("data",r)}let ed=new Map,em=Array.isArray(eo)?eo:[eo],e_=this.map.painter.terrain,eg=this.usedForTerrain&&e_?e_.getScaledDemTileSize():this._source.tileSize;for(let eo of em){let ec=eo.coveringTiles({tileSize:eg,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let eo of ec)ed.set(eo.key,eo);this.usedForTerrain&&eo.updateElevation(!1)}B(Array.from(ed.values()),(eo,ec)=>{let ed=new Pf(eo,this._source.tileSize*eo.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(ed,eo=>{"raster-dem"===this._source.type&&ed.dem&&this._backfillDEM(ed),ec(eo,ed)})},ec)}};function ry(eo,ec){let ed=Math.abs(2*eo.wrap)-+(eo.wrap<0),em=Math.abs(2*ec.wrap)-+(ec.wrap<0);return eo.overscaledZ-ec.overscaledZ||em-ed||ec.canonical.y-eo.canonical.y||ec.canonical.x-eo.canonical.x}function ny(eo){return"raster"===eo||"image"===eo||"video"===eo||"custom"===eo}function iy(eo,ec){let ed=1<<eo.z;return[eo.x/ed+ec,(eo.x+1)/ed+ec]}ey.maxOverzooming=10,ey.maxUnderzooming=3;let sy=class sy{constructor(eo,ec,ed){this._demTile=eo,this._dem=this._demTile.dem,this._scale=ec,this._offset=ed}static create(eo,ec,ed){let em=ed||eo.findDEMTileFor(ec);if(!em||!em.dem)return;let e_=em.dem,eg=em.tileID,ex=1<<ec.canonical.z-eg.canonical.z;return new sy(em,em.tileSize/8192/ex,[(ec.canonical.x/ex-eg.canonical.x)*e_.dim,(ec.canonical.y/ex-eg.canonical.y)*e_.dim])}tileCoordToPixel(eo,ec){let ed=ec*this._scale+this._offset[1],em=Math.floor(eo*this._scale+this._offset[0]),e_=Math.floor(ed);return new eL(em,e_)}getElevationAt(eo,ec,ed,em){let e_=eo*this._scale+this._offset[0],eg=ec*this._scale+this._offset[1],ex=Math.floor(e_),ev=Math.floor(eg),eb=this._dem;return em=!!em,ed?Er(Er(eb.get(ex,ev,em),eb.get(ex,ev+1,em),eg-ev),Er(eb.get(ex+1,ev,em),eb.get(ex+1,ev+1,em),eg-ev),e_-ex):eb.get(ex,ev,em)}getElevationAtPixel(eo,ec,ed){return this._dem.get(eo,ec,!!ed)}getMeterToDEM(eo){return(1<<this._demTile.tileID.canonical.z)*(1/ql(eo))*this._dem.stride}};let ay=class ay{constructor(eo,ec){this.tileID=eo,this.x=eo.canonical.x,this.y=eo.canonical.y,this.z=eo.canonical.z,this.grid=new tK(8192,16,0),this.featureIndexArray=new ba,this.promoteId=ec}insert(eo,ec,ed,em,e_,eg=0){let ex=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(ed,em,e_,eg);let ev=this.grid;for(let eo=0;eo<ec.length;eo++){let ed=ec[eo],em=[1/0,1/0,-1/0,-1/0];for(let eo=0;eo<ed.length;eo++){let ec=ed[eo];em[0]=Math.min(em[0],ec.x),em[1]=Math.min(em[1],ec.y),em[2]=Math.max(em[2],ec.x),em[3]=Math.max(em[3],ec.y)}em[0]<8192&&em[1]<8192&&em[2]>=0&&em[3]>=0&&ev.insert(ex,em[0],em[1],em[2],em[3])}}loadVTLayers(){if(!this.vtLayers)for(let eo in this.vtLayers=new rh(new rB(this.rawTileData)).layers,this.sourceLayerCoder=new wf(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={},this.vtLayers)this.vtFeatures[eo]=[];return this.vtLayers}query(eo,ec,ed,em){let e_;this.loadVTLayers();let eg=eo.params||{},ex=hi(eg.filter),ev=eo.tileResult,eb=eo.transform,ew=ev.bufferedTilespaceBounds,eT=this.grid.query(ew.min.x,ew.min.y,ew.max.x,ew.max.y,(eo,ec,ed,em)=>wu(ev.bufferedTilespaceGeometry,eo,ec,ed,em));eT.sort(ly);let eE=null;eb.elevation&&eT.length>0&&(eE=sy.create(eb.elevation,this.tileID));let eM={};for(let eb=0;eb<eT.length;eb++){let ew=eT[eb];if(ew===e_)continue;e_=ew;let eS=this.featureIndexArray.get(ew),eA=null;this.loadMatchingFeature(eM,eS,ex,eg.layers,eg.availableImages,ec,ed,em,(ec,ed,em,e_=0)=>(eA||(eA=au(ec,this.tileID.canonical,eo.tileTransform)),ed.queryIntersectsFeature(ev,ec,em,eA,this.z,eo.transform,eo.pixelPosMatrix,eE,e_)))}return eM}loadMatchingFeature(eo,ec,ed,em,e_,eg,ex,ev,eb){let{featureIndex:ew,bucketIndex:eT,sourceLayerIndex:eE,layoutVertexArrayOffset:eM}=ec,eS=this.bucketLayerIDs[eT];if(em&&!function(eo,ec){for(let ed=0;ed<eo.length;ed++)if(ec.indexOf(eo[ed])>=0)return!0;return!1}(em,eS))return;let eA=this.sourceLayerCoder.decode(eE),eI=this.vtLayers[eA].feature(ew);if(ed.needGeometry){let eo=ou(eI,!0);if(!ed.filter(new ws(this.tileID.overscaledZ),eo,this.tileID.canonical))return}else if(!ed.filter(new ws(this.tileID.overscaledZ),eI))return;let eC=this.getId(eI,eA);for(let ec=0;ec<eS.length;ec++){let ed=eS[ec];if(em&&0>em.indexOf(ed))continue;let eT=eg[ed];if(!eT)continue;let eE={};void 0!==eC&&ev&&(eE=ev.getState(eT.sourceLayer||"_geojsonTileLayer",eC));let eA=C({},ex[ed]);eA.paint=oy(eA.paint,eT.paint,eI,eE,e_),eA.layout=oy(eA.layout,eT.layout,eI,eE,e_);let eP=!eb||eb(eI,eT,eE,eM);if(!eP)continue;let ez=new Af(eI,this.z,this.x,this.y,eC);ez.layer=eA;let eD=eo[ed];void 0===eD&&(eD=eo[ed]=[]),eD.push({featureIndex:ew,feature:ez,intersectionZ:eP})}}lookupSymbolFeatures(eo,ec,ed,em,e_,eg,ex,ev){let eb={};this.loadVTLayers();let ew=hi(e_);for(let e_ of eo)this.loadMatchingFeature(eb,{bucketIndex:ed,sourceLayerIndex:em,featureIndex:e_,layoutVertexArrayOffset:0},ew,eg,ex,ev,ec);return eb}loadFeature(eo){let{featureIndex:ec,sourceLayerIndex:ed}=eo;this.loadVTLayers();let em=this.sourceLayerCoder.decode(ed),e_=this.vtFeatures[em];if(e_[ec])return e_[ec];let eg=this.vtLayers[em].feature(ec);return e_[ec]=eg,eg}hasLayer(eo){for(let ec of this.bucketLayerIDs)for(let ed of ec)if(eo===ed)return!0;return!1}getId(eo,ec){let ed=eo.id;if(this.promoteId){let em="string"==typeof this.promoteId?this.promoteId:this.promoteId[ec];null!=em&&(ed=eo.properties[em]),"boolean"==typeof ed&&(ed=Number(ed))}return ed}};function oy(eo,ec,ed,em,e_){return $(eo,(eo,eg)=>{let ex=ec instanceof zs?ec.get(eg):null;return ex&&ex.evaluate?ex.evaluate(ed,em,e_):ex})}function ly(eo,ec){return ec-eo}Ji(ay,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let uy=class uy{constructor(eo,ec){this.width=eo,this.height=ec,this.nextRow=0,this.image=new Ru({width:eo,height:ec}),this.positions={},this.uploaded=!1}getDash(eo,ec){let ed=this.getKey(eo,ec);return this.positions[ed]}trim(){let eo=this.width,ec=this.height=L(this.nextRow);this.image.resize({width:eo,height:ec})}getKey(eo,ec){return eo.join(",")+ec}getDashRanges(eo,ec,ed){let em=[],e_=eo.length%2==1?-eo[eo.length-1]*ed:0,eg=eo[0]*ed,ex=!0;em.push({left:e_,right:eg,isDash:ex,zeroLength:0===eo[0]});let ev=eo[0];for(let ec=1;ec<eo.length;ec++){ex=!ex;let eb=eo[ec];e_=ev*ed,ev+=eb,eg=ev*ed,em.push({left:e_,right:eg,isDash:ex,zeroLength:0===eb})}return em}addRoundDash(eo,ec,ed){let em=ec/2;for(let ec=-ed;ec<=ed;ec++){let e_=this.width*(this.nextRow+ed+ec),eg=0,ex=eo[0];for(let ev=0;ev<this.width;ev++){let eb;ev/ex.right>1&&(ex=eo[++eg]);let ew=Math.abs(ev-ex.left),eT=Math.abs(ev-ex.right),eE=Math.min(ew,eT),eM=ec/ed*(em+1);if(ex.isDash){let eo=em-Math.abs(eM);eb=Math.sqrt(eE*eE+eo*eo)}else eb=em-Math.sqrt(eE*eE+eM*eM);this.image.data[e_+ev]=Math.max(0,Math.min(255,eb+128))}}}addRegularDash(eo,ec){for(let ec=eo.length-1;ec>=0;--ec){let ed=eo[ec],em=eo[ec+1];ed.zeroLength?eo.splice(ec,1):em&&em.isDash===ed.isDash&&(em.left=ed.left,eo.splice(ec,1))}let ed=eo[0],em=eo[eo.length-1];ed.isDash===em.isDash&&(ed.left=em.left-this.width,em.right=ed.right+this.width);let e_=this.width*this.nextRow,eg=0,ex=eo[0];for(let ed=0;ed<this.width;ed++){ed/ex.right>1&&(ex=eo[++eg]);let em=Math.abs(ed-ex.left),ev=Math.abs(ed-ex.right),eb=Math.min(em,ev);this.image.data[e_+ed]=Math.max(0,Math.min(255,(ex.isDash?eb:-eb)+ec+128))}}addDash(eo,ec){let ed=this.getKey(eo,ec);if(this.positions[ed])return this.positions[ed];let em="round"===ec,e_=em?7:0,eg=2*e_+1;if(this.nextRow+eg>this.height)return N("LineAtlas out of space"),null;0===eo.length&&eo.push(1);let ex=0;for(let ec=0;ec<eo.length;ec++)eo[ec]<0&&(N("Negative value is found in line dasharray, replacing values with 0"),eo[ec]=0),ex+=eo[ec];if(0!==ex){let ed=this.width/ex,eg=this.getDashRanges(eo,this.width,ed);em?this.addRoundDash(eg,ed,e_):this.addRegularDash(eg,"square"===ec?.5*ed:0)}let ev=this.nextRow+e_;this.nextRow+=eg;let eb={tl:[ev,e_],br:[ex,0]};return this.positions[ed]=eb,eb}};Ji(uy,"LineAtlas");let hy=class hy{constructor(eo){let ec={},ed=[];for(let em in eo){let e_=eo[em],eg=ec[em]={};for(let eo in e_.glyphs){let ec=e_.glyphs[+eo];if(!ec||0===ec.bitmap.width||0===ec.bitmap.height)continue;let em=ec.metrics.localGlyph?2:1,ex={x:0,y:0,w:ec.bitmap.width+2*em,h:ec.bitmap.height+2*em};ed.push(ex),eg[eo]=ex}}let{w:em,h:e_}=_p(ed),eg=new Ru({width:em||1,height:e_||1});for(let ed in eo){let em=eo[ed];for(let eo in em.glyphs){let e_=em.glyphs[+eo];if(!e_||0===e_.bitmap.width||0===e_.bitmap.height)continue;let ex=ec[ed][eo],ev=e_.metrics.localGlyph?2:1;Ru.copy(e_.bitmap,eg,{x:0,y:0},{x:ex.x+ev,y:ex.y+ev},e_.bitmap)}}this.image=eg,this.positions=ec}};Ji(hy,"GlyphAtlas");let py=class py{constructor(eo){this.tileID=new fh(eo.tileID.overscaledZ,eo.tileID.wrap,eo.tileID.canonical.z,eo.tileID.canonical.x,eo.tileID.canonical.y),this.tileZoom=eo.tileZoom,this.uid=eo.uid,this.zoom=eo.zoom,this.canonical=eo.tileID.canonical,this.pixelRatio=eo.pixelRatio,this.tileSize=eo.tileSize,this.source=eo.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=eo.showCollisionBoxes,this.collectResourceTiming=!!eo.collectResourceTiming,this.returnDependencies=!!eo.returnDependencies,this.promoteId=eo.promoteId,this.enableTerrain=!!eo.enableTerrain,this.isSymbolTile=eo.isSymbolTile,this.tileTransform=Bd(eo.tileID.canonical,eo.projection),this.projection=eo.projection}parse(eo,ec,ed,em,e_){let eg,ex,ev,eb;this.status="parsing",this.data=eo,this.collisionBoxArray=new pa;let ew=new wf(Object.keys(eo.layers).sort()),eT=new ay(this.tileID,this.promoteId);eT.bucketLayerIDs=[];let eE={},eM=new uy(256,256),eS={featureIndex:eT,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:eM,availableImages:ed},eA=ec.familiesBySource[this.source];for(let ec in eA){let em=eo.layers[ec];if(!em)continue;let e_=!1,eg=!1;for(let eo of eA[ec])"symbol"===eo[0].type?e_=!0:eg=!0;if(!0===this.isSymbolTile&&!e_||!1===this.isSymbolTile&&!eg)continue;1===em.version&&N(`Vector tile source "${this.source}" layer "${ec}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let ex=ew.encode(ec),ev=[];for(let eo=0;eo<em.length;eo++){let ed=em.feature(eo),e_=eT.getId(ed,ec);ev.push({feature:ed,id:e_,index:eo,sourceLayerIndex:ex})}for(let eo of eA[ec]){let ec=eo[0];void 0!==this.isSymbolTile&&"symbol"===ec.type!==this.isSymbolTile||ec.minzoom&&this.zoom<Math.floor(ec.minzoom)||ec.maxzoom&&this.zoom>=ec.maxzoom||"none"!==ec.visibility&&(dy(eo,this.zoom,ed),(eE[ec.id]=ec.createBucket({index:eT.bucketLayerIDs.length,layers:eo,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ex,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:ed})).populate(ev,eS,this.tileID.canonical,this.tileTransform),eT.bucketLayerIDs.push(eo.map(eo=>eo.id)))}}eM.trim();let eI={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},m=()=>{if(eg)return e_(eg);if(ex&&ev&&eb){let eo=new hy(ex),ec=new kp(ev,eb);for(let em in eE){let e_=eE[em];e_ instanceof of?(dy(e_.layers,this.zoom,ed),function(eo,ec,ed,em,e_,eg,ex,ev,eb,ew){eo.createArrays(),eo.tilePixelRatio=8192/(512*eo.overscaling),eo.compareText={},eo.iconsNeedLinear=!1;let eT=eo.layers[0].layout,eE=eo.layers[0]._unevaluatedLayout._values,eM={};if("composite"===eo.textSizeData.kind){let{minZoom:ec,maxZoom:ed}=eo.textSizeData;eM.compositeTextSizes=[eE["text-size"].possiblyEvaluate(new ws(ec),ev),eE["text-size"].possiblyEvaluate(new ws(ed),ev)]}if("composite"===eo.iconSizeData.kind){let{minZoom:ec,maxZoom:ed}=eo.iconSizeData;eM.compositeIconSizes=[eE["icon-size"].possiblyEvaluate(new ws(ec),ev),eE["icon-size"].possiblyEvaluate(new ws(ed),ev)]}eM.layoutTextSize=eE["text-size"].possiblyEvaluate(new ws(eb+1),ev),eM.layoutIconSize=eE["icon-size"].possiblyEvaluate(new ws(eb+1),ev),eM.textMaxSize=eE["text-size"].possiblyEvaluate(new ws(18),ev);let eS="map"===eT.get("text-rotation-alignment")&&"point"!==eT.get("symbol-placement"),eA=eT.get("text-size");for(let eg of eo.features){let eb=eT.get("text-font").evaluate(eg,{},ev).join(","),eE=eA.evaluate(eg,{},ev),eI=eM.layoutTextSize.evaluate(eg,{},ev),eC=(eM.layoutIconSize.evaluate(eg,{},ev),{horizontal:{},vertical:void 0}),eP=eg.text,ez,eD=[0,0];if(eP){let em=eP.toString(),ex=24*eT.get("text-letter-spacing").evaluate(eg,{},ev),ew=24*eT.get("text-line-height").evaluate(eg,{},ev),eM=!function(eo){for(let ed of eo){var ec;if(ec=ed.charCodeAt(0),t0.Arabic(ec)||t0["Arabic Supplement"](ec)||t0["Arabic Extended-A"](ec)||t0["Arabic Presentation Forms-A"](ec)||t0["Arabic Presentation Forms-B"](ec))return!1}return!0}(em)?0:ex,eA=eT.get("text-anchor").evaluate(eg,{},ev),ez=eT.get("text-variable-anchor");if(!ez){let eo=eT.get("text-radial-offset").evaluate(eg,{},ev);eD=eo?xd(eA,[24*eo,rV]):eT.get("text-offset").evaluate(eg,{},ev).map(eo=>24*eo)}let ek=eS?"center":eT.get("text-justify").evaluate(eg,{},ev),eL="point"===eT.get("symbol-placement"),eR=eL?24*eT.get("text-max-width").evaluate(eg,{},ev):1/0,A=eg=>{eo.allowVerticalPlacement&&es(em)&&(eC.vertical=Bp(eP,ec,ed,e_,eb,eR,ew,eA,eg,eM,eD,rF.vertical,!0,eI,eE))};if(!eS&&ez){let eo="auto"===ek?ez.map(eo=>bd(eo)):[ek],em=!1;for(let eg=0;eg<eo.length;eg++){let ex=eo[eg];if(!eC.horizontal[ex]){if(em)eC.horizontal[ex]=eC.horizontal[0];else{let eo=Bp(eP,ec,ed,e_,eb,eR,ew,"center",ex,eM,eD,rF.horizontal,!1,eI,eE);eo&&(eC.horizontal[ex]=eo,em=1===eo.positionedLines.length)}}}A("left")}else{if("auto"===ek&&(ek=bd(eA)),eL||eT.get("text-writing-mode").indexOf("horizontal")>=0||!es(em)){let eo=Bp(eP,ec,ed,e_,eb,eR,ew,eA,ek,eM,eD,rF.horizontal,!1,eI,eE);eo&&(eC.horizontal[ek]=eo)}A(eL?"left":ek)}}let ek=!1;if(eg.icon&&eg.icon.name){let ec=em[eg.icon.name];ec&&(ez=function(eo,ec,ed){let{horizontalAlign:em,verticalAlign:e_}=Rp(ed),eg=ec[0]-eo.displaySize[0]*em,ex=ec[1]-eo.displaySize[1]*e_;return{image:eo,top:ex,bottom:ex+eo.displaySize[1],left:eg,right:eg+eo.displaySize[0]}}(e_[eg.icon.name],eT.get("icon-offset").evaluate(eg,{},ev),eT.get("icon-anchor").evaluate(eg,{},ev)),ek=ec.sdf,void 0===eo.sdfIcons?eo.sdfIcons=ec.sdf:eo.sdfIcons!==ec.sdf&&N("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ec.pixelRatio!==eo.pixelRatio||0!==eT.get("icon-rotate").constantOr(1))&&(eo.iconsNeedLinear=!0))}let eB=kd(eC.horizontal)||eC.vertical;eo.iconsInText||(eo.iconsInText=!!eB&&eB.iconsInText),(eB||ez)&&function(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM){var eS;let eA,eI=eg.textMaxSize.evaluate(ec,{},eE);void 0===eI&&(eI=ex);let eC=eo.layers[0].layout,eP=eC.get("icon-offset").evaluate(ec,{},eE),ez=kd(ed.horizontal)||ed.vertical,eD="globe"===eM.name,ek=ex/24,eB=eo.tilePixelRatio*eI/24,eF=(eS=eo.overscaling,eo.zoom>18&&eS>2&&(eS>>=1),Math.max(8192/(512*eS),1)*eC.get("symbol-spacing")),eO=eC.get("text-padding")*eo.tilePixelRatio,eU=eC.get("icon-padding")*eo.tilePixelRatio,eN=eC.get("text-max-angle")*eR,eV="map"===eC.get("text-rotation-alignment")&&"point"!==eC.get("symbol-placement"),ej="map"===eC.get("icon-rotation-alignment")&&"point"!==eC.get("symbol-placement"),eG=eC.get("symbol-placement"),eZ=eF/2,e$=eC.get("icon-text-fit");em&&"none"!==e$&&(eo.allowVerticalPlacement&&ed.vertical&&(eA=jp(em,ed.vertical,e$,eC.get("icon-text-fit-padding"),eP,ek)),ez&&(em=jp(em,ez,e$,eC.get("icon-text-fit-padding"),eP,ek)));let P=(ex,ev,eS)=>{if(ev.x<0||ev.x>=8192||ev.y<0||ev.y>=8192)return;let eI=null;if(eD){let{x:eo,y:ec,z:ed}=eM.projectTilePoint(ev.x,ev.y,eS);eI={anchor:new Op(eo,ec,ed,0,void 0),up:eM.upVector(eS,ev.x,ev.y)}}!function(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez,eD,ek,eL,eR,eB,eF){let eO=eo.addToLineVertexArray(ec,em),eU,eN,eV,ej,eG,eZ,e$,eq=0,eX=0,eW=0,eH=0,eJ=-1,eY=-1,eK={},eQ=ib(""),e0=ed?ed.anchor:ec,e1=0,e2=0;if(void 0===eb._unevaluatedLayout.getValue("text-radial-offset")?[e1,e2]=eb.layout.get("text-offset").evaluate(ek,{},eF).map(eo=>24*eo):(e1=24*eb.layout.get("text-radial-offset").evaluate(ek,{},eF),e2=rV),eo.allowVerticalPlacement&&e_.vertical){let eo=e_.vertical;if(eA)eZ=Md(eo),ev&&(e$=Md(ev));else{let ed=eb.layout.get("text-rotate").evaluate(ek,{},eF)+90;eV=Id(ew,e0,ec,eT,eE,eM,eo,eS,ed,eI),ev&&(ej=Id(ew,e0,ec,eT,eE,eM,ev,eP,ed))}}if(eg){let em=eb.layout.get("icon-rotate").evaluate(ek,{},eF),e_="none"!==eb.layout.get("icon-text-fit"),ex=id(eg,em,eR,e_),eS=ev?id(ev,em,eR,e_):void 0;eN=Id(ew,e0,ec,eT,eE,eM,eg,eP,em),eq=4*ex.length;let eA=eo.iconSizeData,eI=null;"source"===eA.kind?(eI=[128*eb.layout.get("icon-size").evaluate(ek,{},eF)])[0]>32640&&N(`${eo.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`):"composite"===eA.kind&&((eI=[128*eL.compositeIconSizes[0].evaluate(ek,{},eF),128*eL.compositeIconSizes[1].evaluate(ek,{},eF)])[0]>32640||eI[1]>32640)&&N(`${eo.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`),eo.addSymbols(eo.icon,ex,eI,eD,ez,ek,!1,ed,ec,eO.lineStartIndex,eO.lineLength,-1,eB,eF),eJ=eo.icon.placedSymbolArray.length-1,eS&&(eX=4*eS.length,eo.addSymbols(eo.icon,eS,eI,eD,ez,ek,rF.vertical,ed,ec,eO.lineStartIndex,eO.lineLength,-1,eB,eF),eY=eo.icon.placedSymbolArray.length-1)}for(let em in e_.horizontal){let eg=e_.horizontal[em];eU||(eQ=ib(eg.text),eA?eG=Md(eg):eU=Id(ew,e0,ec,eT,eE,eM,eg,eS,eb.layout.get("text-rotate").evaluate(ek,{},eF),eI));let ev=1===eg.positionedLines.length;if(eW+=Sd(eo,ed,ec,eg,ex,eb,eA,ek,eI,eO,e_.vertical?rF.horizontal:rF.horizontalOnly,ev?Object.keys(e_.horizontal):[em],eK,eJ,eL,eB,eF),ev)break}e_.vertical&&(eH+=Sd(eo,ed,ec,e_.vertical,ex,eb,eA,ek,eI,eO,rF.vertical,["vertical"],eK,eY,eL,eB,eF));let e3=-1,Z=(eo,ec)=>eo?Math.max(eo,ec):ec;e3=Z(eG,e3),e3=Z(eZ,e3),e3=Z(e$,e3);let e5=e3>-1?1:0;eo.glyphOffsetArray.length>=of.MAX_GLYPHS&&N("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==ek.sortKey&&eo.addToSortKeyRanges(eo.symbolInstances.length,ek.sortKey),eo.symbolInstances.emplaceBack(e0.x,e0.y,e0.z,ec.x,ec.y,eK.right>=0?eK.right:-1,eK.center>=0?eK.center:-1,eK.left>=0?eK.left:-1,eK.vertical>=0?eK.vertical:-1,eJ,eY,eQ,void 0!==eU?eU:eo.collisionBoxArray.length,void 0!==eU?eU+1:eo.collisionBoxArray.length,void 0!==eV?eV:eo.collisionBoxArray.length,void 0!==eV?eV+1:eo.collisionBoxArray.length,void 0!==eN?eN:eo.collisionBoxArray.length,void 0!==eN?eN+1:eo.collisionBoxArray.length,ej||eo.collisionBoxArray.length,ej?ej+1:eo.collisionBoxArray.length,eT,eW,eH,eq,eX,e5,0,e1,e2,e3)}(eo,ev,eI,ex,ed,em,e_,eA,eo.layers[0],eo.collisionBoxArray,ec.index,ec.sourceLayerIndex,eo.index,eO,eV,eb,0,eU,ej,eP,ec,eg,ew,eT,eE)};if("line"===eG)for(let e_ of Hp(ec.geometry,0,0,8192,8192)){let ec=function(eo,ec,ed,em,e_,eg,ex,ev,eb){let ew=em?.6*eg*ex:0,eT=Zp(em,e_),eE=eT*ex,eM=0===eo[0].x||eo[0].x===eb||0===eo[0].y||eo[0].y===eb;return ec-eE<ec/4&&(ec=eE+ec/4),function Jp(eo,ec,ed,em,e_,eg,ex,ev,eb){let ew=eg/2,eT=Np(eo),eE=0,eM=ec-ed,eS=[];for(let ec=0;ec<eo.length-1;ec++){let ex=eo[ec],ev=eo[ec+1],eA=ex.dist(ev),eI=ev.angleTo(ex);for(;eM+ed<eE+eA;){eM+=ed;let eC=(eM-eE)/eA,eP=Er(ex.x,ev.x,eC),ez=Er(ex.y,ev.y,eC);if(eP>=0&&eP<eb&&ez>=0&&ez<eb&&eM-ew>=0&&eM+ew<=eT){let ed=new Op(eP,ez,0,eI,ec);ed._round(),em&&!qp(eo,ed,eg,em,e_)||eS.push(ed)}}eE+=eA}return ev||eS.length||ex||(eS=Jp(eo,eE/2,ed,em,e_,eg,ex,!0,eb)),eS}(eo,eM?ec/2*ev%ec:(eT/2+2*eg)*ex*ev%ec,ec,ew,ed,eE,eM,!1,eb)}(e_,eF,eN,ed.vertical||ez,em,24,eB,eo.overscaling,8192);for(let ed of ec)ez&&function(eo,ec,ed,em){let e_=eo.compareText;if(ec in e_){let eo=e_[ec];for(let ec=eo.length-1;ec>=0;ec--)if(em.dist(eo[ec])<ed)return!0}else e_[ec]=[];return e_[ec].push(em),!1}(eo,ez.text,eZ,ed)||P(e_,ed,eE)}else if("line-center"===eG){for(let eo of ec.geometry)if(eo.length>1){let ec=function(eo,ec,ed,em,e_,eg){let ex=ed?14.399999999999999*eg:0,ev=Zp(ed,em)*eg,eb=0,ew=Np(eo)/2;for(let ed=0;ed<eo.length-1;ed++){let em=eo[ed],e_=eo[ed+1],eg=em.dist(e_);if(eb+eg>ew){let eT=(ew-eb)/eg,eE=Er(em.x,e_.x,eT),eM=Er(em.y,e_.y,eT),eS=new Op(eE,eM,0,e_.angleTo(em),ed);return!ex||qp(eo,eS,ev,ex,ec)?eS:void 0}eb+=eg}}(eo,eN,ed.vertical||ez,em,0,eB);ec&&P(eo,ec,eE)}}else if("Polygon"===ec.type)for(let eo of Ac(ec.geometry,0)){let ec=function(eo,ec=1,ed=!1){let em=1/0,e_=1/0,eg=-1/0,ex=-1/0,ev=eo[0];for(let eo=0;eo<ev.length;eo++){let ec=ev[eo];(!eo||ec.x<em)&&(em=ec.x),(!eo||ec.y<e_)&&(e_=ec.y),(!eo||ec.x>eg)&&(eg=ec.x),(!eo||ec.y>ex)&&(ex=ec.y)}let eb=Math.min(eg-em,ex-e_),ew=eb/2,eT=new cd([],dd);if(0===eb)return new eL(em,e_);for(let ec=em;ec<eg;ec+=eb)for(let ed=e_;ed<ex;ed+=eb)eT.push(new fd(ec+ew,ed+ew,ew,eo));let eE=function(eo){let ec=0,ed=0,em=0,e_=eo[0];for(let eo=0,eg=e_.length,ex=eg-1;eo<eg;ex=eo++){let eg=e_[eo],ev=e_[ex],eb=eg.x*ev.y-ev.x*eg.y;ed+=(eg.x+ev.x)*eb,em+=(eg.y+ev.y)*eb,ec+=3*eb}return new fd(ed/ec,em/ec,0,eo)}(eo),eM=eT.length;for(;eT.length;){let em=eT.pop();(em.d>eE.d||!eE.d)&&(eE=em,ed&&console.log("found best %d after %d probes",Math.round(1e4*em.d)/1e4,eM)),em.max-eE.d<=ec||(ew=em.h/2,eT.push(new fd(em.p.x-ew,em.p.y-ew,ew,eo)),eT.push(new fd(em.p.x+ew,em.p.y-ew,ew,eo)),eT.push(new fd(em.p.x-ew,em.p.y+ew,ew,eo)),eT.push(new fd(em.p.x+ew,em.p.y+ew,ew,eo)),eM+=4)}return ed&&(console.log(`num probes: ${eM}`),console.log(`best distance: ${eE.d}`)),eE.p}(eo,16);P(eo[0],new Op(ec.x,ec.y,0,0,void 0),eE)}else if("LineString"===ec.type)for(let eo of ec.geometry)P(eo,new Op(eo[0].x,eo[0].y,0,0,void 0),eE);else if("Point"===ec.type)for(let eo of ec.geometry)for(let ec of eo)P([ec],new Op(ec.x,ec.y,0,0,void 0),eE)}(eo,eg,eC,ez,em,eM,eI,0,eD,ek,ex,ev,ew)}eg&&eo.generateCollisionDebugBuffers(eb,eo.collisionBoxArray)}(e_,ex,eo.positions,ev,ec.iconPositions,this.showCollisionBoxes,ed,this.tileID.canonical,this.tileZoom,this.projection)):e_.hasPattern&&(e_ instanceof Ih||e_ instanceof Mc||e_ instanceof th)&&(dy(e_.layers,this.zoom,ed),e_.addFeatures(eS,this.tileID.canonical,ec.patternPositions,ed,this.tileTransform))}this.status="done",e_(null,{buckets:E(eE).filter(eo=>!eo.isEmpty()),featureIndex:eT,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:eo.image,lineAtlas:eM,imageAtlas:ec,glyphMap:this.returnDependencies?ex:null,iconMap:this.returnDependencies?ev:null,glyphPositions:this.returnDependencies?eo.positions:null})}},eC=$(eS.glyphDependencies,eo=>Object.keys(eo).map(Number));Object.keys(eC).length?em.send("getGlyphs",{uid:this.uid,stacks:eC},(eo,ec)=>{eg||(eg=eo,ex=ec,m())},void 0,!1,eI):ex={};let eP=Object.keys(eS.iconDependencies);eP.length?em.send("getImages",{icons:eP,source:this.source,tileID:this.tileID,type:"icons"},(eo,ec)=>{eg||(eg=eo,ev=ec,m())},void 0,!1,eI):ev={};let ez=Object.keys(eS.patternDependencies);ez.length?em.send("getImages",{icons:ez,source:this.source,tileID:this.tileID,type:"patterns"},(eo,ec)=>{eg||(eg=eo,eb=ec,m())},void 0,!1,eI):eb={},m()}};function dy(eo,ec,ed){let em=new ws(ec);for(let ec of eo)ec.recalculate(em,ed)}let fy=class fy{constructor(eo){this.entries={},this.scheduler=eo}request(eo,ec,ed,em){let e_=this.entries[eo]=this.entries[eo]||{callbacks:[]};if(e_.result){let[eo,ed]=e_.result;return this.scheduler?this.scheduler.add(()=>{em(eo,ed)},ec):em(eo,ed),()=>{}}return e_.callbacks.push(em),e_.cancel||(e_.cancel=ed((ed,em)=>{for(let eo of(e_.result=[ed,em],e_.callbacks))this.scheduler?this.scheduler.add(()=>{eo(ed,em)},ec):eo(ed,em);setTimeout(()=>delete this.entries[eo],3e3)})),()=>{e_.result||(e_.callbacks=e_.callbacks.filter(eo=>eo!==em),e_.callbacks.length||(e_.cancel(),delete this.entries[eo]))}}};function yy(eo,ec,ed){let em=JSON.stringify(eo.request);return eo.data&&(this.deduped.entries[em]={result:[null,eo.data]}),this.deduped.request(em,{type:"parseTile",isSymbolTile:eo.isSymbolTile,zoom:eo.tileZoom},ec=>{let em=pt(eo.request,(eo,em,e_,eg)=>{eo?ec(eo):em&&ec(null,{vectorTile:ed?void 0:new rh(new rB(em)),rawData:em,cacheControl:e_,expires:eg})});return()=>{em.cancel(),ec()}},ec)}let nt=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];let gy=class gy{static from(eo){if(!(eo instanceof ArrayBuffer))throw Error("Data must be an instance of ArrayBuffer.");let[ec,ed]=new Uint8Array(eo,0,2);if(219!==ec)throw Error("Data does not appear to be in a KDBush format.");let em=ed>>4;if(1!==em)throw Error(`Got v${em} data when expected v1.`);let e_=nt[15&ed];if(!e_)throw Error("Unrecognized array type.");let[eg]=new Uint16Array(eo,2,1),[ex]=new Uint32Array(eo,4,1);return new gy(ex,eg,e_,eo)}constructor(eo,ec=64,ed=Float64Array,em){if(isNaN(eo)||eo<0)throw Error(`Unpexpected numItems value: ${eo}.`);this.numItems=+eo,this.nodeSize=Math.min(Math.max(+ec,2),65535),this.ArrayType=ed,this.IndexArrayType=eo<65536?Uint16Array:Uint32Array;let e_=nt.indexOf(this.ArrayType),eg=2*eo*this.ArrayType.BYTES_PER_ELEMENT,ex=eo*this.IndexArrayType.BYTES_PER_ELEMENT,ev=(8-ex%8)%8;if(e_<0)throw Error(`Unexpected typed array class: ${ed}.`);em&&em instanceof ArrayBuffer?(this.data=em,this.ids=new this.IndexArrayType(this.data,8,eo),this.coords=new this.ArrayType(this.data,8+ex+ev,2*eo),this._pos=2*eo,this._finished=!0):(this.data=new ArrayBuffer(8+eg+ex+ev),this.ids=new this.IndexArrayType(this.data,8,eo),this.coords=new this.ArrayType(this.data,8+ex+ev,2*eo),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+e_]),new Uint16Array(this.data,2,1)[0]=ec,new Uint32Array(this.data,4,1)[0]=eo)}add(eo,ec){let ed=this._pos>>1;return this.ids[ed]=ed,this.coords[this._pos++]=eo,this.coords[this._pos++]=ec,ed}finish(){let eo=this._pos>>1;if(eo!==this.numItems)throw Error(`Added ${eo} items when expected ${this.numItems}.`);return function xy(eo,ec,ed,em,e_,eg){if(e_-em<=ed)return;let ex=em+e_>>1;(function vy(eo,ec,ed,em,e_,eg){for(;e_>em;){if(e_-em>600){let ex=e_-em+1,ev=ed-em+1,eb=Math.log(ex),ew=.5*Math.exp(2*eb/3),eT=.5*Math.sqrt(eb*ew*(ex-ew)/ex)*(ev-ex/2<0?-1:1);vy(eo,ec,ed,Math.max(em,Math.floor(ed-ev*ew/ex+eT)),Math.min(e_,Math.floor(ed+(ex-ev)*ew/ex+eT)),eg)}let ex=ec[2*ed+eg],ev=em,eb=e_;for(by(eo,ec,em,ed),ec[2*e_+eg]>ex&&by(eo,ec,em,e_);ev<eb;){for(by(eo,ec,ev,eb),ev++,eb--;ec[2*ev+eg]<ex;)ev++;for(;ec[2*eb+eg]>ex;)eb--}ec[2*em+eg]===ex?by(eo,ec,em,eb):by(eo,ec,++eb,e_),eb<=ed&&(em=eb+1),ed<=eb&&(e_=eb-1)}})(eo,ec,ex,em,e_,eg),xy(eo,ec,ed,em,ex-1,1-eg),xy(eo,ec,ed,ex+1,e_,1-eg)}(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(eo,ec,ed,em){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:e_,coords:eg,nodeSize:ex}=this,ev=[0,e_.length-1,0],eb=[];for(;ev.length;){let ew=ev.pop()||0,eT=ev.pop()||0,eE=ev.pop()||0;if(eT-eE<=ex){for(let ex=eE;ex<=eT;ex++){let ev=eg[2*ex],ew=eg[2*ex+1];ev>=eo&&ev<=ed&&ew>=ec&&ew<=em&&eb.push(e_[ex])}continue}let eM=eE+eT>>1,eS=eg[2*eM],eA=eg[2*eM+1];eS>=eo&&eS<=ed&&eA>=ec&&eA<=em&&eb.push(e_[eM]),(0===ew?eo<=eS:ec<=eA)&&(ev.push(eE),ev.push(eM-1),ev.push(1-ew)),(0===ew?ed>=eS:em>=eA)&&(ev.push(eM+1),ev.push(eT),ev.push(1-ew))}return eb}within(eo,ec,ed){if(!this._finished)throw Error("Data not yet indexed - call index.finish().");let{ids:em,coords:e_,nodeSize:eg}=this,ex=[0,em.length-1,0],ev=[],eb=ed*ed;for(;ex.length;){let ew=ex.pop()||0,eT=ex.pop()||0,eE=ex.pop()||0;if(eT-eE<=eg){for(let ed=eE;ed<=eT;ed++)_y(e_[2*ed],e_[2*ed+1],eo,ec)<=eb&&ev.push(em[ed]);continue}let eM=eE+eT>>1,eS=e_[2*eM],eA=e_[2*eM+1];_y(eS,eA,eo,ec)<=eb&&ev.push(em[eM]),(0===ew?eo-ed<=eS:ec-ed<=eA)&&(ex.push(eE),ex.push(eM-1),ex.push(1-ew)),(0===ew?eo+ed>=eS:ec+ed>=eA)&&(ex.push(eM+1),ex.push(eT),ex.push(1-ew))}return ev}};function by(eo,ec,ed,em){wy(eo,ed,em),wy(ec,2*ed,2*em),wy(ec,2*ed+1,2*em+1)}function wy(eo,ec,ed){let em=eo[ec];eo[ec]=eo[ed],eo[ed]=em}function _y(eo,ec,ed,em){let e_=eo-ed,eg=ec-em;return e_*e_+eg*eg}eo.ARRAY_TYPE=iz,eo.AUTH_ERR_MSG=eH,eo.Aabb=il,eo.Actor=class{constructor(eo,ec,ed){this.target=eo,this.parent=ec,this.mapId=ed,this.callbacks={},this.cancelCallbacks={},R(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=K()?eo:eM,this.scheduler=new bf}send(eo,ec,ed,em,e_=!1,eg){let ex=Math.round(1e18*Math.random()).toString(36).substring(0,10);ed&&(ed.metadata=eg,this.callbacks[ex]=ed);let ev=H(this.globalScope)?void 0:[];return this.target.postMessage({id:ex,type:eo,hasCallback:!!ed,targetMapId:em,mustQueue:e_,sourceMapId:this.mapId,data:Wi(ec,ev)},ev),{cancel:()=>{ed&&delete this.callbacks[ex],this.target.postMessage({id:ex,type:"<cancel>",targetMapId:em,sourceMapId:this.mapId})}}}receive(eo){let ec=eo.data,ed=ec.id;if(ed&&(!ec.targetMapId||this.mapId===ec.targetMapId)){if("<cancel>"===ec.type){let eo=this.cancelCallbacks[ed];delete this.cancelCallbacks[ed],eo&&eo.cancel()}else if(ec.mustQueue||K()){let eo=this.callbacks[ed];this.cancelCallbacks[ed]=this.scheduler.add(()=>this.processTask(ed,ec),eo&&eo.metadata||{type:"message"})}else this.processTask(ed,ec)}}processTask(eo,ec){if("<response>"===ec.type){let ed=this.callbacks[eo];delete this.callbacks[eo],ed&&(ec.error?ed(Qi(ec.error)):ed(null,Qi(ec.data)))}else{let ed=H(this.globalScope)?void 0:[],em=ec.hasCallback?(ec,em)=>{delete this.cancelCallbacks[eo],this.target.postMessage({id:eo,type:"<response>",sourceMapId:this.mapId,error:ec?Wi(ec):null,data:Wi(em,ed)},ed)}:eo=>{},e_=Qi(ec.data);if(this.parent[ec.type])this.parent[ec.type](ec.sourceMapId,e_,em);else if(this.parent.getWorkerSource){let eo=ec.type.split(".");this.parent.getWorkerSource(ec.sourceMapId,eo[0],e_.source)[eo[1]](e_,em)}else em(Error(`Could not find function ${ec.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},eo.CanonicalTileID=ph,eo.Color=Be,eo.ColorMode=Yf,eo.CullFaceMode=ty,eo.DEMData=Zf,eo.DataConstantProperty=Bs,eo.DedupedRequest=fy,eo.DepthMode=Xf,eo.EXTENT=8192,eo.Elevation=class{isDataAvailableAtPoint(eo){let ec=this._source();if(this.isUsingMockSource()||!ec||eo.y<0||eo.y>1)return!1;let ed=ec.getSource().maxzoom,em=1<<ed,e_=Math.floor(eo.x),eg=Math.floor((eo.x-e_)*em),ex=Math.floor(eo.y*em),ev=this.findDEMTileFor(new fh(ed,e_,ed,eg,ex));return!(!ev||!ev.dem)}getAtPointOrZero(eo,ec=0){return this.getAtPoint(eo,ec)||0}getAtPoint(eo,ec,ed=!0){if(this.isUsingMockSource())return null;null==ec&&(ec=null);let em=this._source();if(!em||eo.y<0||eo.y>1)return ec;let e_=em.getSource().maxzoom,eg=1<<e_,ex=Math.floor(eo.x),ev=eo.x-ex,eb=new fh(e_,ex,e_,Math.floor(ev*eg),Math.floor(eo.y*eg)),ew=this.findDEMTileFor(eb);if(!ew||!ew.dem)return ec;let eT=ew.dem,eE=1<<ew.tileID.canonical.z,eM=(ev*eE-ew.tileID.canonical.x)*eT.dim,eS=(eo.y*eE-ew.tileID.canonical.y)*eT.dim,eA=Math.floor(eM),eI=Math.floor(eS);return(ed?this.exaggeration():1)*Er(Er(eT.get(eA,eI),eT.get(eA,eI+1),eS-eI),Er(eT.get(eA+1,eI),eT.get(eA+1,eI+1),eS-eI),eM-eA)}getAtTileOffset(eo,ec,ed){let em=1<<eo.canonical.z;return this.getAtPointOrZero(new Wl(eo.wrap+(eo.canonical.x+ec/8192)/em,(eo.canonical.y+ed/8192)/em))}getAtTileOffsetFunc(eo,ec,ed,em){return e_=>{let eg=this.getAtTileOffset(eo,e_.x,e_.y),ex=em.upVector(eo.canonical,e_.x,e_.y);return Co(ex,ex,eg*em.upVectorScale(eo.canonical,ec,ed).metersToTile),ex}}getForTilePoints(eo,ec,ed,em){if(this.isUsingMockSource())return!1;let e_=sy.create(this,eo,em);return!!e_&&(ec.forEach(eo=>{eo[2]=this.exaggeration()*e_.getElevationAt(eo[0],eo[1],ed)}),!0)}getMinMaxForTile(eo){if(this.isUsingMockSource())return null;let ec=this.findDEMTileFor(eo);if(!ec||!ec.dem)return null;let ed=ec.dem.tree,em=ec.tileID,e_=1<<eo.canonical.z-em.canonical.z,eg=eo.canonical.x/e_-em.canonical.x,ex=eo.canonical.y/e_-em.canonical.y,ev=0;for(let ec=0;ec<eo.canonical.z-em.canonical.z&&!ed.leaves[ev];ec++){eg*=2,ex*=2;let eo=2*Math.floor(ex)+Math.floor(eg);ev=ed.childOffsets[ev]+eo,eg%=1,ex%=1}return{min:this.exaggeration()*ed.minimums[ev],max:this.exaggeration()*ed.maximums[ev]}}getMinElevationBelowMSL(){throw Error("Pure virtual method called.")}raycast(eo,ec,ed){throw Error("Pure virtual method called.")}pointCoordinate(eo){throw Error("Pure virtual method called.")}_source(){throw Error("Pure virtual method called.")}isUsingMockSource(){throw Error("Pure virtual method called.")}exaggeration(){throw Error("Pure virtual method called.")}findDEMTileFor(eo){throw Error("Pure virtual method called.")}get visibleDemTiles(){throw Error("Getter must be implemented in subclass.")}},eo.ErrorEvent=Wt,eo.EvaluationParameters=ws,eo.Event=Yt,eo.Evented=Qt,eo.FillExtrusionBucket=th,eo.Frustum=nl,eo.FrustumCorners=rl,eo.GLOBE_RADIUS=iB,eo.GLOBE_SCALE_MATCH_LATITUDE=45,eo.GLOBE_ZOOM_THRESHOLD_MAX=6,eo.GLOBE_ZOOM_THRESHOLD_MIN=5,eo.GlobeSharedBuffers=class{constructor(eo){this._createGrid(eo),this._createPoles(eo)}destroy(){for(let eo of(this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy(),this._poleSegments))eo.destroy();for(let eo of this._gridSegments)eo.withSkirts.destroy(),eo.withoutSkirts.destroy();if(this._wireframeIndexBuffer)for(let eo of(this._wireframeIndexBuffer.destroy(),this._wireframeSegments))eo.destroy()}_fillGridMeshWithLods(eo,ec){let ed=new $s,em=new ra,e_=[],eg=eo+1+2,ex=ec[0]+1,ev=ec[0]+1+(1+ec.length),l=(eo,ec,ed)=>{let em=eo===eg-1?eo-2:0===eo?eo:eo-1;return[em+=ed?24575:0,ec]};for(let eo=0;eo<eg;++eo)ed.emplaceBack(...l(eo,0,!0));for(let eo=0;eo<ex;++eo)for(let ec=0;ec<eg;++ec)ed.emplaceBack(...l(ec,eo,0===ec||ec===eg-1));for(let eo=0;eo<ec.length;++eo){let em=ec[eo];for(let eo=0;eo<eg;++eo)ed.emplaceBack(...l(eo,em,!0))}for(let eo=0;eo<ec.length;++eo){let ex=em.length,eb=ec[eo]+1+2,ew=new ra;for(let ed=0;ed<eb-1;ed++){let e_=ed===eb-2,ex=e_?eg*(ev-ec.length+eo-ed):eg;for(let eo=0;eo<eg-1;eo++){let ec=ed*eg+eo;0===ed||e_||0===eo||eo===eg-2?(ew.emplaceBack(ec+1,ec,ec+ex),ew.emplaceBack(ec+ex,ec+ex+1,ec+1)):(em.emplaceBack(ec+1,ec,ec+ex),em.emplaceBack(ec+ex,ec+ex+1,ec+1))}}let eT=so.simpleSegment(0,ex,ed.length,em.length-ex);for(let eo=0;eo<ew.uint16.length;eo+=3)em.emplaceBack(ew.uint16[eo],ew.uint16[eo+1],ew.uint16[eo+2]);let eE=so.simpleSegment(0,ex,ed.length,em.length-ex);e_.push({withoutSkirts:eT,withSkirts:eE})}return{vertices:ed,indices:em,segments:e_}}_createGrid(eo){let ec=this._fillGridMeshWithLods(64,iF);this._gridSegments=ec.segments,this._gridBuffer=eo.createVertexBuffer(ec.vertices,iR.members),this._gridIndexBuffer=eo.createIndexBuffer(ec.indices,!0)}_createPoles(eo){let ec=new ra;for(let eo=0;eo<=64;eo++)ec.emplaceBack(0,eo+1,eo+2);this._poleIndexBuffer=eo.createIndexBuffer(ec,!0);let ed=new aa,em=new aa;this._poleSegments=[];for(let eo=0,ec=0;eo<5;eo++){let e_=360/(1<<eo);ed.emplaceBack(0,-iB,0,.5,0),em.emplaceBack(0,-iB,0,.5,1);for(let eo=0;eo<=64;eo++){let ec=eo/64,eg=Er(0,e_,ec),[ex,ev,eb]=kl(ij,iG,eg,iB);ed.emplaceBack(ex,ev,eb,ec,0),em.emplaceBack(ex,ev,eb,ec,1)}this._poleSegments.push(so.simpleSegment(ec,0,66,64)),ec+=66}this._poleNorthVertexBuffer=eo.createVertexBuffer(ed,ik,!1),this._poleSouthVertexBuffer=eo.createVertexBuffer(em,ik,!1)}getGridBuffers(eo,ec){return[this._gridBuffer,this._gridIndexBuffer,ec?this._gridSegments[eo].withSkirts:this._gridSegments[eo].withoutSkirts]}getPoleBuffers(eo){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[eo]]}getWirefameBuffers(eo,ec){if(!this._wireframeSegments){let ec=new la;this._wireframeSegments=[];for(let eo=0,ed=0;eo<iF.length;eo++){let em=iF[eo];for(let eo=1;eo<em+1;eo++)for(let ed=1;ed<65;ed++){let em=67*eo+ed;ec.emplaceBack(em,em+1),ec.emplaceBack(em,em+67),ec.emplaceBack(em,em+67+1)}let e_=192*em;this._wireframeSegments.push(so.simpleSegment(0,ed,(em+1)*67,e_)),ed+=e_}this._wireframeIndexBuffer=eo.createIndexBuffer(ec)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[ec]]}},eo.GlyphManager=rd,eo.ImagePosition=Sp,eo.KDBush=gy,eo.LivePerformanceUtils={mark(eo){eM.performance.mark(eo)},measure(eo,ec,ed){eM.performance.measure(eo,ec,ed)}},eo.LngLat=iq,eo.LngLatBounds=oo,eo.LocalGlyphMode=rN,eo.MAX_MERCATOR_LATITUDE=85.051129,eo.MercatorCoordinate=Wl,eo.ONE_EM=24,eo.OverscaledTileID=fh,eo.PerformanceMarkers=e8,eo.Point=eL,eo.Properties=Ps,eo.RGBAImage=Uu,eo.Ray=el,eo.RequestManager=class{constructor(eo,ec,ed){this._transformRequestFn=eo,this._customAccessToken=ec,this._silenceAuthErrors=!!ed,this._createSkuToken()}_createSkuToken(){let eo=function(){let eo="";for(let ec=0;ec<10;ec++)eo+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1","01",eo].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=eo.token,this._skuTokenExpiresAt=eo.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(eo,ec){return this._transformRequestFn&&this._transformRequestFn(eo,ec)||{url:eo}}normalizeStyleURL(eo,ec){if(!vt(eo))return eo;let ed=kt(eo);return ed.path=`/styles/v1${ed.path}`,this._makeAPIURL(ed,this._customAccessToken||ec)}normalizeGlyphsURL(eo,ec){if(!vt(eo))return eo;let ed=kt(eo);return ed.path=`/fonts/v1${ed.path}`,this._makeAPIURL(ed,this._customAccessToken||ec)}normalizeSourceURL(eo,ec,ed,em){if(!vt(eo))return eo;let e_=kt(eo);return e_.path=`/v4/${e_.authority}.json`,e_.params.push("secure"),ed&&e_.params.push(`language=${ed}`),em&&e_.params.push(`worldview=${em}`),this._makeAPIURL(e_,this._customAccessToken||ec)}normalizeSpriteURL(eo,ec,ed,em){let e_=kt(eo);return vt(eo)?(e_.path=`/styles/v1${e_.path}/sprite${ec}${ed}`,this._makeAPIURL(e_,this._customAccessToken||em)):(e_.path+=`${ec}${ed}`,It(e_))}normalizeTileURL(eo,ec,ed){if(this._isSkuTokenExpired()&&this._createSkuToken(),eo&&!vt(eo))return eo;let em=kt(eo);em.path=em.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${ec||ed&&"raster"!==em.authority&&512===ed?"@2x":""}${eI.supported?".webp":"$1"}`),"raster"===em.authority?em.path=`/${eA.RASTER_URL_PREFIX}${em.path}`:(em.path=em.path.replace(/^.+\/v4\//,"/"),em.path=`/${eA.TILE_URL_VERSION}${em.path}`);let e_=this._customAccessToken||function(eo){for(let ec of eo){let eo=ec.match(/^access_token=(.*)$/);if(eo)return eo[1]}return null}(em.params)||eA.ACCESS_TOKEN;return eA.REQUIRE_ACCESS_TOKEN&&e_&&this._skuToken&&em.params.push(`sku=${this._skuToken}`),this._makeAPIURL(em,e_)}canonicalizeTileURL(eo,ec){let ed=kt(eo);if(!ed.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!ed.path.match(/\.[\w]+$/))return eo;let em="mapbox://";ed.path.match(/^\/raster\/v1\//)?em+=`raster/${ed.path.replace(`/${eA.RASTER_URL_PREFIX}/`,"")}`:em+=`tiles/${ed.path.replace(`/${eA.TILE_URL_VERSION}/`,"")}`;let e_=ed.params;return ec&&(e_=e_.filter(eo=>!eo.match(/^access_token=/))),e_.length&&(em+=`?${e_.join("&")}`),em}canonicalizeTileset(eo,ec){let ed=!!ec&&vt(ec),em=[];for(let ec of eo.tiles||[])bt(ec)?em.push(this.canonicalizeTileURL(ec,ed)):em.push(ec);return em}_makeAPIURL(eo,ec){let ed="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",em=kt(eA.API_URL);if(eo.protocol=em.protocol,eo.authority=em.authority,"http"===eo.protocol){let ec=eo.params.indexOf("secure");ec>=0&&eo.params.splice(ec,1)}if("/"!==em.path&&(eo.path=`${em.path}${eo.path}`),!eA.REQUIRE_ACCESS_TOKEN)return It(eo);if(ec=ec||eA.ACCESS_TOKEN,!this._silenceAuthErrors){if(!ec)throw Error(`An API access token is required to use Mapbox GL. ${ed}`);if("s"===ec[0])throw Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${ed}`)}return eo.params=eo.params.filter(eo=>-1===eo.indexOf("access_token")),eo.params.push(`access_token=${ec||""}`),It(eo)}},eo.ResourceType=eq,eo.SegmentVector=so,eo.SourceCache=ey,eo.StencilMode=Hf,eo.StructArrayLayout1ui2=ua,eo.StructArrayLayout2f1f2i16=Qs,eo.StructArrayLayout2i4=$s,eo.StructArrayLayout2ui4=la,eo.StructArrayLayout3f12=ea,eo.StructArrayLayout3ui6=ra,eo.StructArrayLayout4i8=Os,eo.StructArrayLayout5f20=aa,eo.Texture=xf,eo.Tile=Pf,eo.Transitionable=Ss,eo.Uniform1f=La,eo.Uniform1i=class extends Va{constructor(eo){super(eo),this.current=0}set(eo,ec,ed){this.fetchUniformLocation(eo,ec)&&this.current!==ed&&(this.current=ed,this.gl.uniform1i(this.location,ed))}},eo.Uniform2f=class extends Va{constructor(eo){super(eo),this.current=[0,0]}set(eo,ec,ed){this.fetchUniformLocation(eo,ec)&&(ed[0]===this.current[0]&&ed[1]===this.current[1]||(this.current=ed,this.gl.uniform2f(this.location,ed[0],ed[1])))}},eo.Uniform3f=class extends Va{constructor(eo){super(eo),this.current=[0,0,0]}set(eo,ec,ed){this.fetchUniformLocation(eo,ec)&&(ed[0]===this.current[0]&&ed[1]===this.current[1]&&ed[2]===this.current[2]||(this.current=ed,this.gl.uniform3f(this.location,ed[0],ed[1],ed[2])))}},eo.Uniform4f=Fa,eo.UniformColor=Ra,eo.UniformMatrix2f=class extends Va{constructor(eo){super(eo),this.current=iE}set(eo,ec,ed){if(this.fetchUniformLocation(eo,ec)){for(let eo=0;eo<4;eo++)if(ed[eo]!==this.current[eo]){this.current=ed,this.gl.uniformMatrix2fv(this.location,!1,ed);break}}}},eo.UniformMatrix3f=class extends Va{constructor(eo){super(eo),this.current=iT}set(eo,ec,ed){if(this.fetchUniformLocation(eo,ec)){for(let eo=0;eo<9;eo++)if(ed[eo]!==this.current[eo]){this.current=ed,this.gl.uniformMatrix3fv(this.location,!1,ed);break}}}},eo.UniformMatrix4f=class extends Va{constructor(eo){super(eo),this.current=iw}set(eo,ec,ed){if(this.fetchUniformLocation(eo,ec)){if(ed[12]!==this.current[12]||ed[0]!==this.current[0])return this.current=ed,void this.gl.uniformMatrix4fv(this.location,!1,ed);for(let eo=1;eo<16;eo++)if(ed[eo]!==this.current[eo]){this.current=ed,this.gl.uniformMatrix4fv(this.location,!1,ed);break}}}},eo.UnwrappedTileID=dh,eo.ValidationError=ri,eo.VectorTileFeature=ru,eo.VectorTileWorkerSource=class extends Qt{constructor(eo,ec,ed,em,e_){super(),this.actor=eo,this.layerIndex=ec,this.availableImages=ed,this.loadVectorData=e_||yy,this.loading={},this.loaded={},this.deduped=new fy(eo.scheduler),this.isSpriteLoaded=em,this.scheduler=eo.scheduler}loadTile(eo,ec){let ed=eo.uid,em=eo&&eo.request,e_=em&&em.collectResourceTiming,eg=this.loading[ed]=new py(eo);eg.abort=this.loadVectorData(eo,(ex,ev)=>{let eb=!this.loading[ed];if(delete this.loading[ed],eb||ex||!ev)return eg.status="done",eb||(this.loaded[ed]=eg),ec(ex);let ew=ev.rawData,eT={};ev.expires&&(eT.expires=ev.expires),ev.cacheControl&&(eT.cacheControl=ev.cacheControl),eg.vectorTile=ev.vectorTile||new rh(new rB(ew));let h=()=>{eg.parse(eg.vectorTile,this.layerIndex,this.availableImages,this.actor,(eo,ed)=>{if(eo||!ed)return ec(eo);let eg={};if(e_){let eo=qt(em);eo.length>0&&(eg.resourceTiming=JSON.parse(JSON.stringify(eo)))}ec(null,C({rawTileData:ew.slice(0)},ed,eT,eg))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:eo.isSymbolTile,zoom:eo.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[ed]=eg})}reloadTile(eo,ec){let ed=this.loaded,em=eo.uid,e_=this;if(ed&&ed[em]){let eg=ed[em];eg.showCollisionBoxes=eo.showCollisionBoxes,eg.enableTerrain=!!eo.enableTerrain,eg.projection=eo.projection,eg.tileTransform=Bd(eo.tileID.canonical,eo.projection);let a=(eo,ed)=>{let em=eg.reloadCallback;em&&(delete eg.reloadCallback,eg.parse(eg.vectorTile,e_.layerIndex,this.availableImages,e_.actor,em)),ec(eo,ed)};"parsing"===eg.status?eg.reloadCallback=a:"done"===eg.status&&(eg.vectorTile?eg.parse(eg.vectorTile,this.layerIndex,this.availableImages,this.actor,a):a())}}abortTile(eo,ec){let ed=eo.uid,em=this.loading[ed];em&&(em.abort&&em.abort(),delete this.loading[ed]),ec()}removeTile(eo,ec){let ed=this.loaded,em=eo.uid;ed&&ed[em]&&delete ed[em],ec()}},eo.WritingMode=rF,eo.ZoomDependentExpression=Wn,eo.add=Mo,eo.addDynamicAttributes=rf,eo.adjoint=function(eo,ec){var ed=ec[0],em=ec[1],e_=ec[2],eg=ec[3],ex=ec[4],ev=ec[5],eb=ec[6],ew=ec[7],eT=ec[8];return eo[0]=ex*eT-ev*ew,eo[1]=e_*ew-em*eT,eo[2]=em*ev-e_*ex,eo[3]=ev*eb-eg*eT,eo[4]=ed*eT-e_*eb,eo[5]=e_*eg-ed*ev,eo[6]=eg*ew-ex*eb,eo[7]=em*eb-ed*ew,eo[8]=ed*ex-em*eg,eo},eo.asyncAll=B,eo.bezier=k,eo.bindAll=R,eo.boundsAttributes=r8,eo.bufferConvexPolygon=function(eo,ec){let ed=[];for(let em=0;em<eo.length;em++){let e_=z(em-1,-1,eo.length-1),eg=z(em+1,-1,eo.length-1),ex=eo[em],ev=eo[eg],eb=eo[e_].sub(ex).unit(),ew=ev.sub(ex).unit(),eT=ew.angleWithSep(eb.x,eb.y),eE=eb.add(ew).unit().mult(-1*ec/Math.sin(eT/2));ed.push(ex.add(eE))}return ed},eo.cacheEntryPossiblyAdded=function(eo){++e$>eZ&&(eo.getActor().send("enforceCacheSizeLimit",eG),e$=0)},eo.calculateGlobeLabelMatrix=function(eo,ec){let{x:ed,y:em}=eo.point,e_=Cl(ed,em,eo.worldSize/eo._pixelsPerMercatorPixel,0,0);return yo(e_,e_,El(xl(ec)))},eo.calculateGlobeMatrix=function(eo){let{x:ec,y:ed}=eo.point,{lng:em,lat:e_}=eo._center;return Cl(ec,ed,eo.worldSize,em,e_)},eo.calculateGlobeMercatorMatrix=function(eo){let ec=eo.pixelsPerMeter,ed=ec/(1/ql(eo.center.lat)),em=po(new Float64Array(16));return mo(em,em,[eo.point.x,eo.point.y,0]),go(em,em,[ed,ed,ec]),Float32Array.from(em)},eo.circumferenceAtLatitude=ql,eo.clamp=M,eo.clearTileCache=function(eo){if(!it())return;let ec=eM.caches.delete(ej);eo&&ec.catch(eo).then(()=>eo())},eo.clipLine=Hp,eo.clone=function(eo){var ec=new iz(16);return ec[0]=eo[0],ec[1]=eo[1],ec[2]=eo[2],ec[3]=eo[3],ec[4]=eo[4],ec[5]=eo[5],ec[6]=eo[6],ec[7]=eo[7],ec[8]=eo[8],ec[9]=eo[9],ec[10]=eo[10],ec[11]=eo[11],ec[12]=eo[12],ec[13]=eo[13],ec[14]=eo[14],ec[15]=eo[15],ec},eo.clone$1=O,eo.collisionCircleLayout=rD,eo.config=eA,eo.conjugate=function(eo,ec){return eo[0]=-ec[0],eo[1]=-ec[1],eo[2]=-ec[2],eo[3]=ec[3],eo},eo.create=function(){var eo=new iz(16);return iz!=Float32Array&&(eo[1]=0,eo[2]=0,eo[3]=0,eo[4]=0,eo[6]=0,eo[7]=0,eo[8]=0,eo[9]=0,eo[11]=0,eo[12]=0,eo[13]=0,eo[14]=0),eo[0]=1,eo[5]=1,eo[10]=1,eo[15]=1,eo},eo.create$1=co,eo.createExpression=Hn,eo.createLayout=Rs,eo.createStyleLayer=function(eo){return"custom"===eo.type?new ff(eo):new r1[eo.type](eo)},eo.cross=Lo,eo.degToRad=function(eo){return eo*eR},eo.distance=function(eo,ec){return Math.hypot(ec[0]-eo[0],ec[1]-eo[1],ec[2]-eo[2])},eo.div=function(eo,ec,ed){return eo[0]=ec[0]/ed[0],eo[1]=ec[1]/ed[1],eo[2]=ec[2]/ed[2],eo},eo.dot=Vo,eo.earthRadius=iZ,eo.ease=eO,eo.easeCubicInOut=S,eo.ecefToLatLng=function([eo,ec,ed]){let em=Math.hypot(eo,ec,ed),e_=Math.atan2(eo,ed),eg=.5*Math.PI-Math.acos(-ec/em);return new iq(e_*eB,eg*eB)},eo.emitValidationErrors=qi,eo.endsWith=U,eo.enforceCacheSizeLimit=function(eo){st(),ed&&ed.then(ec=>{ec.keys().then(ed=>{for(let em=0;em<ed.length-eo;em++)ec.delete(ed[em])})})},eo.evaluateSizeForFeature=jh,eo.evaluateSizeForZoom=Oh,eo.evaluateVariableOffset=xd,eo.evented=t8,eo.exactEquals=function(eo,ec){return eo[0]===ec[0]&&eo[1]===ec[1]&&eo[2]===ec[2]&&eo[3]===ec[3]},eo.exactEquals$1=function(eo,ec){return eo[0]===ec[0]&&eo[1]===ec[1]&&eo[2]===ec[2]},eo.exported=e7,eo.exported$1=eI,eo.extend=C,eo.extend$1=ee,eo.fillExtrusionHeightLift=oh,eo.filterObject=j,eo.fromMat4=function(eo,ec){return eo[0]=ec[0],eo[1]=ec[1],eo[2]=ec[2],eo[3]=ec[4],eo[4]=ec[5],eo[5]=ec[6],eo[6]=ec[8],eo[7]=ec[9],eo[8]=ec[10],eo},eo.fromQuat=function(eo,ec){var ed=ec[0],em=ec[1],e_=ec[2],eg=ec[3],ex=ed+ed,ev=em+em,eb=e_+e_,ew=ed*ex,eT=em*ex,eE=em*ev,eM=e_*ex,eS=e_*ev,eA=e_*eb,eI=eg*ex,eC=eg*ev,eP=eg*eb;return eo[0]=1-eE-eA,eo[1]=eT+eP,eo[2]=eM-eC,eo[3]=0,eo[4]=eT-eP,eo[5]=1-ew-eA,eo[6]=eS+eI,eo[7]=0,eo[8]=eM+eC,eo[9]=eS-eI,eo[10]=1-ew-eE,eo[11]=0,eo[12]=0,eo[13]=0,eo[14]=0,eo[15]=1,eo},eo.fromRotation=function(eo,ec){var ed=Math.sin(ec),em=Math.cos(ec);return eo[0]=em,eo[1]=ed,eo[2]=0,eo[3]=-ed,eo[4]=em,eo[5]=0,eo[6]=0,eo[7]=0,eo[8]=1,eo},eo.fromScaling=bo,eo.furthestTileCorner=function(eo){let ec=Math.round((eo+45+360)%360/90)%4;return eF[ec]},eo.getAABBPointSquareDist=function(eo,ec,ed){let em=0;for(let e_=0;e_<2;++e_){let eg=ed?ed[e_]:0;eo[e_]>eg&&(em+=(eo[e_]-eg)*(eo[e_]-eg)),ec[e_]<eg&&(em+=(eg-ec[e_])*(eg-ec[e_]))}return em},eo.getAnchorAlignment=Rp,eo.getAnchorJustification=bd,eo.getBounds=function(eo){let ec=1/0,ed=1/0,em=-1/0,e_=-1/0;for(let eg of eo)ec=Math.min(ec,eg.x),ed=Math.min(ed,eg.y),em=Math.max(em,eg.x),e_=Math.max(e_,eg.y);return{min:new eL(ec,ed),max:new eL(em,e_)}},eo.getColumn=W,eo.getDefaultExportFromCjs=p,eo.getGridMatrix=function(eo,ec,ed,em){let e_=ec.getNorth(),eg=ec.getSouth(),ex=ec.getWest(),ev=ec.getEast(),eb=1<<eo.z,ew=ev-ex,eT=e_-eg,eE=ew/64,eM=-eT/iF[ed],eS=[0,eE,0,eM,0,0,e_,ex,0];if(eo.z>0){let eo=180/em;ho(eS,eS,[eo/ew+1,0,0,0,eo/eT+1,0,-.5*eo/eE,.5*eo/eM,1])}return eS[2]=eb,eS[5]=eo.x,eS[8]=eo.y,eS},eo.getImage=gt,eo.getJSON=function(eo,ec){return ht(C(eo,{type:"json"}),ec)},eo.getLatitudinalLod=function(eo){eo=M(eo,-80.051129,80.051129)/80.051129*90;let ec=Math.pow(Math.abs(Math.sin(eo*eR)),3);return Math.round(ec*(iF.length-1))},eo.getMapSessionAPI=e4,eo.getPerformanceMeasurement=qt,eo.getProjection=Yd,eo.getRTLTextPluginStatus=xs,eo.getReferrer=eX,eo.getTilePoint=function(eo,{x:ec,y:ed},em=0){return new eL(((ec-em)*eo.scale-eo.x)*8192,(ed*eo.scale-eo.y)*8192)},eo.getTileVec3=function(eo,ec,ed=0){return Io(((ec.x-ed)*eo.scale-eo.x)*8192,(ec.y*eo.scale-eo.y)*8192,ec.z*ql(Xl(ec.y)))},eo.getVideo=function(eo,ec){let ed=eM.document.createElement("video");ed.muted=!0,ed.onloadstart=function(){ec(null,ed)};for(let ec=0;ec<eo.length;ec++){let em=eM.document.createElement("source");(function(eo){let ec=eM.document.createElement("a");return ec.href=eo,ec.protocol===eM.document.location.protocol&&ec.host===eM.document.location.host})(eo[ec])||(ed.crossOrigin="Anonymous"),em.src=eo[ec],ed.appendChild(em)}return{cancel:()=>{}}},eo.globeCenterToScreenPoint=function(eo){let ec=[0,0,0],ed=po(new Float64Array(16));return yo(ed,eo.pixelMatrix,eo.globeMatrix),Fo(ec,ec,ed),new eL(ec[0],ec[1])},eo.globeDenormalizeECEF=El,eo.globeECEFOrigin=function(eo,ec){let ed=[0,0,0];return Fo(ed,ed,Bl(xl(ec.canonical))),Fo(ed,ed,eo),ed},eo.globeMetersToEcef=fl,eo.globeNormalizeECEF=Bl,eo.globePixelsToTileUnits=function(eo,ec){return 8192/(512*Math.pow(2,eo))*Tl(xl(ec))},eo.globePoleMatrixForTile=function(eo,ec,ed){let em=po(new Float64Array(16)),e_=(ec/(1<<eo)-.5)*Math.PI*2;return vo(em,ed.globeMatrix,e_),Float32Array.from(em)},eo.globeTileBounds=xl,eo.globeTiltAtLngLat=Dl,eo.globeToMercatorTransition=Pl,eo.globeUseCustomAntiAliasing=function(eo,ec,ed){let em=Pl(ed.zoom),e_=eo.style.map._antialias,eg=!!ec.extStandardDerivatives,ex=ec.extStandardDerivativesForceOff||eo.terrain&&eo.terrain.exaggeration()>0;return 0===em&&!e_&&!ex&&eg},eo.identity=po,eo.identity$1=Ko,eo.invert=fo,eo.isFullscreen=function(){return!!eM.document.fullscreenElement||!!eM.document.webkitFullscreenElement},eo.isLngLatBehindGlobe=Vl,eo.isMapAuthenticated=function(eo){return e6.has(eo)},eo.isMapboxURL=vt,eo.isSafariWithAntialiasingBug=function(eo){let ec=eo.navigator?eo.navigator.userAgent:null;return!!H(eo)&&ec&&(ec.match("Version/15.4")||ec.match("Version/15.5")||ec.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},eo.latFromMercatorY=Xl,eo.latLngToECEF=Il,eo.len=ko,eo.length=ko,eo.length$1=function(eo){return Math.hypot(eo[0],eo[1],eo[2],eo[3])},eo.lngFromMercatorX=Kl,eo.loadVectorTile=yy,eo.makeRequest=ht,eo.mapValue=function(eo,ec,ed,em,e_){return M((eo-ec)/(ed-ec)*(e_-em)+em,em,e_)},eo.mercatorScale=Yl,eo.mercatorXfromLng=Nl,eo.mercatorYfromLat=Gl,eo.mercatorZfromAltitude=function(eo,ec){return eo/ql(ec)},eo.mul=yo,eo.mul$1=zo,eo.multiply=yo,eo.multiply$1=ho,eo.multiply$2=zo,eo.nextPowerOfTwo=L,eo.normalize=Do,eo.normalize$1=No,eo.normalize$2=No,eo.number=Er,eo.ortho=function(eo,ec,ed,em,e_,eg,ex){var ev=1/(ec-ed),eb=1/(em-e_),ew=1/(eg-ex);return eo[0]=-2*ev,eo[1]=0,eo[2]=0,eo[3]=0,eo[4]=0,eo[5]=-2*eb,eo[6]=0,eo[7]=0,eo[8]=0,eo[9]=0,eo[10]=2*ew,eo[11]=0,eo[12]=(ec+ed)*ev,eo[13]=(e_+em)*eb,eo[14]=(ex+eg)*ew,eo[15]=1,eo},eo.pbf=Yh,eo.perspective=function(eo,ec,ed,em,e_){var eg,ex=1/Math.tan(ec/2);return eo[0]=ex/ed,eo[1]=0,eo[2]=0,eo[3]=0,eo[4]=0,eo[5]=ex,eo[6]=0,eo[7]=0,eo[8]=0,eo[9]=0,eo[11]=-1,eo[12]=0,eo[13]=0,eo[15]=0,null!=e_&&e_!==1/0?(eo[10]=(e_+em)*(eg=1/(em-e_)),eo[14]=2*e_*em*eg):(eo[10]=-1,eo[14]=-2*em),eo},eo.pick=function(eo,ec){let ed={};for(let em=0;em<ec.length;em++){let e_=ec[em];e_ in eo&&(ed[e_]=eo[e_])}return ed},eo.plugin=t9,eo.pointGeometry=g,eo.polesInViewport=function(eo){let ec=po(new Float64Array(16));yo(ec,eo.pixelMatrix,eo.globeMatrix);let ed=[0,iO,0],em=[0,iB,0];return Fo(ed,ed,ec),Fo(em,em,ec),[ed[0]>0&&ed[0]<=eo.width&&ed[1]>0&&ed[1]<=eo.height&&!Vl(eo,new iq(eo.center.lat,90)),em[0]>0&&em[0]<=eo.width&&em[1]>0&&em[1]<=eo.height&&!Vl(eo,new iq(eo.center.lat,-90))]},eo.polygonContainsPoint=bu,eo.polygonIntersectsBox=wu,eo.polygonIntersectsPolygon=hu,eo.polygonizeBounds=function(eo,ec,ed=0,em=!0){let e_=new eL(ed,ed),eg=eo.sub(e_),ex=ec.add(e_),ev=[eg,new eL(ex.x,eg.y),ex,new eL(eg.x,ex.y)];return em&&ev.push(eg.clone()),ev},eo.posAttributes=iR,eo.postMapLoadEvent=e1,eo.postPerformanceEvent=e3,eo.postTurnstileEvent=eQ,eo.potpack=_p,eo.prevPowerOfTwo=function(eo){return eo<=1?1:Math.pow(2,Math.floor(Math.log(eo)/Math.LN2))},eo.radToDeg=function(eo){return eo*eB},eo.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],eo.registerForPluginStateChange=function(eo){return eo({pluginStatus:t4,pluginURL:t6}),t8.on("pluginStateChange",eo),eo},eo.removeAuthState=function(eo){e6.delete(eo)},eo.renderColorRamp=ju,eo.resample=tu,eo.rotateX=xo,eo.rotateX$1=Xo,eo.rotateY=vo,eo.rotateY$1=Jo,eo.rotateZ=function(eo,ec,ed){var em=Math.sin(ed),e_=Math.cos(ed),eg=ec[0],ex=ec[1],ev=ec[2],eb=ec[3],ew=ec[4],eT=ec[5],eE=ec[6],eM=ec[7];return ec!==eo&&(eo[8]=ec[8],eo[9]=ec[9],eo[10]=ec[10],eo[11]=ec[11],eo[12]=ec[12],eo[13]=ec[13],eo[14]=ec[14],eo[15]=ec[15]),eo[0]=eg*e_+ew*em,eo[1]=ex*e_+eT*em,eo[2]=ev*e_+eE*em,eo[3]=eb*e_+eM*em,eo[4]=ew*e_-eg*em,eo[5]=eT*e_-ex*em,eo[6]=eE*e_-ev*em,eo[7]=eM*e_-eb*em,eo},eo.rotateZ$1=function(eo,ec,ed){ed*=.5;var em=ec[0],e_=ec[1],eg=ec[2],ex=ec[3],ev=Math.sin(ed),eb=Math.cos(ed);return eo[0]=em*eb+e_*ev,eo[1]=e_*eb-em*ev,eo[2]=eg*eb+ex*ev,eo[3]=ex*eb-eg*ev,eo},eo.scale=go,eo.scale$1=qo,eo.scale$2=Co,eo.scaleAndAdd=Po,eo.set=function(eo,ec,ed,em){return eo[0]=ec,eo[1]=ed,eo[2]=em,eo},eo.setCacheLimits=function(eo,ec){eG=eo,eZ=ec},eo.setColumn=function(eo,ec,ed){eo[4*ec+0]=ed[0],eo[4*ec+1]=ed[1],eo[4*ec+2]=ed[2],eo[4*ec+3]=ed[3]},eo.setRTLTextPlugin=function(eo,ec,ed=!1){if(t4===t1||t4===t2||t4===t3)throw Error("setRTLTextPlugin cannot be called multiple times.");t6=e7.resolveURL(eo),t4=t1,t5=ec,ms(),ed||vs()},eo.smoothstep=T,eo.spec=tr,eo.squaredLength=function(eo){var ec=eo[0],ed=eo[1],em=eo[2];return ec*ec+ed*ed+em*em},eo.storeAuthState=function(eo,ec){ec?e6.add(eo):e6.delete(eo)},eo.sub=To,eo.subtract=To,eo.symbolSize=rk,eo.tileAABB=function(eo,ec,ed,em,e_,eg,ex,ev,eb){if("globe"===eb.name)return function(eo,ec,ed){let em=ec/eo.worldSize,e_=eo.globeMatrix;if(ed.z<=1){let eo=xl(ed).getCorners();return wl(eo,e_,em),il.fromPoints(eo)}let eg=Al(ed),ex=Sl(eg);wl(ex,e_,em);let ev=Number.MAX_VALUE,eb=[-ev,-ev,-ev],ew=[ev,ev,ev];if(eg.contains(eo.center)){for(let eo of ex)Bo(ew,ew,eo),Eo(eb,eb,eo);eb[2]=0;let ec=eo.point,ed=[ec.x*em,ec.y*em,0];return Bo(ew,ew,ed),Eo(eb,eb,ed),new il(ew,eb)}let eT=[e_[12]*em,e_[13]*em,e_[14]*em],eE=eg.getCenter(),eM=M(eo.center.lat,-85.051129,85.051129),eS=M(eE.lat,-85.051129,85.051129),eA=Nl(eo.center.lng),eI=Gl(eM),eC=eA-Nl(eE.lng),eP=eI-Gl(eS);eC>.5?eC-=1:eC<-.5&&(eC+=1);let ez=0;Math.abs(eC)>Math.abs(eP)?ez=eC>=0?1:3:(ez=eP>=0?0:2,Po(eT,eT,[e_[4]*em,e_[5]*em,e_[6]*em],-Math.sin((eP>=0?eg.getSouth():eg.getNorth())*eR)*iB));let eD=ex[ez],ek=ex[(ez+1)%4],eL=new ml(eD,ek,eT),eB=[gl(eL,0)||eD[0],gl(eL,1)||eD[1],gl(eL,2)||eD[2]],eF=Pl(eo.zoom);if(eF>0){let em=function({x:eo,y:ec,z:ed},em,e_,eg,ex){let ev=1/(1<<ed),eb=eo*ev,ew=eb+ev,eT=ec*ev,eE=eT+ev,eM=0,eS=(eb+ew)/2-eg;return eS>.5?eM=-1:eS<-.5&&(eM=1),eb=((eb+eM)*em-(eg*=em))*e_+eg,ew=((ew+eM)*em-eg)*e_+eg,eT=(eT*em-(ex*=em))*e_+ex,[[eb,eE=(eE*em-ex)*e_+ex,0],[ew,eE,0],[ew,eT,0],[eb,eT,0]]}(ed,ec,eo._pixelsPerMercatorPixel,eA,eI);for(let eo=0;eo<ex.length;eo++)vl(ex[eo],em[eo],eF);let e_=Mo([],em[ez],em[(ez+1)%4]);Co(e_,e_,.5),vl(eB,e_,eF)}for(let eo of ex)Bo(ew,ew,eo),Eo(eb,eb,eo);return ew[2]=Math.min(eD[2],ek[2]),Bo(ew,ew,eB),Eo(eb,eb,eB),new il(ew,eb)}(eo,ec,new ph(ed,em,e_));let ew=Bd({z:ed,x:em,y:e_},eb);return new il([(eg+ew.x/ew.scale)*ec,ec*(ew.y/ew.scale),ex],[(eg+ew.x2/ew.scale)*ec,ec*(ew.y2/ew.scale),ev])},eo.tileCornersToBounds=Al,eo.tileTransform=Bd,eo.transformMat3=function(eo,ec,ed){var em=ec[0],e_=ec[1],eg=ec[2];return eo[0]=em*ed[0]+e_*ed[3]+eg*ed[6],eo[1]=em*ed[1]+e_*ed[4]+eg*ed[7],eo[2]=em*ed[2]+e_*ed[5]+eg*ed[8],eo},eo.transformMat4=Fo,eo.transformMat4$1=Go,eo.transformQuat=Ro,eo.transitionTileAABBinECEF=bl,eo.translate=mo,eo.transpose=function(eo,ec){if(eo===ec){var ed=ec[1],em=ec[2],e_=ec[5];eo[1]=ec[3],eo[2]=ec[6],eo[3]=ed,eo[5]=ec[7],eo[6]=em,eo[7]=e_}else eo[0]=ec[0],eo[1]=ec[3],eo[2]=ec[6],eo[3]=ec[1],eo[4]=ec[4],eo[5]=ec[7],eo[6]=ec[2],eo[7]=ec[5],eo[8]=ec[8];return eo},eo.triggerPluginCompletionEvent=ys,eo.uniqueId=D,eo.updateGlobeVertexNormal=function(eo,ec,ed,em,e_){let eg=5*ec+2;eo.float32[eg+0]=ed,eo.float32[eg+1]=em,eo.float32[eg+2]=e_},eo.validateCustomStyleLayer=function(eo){let ec=[],ed=eo.id;return void 0===ed&&ec.push({message:`layers.${ed}: missing required property "id"`}),void 0===eo.render&&ec.push({message:`layers.${ed}: missing required method "render"`}),eo.renderingMode&&"2d"!==eo.renderingMode&&"3d"!==eo.renderingMode&&ec.push({message:`layers.${ed}: property "renderingMode" must be either "2d" or "3d"`}),ec},eo.validateFilter=eo=>Oi(Ai(eo)),eo.validateFog=eo=>Oi(Vi(eo)),eo.validateLayer=eo=>Oi(Ti(eo)),eo.validateLight=eo=>Oi(Pi(eo)),eo.validateSource=eo=>Oi(Ei(eo)),eo.validateStyle=Ui,eo.validateTerrain=eo=>Oi(Di(eo)),eo.values=E,eo.vectorTile=rs,eo.version=eS,eo.warnOnce=N,eo.window=eM,eo.wrap=z}),define(["./shared"],function(eo){let o=class o{constructor(eo){this.keyCache={},eo&&this.replace(eo)}replace(eo){this._layerConfigs={},this._layers={},this.update(eo,[])}update(ec,ed){for(let ed of ec)this._layerConfigs[ed.id]=ed,(this._layers[ed.id]=eo.createStyleLayer(ed)).compileFilter(),this.keyCache[ed.id]&&delete this.keyCache[ed.id];for(let eo of ed)delete this.keyCache[eo],delete this._layerConfigs[eo],delete this._layers[eo];this.familiesBySource={};let em=function(ec,ed){let em={};for(let e_=0;e_<ec.length;e_++){let eg=ed&&ed[ec[e_].id]||function(ec){let ed="";for(let em of eo.refProperties)ed+=`/${function t(eo){if("number"==typeof eo||"boolean"==typeof eo||"string"==typeof eo||null==eo)return JSON.stringify(eo);if(Array.isArray(eo)){let ec="[";for(let ed of eo)ec+=`${t(ed)},`;return`${ec}]`}let ec="{";for(let ed of Object.keys(eo).sort())ec+=`${ed}:${t(eo[ed])},`;return`${ec}}`}(ec[em])}`;return ed}(ec[e_]);ed&&(ed[ec[e_].id]=eg);let ex=em[eg];ex||(ex=em[eg]=[]),ex.push(ec[e_])}let e_=[];for(let eo in em)e_.push(em[eo]);return e_}(eo.values(this._layerConfigs),this.keyCache);for(let eo of em){let ec=eo.map(eo=>this._layers[eo.id]),ed=ec[0];if("none"===ed.visibility)continue;let em=ed.source||"",e_=this.familiesBySource[em];e_||(e_=this.familiesBySource[em]={});let eg=ed.sourceLayer||"_geojsonTileLayer",ex=e_[eg];ex||(ex=e_[eg]=[]),ex.push(ec)}}};let i=class i{loadTile(ec,ed){let{uid:em,encoding:e_,rawImageData:eg,padding:ex,buildQuadTree:ev}=ec,eb=eo.window.ImageBitmap&&eg instanceof eo.window.ImageBitmap?this.getImageData(eg,ex):eg;ed(null,new eo.DEMData(em,eb,e_,ex<1,ev))}getImageData(eo,ec){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(eo.width,eo.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=eo.width,this.offscreenCanvas.height=eo.height,this.offscreenCanvasContext.drawImage(eo,0,0,eo.width,eo.height);let ed=this.offscreenCanvasContext.getImageData(-ec,-ec,eo.width+2*ec,eo.height+2*ec);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ed}};function n(eo,ec){if(0!==eo.length){s(eo[0],ec);for(var ed=1;ed<eo.length;ed++)s(eo[ed],!ec)}}function s(eo,ec){for(var ed=0,em=0,e_=0,eg=eo.length,ex=eg-1;e_<eg;ex=e_++){var ev=(eo[e_][0]-eo[ex][0])*(eo[ex][1]+eo[e_][1]),eb=ed+ev;em+=Math.abs(ed)>=Math.abs(ev)?ed-eb+ev:ev-eb+ed,ed=eb}ed+em>=0!=!!ec&&eo.reverse()}var ec,ed=eo.getDefaultExportFromCjs(function e(eo,ec){var ed,em=eo&&eo.type;if("FeatureCollection"===em)for(ed=0;ed<eo.features.length;ed++)e(eo.features[ed],ec);else if("GeometryCollection"===em)for(ed=0;ed<eo.geometries.length;ed++)e(eo.geometries[ed],ec);else if("Feature"===em)e(eo.geometry,ec);else if("Polygon"===em)n(eo.coordinates,ec);else if("MultiPolygon"===em)for(ed=0;ed<eo.coordinates.length;ed++)n(eo.coordinates[ed],ec);return eo});let em=eo.VectorTileFeature.prototype.toGeoJSON;var e_={exports:{}},eg=eo.pointGeometry,ex=eo.vectorTile.VectorTileFeature;function p(eo,ec){this.options=ec||{},this.features=eo,this.length=eo.length}function g(eo,ec){this.id="number"==typeof eo.id?eo.id:void 0,this.type=eo.type,this.rawGeometry=1===eo.type?[eo.geometry]:eo.geometry,this.properties=eo.tags,this.extent=ec||4096}p.prototype.feature=function(eo){return new g(this.features[eo],this.options.extent)},g.prototype.loadGeometry=function(){var eo=this.rawGeometry;this.geometry=[];for(var ec=0;ec<eo.length;ec++){for(var ed=eo[ec],em=[],e_=0;e_<ed.length;e_++)em.push(new eg(ed[e_][0],ed[e_][1]));this.geometry.push(em)}return this.geometry},g.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var eo=this.geometry,ec=1/0,ed=-1/0,em=1/0,e_=-1/0,eg=0;eg<eo.length;eg++)for(var ex=eo[eg],ev=0;ev<ex.length;ev++){var eb=ex[ev];ec=Math.min(ec,eb.x),ed=Math.max(ed,eb.x),em=Math.min(em,eb.y),e_=Math.max(e_,eb.y)}return[ec,em,ed,e_]},g.prototype.toGeoJSON=ex.prototype.toGeoJSON;var ev=eo.pbf;function y(eo){var ec=new ev;return function(eo,ec){for(var ed in eo.layers)ec.writeMessage(3,v,eo.layers[ed])}(eo,ec),ec.finish()}function v(eo,ec){ec.writeVarintField(15,eo.version||1),ec.writeStringField(1,eo.name||""),ec.writeVarintField(5,eo.extent||4096);var ed,em={keys:[],values:[],keycache:{},valuecache:{}};for(ed=0;ed<eo.length;ed++)em.feature=eo.feature(ed),ec.writeMessage(2,x,em);var e_=em.keys;for(ed=0;ed<e_.length;ed++)ec.writeStringField(3,e_[ed]);var eg=em.values;for(ed=0;ed<eg.length;ed++)ec.writeMessage(4,b,eg[ed])}function x(eo,ec){var ed=eo.feature;void 0!==ed.id&&ec.writeVarintField(1,ed.id),ec.writeMessage(2,w,eo),ec.writeVarintField(3,ed.type),ec.writeMessage(4,P,ed)}function w(eo,ec){var ed=eo.feature,em=eo.keys,e_=eo.values,eg=eo.keycache,ex=eo.valuecache;for(var ev in ed.properties){var eb=ed.properties[ev],ew=eg[ev];if(null!==eb){void 0===ew&&(em.push(ev),eg[ev]=ew=em.length-1),ec.writeVarint(ew);var eT=typeof eb;"string"!==eT&&"boolean"!==eT&&"number"!==eT&&(eb=JSON.stringify(eb));var eE=eT+":"+eb,eM=ex[eE];void 0===eM&&(e_.push(eb),ex[eE]=eM=e_.length-1),ec.writeVarint(eM)}}}function P(eo,ec){for(var ed=eo.loadGeometry(),em=eo.type,e_=0,eg=0,ex=ed.length,ev=0;ev<ex;ev++){var eb=ed[ev],ew=1;1===em&&(ew=eb.length),ec.writeVarint((ew<<3)+1);for(var eT=3===em?eb.length-1:eb.length,eE=0;eE<eT;eE++){1===eE&&1!==em&&ec.writeVarint((eT-1<<3)+2);var eM=eb[eE].x-e_,eS=eb[eE].y-eg;ec.writeVarint(eM<<1^eM>>31),ec.writeVarint(eS<<1^eS>>31),e_+=eM,eg+=eS}3===em&&ec.writeVarint(15)}}function b(eo,ec){var ed=typeof eo;"string"===ed?ec.writeStringField(1,eo):"boolean"===ed?ec.writeBooleanField(7,eo):"number"===ed&&(eo%1!=0?ec.writeDoubleField(3,eo):eo<0?ec.writeSVarintField(6,eo):ec.writeVarintField(5,eo))}e_.exports=y,e_.exports.fromVectorTileJs=y,e_.exports.fromGeojsonVt=function(eo,ec){ec=ec||{};var ed={};for(var em in eo)ed[em]=new p(eo[em].features,ec),ed[em].name=em,ed[em].version=ec.version,ed[em].extent=ec.extent;return y({layers:ed})},e_.exports.GeoJSONWrapper=p;var eb=eo.getDefaultExportFromCjs(e_.exports);let ew={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:eo=>eo},eT=Math.fround||(ec=new Float32Array(1),eo=>(ec[0]=+eo,ec[0]));let E=class E{constructor(eo){this.options=Object.assign(Object.create(ew),eo),this.trees=Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(eo){let{log:ec,minZoom:ed,maxZoom:em}=this.options;ec&&console.time("total time");let e_=`prepare ${eo.length} points`;ec&&console.time(e_),this.points=eo;let eg=[];for(let ec=0;ec<eo.length;ec++){let ed=eo[ec];if(!ed.geometry)continue;let[em,e_]=ed.geometry.coordinates,ex=eT(N(em)),ev=eT(Z(e_));eg.push(ex,ev,1/0,ec,-1,1),this.options.reduce&&eg.push(0)}let ex=this.trees[em+1]=this._createTree(eg);ec&&console.timeEnd(e_);for(let eo=em;eo>=ed;eo--){let ed=+Date.now();ex=this.trees[eo]=this._createTree(this._cluster(ex,eo)),ec&&console.log("z%d: %d clusters in %dms",eo,ex.numItems,+Date.now()-ed)}return ec&&console.timeEnd("total time"),this}getClusters(eo,ec){let ed=((eo[0]+180)%360+360)%360-180,em=Math.max(-90,Math.min(90,eo[1])),e_=180===eo[2]?180:((eo[2]+180)%360+360)%360-180,eg=Math.max(-90,Math.min(90,eo[3]));if(eo[2]-eo[0]>=360)ed=-180,e_=180;else if(ed>e_){let eo=this.getClusters([ed,em,180,eg],ec),ex=this.getClusters([-180,em,e_,eg],ec);return eo.concat(ex)}let ex=this.trees[this._limitZoom(ec)],ev=ex.range(N(ed),Z(eg),N(e_),Z(em)),eb=ex.data,ew=[];for(let eo of ev){let ec=this.stride*eo;ew.push(eb[ec+5]>1?j(eb,ec,this.clusterProps):this.points[eb[ec+3]])}return ew}getChildren(eo){let ec=this._getOriginId(eo),ed=this._getOriginZoom(eo),em="No cluster with the specified id.",e_=this.trees[ed];if(!e_)throw Error(em);let eg=e_.data;if(ec*this.stride>=eg.length)throw Error(em);let ex=this.options.radius/(this.options.extent*Math.pow(2,ed-1)),ev=e_.within(eg[ec*this.stride],eg[ec*this.stride+1],ex),eb=[];for(let ec of ev){let ed=ec*this.stride;eg[ed+4]===eo&&eb.push(eg[ed+5]>1?j(eg,ed,this.clusterProps):this.points[eg[ed+3]])}if(0===eb.length)throw Error(em);return eb}getLeaves(eo,ec,ed){let em=[];return this._appendLeaves(em,eo,ec=ec||10,ed=ed||0,0),em}getTile(eo,ec,ed){let em=this.trees[this._limitZoom(eo)],e_=Math.pow(2,eo),{extent:eg,radius:ex}=this.options,ev=ex/eg,eb=(ed-ev)/e_,ew=(ed+1+ev)/e_,eT={features:[]};return this._addTileFeatures(em.range((ec-ev)/e_,eb,(ec+1+ev)/e_,ew),em.data,ec,ed,e_,eT),0===ec&&this._addTileFeatures(em.range(1-ev/e_,eb,1,ew),em.data,e_,ed,e_,eT),ec===e_-1&&this._addTileFeatures(em.range(0,eb,ev/e_,ew),em.data,-1,ed,e_,eT),eT.features.length?eT:null}getClusterExpansionZoom(eo){let ec=this._getOriginZoom(eo)-1;for(;ec<=this.options.maxZoom;){let ed=this.getChildren(eo);if(ec++,1!==ed.length)break;eo=ed[0].properties.cluster_id}return ec}_appendLeaves(eo,ec,ed,em,e_){let eg=this.getChildren(ec);for(let ec of eg){let eg=ec.properties;if(eg&&eg.cluster?e_+eg.point_count<=em?e_+=eg.point_count:e_=this._appendLeaves(eo,eg.cluster_id,ed,em,e_):e_<em?e_++:eo.push(ec),eo.length===ed)break}return e_}_createTree(ec){let ed=new eo.KDBush(ec.length/this.stride|0,this.options.nodeSize,Float32Array);for(let eo=0;eo<ec.length;eo+=this.stride)ed.add(ec[eo],ec[eo+1]);return ed.finish(),ed.data=ec,ed}_addTileFeatures(eo,ec,ed,em,e_,eg){for(let ex of eo){let eo,ev,eb,ew;let eT=ex*this.stride,eE=ec[eT+5]>1;if(eE)eo=F(ec,eT,this.clusterProps),ev=ec[eT],eb=ec[eT+1];else{let ed=this.points[ec[eT+3]];eo=ed.properties;let[em,e_]=ed.geometry.coordinates;ev=N(em),eb=Z(e_)}let eM={type:1,geometry:[[Math.round(this.options.extent*(ev*e_-ed)),Math.round(this.options.extent*(eb*e_-em))]],tags:eo};void 0!==(ew=eE||this.options.generateId?ec[eT+3]:this.points[ec[eT+3]].id)&&(eM.id=ew),eg.features.push(eM)}}_limitZoom(eo){return Math.max(this.options.minZoom,Math.min(Math.floor(+eo),this.options.maxZoom+1))}_cluster(eo,ec){let{radius:ed,extent:em,reduce:e_,minPoints:eg}=this.options,ex=ed/(em*Math.pow(2,ec)),ev=eo.data,eb=[],ew=this.stride;for(let ed=0;ed<ev.length;ed+=ew){if(ev[ed+2]<=ec)continue;ev[ed+2]=ec;let em=ev[ed],eT=ev[ed+1],eE=eo.within(ev[ed],ev[ed+1],ex),eM=ev[ed+5],eS=eM;for(let eo of eE){let ed=eo*ew;ev[ed+2]>ec&&(eS+=ev[ed+5])}if(eS>eM&&eS>=eg){let eo,eg=em*eM,ex=eT*eM,eA=-1,eI=((ed/ew|0)<<5)+(ec+1)+this.points.length;for(let em of eE){let eb=em*ew;if(ev[eb+2]<=ec)continue;ev[eb+2]=ec;let eT=ev[eb+5];eg+=ev[eb]*eT,ex+=ev[eb+1]*eT,ev[eb+4]=eI,e_&&(eo||(eo=this._map(ev,ed,!0),eA=this.clusterProps.length,this.clusterProps.push(eo)),e_(eo,this._map(ev,eb)))}ev[ed+4]=eI,eb.push(eg/eS,ex/eS,1/0,eI,-1,eS),e_&&eb.push(eA)}else{for(let eo=0;eo<ew;eo++)eb.push(ev[ed+eo]);if(eS>1)for(let eo of eE){let ed=eo*ew;if(!(ev[ed+2]<=ec)){ev[ed+2]=ec;for(let eo=0;eo<ew;eo++)eb.push(ev[ed+eo])}}}}return eb}_getOriginId(eo){return eo-this.points.length>>5}_getOriginZoom(eo){return(eo-this.points.length)%32}_map(eo,ec,ed){if(eo[ec+5]>1){let em=this.clusterProps[eo[ec+6]];return ed?Object.assign({},em):em}let em=this.points[eo[ec+3]].properties,e_=this.options.map(em);return ed&&e_===em?Object.assign({},e_):e_}};function j(eo,ec,ed){return{type:"Feature",id:eo[ec+3],properties:F(eo,ec,ed),geometry:{type:"Point",coordinates:[360*(eo[ec]-.5),function(eo){let ec=(180-360*eo)*Math.PI/180;return 360*Math.atan(Math.exp(ec))/Math.PI-90}(eo[ec+1])]}}}function F(eo,ec,ed){let em=eo[ec+5],e_=em>=1e4?`${Math.round(em/1e3)}k`:em>=1e3?Math.round(em/100)/10+"k":em,eg=eo[ec+6],ex=-1===eg?{}:Object.assign({},ed[eg]);return Object.assign(ex,{cluster:!0,cluster_id:eo[ec+3],point_count:em,point_count_abbreviated:e_})}function N(eo){return eo/360+.5}function Z(eo){let ec=Math.sin(eo*Math.PI/180),ed=.5-.25*Math.log((1+ec)/(1-ec))/Math.PI;return ed<0?0:ed>1?1:ed}function W(eo,ec,ed,em){var e_={id:void 0===eo?null:eo,type:ec,geometry:ed,tags:em,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(eo){var ec=eo.geometry,ed=eo.type;if("Point"===ed||"MultiPoint"===ed||"LineString"===ed)Y(eo,ec);else if("Polygon"===ed||"MultiLineString"===ed)for(var em=0;em<ec.length;em++)Y(eo,ec[em]);else if("MultiPolygon"===ed)for(em=0;em<ec.length;em++)for(var e_=0;e_<ec[em].length;e_++)Y(eo,ec[em][e_])}(e_),e_}function Y(eo,ec){for(var ed=0;ed<ec.length;ed+=3)eo.minX=Math.min(eo.minX,ec[ed]),eo.minY=Math.min(eo.minY,ec[ed+1]),eo.maxX=Math.max(eo.maxX,ec[ed]),eo.maxY=Math.max(eo.maxY,ec[ed+1])}function X(eo,ec,ed,em){if(ec.geometry){var e_=ec.geometry.coordinates,eg=ec.geometry.type,ex=Math.pow(ed.tolerance/((1<<ed.maxZoom)*ed.extent),2),ev=[],eb=ec.id;if(ed.promoteId?eb=ec.properties[ed.promoteId]:ed.generateId&&(eb=em||0),"Point"===eg)V(e_,ev);else if("MultiPoint"===eg)for(var ew=0;ew<e_.length;ew++)V(e_[ew],ev);else if("LineString"===eg)D(e_,ev,ex,!1);else if("MultiLineString"===eg){if(ed.lineMetrics){for(ew=0;ew<e_.length;ew++)D(e_[ew],ev=[],ex,!1),eo.push(W(eb,"LineString",ev,ec.properties));return}$(e_,ev,ex,!1)}else if("Polygon"===eg)$(e_,ev,ex,!0);else{if("MultiPolygon"!==eg){if("GeometryCollection"===eg){for(ew=0;ew<ec.geometry.geometries.length;ew++)X(eo,{id:eb,geometry:ec.geometry.geometries[ew],properties:ec.properties},ed,em);return}throw Error("Input data is not a valid GeoJSON object.")}for(ew=0;ew<e_.length;ew++){var eT=[];$(e_[ew],eT,ex,!0),ev.push(eT)}}eo.push(W(eb,eg,ev,ec.properties))}}function V(eo,ec){var ed;ec.push(eo[0]/360+.5),ec.push(B(eo[1])),ec.push(0)}function D(eo,ec,ed,em){for(var e_,eg,ex=0,ev=0;ev<eo.length;ev++){var eb,ew=eo[ev][0]/360+.5,eT=B(eo[ev][1]);ec.push(ew),ec.push(eT),ec.push(0),ev>0&&(ex+=em?(e_*eT-ew*eg)/2:Math.sqrt(Math.pow(ew-e_,2)+Math.pow(eT-eg,2))),e_=ew,eg=eT}var eE=ec.length-3;ec[2]=1,function z(eo,ec,ed,em){for(var e_,eg=em,ex=ed-ec>>1,ev=ed-ec,eb=eo[ec],ew=eo[ec+1],eT=eo[ed],eE=eo[ed+1],eM=ec+3;eM<ed;eM+=3){var eS=function(eo,ec,ed,em,e_,eg){var ex=e_-ed,ev=eg-em;if(0!==ex||0!==ev){var eb=((eo-ed)*ex+(ec-em)*ev)/(ex*ex+ev*ev);eb>1?(ed=e_,em=eg):eb>0&&(ed+=ex*eb,em+=ev*eb)}return(ex=eo-ed)*ex+(ev=ec-em)*ev}(eo[eM],eo[eM+1],eb,ew,eT,eE);if(eS>eg)e_=eM,eg=eS;else if(eS===eg){var eA=Math.abs(eM-ex);eA<ev&&(e_=eM,ev=eA)}}eg>em&&(e_-ec>3&&z(eo,ec,e_,em),eo[e_+2]=eg,ed-e_>3&&z(eo,e_,ed,em))}(ec,0,eE,ed),ec[eE+2]=1,ec.size=Math.abs(ex),ec.start=0,ec.end=ec.size}function $(eo,ec,ed,em){for(var e_=0;e_<eo.length;e_++){var eg=[];D(eo[e_],eg,ed,em),ec.push(eg)}}function B(eo){var ec=Math.sin(eo*Math.PI/180),ed=.5-.25*Math.log((1+ec)/(1-ec))/Math.PI;return ed<0?0:ed>1?1:ed}function R(eo,ec,ed,em,e_,eg,ex,ev){if(em/=ec,eg>=(ed/=ec)&&ex<em)return eo;if(ex<ed||eg>=em)return null;for(var eb=[],ew=0;ew<eo.length;ew++){var eT=eo[ew],eE=eT.geometry,eM=eT.type,eS=0===e_?eT.minX:eT.minY,eA=0===e_?eT.maxX:eT.maxY;if(eS>=ed&&eA<em)eb.push(eT);else if(!(eA<ed||eS>=em)){var eI=[];if("Point"===eM||"MultiPoint"===eM)(function(eo,ec,ed,em,e_){for(var eg=0;eg<eo.length;eg+=3){var ex=eo[eg+e_];ex>=ed&&ex<=em&&(ec.push(eo[eg]),ec.push(eo[eg+1]),ec.push(eo[eg+2]))}})(eE,eI,ed,em,e_);else if("LineString"===eM)Q(eE,eI,ed,em,e_,!1,ev.lineMetrics);else if("MultiLineString"===eM)K(eE,eI,ed,em,e_,!1);else if("Polygon"===eM)K(eE,eI,ed,em,e_,!0);else if("MultiPolygon"===eM)for(var eC=0;eC<eE.length;eC++){var eP=[];K(eE[eC],eP,ed,em,e_,!0),eP.length&&eI.push(eP)}if(eI.length){if(ev.lineMetrics&&"LineString"===eM){for(eC=0;eC<eI.length;eC++)eb.push(W(eT.id,eM,eI[eC],eT.tags));continue}"LineString"!==eM&&"MultiLineString"!==eM||(1===eI.length?(eM="LineString",eI=eI[0]):eM="MultiLineString"),"Point"!==eM&&"MultiPoint"!==eM||(eM=3===eI.length?"Point":"MultiPoint"),eb.push(W(eT.id,eM,eI,eT.tags))}}}return eb.length?eb:null}function Q(eo,ec,ed,em,e_,eg,ex){for(var ev,eb,ew=U(eo),eT=0===e_?ee:te,eE=eo.start,eM=0;eM<eo.length-3;eM+=3){var eS=eo[eM],eA=eo[eM+1],eI=eo[eM+2],eC=eo[eM+3],eP=eo[eM+4],ez=0===e_?eS:eA,eD=0===e_?eC:eP,ek=!1;ex&&(ev=Math.sqrt(Math.pow(eS-eC,2)+Math.pow(eA-eP,2))),ez<ed?eD>ed&&(eb=eT(ew,eS,eA,eC,eP,ed),ex&&(ew.start=eE+ev*eb)):ez>em?eD<em&&(eb=eT(ew,eS,eA,eC,eP,em),ex&&(ew.start=eE+ev*eb)):H(ew,eS,eA,eI),eD<ed&&ez>=ed&&(eb=eT(ew,eS,eA,eC,eP,ed),ek=!0),eD>em&&ez<=em&&(eb=eT(ew,eS,eA,eC,eP,em),ek=!0),!eg&&ek&&(ex&&(ew.end=eE+ev*eb),ec.push(ew),ew=U(eo)),ex&&(eE+=ev)}var eL=eo.length-3;eS=eo[eL],eA=eo[eL+1],eI=eo[eL+2],(ez=0===e_?eS:eA)>=ed&&ez<=em&&H(ew,eS,eA,eI),eL=ew.length-3,eg&&eL>=3&&(ew[eL]!==ew[0]||ew[eL+1]!==ew[1])&&H(ew,ew[0],ew[1],ew[2]),ew.length&&ec.push(ew)}function U(eo){var ec=[];return ec.size=eo.size,ec.start=eo.start,ec.end=eo.end,ec}function K(eo,ec,ed,em,e_,eg){for(var ex=0;ex<eo.length;ex++)Q(eo[ex],ec,ed,em,e_,eg,!1)}function H(eo,ec,ed,em){eo.push(ec),eo.push(ed),eo.push(em)}function ee(eo,ec,ed,em,e_,eg){var ex=(eg-ec)/(em-ec);return eo.push(eg),eo.push(ed+(e_-ed)*ex),eo.push(1),ex}function te(eo,ec,ed,em,e_,eg){var ex=(eg-ed)/(e_-ed);return eo.push(ec+(em-ec)*ex),eo.push(eg),eo.push(1),ex}function re(eo,ec){for(var ed=[],em=0;em<eo.length;em++){var e_,eg=eo[em],ex=eg.type;if("Point"===ex||"MultiPoint"===ex||"LineString"===ex)e_=oe(eg.geometry,ec);else if("MultiLineString"===ex||"Polygon"===ex){e_=[];for(var ev=0;ev<eg.geometry.length;ev++)e_.push(oe(eg.geometry[ev],ec))}else if("MultiPolygon"===ex)for(e_=[],ev=0;ev<eg.geometry.length;ev++){for(var eb=[],ew=0;ew<eg.geometry[ev].length;ew++)eb.push(oe(eg.geometry[ev][ew],ec));e_.push(eb)}ed.push(W(eg.id,ex,e_,eg.tags))}return ed}function oe(eo,ec){var ed=[];ed.size=eo.size,void 0!==eo.start&&(ed.start=eo.start,ed.end=eo.end);for(var em=0;em<eo.length;em+=3)ed.push(eo[em]+ec,eo[em+1],eo[em+2]);return ed}function ie(eo,ec){if(eo.transformed)return eo;var ed,em,e_,eg=1<<eo.z,ex=eo.x,ev=eo.y;for(ed=0;ed<eo.features.length;ed++){var eb=eo.features[ed],ew=eb.geometry,eT=eb.type;if(eb.geometry=[],1===eT)for(em=0;em<ew.length;em+=2)eb.geometry.push(ne(ew[em],ew[em+1],ec,eg,ex,ev));else for(em=0;em<ew.length;em++){var eE=[];for(e_=0;e_<ew[em].length;e_+=2)eE.push(ne(ew[em][e_],ew[em][e_+1],ec,eg,ex,ev));eb.geometry.push(eE)}}return eo.transformed=!0,eo}function ne(eo,ec,ed,em,e_,eg){return[Math.round(ed*(eo*em-e_)),Math.round(ed*(ec*em-eg))]}function le(eo,ec,ed,em,e_,eg){var ex=em*em;if(em>0&&ec.size<(e_?ex:em))ed.numPoints+=ec.length/3;else{for(var ev=[],eb=0;eb<ec.length;eb+=3)(0===em||ec[eb+2]>ex)&&(ed.numSimplified++,ev.push(ec[eb]),ev.push(ec[eb+1])),ed.numPoints++;e_&&function(eo,ec){for(var ed=0,em=0,e_=eo.length,eg=e_-2;em<e_;eg=em,em+=2)ed+=(eo[em]-eo[eg])*(eo[em+1]+eo[eg+1]);if(ed>0===ec)for(em=0,e_=eo.length;em<e_/2;em+=2){var ex=eo[em],ev=eo[em+1];eo[em]=eo[e_-2-em],eo[em+1]=eo[e_-1-em],eo[e_-2-em]=ex,eo[e_-1-em]=ev}}(ev,eg),eo.push(ev)}}function ue(eo,ec){var ed,em,e_,eg,ex,ev,eb=(ec=this.options=function(eo,ec){for(var ed in ec)eo[ed]=ec[ed];return eo}(Object.create(this.options),ec)).debug;if(eb&&console.time("preprocess data"),ec.maxZoom<0||ec.maxZoom>24)throw Error("maxZoom should be in the 0-24 range");if(ec.promoteId&&ec.generateId)throw Error("promoteId and generateId cannot be used together.");var ew=function(eo,ec){var ed=[];if("FeatureCollection"===eo.type)for(var em=0;em<eo.features.length;em++)X(ed,eo.features[em],ec,em);else X(ed,"Feature"===eo.type?eo:{geometry:eo},ec);return ed}(eo,ec);this.tiles={},this.tileCoords=[],eb&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ec.indexMaxZoom,ec.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),ed=ew,e_=(em=ec).buffer/em.extent,eg=ed,ex=R(ed,1,-1-e_,e_,0,-1,2,em),ev=R(ed,1,1-e_,2+e_,0,-1,2,em),(ex||ev)&&(eg=R(ed,1,-e_,1+e_,0,-1,2,em)||[],ex&&(eg=re(ex,1).concat(eg)),ev&&(eg=eg.concat(re(ev,-1)))),(ew=eg).length&&this.splitTile(ew,0,0,0),eb&&(ew.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function he(eo,ec,ed){return 32*((1<<eo)*ed+ec)+eo}function ce(ec,ed){let e_=ec.tileID.canonical;if(!this._geoJSONIndex)return ed(null,null);let eg=this._geoJSONIndex.getTile(e_.z,e_.x,e_.y);if(!eg)return ed(null,null);let ex=new class{constructor(ec){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=eo.EXTENT,this.length=ec.length,this._features=ec}feature(ec){return new class{constructor(ec){this._feature=ec,this.extent=eo.EXTENT,this.type=ec.type,this.properties=ec.tags,"id"in ec&&!isNaN(ec.id)&&(this.id=parseInt(ec.id,10))}loadGeometry(){if(1===this._feature.type){let ec=[];for(let ed of this._feature.geometry)ec.push([new eo.Point(ed[0],ed[1])]);return ec}{let ec=[];for(let ed of this._feature.geometry){let em=[];for(let ec of ed)em.push(new eo.Point(ec[0],ec[1]));ec.push(em)}return ec}}toGeoJSON(eo,ec,ed){return em.call(this,eo,ec,ed)}}(this._features[ec])}}(eg.features),ev=eb(ex);0===ev.byteOffset&&ev.byteLength===ev.buffer.byteLength||(ev=new Uint8Array(ev)),ed(null,{vectorTile:ex,rawData:ev.buffer})}ue.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ue.prototype.splitTile=function(eo,ec,ed,em,e_,eg,ex){for(var ev=[eo,ec,ed,em],eb=this.options,ew=eb.debug;ev.length;){em=ev.pop(),ed=ev.pop(),ec=ev.pop(),eo=ev.pop();var eT=1<<ec,eE=he(ec,ed,em),eM=this.tiles[eE];if(!eM&&(ew>1&&console.time("creation"),eM=this.tiles[eE]=function(eo,ec,ed,em,e_){for(var eg=ec===e_.maxZoom?0:e_.tolerance/((1<<ec)*e_.extent),ex={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ed,y:em,z:ec,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ev=0;ev<eo.length;ev++){ex.numFeatures++,function(eo,ec,ed,em){var e_=ec.geometry,eg=ec.type,ex=[];if("Point"===eg||"MultiPoint"===eg)for(var ev=0;ev<e_.length;ev+=3)ex.push(e_[ev]),ex.push(e_[ev+1]),eo.numPoints++,eo.numSimplified++;else if("LineString"===eg)le(ex,e_,eo,ed,!1,!1);else if("MultiLineString"===eg||"Polygon"===eg)for(ev=0;ev<e_.length;ev++)le(ex,e_[ev],eo,ed,"Polygon"===eg,0===ev);else if("MultiPolygon"===eg)for(var eb=0;eb<e_.length;eb++){var ew=e_[eb];for(ev=0;ev<ew.length;ev++)le(ex,ew[ev],eo,ed,!0,0===ev)}if(ex.length){var eT=ec.tags||null;if("LineString"===eg&&em.lineMetrics){for(var eE in eT={},ec.tags)eT[eE]=ec.tags[eE];eT.mapbox_clip_start=e_.start/e_.size,eT.mapbox_clip_end=e_.end/e_.size}var eM={geometry:ex,type:"Polygon"===eg||"MultiPolygon"===eg?3:"LineString"===eg||"MultiLineString"===eg?2:1,tags:eT};null!==ec.id&&(eM.id=ec.id),eo.features.push(eM)}}(ex,eo[ev],eg,e_);var eb=eo[ev].minX,ew=eo[ev].minY,eT=eo[ev].maxX,eE=eo[ev].maxY;eb<ex.minX&&(ex.minX=eb),ew<ex.minY&&(ex.minY=ew),eT>ex.maxX&&(ex.maxX=eT),eE>ex.maxY&&(ex.maxY=eE)}return ex}(eo,ec,ed,em,eb),this.tileCoords.push({z:ec,x:ed,y:em}),ew)){ew>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ec,ed,em,eM.numFeatures,eM.numPoints,eM.numSimplified),console.timeEnd("creation"));var eS="z"+ec;this.stats[eS]=(this.stats[eS]||0)+1,this.total++}if(eM.source=eo,e_){if(ec===eb.maxZoom||ec===e_)continue;var eA=1<<e_-ec;if(ed!==Math.floor(eg/eA)||em!==Math.floor(ex/eA))continue}else if(ec===eb.indexMaxZoom||eM.numPoints<=eb.indexMaxPoints)continue;if(eM.source=null,0!==eo.length){ew>1&&console.time("clipping");var eI,eC,eP,ez,eD,ek,eL=.5*eb.buffer/eb.extent,eR=.5-eL,eB=.5+eL,eF=1+eL;eI=eC=eP=ez=null,eD=R(eo,eT,ed-eL,ed+eB,0,eM.minX,eM.maxX,eb),ek=R(eo,eT,ed+eR,ed+eF,0,eM.minX,eM.maxX,eb),eo=null,eD&&(eI=R(eD,eT,em-eL,em+eB,1,eM.minY,eM.maxY,eb),eC=R(eD,eT,em+eR,em+eF,1,eM.minY,eM.maxY,eb),eD=null),ek&&(eP=R(ek,eT,em-eL,em+eB,1,eM.minY,eM.maxY,eb),ez=R(ek,eT,em+eR,em+eF,1,eM.minY,eM.maxY,eb),ek=null),ew>1&&console.timeEnd("clipping"),ev.push(eI||[],ec+1,2*ed,2*em),ev.push(eC||[],ec+1,2*ed,2*em+1),ev.push(eP||[],ec+1,2*ed+1,2*em),ev.push(ez||[],ec+1,2*ed+1,2*em+1)}}},ue.prototype.getTile=function(eo,ec,ed){var em=this.options,e_=em.extent,eg=em.debug;if(eo<0||eo>24)return null;var ex=1<<eo,ev=he(eo,ec=(ec%ex+ex)%ex,ed);if(this.tiles[ev])return ie(this.tiles[ev],e_);eg>1&&console.log("drilling down to z%d-%d-%d",eo,ec,ed);for(var eb,ew=eo,eT=ec,eE=ed;!eb&&ew>0;)ew--,eT=Math.floor(eT/2),eE=Math.floor(eE/2),eb=this.tiles[he(ew,eT,eE)];return eb&&eb.source?(eg>1&&console.log("found parent tile z%d-%d-%d",ew,eT,eE),eg>1&&console.time("drilling down"),this.splitTile(eb.source,ew,eT,eE,eo,ec,ed),eg>1&&console.timeEnd("drilling down"),this.tiles[ev]?ie(this.tiles[ev],e_):null):null};let fe=class fe extends eo.VectorTileWorkerSource{constructor(eo,ec,ed,em,e_){super(eo,ec,ed,em,ce),e_&&(this.loadGeoJSON=e_)}loadData(ec,em){let e_=ec&&ec.request,eg=e_&&e_.collectResourceTiming;this.loadGeoJSON(ec,(ex,ev)=>{if(ex||!ev)return em(ex);if("object"!=typeof ev)return em(Error(`Input data given to '${ec.source}' is not a valid GeoJSON object.`));{ed(ev,!0);try{var eb,ew;if(ec.filter){let ed=eo.createExpression(ec.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===ed.result)throw Error(ed.value.map(eo=>`${eo.key}: ${eo.message}`).join(", "));let em=ev.features.filter(eo=>ed.value.evaluate({zoom:0},eo));ev={type:"FeatureCollection",features:em}}this._geoJSONIndex=ec.cluster?new E(function({superclusterOptions:ec,clusterProperties:ed}){if(!ed||!ec)return ec;let em={},e_={},eg={accumulated:null,zoom:0},ex={properties:null},ev=Object.keys(ed);for(let ec of ev){let[eg,ex]=ed[ec],ev=eo.createExpression(ex),eb=eo.createExpression("string"==typeof eg?[eg,["accumulated"],["get",ec]]:eg);em[ec]=ev.value,e_[ec]=eb.value}return ec.map=eo=>{ex.properties=eo;let ec={};for(let eo of ev)ec[eo]=em[eo].evaluate(eg,ex);return ec},ec.reduce=(eo,ec)=>{for(let ed of(ex.properties=ec,ev))eg.accumulated=eo[ed],eo[ed]=e_[ed].evaluate(eg,ex)},ec}(ec)).load(ev.features):(eb=ev,ew=ec.geojsonVtOptions,new ue(eb,ew))}catch(eo){return em(eo)}this.loaded={};let ex={};if(eg){let ed=eo.getPerformanceMeasurement(e_);ed&&(ex.resourceTiming={},ex.resourceTiming[ec.source]=JSON.parse(JSON.stringify(ed)))}em(null,ex)}})}reloadTile(eo,ec){let ed=this.loaded;return ed&&ed[eo.uid]?super.reloadTile(eo,ec):this.loadTile(eo,ec)}loadGeoJSON(ec,ed){if(ec.request)eo.getJSON(ec.request,ed);else{if("string"!=typeof ec.data)return ed(Error(`Input data given to '${ec.source}' is not a valid GeoJSON object.`));try{return ed(null,JSON.parse(ec.data))}catch(eo){return ed(Error(`Input data given to '${ec.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(eo,ec){try{ec(null,this._geoJSONIndex.getClusterExpansionZoom(eo.clusterId))}catch(eo){ec(eo)}}getClusterChildren(eo,ec){try{ec(null,this._geoJSONIndex.getChildren(eo.clusterId))}catch(eo){ec(eo)}}getClusterLeaves(eo,ec){try{ec(null,this._geoJSONIndex.getLeaves(eo.clusterId,eo.limit,eo.offset))}catch(eo){ec(eo)}}};let pe=class pe{constructor(ec){this.self=ec,this.actor=new eo.Actor(ec,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=eo.getProjection({name:"mercator"}),this.workerSourceTypes={vector:eo.VectorTileWorkerSource,geojson:fe},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(eo,ec)=>{if(this.workerSourceTypes[eo])throw Error(`Worker source with name "${eo}" already registered.`);this.workerSourceTypes[eo]=ec},this.self.registerRTLTextPlugin=ec=>{if(eo.plugin.isParsed())throw Error("RTL text plugin already registered.");eo.plugin.applyArabicShaping=ec.applyArabicShaping,eo.plugin.processBidirectionalText=ec.processBidirectionalText,eo.plugin.processStyledBidirectionalText=ec.processStyledBidirectionalText}}clearCaches(eo,ec,ed){delete this.layerIndexes[eo],delete this.availableImages[eo],delete this.workerSources[eo],delete this.demWorkerSources[eo],ed()}checkIfReady(eo,ec,ed){ed()}setReferrer(eo,ec){this.referrer=ec}spriteLoaded(ec,ed){for(let em in this.isSpriteLoaded[ec]=ed,this.workerSources[ec]){let e_=this.workerSources[ec][em];for(let ec in e_)e_[ec]instanceof eo.VectorTileWorkerSource&&(e_[ec].isSpriteLoaded=ed,e_[ec].fire(new eo.Event("isSpriteLoaded")))}}setImages(eo,ec,ed){for(let ed in this.availableImages[eo]=ec,this.workerSources[eo]){let em=this.workerSources[eo][ed];for(let eo in em)em[eo].availableImages=ec}ed()}enableTerrain(eo,ec,ed){this.terrain=ec,ed()}setProjection(ec,ed){this.projections[ec]=eo.getProjection(ed)}setLayers(eo,ec,ed){this.getLayerIndex(eo).replace(ec),ed()}updateLayers(eo,ec,ed){this.getLayerIndex(eo).update(ec.layers,ec.removedIds),ed()}loadTile(ec,ed,em){let e_=this.enableTerrain?eo.extend({enableTerrain:this.terrain},ed):ed;e_.projection=this.projections[ec]||this.defaultProjection,this.getWorkerSource(ec,ed.type,ed.source).loadTile(e_,em)}loadDEMTile(ec,ed,em){let e_=this.enableTerrain?eo.extend({buildQuadTree:this.terrain},ed):ed;this.getDEMWorkerSource(ec,ed.source).loadTile(e_,em)}reloadTile(ec,ed,em){let e_=this.enableTerrain?eo.extend({enableTerrain:this.terrain},ed):ed;e_.projection=this.projections[ec]||this.defaultProjection,this.getWorkerSource(ec,ed.type,ed.source).reloadTile(e_,em)}abortTile(eo,ec,ed){this.getWorkerSource(eo,ec.type,ec.source).abortTile(ec,ed)}removeTile(eo,ec,ed){this.getWorkerSource(eo,ec.type,ec.source).removeTile(ec,ed)}removeSource(eo,ec,ed){if(!this.workerSources[eo]||!this.workerSources[eo][ec.type]||!this.workerSources[eo][ec.type][ec.source])return;let em=this.workerSources[eo][ec.type][ec.source];delete this.workerSources[eo][ec.type][ec.source],void 0!==em.removeSource?em.removeSource(ec,ed):ed()}loadWorkerSource(eo,ec,ed){try{this.self.importScripts(ec.url),ed()}catch(eo){ed(eo.toString())}}syncRTLPluginState(ec,ed,em){try{eo.plugin.setState(ed);let ec=eo.plugin.getPluginURL();if(eo.plugin.isLoaded()&&!eo.plugin.isParsed()&&null!=ec){this.self.importScripts(ec);let ed=eo.plugin.isParsed();em(ed?void 0:Error(`RTL Text Plugin failed to import scripts from ${ec}`),ed)}}catch(eo){em(eo.toString())}}getAvailableImages(eo){let ec=this.availableImages[eo];return ec||(ec=[]),ec}getLayerIndex(eo){let ec=this.layerIndexes[eo];return ec||(ec=this.layerIndexes[eo]=new o),ec}getWorkerSource(eo,ec,ed){if(this.workerSources[eo]||(this.workerSources[eo]={}),this.workerSources[eo][ec]||(this.workerSources[eo][ec]={}),!this.workerSources[eo][ec][ed]){let em={send:(ec,ed,em,e_,eg,ex)=>{this.actor.send(ec,ed,em,eo,eg,ex)},scheduler:this.actor.scheduler};this.workerSources[eo][ec][ed]=new this.workerSourceTypes[ec](em,this.getLayerIndex(eo),this.getAvailableImages(eo),this.isSpriteLoaded[eo])}return this.workerSources[eo][ec][ed]}getDEMWorkerSource(eo,ec){return this.demWorkerSources[eo]||(this.demWorkerSources[eo]={}),this.demWorkerSources[eo][ec]||(this.demWorkerSources[eo][ec]=new i),this.demWorkerSources[eo][ec]}enforceCacheSizeLimit(ec,ed){eo.enforceCacheSizeLimit(ed)}getWorkerPerformanceMetrics(eo,ec,ed){ed(void 0,void 0)}};return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new pe(self)),pe}),define(["./shared"],function(eo){let ec,ed,em;function t(eo,ec){if(Array.isArray(eo)){if(!Array.isArray(ec)||eo.length!==ec.length)return!1;for(let ed=0;ed<eo.length;ed++)if(!t(eo[ed],ec[ed]))return!1;return!0}if("object"==typeof eo&&null!==eo&&null!==ec){if("object"!=typeof ec||Object.keys(eo).length!==Object.keys(ec).length)return!1;for(let ed in eo)if(!t(eo[ed],ec[ed]))return!1;return!0}return eo===ec}function o(eo){var ec;return"undefined"!=typeof window&&"undefined"!=typeof document&&!!Array.prototype&&!!Array.prototype.every&&!!Array.prototype.filter&&!!Array.prototype.forEach&&!!Array.prototype.indexOf&&!!Array.prototype.lastIndexOf&&!!Array.prototype.map&&!!Array.prototype.some&&!!Array.prototype.reduce&&!!Array.prototype.reduceRight&&!!Array.isArray&&!!Function.prototype&&!!Function.prototype.bind&&!!Object.keys&&!!Object.create&&!!Object.getPrototypeOf&&!!Object.getOwnPropertyNames&&!!Object.isSealed&&!!Object.isFrozen&&!!Object.isExtensible&&!!Object.getOwnPropertyDescriptor&&!!Object.defineProperty&&!!Object.defineProperties&&!!Object.seal&&!!Object.freeze&&!!Object.preventExtensions&&!!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)&&!!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var eo,ec,ed=new Blob([""],{type:"text/javascript"}),em=URL.createObjectURL(ed);try{ec=new Worker(em),eo=!0}catch(ec){eo=!1}return ec&&ec.terminate(),URL.revokeObjectURL(em),eo}()&&"Uint8ClampedArray"in window&&!!ArrayBuffer.isView&&!!function(){var eo=document.createElement("canvas");eo.width=eo.height=1;var ec=eo.getContext("2d");if(!ec)return!1;var ed=ec.getImageData(0,0,1,1);return ed&&ed.width===eo.width}()&&(void 0===e_[ec=eo&&eo.failIfMajorPerformanceCaveat]&&(e_[ec]=function(eo){var ec,ed,em,e_=(ec=document.createElement("canvas"),(ed=Object.create(o.webGLContextAttributes)).failIfMajorPerformanceCaveat=eo,ec.getContext("webgl",ed)||ec.getContext("experimental-webgl",ed));if(!e_)return!1;try{em=e_.createShader(e_.VERTEX_SHADER)}catch(eo){return!1}return!(!em||e_.isContextLost())&&(e_.shaderSource(em,"void main() {}"),e_.compileShader(em),!0===e_.getShaderParameter(em,e_.COMPILE_STATUS))}(ec)),!!e_[ec]&&!document.documentMode)}var e_={};function n(ec,ed,em){let e_=eo.window.document.createElement(ec);return void 0!==ed&&(e_.className=ed),em&&em.appendChild(e_),e_}function s(ec,ed,em){let e_=eo.window.document.createElementNS("http://www.w3.org/2000/svg",ec);for(let eo of Object.keys(ed))e_.setAttributeNS(null,eo,ed[eo]);return em&&em.appendChild(e_),e_}o.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let eg=eo.window.document&&eo.window.document.documentElement.style,ex=eg&&void 0!==eg.userSelect?"userSelect":"WebkitUserSelect";function h(){eg&&ex&&(ec=eg[ex],eg[ex]="none")}function u(){eg&&ex&&(eg[ex]=ec)}function _(ec){ec.preventDefault(),ec.stopPropagation(),eo.window.removeEventListener("click",_,!0)}function d(){eo.window.addEventListener("click",_,!0),eo.window.setTimeout(()=>{eo.window.removeEventListener("click",_,!0)},0)}function p(eo,ec){let ed=eo.getBoundingClientRect();return g(eo,ed,ec)}function m(eo,ec){let ed=eo.getBoundingClientRect(),em=[];for(let e_=0;e_<ec.length;e_++)em.push(g(eo,ed,ec[e_]));return em}function f(ec){return void 0!==eo.window.InstallTrigger&&2===ec.button&&ec.ctrlKey&&eo.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:ec.button}function g(ec,ed,em){let e_=ec.offsetWidth===ed.width?1:ec.offsetWidth/ed.width;return new eo.Point((em.clientX-ed.left)*e_,(em.clientY-ed.top)*e_)}function v(eo,ec){var ed=ec[0],em=ec[1],e_=ec[2],eg=ec[3],ex=ed*eg-e_*em;return ex?(eo[0]=eg*(ex=1/ex),eo[1]=-em*ex,eo[2]=-e_*ex,eo[3]=ed*ex,eo):null}let y=class y extends eo.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new eo.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(eo){if(this.loaded!==eo&&(this.loaded=eo,eo)){for(let{ids:eo,callback:ec}of this.requestors)this._notify(eo,ec);this.requestors=[]}}hasImage(eo){return!!this.getImage(eo)}getImage(eo){return this.images[eo]}addImage(eo,ec){this._validate(eo,ec)&&(this.images[eo]=ec)}_validate(ec,ed){let em=!0;return this._validateStretch(ed.stretchX,ed.data&&ed.data.width)||(this.fire(new eo.ErrorEvent(Error(`Image "${ec}" has invalid "stretchX" value`))),em=!1),this._validateStretch(ed.stretchY,ed.data&&ed.data.height)||(this.fire(new eo.ErrorEvent(Error(`Image "${ec}" has invalid "stretchY" value`))),em=!1),this._validateContent(ed.content,ed)||(this.fire(new eo.ErrorEvent(Error(`Image "${ec}" has invalid "content" value`))),em=!1),em}_validateStretch(eo,ec){if(!eo)return!0;let ed=0;for(let em of eo){if(em[0]<ed||em[1]<em[0]||ec<em[1])return!1;ed=em[1]}return!0}_validateContent(eo,ec){return!(eo&&(4!==eo.length||eo[0]<0||ec.data.width<eo[0]||eo[1]<0||ec.data.height<eo[1]||eo[2]<0||ec.data.width<eo[2]||eo[3]<0||ec.data.height<eo[3]||eo[2]<eo[0]||eo[3]<eo[1]))}updateImage(eo,ec){ec.version=this.images[eo].version+1,this.images[eo]=ec,this.updatedImages[eo]=!0}removeImage(eo){let ec=this.images[eo];delete this.images[eo],delete this.patterns[eo],ec.userImage&&ec.userImage.onRemove&&ec.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(eo,ec){let ed=!0;if(!this.isLoaded())for(let ec of eo)this.images[ec]||(ed=!1);this.isLoaded()||ed?this._notify(eo,ec):this.requestors.push({ids:eo,callback:ec})}_notify(ec,ed){let em={};for(let ed of ec){this.images[ed]||this.fire(new eo.Event("styleimagemissing",{id:ed}));let ec=this.images[ed];ec?em[ed]={data:ec.data.clone(),pixelRatio:ec.pixelRatio,sdf:ec.sdf,version:ec.version,stretchX:ec.stretchX,stretchY:ec.stretchY,content:ec.content,hasRenderCallback:!!(ec.userImage&&ec.userImage.render)}:eo.warnOnce(`Image "${ed}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}ed(null,em)}getPixelSize(){let{width:eo,height:ec}=this.atlasImage;return{width:eo,height:ec}}getPattern(ec){let ed=this.patterns[ec],em=this.getImage(ec);if(!em)return null;if(ed&&ed.position.version===em.version)return ed.position;if(ed)ed.position.version=em.version;else{let ed={w:em.data.width+2,h:em.data.height+2,x:0,y:0},e_=new eo.ImagePosition(ed,em);this.patterns[ec]={bin:ed,position:e_}}return this._updatePatternAtlas(),this.patterns[ec].position}bind(ec){let ed=ec.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new eo.Texture(ec,this.atlasImage,ed.RGBA),this.atlasTexture&&this.atlasTexture.bind(ed.LINEAR,ed.CLAMP_TO_EDGE)}_updatePatternAtlas(){let ec=[];for(let eo in this.patterns)ec.push(this.patterns[eo].bin);let{w:ed,h:em}=eo.potpack(ec),e_=this.atlasImage;for(let ec in e_.resize({width:ed||1,height:em||1}),this.patterns){let{bin:ed}=this.patterns[ec],em=ed.x+1,eg=ed.y+1,ex=this.images[ec].data,ev=ex.width,eb=ex.height;eo.RGBAImage.copy(ex,e_,{x:0,y:0},{x:em,y:eg},{width:ev,height:eb}),eo.RGBAImage.copy(ex,e_,{x:0,y:eb-1},{x:em,y:eg-1},{width:ev,height:1}),eo.RGBAImage.copy(ex,e_,{x:0,y:0},{x:em,y:eg+eb},{width:ev,height:1}),eo.RGBAImage.copy(ex,e_,{x:ev-1,y:0},{x:em-1,y:eg},{width:1,height:eb}),eo.RGBAImage.copy(ex,e_,{x:0,y:0},{x:em+ev,y:eg},{width:1,height:eb})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(eo){for(let ec of eo){if(this.callbackDispatchedThisFrame[ec])continue;this.callbackDispatchedThisFrame[ec]=!0;let eo=this.images[ec];(function(eo){let{userImage:ec}=eo;return!!(ec&&ec.render&&ec.render())&&(eo.data.replace(new Uint8Array(ec.data.buffer)),!0)})(eo)&&this.updateImage(ec,eo)}}};let ev=new eo.Properties({anchor:new eo.DataConstantProperty(eo.spec.light.anchor),position:new class{constructor(){this.specification=eo.spec.light.position}possiblyEvaluate(ec,ed){return function([ec,ed,em]){let e_=eo.degToRad(ed+90),eg=eo.degToRad(em);return{x:ec*Math.cos(e_)*Math.sin(eg),y:ec*Math.sin(e_)*Math.sin(eg),z:ec*Math.cos(eg),azimuthal:ed,polar:em}}(ec.expression.evaluate(ed))}interpolate(ec,ed,em){return{x:eo.number(ec.x,ed.x,em),y:eo.number(ec.y,ed.y,em),z:eo.number(ec.z,ed.z,em),azimuthal:eo.number(ec.azimuthal,ed.azimuthal,em),polar:eo.number(ec.polar,ed.polar,em)}}},color:new eo.DataConstantProperty(eo.spec.light.color),intensity:new eo.DataConstantProperty(eo.spec.light.intensity)});let w=class w extends eo.Evented{constructor(ec){super(),this._transitionable=new eo.Transitionable(ev),this.setLight(ec),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(ec,ed={}){if(!this._validate(eo.validateLight,ec,ed))for(let ed in ec){let em=ec[ed];eo.endsWith(ed,"-transition")?this._transitionable.setTransition(ed.slice(0,-11),em):this._transitionable.setValue(ed,em)}}updateTransitions(eo){this._transitioning=this._transitionable.transitioned(eo,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(eo){this.properties=this._transitioning.possiblyEvaluate(eo)}_validate(ec,ed,em){return(!em||!1!==em.validate)&&eo.emitValidationErrors(this,ec.call(eo.validateStyle,eo.extend({value:ed,style:{glyphs:!0,sprite:!0},styleSpec:eo.spec})))}};let eb=new eo.Properties({source:new eo.DataConstantProperty(eo.spec.terrain.source),exaggeration:new eo.DataConstantProperty(eo.spec.terrain.exaggeration)}),ew=class extends eo.Evented{constructor(ec,ed){super(),this._transitionable=new eo.Transitionable(eb),this.set(ec),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=ed}get(){return this._transitionable.serialize()}set(ec){for(let ed in ec){let em=ec[ed];eo.endsWith(ed,"-transition")?this._transitionable.setTransition(ed.slice(0,-11),em):this._transitionable.setValue(ed,em)}}updateTransitions(eo){this._transitioning=this._transitionable.transitioned(eo,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(eo){this.properties=this._transitioning.possiblyEvaluate(eo)}};function C(ec,ed,em,e_){let eg=eo.smoothstep(45,65,em),[ex,ev]=M(ec,e_),eb=eo.length(ed),ew=1-Math.min(1,Math.exp(-((eb-ex)/(ev-ex)*6)));return ew*=ew*ew,(ew=Math.min(1,1.00747*ew))*eg*ec.alpha}function M(eo,ec){let ed=.5/Math.tan(.5*ec);return[eo.range[0]+ed,eo.range[1]+ed]}let eT=new eo.Properties({range:new eo.DataConstantProperty(eo.spec.fog.range),color:new eo.DataConstantProperty(eo.spec.fog.color),"high-color":new eo.DataConstantProperty(eo.spec.fog["high-color"]),"space-color":new eo.DataConstantProperty(eo.spec.fog["space-color"]),"horizon-blend":new eo.DataConstantProperty(eo.spec.fog["horizon-blend"]),"star-intensity":new eo.DataConstantProperty(eo.spec.fog["star-intensity"])});let P=class P extends eo.Evented{constructor(ec,ed){super(),this._transitionable=new eo.Transitionable(eT),this.set(ec),this._transitioning=this._transitionable.untransitioned(),this._transform=ed}get state(){let ec=this._transform,ed="globe"===ec.projection.name,em=eo.globeToMercatorTransition(ec.zoom),e_=this.properties.get("range");return{range:ed?[eo.number(.5,e_[0],em),eo.number(3,e_[1],em)]:e_,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(ec,ed={}){if(!this._validate(eo.validateFog,ec,ed)){for(let ed of Object.keys(eo.spec.fog))ec&&void 0===ec[ed]&&(ec[ed]=eo.spec.fog[ed].default);for(let ed in ec){let em=ec[ed];eo.endsWith(ed,"-transition")?this._transitionable.setTransition(ed.slice(0,-11),em):this._transitionable.setValue(ed,em)}}}getOpacity(ec){if(!this._transform.projection.supportsFog)return 0;let ed=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:eo.smoothstep(45,65,ec))*ed.a}getOpacityAtLatLng(ec,ed){return this._transform.projection.supportsFog?function(ec,ed,em){let e_=eo.MercatorCoordinate.fromLngLat(ed),eg=em.elevation?em.elevation.getAtPointOrZero(e_):0,ex=[e_.x,e_.y,eg];return eo.transformMat4(ex,ex,em.mercatorFogMatrix),C(ec,ex,em.pitch,em._fov)}(this.state,ec,ed):0}getFovAdjustedRange(eo){return this._transform.projection.supportsFog?M(this.state,eo):[0,1]}updateTransitions(eo){this._transitioning=this._transitionable.transitioned(eo,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(eo){this.properties=this._transitioning.possiblyEvaluate(eo)}_validate(ec,ed,em){return(!em||!1!==em.validate)&&eo.emitValidationErrors(this,ec.call(eo.validateStyle,eo.extend({value:ed,style:{glyphs:!0,sprite:!0},styleSpec:eo.spec})))}};let S=class S{constructor(ec,ed){this.workerPool=ec,this.actors=[],this.currentActor=0,this.id=eo.uniqueId();let em=this.workerPool.acquire(this.id);for(let eo=0;eo<em.length;eo++){let ec=new S.Actor(em[eo],ed,this.id);ec.name=`Worker ${eo}`,this.actors.push(ec)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(ec,ed,em){eo.asyncAll(this.actors,(eo,em)=>{eo.send(ec,ed,em)},em=em||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(eo=>{eo.remove()}),this.actors=[],this.workerPool.release(this.id)}};function D(ec,ed,em){return ed*(eo.EXTENT/(ec.tileSize*Math.pow(2,em-ec.tileID.overscaledZ)))}S.Actor=eo.Actor;let L=class L{constructor(eo,ec,ed,em){this.screenBounds=eo,this.cameraPoint=ec,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=ed,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,em)}static createFromScreenPoints(ec,ed){let em,e_;if(ec instanceof eo.Point||"number"==typeof ec[0]){let eg=eo.Point.convert(ec);em=[eg],e_=ed.isPointAboveHorizon(eg)}else{let eg=eo.Point.convert(ec[0]),ex=eo.Point.convert(ec[1]);em=[eg,ex],e_=eo.polygonizeBounds(eg,ex).every(eo=>ed.isPointAboveHorizon(eo))}return new L(em,ed.getCameraPoint(),e_,ed)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(ec){return eo.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],ec)}bufferedCameraGeometry(ec){let ed=this.screenBounds[0],em=1===this.screenBounds.length?this.screenBounds[0].add(new eo.Point(1,1)):this.screenBounds[1],e_=eo.polygonizeBounds(ed,em,0,!1);return this.cameraPoint.y>em.y&&(this.cameraPoint.x>ed.x&&this.cameraPoint.x<em.x?e_.splice(3,0,this.cameraPoint):this.cameraPoint.x>=em.x?e_[2]=this.cameraPoint:this.cameraPoint.x<=ed.x&&(e_[3]=this.cameraPoint)),eo.bufferConvexPolygon(e_,ec)}bufferedCameraGeometryGlobe(ec){let ed=this.screenBounds[0],em=1===this.screenBounds.length?this.screenBounds[0].add(new eo.Point(1,1)):this.screenBounds[1],e_=eo.polygonizeBounds(ed,em,ec),eg=this.cameraPoint.clone();switch(3*((eg.y>ed.y)+(eg.y>em.y))+((eg.x>ed.x)+(eg.x>em.x))){case 0:e_[0]=eg,e_[4]=eg.clone();break;case 1:e_.splice(1,0,eg);break;case 2:e_[1]=eg;break;case 3:e_.splice(4,0,eg);break;case 5:e_.splice(2,0,eg);break;case 6:e_[3]=eg;break;case 7:e_.splice(3,0,eg);break;case 8:e_[2]=eg}return e_}containsTile(ec,ed,em,e_=0){var eg;let ex=ec.queryPadding/ed._pixelsPerMercatorPixel+1,ev=em?this._bufferedCameraMercator(ex,ed):this._bufferedScreenMercator(ex,ed),eb=ec.tileID.wrap+(ev.unwrapped?e_:0),ew=ev.polygon.map(ed=>eo.getTilePoint(ec.tileTransform,ed,eb));if(!eo.polygonIntersectsBox(ew,0,0,eo.EXTENT,eo.EXTENT))return;eb=ec.tileID.wrap+(this.screenGeometryMercator.unwrapped?e_:0);let eT=this.screenGeometryMercator.polygon.map(ed=>eo.getTileVec3(ec.tileTransform,ed,eb)),eE=eT.map(ec=>new eo.Point(ec[0],ec[1])),eM=ed.getFreeCameraOptions().position||new eo.MercatorCoordinate(0,0,0),eS=eo.getTileVec3(ec.tileTransform,eM,eb),eA=eT.map(ec=>{let ed=eo.sub(ec,ec,eS);return eo.normalize(ed,ed),new eo.Ray(eS,ed)}),eI=D(ec,1,ed.zoom)*ed._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:eE,tilespaceRays:eA,bufferedTilespaceGeometry:ew,bufferedTilespaceBounds:((eg=eo.getBounds(ew)).min.x=eo.clamp(eg.min.x,0,eo.EXTENT),eg.min.y=eo.clamp(eg.min.y,0,eo.EXTENT),eg.max.x=eo.clamp(eg.max.x,0,eo.EXTENT),eg.max.y=eo.clamp(eg.max.y,0,eo.EXTENT),eg),tile:ec,tileID:ec.tileID,pixelToTileUnitsFactor:eI}}_bufferedScreenMercator(eo,ec){let ed=100*eo|0;if(this._screenRaycastCache[ed])return this._screenRaycastCache[ed];{let em;return em="globe"===ec.projection.name?this._projectAndResample(this.bufferedScreenGeometry(eo),ec):{polygon:this.bufferedScreenGeometry(eo).map(eo=>ec.pointCoordinate3D(eo)),unwrapped:!0},this._screenRaycastCache[ed]=em,em}}_bufferedCameraMercator(eo,ec){let ed=100*eo|0;if(this._cameraRaycastCache[ed])return this._cameraRaycastCache[ed];{let em;return em="globe"===ec.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(eo),ec):{polygon:this.bufferedCameraGeometry(eo).map(eo=>ec.pointCoordinate3D(eo)),unwrapped:!0},this._cameraRaycastCache[ed]=em,em}}_projectAndResample(ec,ed){let em=function(ec,ed){let em=eo.multiply([],ed.pixelMatrix,ed.globeMatrix),e_=[0,-eo.GLOBE_RADIUS,0,1],eg=[0,eo.GLOBE_RADIUS,0,1],ex=[0,0,0,1];eo.transformMat4$1(e_,e_,em),eo.transformMat4$1(eg,eg,em),eo.transformMat4$1(ex,ex,em);let ev=new eo.Point(e_[0]/e_[3],e_[1]/e_[3]),eb=new eo.Point(eg[0]/eg[3],eg[1]/eg[3]),ew=eo.polygonContainsPoint(ec,ev)&&e_[3]<ex[3],eT=eo.polygonContainsPoint(ec,eb)&&eg[3]<ex[3];if(!ew&&!eT)return null;let eE=function(eo,ec,ed){for(let em=1;em<eo.length;em++){let e_=z(ec.pointCoordinate3D(eo[em-1]).x),eg=z(ec.pointCoordinate3D(eo[em]).x);if(ed<0){if(e_<eg)return{idx:em,t:-e_/(eg-1-e_)}}else if(eg<e_)return{idx:em,t:(1-e_)/(eg+1-e_)}}return null}(ec,ed,ew?-1:1);if(!eE)return null;let{idx:eM,t:eS}=eE,eA=eM>1?A(ec.slice(0,eM),ed):[],eI=eM<ec.length?A(ec.slice(eM),ed):[];eA=eA.map(ec=>new eo.Point(z(ec.x),ec.y)),eI=eI.map(ec=>new eo.Point(z(ec.x),ec.y));let eC=[...eA];0===eC.length&&eC.push(eI[eI.length-1]);let eP=eo.number(eC[eC.length-1].y,(0===eI.length?eA[0]:eI[0]).y,eS);return eC.push(...ew?[new eo.Point(0,eP),new eo.Point(0,0),new eo.Point(1,0),new eo.Point(1,eP)]:[new eo.Point(1,eP),new eo.Point(1,1),new eo.Point(0,1),new eo.Point(0,eP)]),0===eI.length?eC.push(eA[0]):eC.push(...eI),{polygon:eC.map(ec=>new eo.MercatorCoordinate(ec.x,ec.y)),unwrapped:!1}}(ec,ed);if(em)return em;let e_=function(ec,ed){let em=!1,e_=-1/0,eg=0;for(let eo=0;eo<ec.length-1;eo++)ec[eo].x>e_&&(e_=ec[eo].x,eg=eo);for(let eo=0;eo<ec.length-1;eo++){let ed=(eg+eo)%(ec.length-1),e_=ec[ed],ex=ec[ed+1];Math.abs(e_.x-ex.x)>.5&&(e_.x<ex.x?(e_.x+=1,0===ed&&(ec[ec.length-1].x+=1)):(ex.x+=1,ed+1===ec.length-1&&(ec[0].x+=1)),em=!0)}let ex=eo.mercatorXfromLng(ed.center.lng);return em&&ex<Math.abs(ex-1)&&ec.forEach(eo=>{eo.x-=1}),{polygon:ec,unwrapped:em}}(A(ec,ed).map(ec=>new eo.Point(z(ec.x),ec.y)),ed);return{polygon:e_.polygon.map(ec=>new eo.MercatorCoordinate(ec.x,ec.y)),unwrapped:e_.unwrapped}}};function A(ec,ed){return eo.resample(ec,eo=>{let ec=ed.pointCoordinate3D(eo);eo.x=ec.x,eo.y=ec.y},1/256)}function z(eo){return eo<0?1+eo%1:eo%1}function O(ec,ed,em,e_,eg){let s=function(em,e_){if(em)return eg(em);if(e_){ec.url&&e_.tiles&&ec.tiles&&delete ec.tiles;let em=eo.pick(eo.extend(e_,ec),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);e_.vector_layers&&(em.vectorLayers=e_.vector_layers,em.vectorLayerIds=em.vectorLayers.map(eo=>eo.id)),em.tiles=ed.canonicalizeTileset(em,ec.url),eg(null,em)}};return ec.url?eo.getJSON(ed.transformRequest(ed.normalizeSourceURL(ec.url,null,em,e_),eo.ResourceType.Source),s):eo.exported.frame(()=>s(null,ec))}let B=class B{constructor(ec,ed,em){this.bounds=eo.LngLatBounds.convert(this.validateBounds(ec)),this.minzoom=ed||0,this.maxzoom=em||24}validateBounds(eo){return Array.isArray(eo)&&4===eo.length?[Math.max(-180,eo[0]),Math.max(-90,eo[1]),Math.min(180,eo[2]),Math.min(90,eo[3])]:[-180,-90,180,90]}contains(ec){let ed=Math.pow(2,ec.z),em=Math.floor(eo.mercatorXfromLng(this.bounds.getWest())*ed),e_=Math.floor(eo.mercatorYfromLat(this.bounds.getNorth())*ed),eg=Math.ceil(eo.mercatorXfromLng(this.bounds.getEast())*ed),ex=Math.ceil(eo.mercatorYfromLat(this.bounds.getSouth())*ed);return ec.x>=em&&ec.x<eg&&ec.y>=e_&&ec.y<ex}};let k=class k{constructor(eo,ec,ed){this.context=eo;let em=eo.gl;this.buffer=em.createBuffer(),this.dynamicDraw=!!ed,this.context.unbindVAO(),eo.bindElementBuffer.set(this.buffer),em.bufferData(em.ELEMENT_ARRAY_BUFFER,ec.arrayBuffer,this.dynamicDraw?em.DYNAMIC_DRAW:em.STATIC_DRAW),this.dynamicDraw||ec.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(eo){let ec=this.context.gl;this.context.unbindVAO(),this.bind(),ec.bufferSubData(ec.ELEMENT_ARRAY_BUFFER,0,eo.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}};let eE={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};let U=class U{constructor(eo,ec,ed,em){this.length=ec.length,this.attributes=ed,this.itemSize=ec.bytesPerElement,this.dynamicDraw=em,this.context=eo;let e_=eo.gl;this.buffer=e_.createBuffer(),eo.bindVertexBuffer.set(this.buffer),e_.bufferData(e_.ARRAY_BUFFER,ec.arrayBuffer,this.dynamicDraw?e_.DYNAMIC_DRAW:e_.STATIC_DRAW),this.dynamicDraw||ec.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(eo){let ec=this.context.gl;this.bind(),ec.bufferSubData(ec.ARRAY_BUFFER,0,eo.arrayBuffer)}enableAttributes(eo,ec){for(let ed=0;ed<this.attributes.length;ed++){let em=ec.attributes[this.attributes[ed].name];void 0!==em&&eo.enableVertexAttribArray(em)}}setVertexAttribPointers(eo,ec,ed){for(let em=0;em<this.attributes.length;em++){let e_=this.attributes[em],eg=ec.attributes[e_.name];void 0!==eg&&eo.vertexAttribPointer(eg,e_.components,eo[eE[e_.type]],!1,this.itemSize,e_.offset+this.itemSize*(ed||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}};let N=class N{constructor(eo){this.gl=eo.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(eo){}getDefault(){return this.default}setDefault(){this.set(this.default)}};let j=class j extends N{getDefault(){return eo.Color.transparent}set(eo){let ec=this.current;(eo.r!==ec.r||eo.g!==ec.g||eo.b!==ec.b||eo.a!==ec.a||this.dirty)&&(this.gl.clearColor(eo.r,eo.g,eo.b,eo.a),this.current=eo,this.dirty=!1)}};let G=class G extends N{getDefault(){return 1}set(eo){(eo!==this.current||this.dirty)&&(this.gl.clearDepth(eo),this.current=eo,this.dirty=!1)}};let Z=class Z extends N{getDefault(){return 0}set(eo){(eo!==this.current||this.dirty)&&(this.gl.clearStencil(eo),this.current=eo,this.dirty=!1)}};let V=class V extends N{getDefault(){return[!0,!0,!0,!0]}set(eo){let ec=this.current;(eo[0]!==ec[0]||eo[1]!==ec[1]||eo[2]!==ec[2]||eo[3]!==ec[3]||this.dirty)&&(this.gl.colorMask(eo[0],eo[1],eo[2],eo[3]),this.current=eo,this.dirty=!1)}};let W=class W extends N{getDefault(){return!0}set(eo){(eo!==this.current||this.dirty)&&(this.gl.depthMask(eo),this.current=eo,this.dirty=!1)}};let X=class X extends N{getDefault(){return 255}set(eo){(eo!==this.current||this.dirty)&&(this.gl.stencilMask(eo),this.current=eo,this.dirty=!1)}};let q=class q extends N{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(eo){let ec=this.current;(eo.func!==ec.func||eo.ref!==ec.ref||eo.mask!==ec.mask||this.dirty)&&(this.gl.stencilFunc(eo.func,eo.ref,eo.mask),this.current=eo,this.dirty=!1)}};let $=class $ extends N{getDefault(){let eo=this.gl;return[eo.KEEP,eo.KEEP,eo.KEEP]}set(eo){let ec=this.current;(eo[0]!==ec[0]||eo[1]!==ec[1]||eo[2]!==ec[2]||this.dirty)&&(this.gl.stencilOp(eo[0],eo[1],eo[2]),this.current=eo,this.dirty=!1)}};let H=class H extends N{getDefault(){return!1}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;eo?ec.enable(ec.STENCIL_TEST):ec.disable(ec.STENCIL_TEST),this.current=eo,this.dirty=!1}};let Y=class Y extends N{getDefault(){return[0,1]}set(eo){let ec=this.current;(eo[0]!==ec[0]||eo[1]!==ec[1]||this.dirty)&&(this.gl.depthRange(eo[0],eo[1]),this.current=eo,this.dirty=!1)}};let K=class K extends N{getDefault(){return!1}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;eo?ec.enable(ec.DEPTH_TEST):ec.disable(ec.DEPTH_TEST),this.current=eo,this.dirty=!1}};let J=class J extends N{getDefault(){return this.gl.LESS}set(eo){(eo!==this.current||this.dirty)&&(this.gl.depthFunc(eo),this.current=eo,this.dirty=!1)}};let Q=class Q extends N{getDefault(){return!1}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;eo?ec.enable(ec.BLEND):ec.disable(ec.BLEND),this.current=eo,this.dirty=!1}};let ee=class ee extends N{getDefault(){let eo=this.gl;return[eo.ONE,eo.ZERO]}set(eo){let ec=this.current;(eo[0]!==ec[0]||eo[1]!==ec[1]||this.dirty)&&(this.gl.blendFunc(eo[0],eo[1]),this.current=eo,this.dirty=!1)}};let te=class te extends N{getDefault(){return eo.Color.transparent}set(eo){let ec=this.current;(eo.r!==ec.r||eo.g!==ec.g||eo.b!==ec.b||eo.a!==ec.a||this.dirty)&&(this.gl.blendColor(eo.r,eo.g,eo.b,eo.a),this.current=eo,this.dirty=!1)}};let ie=class ie extends N{getDefault(){return this.gl.FUNC_ADD}set(eo){(eo!==this.current||this.dirty)&&(this.gl.blendEquation(eo),this.current=eo,this.dirty=!1)}};let oe=class oe extends N{getDefault(){return!1}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;eo?ec.enable(ec.CULL_FACE):ec.disable(ec.CULL_FACE),this.current=eo,this.dirty=!1}};let re=class re extends N{getDefault(){return this.gl.BACK}set(eo){(eo!==this.current||this.dirty)&&(this.gl.cullFace(eo),this.current=eo,this.dirty=!1)}};let ne=class ne extends N{getDefault(){return this.gl.CCW}set(eo){(eo!==this.current||this.dirty)&&(this.gl.frontFace(eo),this.current=eo,this.dirty=!1)}};let eM,eS=class extends N{getDefault(){return null}set(eo){(eo!==this.current||this.dirty)&&(this.gl.useProgram(eo),this.current=eo,this.dirty=!1)}};let le=class le extends N{getDefault(){return this.gl.TEXTURE0}set(eo){(eo!==this.current||this.dirty)&&(this.gl.activeTexture(eo),this.current=eo,this.dirty=!1)}};let ce=class ce extends N{getDefault(){let eo=this.gl;return[0,0,eo.drawingBufferWidth,eo.drawingBufferHeight]}set(eo){let ec=this.current;(eo[0]!==ec[0]||eo[1]!==ec[1]||eo[2]!==ec[2]||eo[3]!==ec[3]||this.dirty)&&(this.gl.viewport(eo[0],eo[1],eo[2],eo[3]),this.current=eo,this.dirty=!1)}};let he=class he extends N{getDefault(){return null}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;ec.bindFramebuffer(ec.FRAMEBUFFER,eo),this.current=eo,this.dirty=!1}};let ue=class ue extends N{getDefault(){return null}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;ec.bindRenderbuffer(ec.RENDERBUFFER,eo),this.current=eo,this.dirty=!1}};let _e=class _e extends N{getDefault(){return null}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;ec.bindTexture(ec.TEXTURE_2D,eo),this.current=eo,this.dirty=!1}};let de=class de extends N{getDefault(){return null}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;ec.bindBuffer(ec.ARRAY_BUFFER,eo),this.current=eo,this.dirty=!1}};let pe=class pe extends N{getDefault(){return null}set(eo){let ec=this.gl;ec.bindBuffer(ec.ELEMENT_ARRAY_BUFFER,eo),this.current=eo,this.dirty=!1}};let me=class me extends N{constructor(eo){super(eo),this.vao=eo.extVertexArrayObject}getDefault(){return null}set(eo){this.vao&&(eo!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(eo),this.current=eo,this.dirty=!1)}};let fe=class fe extends N{getDefault(){return 4}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;ec.pixelStorei(ec.UNPACK_ALIGNMENT,eo),this.current=eo,this.dirty=!1}};let ge=class ge extends N{getDefault(){return!1}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;ec.pixelStorei(ec.UNPACK_PREMULTIPLY_ALPHA_WEBGL,eo),this.current=eo,this.dirty=!1}};let ve=class ve extends N{getDefault(){return!1}set(eo){if(eo===this.current&&!this.dirty)return;let ec=this.gl;ec.pixelStorei(ec.UNPACK_FLIP_Y_WEBGL,eo),this.current=eo,this.dirty=!1}};let xe=class xe extends N{constructor(eo,ec){super(eo),this.context=eo,this.parent=ec}getDefault(){return null}};let ye=class ye extends xe{setDirty(){this.dirty=!0}set(eo){if(eo===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let ec=this.gl;ec.framebufferTexture2D(ec.FRAMEBUFFER,ec.COLOR_ATTACHMENT0,ec.TEXTURE_2D,eo,0),this.current=eo,this.dirty=!1}};let be=class be extends xe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(eo){if(eo===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let ec=this.gl;ec.framebufferRenderbuffer(ec.FRAMEBUFFER,this.attachment(),ec.RENDERBUFFER,eo),this.current=eo,this.dirty=!1}};let we=class we extends be{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}};let Te=class Te{constructor(eo,ec,ed,em){this.context=eo,this.width=ec,this.height=ed;let e_=this.framebuffer=eo.gl.createFramebuffer();this.colorAttachment=new ye(eo,e_),em&&(this.depthAttachment=new be(eo,e_))}destroy(){let eo=this.context.gl,ec=this.colorAttachment.get();if(ec&&eo.deleteTexture(ec),this.depthAttachment){let ec=this.depthAttachment.get();ec&&eo.deleteRenderbuffer(ec)}eo.deleteFramebuffer(this.framebuffer)}};let Ee=class Ee{constructor(eo,ec=!1){this.gl=eo,this.isWebGL2=ec,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),ec&&(this.extVertexArrayObject={createVertexArrayOES:eo.createVertexArray.bind(eo),deleteVertexArrayOES:eo.deleteVertexArray.bind(eo),bindVertexArrayOES:eo.bindVertexArray.bind(eo)}),this.clearColor=new j(this),this.clearDepth=new G(this),this.clearStencil=new Z(this),this.colorMask=new V(this),this.depthMask=new W(this),this.stencilMask=new X(this),this.stencilFunc=new q(this),this.stencilOp=new $(this),this.stencilTest=new H(this),this.depthRange=new Y(this),this.depthTest=new K(this),this.depthFunc=new J(this),this.blend=new Q(this),this.blendFunc=new ee(this),this.blendColor=new te(this),this.blendEquation=new ie(this),this.cullFace=new oe(this),this.cullFaceSide=new re(this),this.frontFace=new ne(this),this.program=new eS(this),this.activeTexture=new le(this),this.viewport=new ce(this),this.bindFramebuffer=new he(this),this.bindRenderbuffer=new ue(this),this.bindTexture=new _e(this),this.bindVertexBuffer=new de(this),this.bindElementBuffer=new pe(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new me(this),this.pixelStoreUnpack=new fe(this),this.pixelStoreUnpackPremultiplyAlpha=new ge(this),this.pixelStoreUnpackFlipY=new ve(this),this.extTextureFilterAnisotropic=eo.getExtension("EXT_texture_filter_anisotropic")||eo.getExtension("MOZ_EXT_texture_filter_anisotropic")||eo.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=eo.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=eo.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=eo.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=eo.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),ec||(this.extTextureHalfFloat=eo.getExtension("OES_texture_half_float")),(ec||this.extTextureHalfFloat&&eo.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=eo.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=ec||eo.getExtension("OES_standard_derivatives"),this.extTimerQuery=eo.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=eo.getParameter(eo.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(eo,ec){return new k(this,eo,ec)}createVertexBuffer(eo,ec,ed){return new U(this,eo,ec,ed)}createRenderbuffer(eo,ec,ed){let em=this.gl,e_=em.createRenderbuffer();return this.bindRenderbuffer.set(e_),em.renderbufferStorage(em.RENDERBUFFER,eo,ec,ed),this.bindRenderbuffer.set(null),e_}createFramebuffer(eo,ec,ed){return new Te(this,eo,ec,ed)}clear({color:eo,depth:ec,stencil:ed}){let em=this.gl,e_=0;eo&&(e_|=em.COLOR_BUFFER_BIT,this.clearColor.set(eo),this.colorMask.set([!0,!0,!0,!0])),void 0!==ec&&(e_|=em.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(ec),this.depthMask.set(!0)),void 0!==ed&&(e_|=em.STENCIL_BUFFER_BIT,this.clearStencil.set(ed),this.stencilMask.set(255)),em.clear(e_)}setCullFace(eo){!1===eo.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(eo.mode),this.frontFace.set(eo.frontFace))}setDepthMode(eo){eo.func!==this.gl.ALWAYS||eo.mask?(this.depthTest.set(!0),this.depthFunc.set(eo.func),this.depthMask.set(eo.mask),this.depthRange.set(eo.range)):this.depthTest.set(!1)}setStencilMode(eo){eo.test.func!==this.gl.ALWAYS||eo.mask?(this.stencilTest.set(!0),this.stencilMask.set(eo.mask),this.stencilOp.set([eo.fail,eo.depthFail,eo.pass]),this.stencilFunc.set({func:eo.test.func,ref:eo.ref,mask:eo.test.mask})):this.stencilTest.set(!1)}setColorMode(ec){t(ec.blendFunction,eo.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(ec.blendFunction),this.blendColor.set(ec.blendColor)),this.colorMask.set(ec.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}};let Ce=class Ce extends eo.Evented{constructor(ec,ed,em,e_){if(super(),this.id=ec,this.dispatcher=em,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,eo.extend(this,eo.pick(ed,["url","scheme","tileSize","promoteId"])),this._options=eo.extend({type:"vector"},ed),this._collectResourceTiming=ed.collectResourceTiming,512!==this.tileSize)throw Error("vector tile sources must have a tileSize of 512");this.setEventedParent(e_),this._tileWorkers={},this._deduped=new eo.DedupedRequest}load(ec){this._loaded=!1,this.fire(new eo.Event("dataloading",{dataType:"source"}));let ed=Array.isArray(this.map._language)?this.map._language.join():this.map._language,em=this.map._worldview;this._tileJSONRequest=O(this._options,this.map._requestManager,ed,em,(e_,eg)=>{this._tileJSONRequest=null,this._loaded=!0,e_?(ed&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${ed}`),em&&2!==em.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${em}`),this.fire(new eo.ErrorEvent(e_))):eg&&(eo.extend(this,eg),eg.bounds&&(this.tileBounds=new B(eg.bounds,this.minzoom,this.maxzoom)),eo.postTurnstileEvent(eg.tiles,this.map._requestManager._customAccessToken),this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"content"}))),ec&&ec(e_)})}loaded(){return this._loaded}hasTile(eo){return!this.tileBounds||this.tileBounds.contains(eo.canonical)}onAdd(eo){this.map=eo,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(eo){return this._options.tiles=eo,this.reload(),this}setUrl(eo){return this.url=eo,this._options.url=eo,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return eo.extend({},this._options)}loadTile(ec,ed){let em=this.map._requestManager.normalizeTileURL(ec.tileID.canonical.url(this.tiles,this.scheme)),e_={request:this.map._requestManager.transformRequest(em,eo.ResourceType.Tile),data:void 0,uid:ec.uid,tileID:ec.tileID,tileZoom:ec.tileZoom,zoom:ec.tileID.overscaledZ,tileSize:this.tileSize*ec.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:eo.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:ec.isSymbolTile};if(e_.request.collectResourceTiming=this._collectResourceTiming,ec.actor&&"expired"!==ec.state)"loading"===ec.state?ec.reloadCallback=ed:ec.request=ec.actor.send("reloadTile",e_,n.bind(this));else if(ec.actor=this._tileWorkers[em]=this._tileWorkers[em]||this.dispatcher.getActor(),this.dispatcher.ready)ec.request=ec.actor.send("loadTile",e_,n.bind(this),void 0,!0);else{let ed=eo.loadVectorTile.call({deduped:this._deduped},e_,(eo,ed)=>{eo||!ed?n.call(this,eo):(e_.data={cacheControl:ed.cacheControl,expires:ed.expires,rawData:ed.rawData.slice(0)},ec.actor&&ec.actor.send("loadTile",e_,n.bind(this),void 0,!0))},!0);ec.request={cancel:ed}}function n(em,e_){return delete ec.request,ec.aborted?ed(null):em&&404!==em.status?ed(em):(e_&&e_.resourceTiming&&(ec.resourceTiming=e_.resourceTiming),this.map._refreshExpiredTiles&&e_&&ec.setExpiryData(e_),ec.loadVectorData(e_,this.map.painter),eo.cacheEntryPossiblyAdded(this.dispatcher),ed(null),void(ec.reloadCallback&&(this.loadTile(ec,ec.reloadCallback),ec.reloadCallback=null)))}}abortTile(eo){eo.request&&(eo.request.cancel(),delete eo.request),eo.actor&&eo.actor.send("abortTile",{uid:eo.uid,type:this.type,source:this.id})}unloadTile(eo){eo.unloadVectorData(),eo.actor&&eo.actor.send("removeTile",{uid:eo.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}};let Me=class Me extends eo.Evented{constructor(ec,ed,em,e_){super(),this.id=ec,this.dispatcher=em,this.setEventedParent(e_),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=eo.extend({type:"raster"},ed),eo.extend(this,eo.pick(ed,["url","scheme","tileSize"]))}load(ec){this._loaded=!1,this.fire(new eo.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=O(this._options,this.map._requestManager,null,null,(ed,em)=>{this._tileJSONRequest=null,this._loaded=!0,ed?this.fire(new eo.ErrorEvent(ed)):em&&(eo.extend(this,em),em.bounds&&(this.tileBounds=new B(em.bounds,this.minzoom,this.maxzoom)),eo.postTurnstileEvent(em.tiles),this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"content"}))),ec&&ec(ed)})}loaded(){return this._loaded}onAdd(eo){this.map=eo,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(eo){return this._options.tiles=eo,this.reload(),this}setUrl(eo){return this.url=eo,this._options.url=eo,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return eo.extend({},this._options)}hasTile(eo){return!this.tileBounds||this.tileBounds.contains(eo.canonical)}loadTile(ec,ed){let em=eo.exported.devicePixelRatio>=2,e_=this.map._requestManager.normalizeTileURL(ec.tileID.canonical.url(this.tiles,this.scheme),em,this.tileSize);ec.request=eo.getImage(this.map._requestManager.transformRequest(e_,eo.ResourceType.Tile),(em,e_,eg,ex)=>(delete ec.request,ec.aborted?(ec.state="unloaded",ed(null)):em?(ec.state="errored",ed(em)):e_?(this.map._refreshExpiredTiles&&ec.setExpiryData({cacheControl:eg,expires:ex}),ec.setTexture(e_,this.map.painter),ec.state="loaded",eo.cacheEntryPossiblyAdded(this.dispatcher),void ed(null)):ed(null)))}static loadTileData(eo,ec,ed){eo.setTexture(ec,ed)}static unloadTileData(eo,ec){eo.texture&&ec.saveTileTexture(eo.texture)}abortTile(eo,ec){eo.request&&(eo.request.cancel(),delete eo.request),ec()}unloadTile(eo,ec){eo.texture&&this.map.painter.saveTileTexture(eo.texture),ec()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}};function Ie(ec,ed,em,e_,eg,ex,ev,eb){let ew=[ec,em,eg,ed,e_,ex,1,1,1],eT=[ev,eb,1],eE=eo.adjoint([],ew),[eM,eS,eA]=eo.transformMat3(eT,eT,eo.transpose(eE,eE));return eo.multiply$1(ew,[eM,0,0,0,eS,0,0,0,eA],ew)}let Pe=class Pe extends eo.Evented{constructor(eo,ec,ed,em){super(),this.id=eo,this.dispatcher=ed,this.coordinates=ec.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(em),this.options=ec,this._dirty=!1}load(ec,ed){this._loaded=ed||!1,this.fire(new eo.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=eo.getImage(this.map._requestManager.transformRequest(this.url,eo.ResourceType.Image),(ed,em)=>{if(this._imageRequest=null,this._loaded=!0,ed)this.fire(new eo.ErrorEvent(ed));else if(em){let{HTMLImageElement:ed}=eo.window;this.image=em instanceof ed?eo.exported.getImageData(em):em,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,ec&&(this.coordinates=ec),this._finishLoading()}})}loaded(){return this._loaded}updateImage(eo){return this.image&&eo.url&&(this._imageRequest&&eo.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=eo.url,this.load(eo.coordinates,this._loaded)),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(eo){this.map=eo,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(ec){this.coordinates=ec,this._boundsArray=void 0;let ed=ec.map(eo.MercatorCoordinate.fromLngLat);return this.tileID=function(ec){let ed=1/0,em=1/0,e_=-1/0,eg=-1/0;for(let eo of ec)ed=Math.min(ed,eo.x),em=Math.min(em,eo.y),e_=Math.max(e_,eo.x),eg=Math.max(eg,eo.y);let ex=Math.max(e_-ed,eg-em),ev=Math.max(0,Math.floor(-Math.log(ex)/Math.LN2)),eb=Math.pow(2,ev);return new eo.CanonicalTileID(ev,Math.floor((ed+e_)/2*eb),Math.floor((em+eg)/2*eb))}(ed),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(ec){for(let eo in this.tiles){let ec=this.tiles[eo];"loaded"!==ec.state&&(ec.state="loaded",ec.texture=this.texture)}if(this._boundsArray)return;let ed=eo.tileTransform(this.tileID,this.map.transform.projection),[em,e_,eg,ex]=this.coordinates.map(ec=>{let em=ed.projection.project(ec[0],ec[1]);return eo.getTilePoint(ed,em)._round()});this.perspectiveTransform=function(ec,ed,em,e_,eg,ex,ev,eb,ew,eT){let eE=Ie(0,0,ec,0,0,ed,ec,ed),eM=Ie(em,e_,eg,ex,ev,eb,ew,eT);return eo.multiply$1(eM,eo.adjoint(eE,eE),eM),[eM[6]/eM[8]*ec/eo.EXTENT,eM[7]/eM[8]*ed/eo.EXTENT]}(this.width,this.height,em.x,em.y,e_.x,e_.y,ex.x,ex.y,eg.x,eg.y);let ev=this._boundsArray=new eo.StructArrayLayout4i8;ev.emplaceBack(em.x,em.y,0,0),ev.emplaceBack(e_.x,e_.y,eo.EXTENT,0),ev.emplaceBack(ex.x,ex.y,0,eo.EXTENT),ev.emplaceBack(eg.x,eg.y,eo.EXTENT,eo.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=ec.createVertexBuffer(ev,eo.boundsAttributes.members),this.boundsSegments=eo.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;let ec=this.map.painter.context,ed=ec.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new eo.Texture(ec,this.image,ed.RGBA),this.texture.bind(ed.LINEAR,ed.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(ec)}loadTile(eo,ec){this.tileID&&this.tileID.equals(eo.tileID.canonical)?(this.tiles[String(eo.tileID.wrap)]=eo,eo.buckets={}):eo.state="errored",ec(null)}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}};let eA={vector:Ce,raster:Me,"raster-dem":class extends Me{constructor(ec,ed,em,e_){super(ec,ed,em,e_),this.type="raster-dem",this.maxzoom=22,this._options=eo.extend({type:"raster-dem"},ed),this.encoding=ed.encoding||"mapbox"}loadTile(ec,ed){let em=this.map._requestManager.normalizeTileURL(ec.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function r(eo,em){eo&&(ec.state="errored",ed(eo)),em&&(ec.dem=em,ec.dem.onDeserialize(),ec.needsHillshadePrepare=!0,ec.needsDEMTextureUpload=!0,ec.state="loaded",ed(null))}ec.request=eo.getImage(this.map._requestManager.transformRequest(em,eo.ResourceType.Tile),(function(em,e_,eg,ex){if(delete ec.request,ec.aborted)ec.state="unloaded",ed(null);else if(em)ec.state="errored",ed(em);else if(e_){this.map._refreshExpiredTiles&&ec.setExpiryData({cacheControl:eg,expires:ex});let ed=eo.window.ImageBitmap&&e_ instanceof eo.window.ImageBitmap&&(null==eM&&(eM=eo.window.OffscreenCanvas&&new eo.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof eo.window.createImageBitmap),eM),em=1-(e_.width-eo.prevPowerOfTwo(e_.width))/2;em<1||ec.neighboringTiles||(ec.neighboringTiles=this._getNeighboringTiles(ec.tileID));let ev=ed?e_:eo.exported.getImageData(e_,em),eb={uid:ec.uid,coord:ec.tileID,source:this.id,rawImageData:ev,encoding:this.encoding,padding:em};ec.actor&&"expired"!==ec.state||(ec.actor=this.dispatcher.getActor(),ec.actor.send("loadDEMTile",eb,r.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(ec){let ed=ec.canonical,em=Math.pow(2,ed.z),e_=(ed.x-1+em)%em,eg=0===ed.x?ec.wrap-1:ec.wrap,ex=(ed.x+1+em)%em,ev=ed.x+1===em?ec.wrap+1:ec.wrap,eb={};return eb[new eo.OverscaledTileID(ec.overscaledZ,eg,ed.z,e_,ed.y).key]={backfilled:!1},eb[new eo.OverscaledTileID(ec.overscaledZ,ev,ed.z,ex,ed.y).key]={backfilled:!1},ed.y>0&&(eb[new eo.OverscaledTileID(ec.overscaledZ,eg,ed.z,e_,ed.y-1).key]={backfilled:!1},eb[new eo.OverscaledTileID(ec.overscaledZ,ec.wrap,ed.z,ed.x,ed.y-1).key]={backfilled:!1},eb[new eo.OverscaledTileID(ec.overscaledZ,ev,ed.z,ex,ed.y-1).key]={backfilled:!1}),ed.y+1<em&&(eb[new eo.OverscaledTileID(ec.overscaledZ,eg,ed.z,e_,ed.y+1).key]={backfilled:!1},eb[new eo.OverscaledTileID(ec.overscaledZ,ec.wrap,ed.z,ed.x,ed.y+1).key]={backfilled:!1},eb[new eo.OverscaledTileID(ec.overscaledZ,ev,ed.z,ex,ed.y+1).key]={backfilled:!1}),eb}unloadTile(eo){eo.demTexture&&this.map.painter.saveTileTexture(eo.demTexture),eo.fbo&&(eo.fbo.destroy(),delete eo.fbo),eo.dem&&delete eo.dem,delete eo.neighboringTiles,eo.state="unloaded"}},geojson:class extends eo.Evented{constructor(ec,ed,em,e_){super(),this.id=ec,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=em.getActor(),this.setEventedParent(e_),this._data=ed.data,this._options=eo.extend({},ed),this._collectResourceTiming=ed.collectResourceTiming,void 0!==ed.maxzoom&&(this.maxzoom=ed.maxzoom),ed.type&&(this.type=ed.type),ed.attribution&&(this.attribution=ed.attribution),this.promoteId=ed.promoteId;let eg=eo.EXTENT/this.tileSize;this.workerOptions=eo.extend({source:this.id,cluster:ed.cluster||!1,geojsonVtOptions:{buffer:(void 0!==ed.buffer?ed.buffer:128)*eg,tolerance:(void 0!==ed.tolerance?ed.tolerance:.375)*eg,extent:eo.EXTENT,maxZoom:this.maxzoom,lineMetrics:ed.lineMetrics||!1,generateId:ed.generateId||!1},superclusterOptions:{maxZoom:void 0!==ed.clusterMaxZoom?ed.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,ed.clusterMinPoints||2),extent:eo.EXTENT,radius:(void 0!==ed.clusterRadius?ed.clusterRadius:50)*eg,log:!1,generateId:ed.generateId||!1},clusterProperties:ed.clusterProperties,filter:ed.filter},ed.workerOptions)}onAdd(eo){this.map=eo,this.setData(this._data)}setData(eo){return this._data=eo,this._updateWorkerData(),this}getClusterExpansionZoom(eo,ec){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:eo,source:this.id},ec),this}getClusterChildren(eo,ec){return this.actor.send("geojson.getClusterChildren",{clusterId:eo,source:this.id},ec),this}getClusterLeaves(eo,ec,ed,em){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:eo,limit:ec,offset:ed},em),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new eo.Event("dataloading",{dataType:"source"})),this._loaded=!1;let ec=eo.extend({},this.workerOptions),ed=this._data;"string"==typeof ed?(ec.request=this.map._requestManager.transformRequest(eo.exported.resolveURL(ed),eo.ResourceType.Source),ec.request.collectResourceTiming=this._collectResourceTiming):ec.data=JSON.stringify(ed),this._pendingLoad=this.actor.send(`${this.type}.loadData`,ec,(ec,ed)=>{if(this._loaded=!0,this._pendingLoad=null,ec)this.fire(new eo.ErrorEvent(ec));else{let ec={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&ed&&ed.resourceTiming&&ed.resourceTiming[this.id]&&(ec.resourceTiming=ed.resourceTiming[this.id]),this.fire(new eo.Event("data",ec)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(ec,ed){let em=ec.actor?"reloadTile":"loadTile";ec.actor=this.actor,ec.request=this.actor.send(em,{type:this.type,uid:ec.uid,tileID:ec.tileID,tileZoom:ec.tileZoom,zoom:ec.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:eo.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(eo,e_)=>(delete ec.request,ec.unloadVectorData(),ec.aborted?ed(null):eo?ed(eo):(ec.loadVectorData(e_,this.map.painter,"reloadTile"===em),ed(null))),void 0,"loadTile"===em)}abortTile(eo){eo.request&&(eo.request.cancel(),delete eo.request),eo.aborted=!0}unloadTile(eo){eo.unloadVectorData(),this.actor.send("removeTile",{uid:eo.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return eo.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Pe{constructor(eo,ec,ed,em){super(eo,ec,ed,em),this.roundZoom=!0,this.type="video",this.options=ec}load(){this._loaded=!1;let ec=this.options;for(let ed of(this.urls=[],ec.urls))this.urls.push(this.map._requestManager.transformRequest(ed,eo.ResourceType.Source).url);eo.getVideo(this.urls,(ec,ed)=>{this._loaded=!0,ec?this.fire(new eo.ErrorEvent(ec)):ed&&(this.video=ed,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(ec){if(this.video){let ed=this.video.seekable;ec<ed.start(0)||ec>ed.end(0)?this.fire(new eo.ErrorEvent(new eo.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${ed.start(0)} and ${ed.end(0)}-second mark.`))):this.video.currentTime=ec}}getVideo(){return this.video}onAdd(eo){this.map||(this.map=eo,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;let ec=this.map.painter.context,ed=ec.gl;this.texture?this.video.paused||(this.texture.bind(ed.LINEAR,ed.CLAMP_TO_EDGE),ed.texSubImage2D(ed.TEXTURE_2D,0,0,0,ed.RGBA,ed.UNSIGNED_BYTE,this.video)):(this.texture=new eo.Texture(ec,this.video,ed.RGBA),this.texture.bind(ed.LINEAR,ed.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(ec)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Pe,canvas:class extends Pe{constructor(ec,ed,em,e_){super(ec,ed,em,e_),ed.coordinates?Array.isArray(ed.coordinates)&&4===ed.coordinates.length&&!ed.coordinates.some(eo=>!Array.isArray(eo)||2!==eo.length||eo.some(eo=>"number"!=typeof eo))||this.fire(new eo.ErrorEvent(new eo.ValidationError(`sources.${ec}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new eo.ErrorEvent(new eo.ValidationError(`sources.${ec}`,null,'missing required property "coordinates"'))),ed.animate&&"boolean"!=typeof ed.animate&&this.fire(new eo.ErrorEvent(new eo.ValidationError(`sources.${ec}`,null,'optional "animate" property must be a boolean value'))),ed.canvas?"string"==typeof ed.canvas||ed.canvas instanceof eo.window.HTMLCanvasElement||this.fire(new eo.ErrorEvent(new eo.ValidationError(`sources.${ec}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new eo.ErrorEvent(new eo.ValidationError(`sources.${ec}`,null,'missing required property "canvas"'))),this.options=ed,this.animate=void 0===ed.animate||ed.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof eo.window.HTMLCanvasElement?this.options.canvas:eo.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new eo.ErrorEvent(Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(eo){this.map=eo,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let ec=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,ec=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,ec=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;let ed=this.map.painter.context;this.texture?(ec||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new eo.Texture(ed,this.canvas,ed.gl.RGBA,{premultiply:!0}),this._prepareData(ed)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let eo of[this.canvas.width,this.canvas.height])if(isNaN(eo)||eo<=0)return!0;return!1}},custom:class extends eo.Evented{constructor(ec,ed,em,e_){super(),this.id=ec,this.type="custom",this._dataType="raster",this._dispatcher=em,this._implementation=ed,this.setEventedParent(e_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new eo.ErrorEvent(Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new eo.ErrorEvent(Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new B(this._implementation.bounds,this.minzoom,this.maxzoom)),ed.update=this._update.bind(this),ed.clearTiles=this._clearTiles.bind(this),ed.coveringTiles=this._coveringTiles.bind(this),eo.extend(this,eo.pick(ed,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return eo.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(ec){this._map=ec,this._loaded=!1,this.fire(new eo.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(ec),this.load()}onRemove(eo){this._implementation.onRemove&&this._implementation.onRemove(eo)}hasTile(eo){if(this._implementation.hasTile){let{x:ec,y:ed,z:em}=eo.canonical;return this._implementation.hasTile({x:ec,y:ed,z:em})}return!this.tileBounds||this.tileBounds.contains(eo.canonical)}loadTile(ec,ed){let{x:em,y:e_,z:eg}=ec.tileID.canonical,ex=new eo.window.AbortController;ec.request=Promise.resolve(this._implementation.loadTile({x:em,y:e_,z:eg},{signal:ex.signal})).then((function(em){return delete ec.request,ec.aborted?(ec.state="unloaded",ed(null)):void 0===em?(ec.state="errored",ed(null)):null===em?(this.loadTileData(ec,{width:this.tileSize,height:this.tileSize,data:null}),ec.state="loaded",ed(null)):em instanceof eo.window.ImageData||em instanceof eo.window.HTMLCanvasElement||em instanceof eo.window.ImageBitmap||em instanceof eo.window.HTMLImageElement?(this.loadTileData(ec,em),ec.state="loaded",void ed(null)):(ec.state="errored",ed(Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(eo=>{20!==eo.code&&(ec.state="errored",ed(eo))}),ec.request.cancel=()=>ex.abort()}loadTileData(eo,ec){Me.loadTileData(eo,ec,this._map.painter)}unloadTileData(eo){Me.unloadTileData(eo,this._map.painter)}unloadTile(eo,ec){if(this.unloadTileData(eo),this._implementation.unloadTile){let{x:ec,y:ed,z:em}=eo.tileID.canonical;this._implementation.unloadTile({x:ec,y:ed,z:em})}ec()}abortTile(eo,ec){eo.request&&eo.request.cancel&&(eo.request.cancel(),delete eo.request),ec()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(eo=>({x:eo.canonical.x,y:eo.canonical.y,z:eo.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new eo.Event("data",{dataType:"source",sourceDataType:"content"}))}}},De=function(ec,ed,em,e_){let eg=new eA[ed.type](ec,ed,em,e_);if(eg.id!==ec)throw Error(`Expected Source id to be ${ec} instead of ${eg.id}`);return eo.bindAll(["load","abort","unload","serialize","prepare"],eg),eg};function Re(eo,ec){let ed=eo.tileID,em=ec.tileID;return ed.overscaledZ-em.overscaledZ||ed.canonical.y-em.canonical.y||ed.wrap-em.wrap||ed.canonical.x-em.canonical.x}function Oe(){return null!=tC.workerClass?new tC.workerClass:new eo.window.Worker(tC.workerUrl)}let eI="mapboxgl_preloaded_worker_pool";let ke=class ke{constructor(){this.active={}}acquire(eo){if(!this.workers)for(this.workers=[];this.workers.length<ke.workerCount;)this.workers.push(new Oe);return this.active[eo]=!0,this.workers.slice()}release(eo){delete this.active[eo],0===this.numActive()&&(this.workers.forEach(eo=>{eo.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[eI]}numActive(){return Object.keys(this.active).length}};function Ue(){return ed||(ed=new ke),ed}function je(ec){ec=ec.slice();let ed=Object.create(null);for(let eo=0;eo<ec.length;eo++)ed[ec[eo].id]=ec[eo];for(let em=0;em<ec.length;em++)"ref"in ec[em]&&(ec[em]=function(ec,ed){let em={};for(let eo in ec)"ref"!==eo&&(em[eo]=ec[eo]);return eo.refProperties.forEach(eo=>{eo in ed&&(em[eo]=ed[eo])}),em}(ec[em],ed[ec[em].ref]));return ec}ke.workerCount=2;let eC={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Ze(eo,ec,ed){ed.push({command:eC.addSource,args:[eo,ec[eo]]})}function Ve(eo,ec,ed){ec.push({command:eC.removeSource,args:[eo]}),ed[eo]=!0}function qe(eo,ec,ed,em,e_,eg){let ex;for(ex in ec=ec||{},eo=eo||{})eo.hasOwnProperty(ex)&&(t(eo[ex],ec[ex])||ed.push({command:eg,args:[em,ex,ec[ex],e_]}));for(ex in ec)ec.hasOwnProperty(ex)&&!eo.hasOwnProperty(ex)&&(t(eo[ex],ec[ex])||ed.push({command:eg,args:[em,ex,ec[ex],e_]}))}function $e(eo){return eo.id}function He(eo,ec){return eo[ec.id]=ec,eo}let Ye=class Ye{constructor(eo,ec){this.reset(eo,ec)}reset(eo,ec){this.points=eo||[],this._distances=[0];for(let eo=1;eo<this.points.length;eo++)this._distances[eo]=this._distances[eo-1]+this.points[eo].dist(this.points[eo-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(ec||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(ec){if(1===this.points.length)return this.points[0];ec=eo.clamp(ec,0,1);let ed=1,em=this._distances[ed],e_=ec*this.paddedLength+this.padding;for(;em<e_&&ed<this._distances.length;)em=this._distances[++ed];let eg=ed-1,ex=this._distances[eg],ev=em-ex,eb=ev>0?(e_-ex)/ev:0;return this.points[eg].mult(1-eb).add(this.points[ed].mult(eb))}};let Ke=class Ke{constructor(eo,ec,ed){let em=this.boxCells=[],e_=this.circleCells=[];this.xCellCount=Math.ceil(eo/ed),this.yCellCount=Math.ceil(ec/ed);for(let eo=0;eo<this.xCellCount*this.yCellCount;eo++)em.push([]),e_.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=eo,this.height=ec,this.xScale=this.xCellCount/eo,this.yScale=this.yCellCount/ec,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(eo,ec,ed,em,e_){this._forEachCell(ec,ed,em,e_,this._insertBoxCell,this.boxUid++),this.boxKeys.push(eo),this.bboxes.push(ec),this.bboxes.push(ed),this.bboxes.push(em),this.bboxes.push(e_)}insertCircle(eo,ec,ed,em){this._forEachCell(ec-em,ed-em,ec+em,ed+em,this._insertCircleCell,this.circleUid++),this.circleKeys.push(eo),this.circles.push(ec),this.circles.push(ed),this.circles.push(em)}_insertBoxCell(eo,ec,ed,em,e_,eg){this.boxCells[e_].push(eg)}_insertCircleCell(eo,ec,ed,em,e_,eg){this.circleCells[e_].push(eg)}_query(eo,ec,ed,em,e_,eg){if(ed<0||eo>this.width||em<0||ec>this.height)return!e_&&[];let ex=[];if(eo<=0&&ec<=0&&this.width<=ed&&this.height<=em){if(e_)return!0;for(let eo=0;eo<this.boxKeys.length;eo++)ex.push({key:this.boxKeys[eo],x1:this.bboxes[4*eo],y1:this.bboxes[4*eo+1],x2:this.bboxes[4*eo+2],y2:this.bboxes[4*eo+3]});for(let eo=0;eo<this.circleKeys.length;eo++){let ec=this.circles[3*eo],ed=this.circles[3*eo+1],em=this.circles[3*eo+2];ex.push({key:this.circleKeys[eo],x1:ec-em,y1:ed-em,x2:ec+em,y2:ed+em})}return eg?ex.filter(eg):ex}return this._forEachCell(eo,ec,ed,em,this._queryCell,ex,{hitTest:e_,seenUids:{box:{},circle:{}}},eg),e_?ex.length>0:ex}_queryCircle(eo,ec,ed,em,e_){let eg=eo-ed,ex=eo+ed,ev=ec-ed,eb=ec+ed;if(ex<0||eg>this.width||eb<0||ev>this.height)return!em&&[];let ew=[];return this._forEachCell(eg,ev,ex,eb,this._queryCellCircle,ew,{hitTest:em,circle:{x:eo,y:ec,radius:ed},seenUids:{box:{},circle:{}}},e_),em?ew.length>0:ew}query(eo,ec,ed,em,e_){return this._query(eo,ec,ed,em,!1,e_)}hitTest(eo,ec,ed,em,e_){return this._query(eo,ec,ed,em,!0,e_)}hitTestCircle(eo,ec,ed,em){return this._queryCircle(eo,ec,ed,!0,em)}_queryCell(eo,ec,ed,em,e_,eg,ex,ev){let eb=ex.seenUids,ew=this.boxCells[e_];if(null!==ew){let e_=this.bboxes;for(let eT of ew)if(!eb.box[eT]){eb.box[eT]=!0;let ew=4*eT;if(eo<=e_[ew+2]&&ec<=e_[ew+3]&&ed>=e_[ew+0]&&em>=e_[ew+1]&&(!ev||ev(this.boxKeys[eT]))){if(ex.hitTest)return eg.push(!0),!0;eg.push({key:this.boxKeys[eT],x1:e_[ew],y1:e_[ew+1],x2:e_[ew+2],y2:e_[ew+3]})}}}let eT=this.circleCells[e_];if(null!==eT){let e_=this.circles;for(let ew of eT)if(!eb.circle[ew]){eb.circle[ew]=!0;let eT=3*ew;if(this._circleAndRectCollide(e_[eT],e_[eT+1],e_[eT+2],eo,ec,ed,em)&&(!ev||ev(this.circleKeys[ew]))){if(ex.hitTest)return eg.push(!0),!0;{let eo=e_[eT],ec=e_[eT+1],ed=e_[eT+2];eg.push({key:this.circleKeys[ew],x1:eo-ed,y1:ec-ed,x2:eo+ed,y2:ec+ed})}}}}}_queryCellCircle(eo,ec,ed,em,e_,eg,ex,ev){let eb=ex.circle,ew=ex.seenUids,eT=this.boxCells[e_];if(null!==eT){let eo=this.bboxes;for(let ec of eT)if(!ew.box[ec]){ew.box[ec]=!0;let ed=4*ec;if(this._circleAndRectCollide(eb.x,eb.y,eb.radius,eo[ed+0],eo[ed+1],eo[ed+2],eo[ed+3])&&(!ev||ev(this.boxKeys[ec])))return eg.push(!0),!0}}let eE=this.circleCells[e_];if(null!==eE){let eo=this.circles;for(let ec of eE)if(!ew.circle[ec]){ew.circle[ec]=!0;let ed=3*ec;if(this._circlesCollide(eo[ed],eo[ed+1],eo[ed+2],eb.x,eb.y,eb.radius)&&(!ev||ev(this.circleKeys[ec])))return eg.push(!0),!0}}}_forEachCell(eo,ec,ed,em,e_,eg,ex,ev){let eb=this._convertToXCellCoord(eo),ew=this._convertToYCellCoord(ec),eT=this._convertToXCellCoord(ed),eE=this._convertToYCellCoord(em);for(let eM=eb;eM<=eT;eM++)for(let eb=ew;eb<=eE;eb++)if(e_.call(this,eo,ec,ed,em,this.xCellCount*eb+eM,eg,ex,ev))return}_convertToXCellCoord(eo){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(eo*this.xScale)))}_convertToYCellCoord(eo){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(eo*this.yScale)))}_circlesCollide(eo,ec,ed,em,e_,eg){let ex=em-eo,ev=e_-ec,eb=ed+eg;return eb*eb>ex*ex+ev*ev}_circleAndRectCollide(eo,ec,ed,em,e_,eg,ex){let ev=(eg-em)/2,eb=Math.abs(eo-(em+ev));if(eb>ev+ed)return!1;let ew=(ex-e_)/2,eT=Math.abs(ec-(e_+ew));if(eT>ew+ed)return!1;if(eb<=ev||eT<=ew)return!0;let eE=eb-ev,eM=eT-ew;return eE*eE+eM*eM<=ed*ed}};let eP={unknown:0,flipRequired:1,flipNotRequired:2},ez=Math.tan(85*Math.PI/180);function et(ec,ed,em,e_,eg,ex,ev){let eb=eo.create();if(em){if("globe"===ex.name){let ec=eo.calculateGlobeLabelMatrix(eg,ed);eo.multiply(eb,eb,ec)}else{let ec=v([],ev);eb[0]=ec[0],eb[1]=ec[1],eb[4]=ec[2],eb[5]=ec[3],e_||eo.rotateZ(eb,eb,eg.angle)}}else eo.multiply(eb,eg.labelPlaneMatrix,ec);return eb}function tt(eo,ec,ed,em,e_,eg,ex){let ev=et(eo,ec,ed,em,e_,eg,ex);return"globe"===eg.name&&ed||(ev[2]=ev[6]=ev[10]=ev[14]=0),ev}function it(ec,ed,em,e_,eg,ex,ev){if(em){if("globe"===ex.name){let eb=et(ec,ed,em,e_,eg,ex,ev);return eo.invert(eb,eb),eo.multiply(eb,ec,eb),eb}{let ed=eo.clone(ec),em=eo.identity([]);return em[0]=ev[0],em[1]=ev[1],em[4]=ev[2],em[5]=ev[3],eo.multiply(ed,ed,em),e_||eo.rotateZ(ed,ed,-eg.angle),ed}}return eg.glCoordMatrix}function ot(ec,ed,em,e_){let eg=[ec,ed,em,1];em?eo.transformMat4$1(eg,eg,e_):pt(eg,eg,e_);let ex=eg[3];return eg[0]/=ex,eg[1]/=ex,eg[2]/=ex,eg}function rt(eo,ec){return Math.min(.5+eo/ec*.5,1.5)}function at(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI){let{lineStartIndex:eC,glyphStartIndex:eP,segment:ez}=ev,eD=eP+ev.numGlyphs,ek=eC+ev.lineLength,eL=ec.getoffsetX(eP),eR=ec.getoffsetX(eD-1),eB=_t(eo*eL,ed,em,e_,eg,ex,ez,eC,ek,eb,ew,eT,eE,eM,!0,eS,eA,eI);if(!eB)return null;let eF=_t(eo*eR,ed,em,e_,eg,ex,ez,eC,ek,eb,ew,eT,eE,eM,!0,eS,eA,eI);return eF?{first:eB,last:eF}:null}function lt(ec,ed,em,e_){return ec===eo.WritingMode.horizontal&&Math.abs(e_)>Math.abs(em)?{useVertical:!0}:ec===eo.WritingMode.vertical?e_>0?{needsFlipping:!0}:null:ed!==eP.unknown&&(0===em||Math.abs(e_/em)>ez)?ed===eP.flipRequired?{needsFlipping:!0}:null:em<0?{needsFlipping:!0}:null}function ct(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,ez,eD,ek){let eL=ed/24,eR=ec.lineOffsetX*eL,eB=ec.lineOffsetY*eL,{lineStartIndex:eF,glyphStartIndex:eO,numGlyphs:eU,segment:eN,writingMode:eV,flipState:ej}=ec,eG=eF+ec.lineLength,D=ec=>{if(eE){let[ed,em,e_]=ec.up,eg=eT.length;eo.updateGlobeVertexNormal(eE,eg+0,ed,em,e_),eo.updateGlobeVertexNormal(eE,eg+1,ed,em,e_),eo.updateGlobeVertexNormal(eE,eg+2,ed,em,e_),eo.updateGlobeVertexNormal(eE,eg+3,ed,em,e_)}let[ed,em,e_]=ec.point;eo.addDynamicAttributes(eT,ed,em,e_,ec.angle)};if(eU>1){let eo=at(eL,eb,eR,eB,em,eM,eS,ec,ew,ex,eA,eC,!1,ez,eD,ek);if(!eo)return{notEnoughRoom:!0};if(e_&&!em){let[ed,em,e_]=eo.first.point,[eg,ex,eb]=eo.last.point;[ed,em]=ot(ed,em,e_,ev),[eg,ex]=ot(eg,ex,eb,ev);let ew=lt(eV,ej,(eg-ed)*eI,ex-em);if(ec.flipState=ew&&ew.needsFlipping?eP.flipRequired:eP.flipNotRequired,ew)return ew}D(eo.first);for(let eo=eO+1;eo<eO+eU-1;eo++){let ec=_t(eL*eb.getoffsetX(eo),eR,eB,em,eM,eS,eN,eF,eG,ew,ex,eA,eC,!1,!1,ez,eD,ek);if(!ec)return eT.length-=4*(eo-eO),{notEnoughRoom:!0};D(ec)}D(eo.last)}else{if(e_&&!em){let ed=ot(eS.x,eS.y,0,eg),em=eF+eN+1,e_=new eo.Point(ew.getx(em),ew.gety(em)),ex=ot(e_.x,e_.y,0,eg),ev=ex[3]>0?ex:ut(eS,e_,ed,1,eg,void 0,ez,eD.canonical),eb=lt(eV,ej,(ev[0]-ed[0])*eI,ev[1]-ed[1]);if(ec.flipState=eb&&eb.needsFlipping?eP.flipRequired:eP.flipNotRequired,eb)return eb}let ed=_t(eL*eb.getoffsetX(eO),eR,eB,em,eM,eS,eN,eF,eG,ew,ex,eA,eC,!1,!1,ez,eD,ek);if(!ed)return{notEnoughRoom:!0};D(ed)}return{}}function ht(eo,ec,ed,em,e_){let{x:eg,y:ex,z:ev}=em.projectTilePoint(eo.x,eo.y,ec);if(!e_)return ot(eg,ex,ev,ed);let[eb,ew,eT]=e_(eo);return ot(eg+eb,ex+ew,ev+eT,ed)}function ut(ec,ed,em,e_,eg,ex,ev,eb){let ew=ht(ec.sub(ed)._unit()._add(ec),eb,eg,ev,ex);return eo.sub(ew,em,ew),eo.normalize(ew,ew),eo.scaleAndAdd(ew,em,ew,e_)}function _t(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP,ez){let eD=e_?ec-ed:ec+ed,ek=eD>0?1:-1,eL=0;e_&&(ek*=-1,eL=Math.PI),ek<0&&(eL+=Math.PI);let eR=eb+ev+(ek>0?0:1)|0,eB=eg,eF=eg,eO=0,eU=0,eN=Math.abs(eD),eV=[],ej=[],eG=ex,eZ=eG,A=()=>ut(eZ,eG,eF,eN-eO+1,eE,eS,eC,eP.canonical);for(;eO+eU<=eN;){if((eR+=ek)<eb||eR>=ew)return null;if(eF=eB,eZ=eG,eV.push(eF),eA&&ej.push(eZ),eG=new eo.Point(eT.getx(eR),eT.gety(eR)),!(eB=eM[eR])){let eo=ht(eG,eP.canonical,eE,eC,eS);eB=eo[3]>0?eM[eR]=eo:A()}eO+=eU,eU=eo.distance(eF,eB)}eI&&eS&&(eM[eR]&&(eB=A(),eU=eo.distance(eF,eB)),eM[eR]=eB);let e$=(eN-eO)/eU,eq=eG.sub(eZ)._mult(e$)._add(eZ),eX=eo.sub([],eB,eF),eW=eo.scaleAndAdd([],eF,eX,e$),eH=[0,0,1],eJ=eX[0],eY=eX[1];if(ez&&(0!==(eH=eC.upVector(eP.canonical,eq.x,eq.y))[0]||0!==eH[1]||1!==eH[2])){let ec=[eH[2],0,-eH[0]],ed=eo.cross([],eH,ec);eo.normalize(ec,ec),eo.normalize(ed,ed),eJ=eo.dot(eX,ec),eY=eo.dot(eX,ed)}if(em){let ec=eo.cross([],eH,eX);eo.normalize(ec,ec),eo.scaleAndAdd(eW,eW,ec,em*ek)}let eK=eL+Math.atan2(eY,eJ);return eV.push(eW),eA&&ej.push(eq),{point:eW,angle:eK,path:eV,tilePath:ej,up:eH}}function dt(eo,ec){let ed=ec.length,em=ed+4*eo;ec.resize(em),ec.float32.fill(-1/0,4*ed,4*em)}function pt(eo,ec,ed){let em=ec[0],e_=ec[1];return eo[0]=ed[0]*em+ed[4]*e_+ed[12],eo[1]=ed[1]*em+ed[5]*e_+ed[13],eo[3]=ed[3]*em+ed[7]*e_+ed[15],eo}let ft=class ft{constructor(eo,ec,ed=new Ke(eo.width+200,eo.height+200,25),em=new Ke(eo.width+200,eo.height+200,25)){this.transform=eo,this.grid=ed,this.ignoredGrid=em,this.pitchfactor=Math.cos(eo._pitch)*eo.cameraToCenterDistance,this.screenRightBoundary=eo.width+100,this.screenBottomBoundary=eo.height+100,this.gridRightBoundary=eo.width+200,this.gridBottomBoundary=eo.height+200,this.fogState=ec}placeCollisionBox(eo,ec,ed,em,e_,eg,ex,ev){let eb=ed.projectedAnchorX,ew=ed.projectedAnchorY,eT=ed.projectedAnchorZ,eE=ed.elevation,eM=ed.tileID,eS=eo.getProjection();if(eE&&eM){let[eo,ec,em]=eS.upVector(eM.canonical,ed.tileAnchorX,ed.tileAnchorY),e_=eS.upVectorScale(eM.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;eb+=eo*eE*e_,ew+=ec*eE*e_,eT+=em*eE*e_}let eA=this.projectAndGetPerspectiveRatio(ex,eb,ew,eT,ed.tileID,"globe"===eS.name||!!eE||this.transform.pitch>0,eS),eI=eg*eA.perspectiveRatio,eC=(ed.x1*ec+em.x-ed.padding)*eI+eA.point.x,eP=(ed.y1*ec+em.y-ed.padding)*eI+eA.point.y,ez=(ed.x2*ec+em.x+ed.padding)*eI+eA.point.x,eD=(ed.y2*ec+em.y+ed.padding)*eI+eA.point.y,ek=eA.perspectiveRatio<=.55||eA.occluded;return!this.isInsideGrid(eC,eP,ez,eD)||!e_&&this.grid.hitTest(eC,eP,ez,eD,ev)||ek?{box:[],offscreen:!1,occluded:eA.occluded}:{box:[eC,eP,ez,eD],offscreen:this.isOffscreen(eC,eP,ez,eD),occluded:!1}}placeCollisionCircles(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI){let eC=[],eP=this.transform.elevation,ez=ec.getProjection(),eD=eP?eP.getAtTileOffsetFunc(eI,this.transform.center.lat,this.transform.worldSize,ez):null,ek=new eo.Point(em.tileAnchorX,em.tileAnchorY),{x:eL,y:eR,z:eB}=ez.projectTilePoint(ek.x,ek.y,eI.canonical);if(eD){let[eo,ec,ed]=eD(ek);eL+=eo,eR+=ec,eB+=ed}let eF="globe"===ez.name,eO=this.projectAndGetPerspectiveRatio(ev,eL,eR,eB,eI,eF||!!eP||this.transform.pitch>0,ez),{perspectiveRatio:eU}=eO,eN=(eE?ex/eU:ex*eU)/eo.ONE_EM,eV=ot(eL,eR,eB,eb),ej=eO.signedDistanceFromCamera>0?at(eN,eg,em.lineOffsetX*eN,em.lineOffsetY*eN,!1,eV,ek,em,e_,eb,{},eP&&!eE?eD:null,eE&&!!eP,ez,eI,eE):null,eG=!1,eZ=!1,e$=!0;if(ej&&!eO.occluded){let ec=.5*eS*eU+eA,em=new eo.Point(-100,-100),e_=new eo.Point(this.screenRightBoundary,this.screenBottomBoundary),eg=new Ye,{first:ex,last:ev}=ej,eb=ex.path.length,eE=[];for(let eo=eb-1;eo>=1;eo--)eE.push(ex.path[eo]);for(let eo=1;eo<ev.path.length;eo++)eE.push(ev.path[eo]);let eI=2.5*ec;ew&&(eE=eE.map(([eo,ec,ed],em)=>(eD&&!eF&&(ed=eD(em<eb-1?ex.tilePath[eb-1-em]:ev.tilePath[em-eb+2])[2]),ot(eo,ec,ed,ew)))).some(eo=>eo[3]<=0)&&(eE=[]);let eP=[];if(eE.length>0){let ec=1/0,ed=-1/0,eg=1/0,ex=-1/0;for(let eo of eE)ec=Math.min(ec,eo[0]),eg=Math.min(eg,eo[1]),ed=Math.max(ed,eo[0]),ex=Math.max(ex,eo[1]);ed>=em.x&&ec<=e_.x&&ex>=em.y&&eg<=e_.y&&(eP=[eE.map(ec=>new eo.Point(ec[0],ec[1]))],(ec<em.x||ed>e_.x||eg<em.y||ex>e_.y)&&(eP=eo.clipLine(eP,em.x,em.y,e_.x,e_.y)))}for(let eo of eP){eg.reset(eo,.25*ec);let em=0;em=eg.length<=.5*ec?1:Math.ceil(eg.paddedLength/eI)+1;for(let eo=0;eo<em;eo++){let e_=eo/Math.max(em-1,1),ex=eg.lerp(e_),ev=ex.x+100,eb=ex.y+100;eC.push(ev,eb,ec,0);let ew=ev-ec,eE=eb-ec,eS=ev+ec,eA=eb+ec;if(e$=e$&&this.isOffscreen(ew,eE,eS,eA),eZ=eZ||this.isInsideGrid(ew,eE,eS,eA),!ed&&this.grid.hitTestCircle(ev,eb,ec,eM)&&(eG=!0,!eT))return{circles:[],offscreen:!1,collisionDetected:eG,occluded:!1}}}}return{circles:(eT||!eG)&&eZ?eC:[],offscreen:e$,collisionDetected:eG,occluded:eO.occluded}}queryRenderedSymbols(ec){if(0===ec.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};let ed=[],em=1/0,e_=1/0,eg=-1/0,ex=-1/0;for(let ev of ec){let ec=new eo.Point(ev.x+100,ev.y+100);em=Math.min(em,ec.x),e_=Math.min(e_,ec.y),eg=Math.max(eg,ec.x),ex=Math.max(ex,ec.y),ed.push(ec)}let ev=this.grid.query(em,e_,eg,ex).concat(this.ignoredGrid.query(em,e_,eg,ex)),eb={},ew={};for(let ec of ev){let em=ec.key;if(void 0===eb[em.bucketInstanceId]&&(eb[em.bucketInstanceId]={}),eb[em.bucketInstanceId][em.featureIndex])continue;let e_=[new eo.Point(ec.x1,ec.y1),new eo.Point(ec.x2,ec.y1),new eo.Point(ec.x2,ec.y2),new eo.Point(ec.x1,ec.y2)];eo.polygonIntersectsPolygon(ed,e_)&&(eb[em.bucketInstanceId][em.featureIndex]=!0,void 0===ew[em.bucketInstanceId]&&(ew[em.bucketInstanceId]=[]),ew[em.bucketInstanceId].push(em.featureIndex))}return ew}insertCollisionBox(eo,ec,ed,em,e_){(ec?this.ignoredGrid:this.grid).insert({bucketInstanceId:ed,featureIndex:em,collisionGroupID:e_},eo[0],eo[1],eo[2],eo[3])}insertCollisionCircles(eo,ec,ed,em,e_){let eg=ec?this.ignoredGrid:this.grid,ex={bucketInstanceId:ed,featureIndex:em,collisionGroupID:e_};for(let ec=0;ec<eo.length;ec+=4)eg.insertCircle(ex,eo[ec],eo[ec+1],eo[ec+2])}projectAndGetPerspectiveRatio(ec,ed,em,e_,eg,ex,ev){let eb=[ed,em,e_,1],ew=!1;if(e_||this.transform.pitch>0){if(eo.transformMat4$1(eb,eb,ec),this.fogState&&eg&&"globe"!==ev.name){let ec=function(ec,ed,em,e_,eg,ex){let ev=ex.calculateFogTileMatrix(eg),eb=[ed,em,e_];return eo.transformMat4(eb,eb,ev),C(ec,eb,ex.pitch,ex._fov)}(this.fogState,ed,em,e_,eg.toUnwrapped(),this.transform);ew=ec>.9}}else pt(eb,eb,ec);let eT=eb[3];return{point:new eo.Point((eb[0]/eT+1)/2*this.transform.width+100,(-eb[1]/eT+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(ev)/eT*.5,1.5),signedDistanceFromCamera:eT,occluded:ex&&eb[2]>eT||ew}}isOffscreen(eo,ec,ed,em){return ed<100||eo>=this.screenRightBoundary||em<100||ec>this.screenBottomBoundary}isInsideGrid(eo,ec,ed,em){return ed>=0&&eo<this.gridRightBoundary&&em>=0&&ec<this.gridBottomBoundary}getViewportMatrix(){let ec=eo.identity([]);return eo.translate(ec,ec,[-100,-100,0]),ec}};function gt(ec,ed,em){let e_=ed.createTileMatrix(ec,ec.worldSize,em.toUnwrapped());return eo.multiply(new Float32Array(16),ec.projMatrix,e_)}function xt(eo,ec,ed){return ec.name===ed.projection.name?eo.projMatrix:gt(ed,ec,eo)}let yt=class yt{constructor(eo,ec,ed,em){this.opacity=eo?Math.max(0,Math.min(1,eo.opacity+(eo.placed?ec:-ec))):em&&ed?1:0,this.placed=ed}isHidden(){return 0===this.opacity&&!this.placed}};let bt=class bt{constructor(eo,ec,ed,em,e_,eg=!1){this.text=new yt(eo?eo.text:null,ec,ed,e_),this.icon=new yt(eo?eo.icon:null,ec,em,e_),this.clipped=eg}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}};let wt=class wt{constructor(eo,ec,ed,em=!1){this.text=eo,this.icon=ec,this.skipFade=ed,this.clipped=em}};let Tt=class Tt{constructor(){this.invProjMatrix=eo.create(),this.viewportMatrix=eo.create(),this.circles=[]}};let Et=class Et{constructor(eo,ec,ed,em,e_){this.bucketInstanceId=eo,this.featureIndex=ec,this.sourceLayerIndex=ed,this.bucketIndex=em,this.tileID=e_}};let Ct=class Ct{constructor(eo){this.crossSourceCollisions=eo,this.maxGroupID=0,this.collisionGroups={}}get(eo){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[eo]){let ec=++this.maxGroupID;this.collisionGroups[eo]={ID:ec,predicate:eo=>eo.collisionGroupID===ec}}return this.collisionGroups[eo]}};function Mt(ec,ed,em,e_,eg){let{horizontalAlign:ex,verticalAlign:ev}=eo.getAnchorAlignment(ec),eb=eo.evaluateVariableOffset(ec,e_);return new eo.Point(-(ex-.5)*ed+eb[0]*eg,-(ev-.5)*em+eb[1]*eg)}function It(ec,ed,em,e_,eg){let ex=new eo.Point(ec,ed);return em&&ex._rotate(e_?eg:-eg),ex}let Pt=class Pt{constructor(eo,ec,ed,em,e_){this.transform=eo.clone(),this.projection=eo.projection.name,this.collisionIndex=new ft(this.transform,e_),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=ec,this.retainedQueryData={},this.collisionGroups=new Ct(ed),this.collisionCircleArrays={},this.prevPlacement=em,em&&(em.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(ec,ed,em,e_){var eg,ex,ev;let eb=em.getBucket(ed),ew=em.latestFeatureIndex;if(!eb||!ew||ed.id!==eb.layerIds[0])return;let eT=eb.layers[0].layout,eE=em.collisionBoxArray,eM=Math.pow(2,this.transform.zoom-em.tileID.overscaledZ),eS=em.tileSize/eo.EXTENT,eA=em.tileID.toUnwrapped();this.transform.setProjection(eb.projection);let eI=(eg=em.tileID,ex=eb.getProjection(),ev=this.transform,ex.name===this.projection?ev.calculateProjMatrix(eg.toUnwrapped()):gt(ev,ex,eg)),eC="map"===eT.get("text-pitch-alignment"),eP="map"===eT.get("text-rotation-alignment");ed.compileFilter();let ez=ed.dynamicFilter(),eD=ed.dynamicFilterNeedsFeature(),ek=this.transform.calculatePixelsToTileUnitsMatrix(em),eL=tt(eI,em.tileID.canonical,eC,eP,this.transform,eb.getProjection(),ek),eR=null;if(eC){let ec=it(eI,em.tileID.canonical,eC,eP,this.transform,eb.getProjection(),ek);eR=eo.multiply([],this.transform.labelPlaneMatrix,ec)}let eB=null;ez&&em.latestFeatureIndex&&(eB={unwrappedTileID:eA,dynamicFilter:ez,dynamicFilterNeedsFeature:eD,featureIndex:em.latestFeatureIndex}),this.retainedQueryData[eb.bucketInstanceId]=new Et(eb.bucketInstanceId,ew,eb.sourceLayerIndex,eb.index,em.tileID);let eF={bucket:eb,layout:eT,posMatrix:eI,textLabelPlaneMatrix:eL,labelToScreenMatrix:eR,clippingData:eB,scale:eM,textPixelRatio:eS,holdingForFade:em.holdingForFade(),collisionBoxArray:eE,partiallyEvaluatedTextSize:eo.evaluateSizeForZoom(eb.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:eo.evaluateSizeForZoom(eb.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(eb.sourceID)};if(e_)for(let eo of eb.sortKeyRanges){let{sortKey:ed,symbolInstanceStart:em,symbolInstanceEnd:e_}=eo;ec.push({sortKey:ed,symbolInstanceStart:em,symbolInstanceEnd:e_,parameters:eF})}else ec.push({symbolInstanceStart:0,symbolInstanceEnd:eb.symbolInstances.length,parameters:eF})}attemptAnchorPlacement(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP){let{textOffset0:ez,textOffset1:eD,crossTileID:ek}=eE,eL=[ez,eD],eR=Mt(eo,ed,em,eL,e_),eB=this.collisionIndex.placeCollisionBox(eS,e_,ec,It(eR.x,eR.y,eg,ex,this.transform.angle),eT,ev,eb,ew.predicate);if(eI){let eo=eS.getSymbolInstanceIconSize(eP,this.transform.zoom,eE.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(eS,eo,eI,It(eR.x,eR.y,eg,ex,this.transform.angle),eT,ev,eb,ew.predicate).box.length)return}if(eB.box.length>0){let ec;return this.prevPlacement&&this.prevPlacement.variableOffsets[ek]&&this.prevPlacement.placements[ek]&&this.prevPlacement.placements[ek].text&&(ec=this.prevPlacement.variableOffsets[ek].anchor),this.variableOffsets[ek]={textOffset:eL,width:ed,height:em,anchor:eo,textScale:e_,prevAnchor:ec},this.markUsedJustification(eS,eo,eE,eA),eS.allowVerticalPlacement&&(this.markUsedOrientation(eS,eA,eE),this.placedOrientations[ek]=eA),{shift:eR,placedGlyphBoxes:eB}}}placeLayerBucketPart(ec,ed,em,e_){let{bucket:eg,layout:ex,posMatrix:ev,textLabelPlaneMatrix:eb,labelToScreenMatrix:ew,clippingData:eT,textPixelRatio:eE,holdingForFade:eM,collisionBoxArray:eS,partiallyEvaluatedTextSize:eA,partiallyEvaluatedIconSize:eI,collisionGroup:eC}=ec.parameters,eP=ex.get("text-optional"),ez=ex.get("icon-optional"),eD=ex.get("text-allow-overlap"),ek=ex.get("icon-allow-overlap"),eL="map"===ex.get("text-rotation-alignment"),eR="map"===ex.get("text-pitch-alignment"),eB="none"!==ex.get("icon-text-fit"),eF="viewport-y"===ex.get("symbol-z-order");this.transform.setProjection(eg.projection);let eO=eD&&(ek||!eg.hasIconData()||ez),eU=ek&&(eD||!eg.hasTextData()||eP);!eg.collisionArrays&&eS&&eg.deserializeCollisionBoxes(eS),em&&e_&&eg.updateCollisionDebugBuffers(this.transform.zoom,eS);let I=(ec,e_,eS)=>{let{crossTileID:eF,numVerticalGlyphVertices:eN}=ec;if(eT){let em={zoom:this.transform.zoom,pitch:this.transform.pitch},e_=null;if(eT.dynamicFilterNeedsFeature){let eo=this.retainedQueryData[eg.bucketInstanceId];e_=eT.featureIndex.loadFeature({featureIndex:ec.featureIndex,bucketIndex:eo.bucketIndex,sourceLayerIndex:eo.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,eT.dynamicFilter)(em,e_,this.retainedQueryData[eg.bucketInstanceId].tileID.canonical,new eo.Point(ec.tileAnchorX,ec.tileAnchorY),this.transform.calculateDistanceTileData(eT.unwrappedTileID)))return this.placements[eF]=new wt(!1,!1,!1,!0),void ed.add(eF)}if(ed.has(eF))return;if(eM)return void(this.placements[eF]=new wt(!1,!1,!1));let eV=!1,ej=!1,eG=!0,eZ=!1,e$=!1,eq=null,eX={box:null,offscreen:null,occluded:null},eW={box:null,offscreen:null,occluded:null},eH=null,eJ=null,eY=null,eK=0,eQ=0,e0=0;eS.textFeatureIndex?eK=eS.textFeatureIndex:ec.useRuntimeCollisionCircles&&(eK=ec.featureIndex),eS.verticalTextFeatureIndex&&(eQ=eS.verticalTextFeatureIndex);let G=eo=>{eo.tileID=this.retainedQueryData[eg.bucketInstanceId].tileID;let ec=this.transform.elevation;(ec||eo.elevation)&&(eo.elevation=ec?ec.getAtTileOffset(eo.tileID,eo.tileAnchorX,eo.tileAnchorY):0)},e1=eS.textBox;if(e1){G(e1);let i=ed=>{let em=eo.WritingMode.horizontal;if(eg.allowVerticalPlacement&&!ed&&this.prevPlacement){let eo=this.prevPlacement.placedOrientations[eF];eo&&(this.placedOrientations[eF]=eo,em=eo,this.markUsedOrientation(eg,em,ec))}return em},o=(ec,ed)=>{if(eg.allowVerticalPlacement&&eN>0&&eS.verticalTextBox){for(let em of eg.writingModes)if(em===eo.WritingMode.vertical?eW=eX=ed():eX=ec(),eX&&eX.box&&eX.box.length)break}else eX=ec()};if(ex.get("text-variable-anchor")){let ed=ex.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[eF]){let eo=this.prevPlacement.variableOffsets[eF];ed.indexOf(eo.anchor)>0&&(ed=ed.filter(ec=>ec!==eo.anchor)).unshift(eo.anchor)}let c=(eo,em,ex)=>{let eb=eg.getSymbolInstanceTextSize(eA,ec,this.transform.zoom,e_),ew=(eo.x2-eo.x1)*eb+2*eo.padding,eT=(eo.y2-eo.y1)*eb+2*eo.padding,eM=eB&&!ek?em:null;eM&&G(eM);let eS={box:[],offscreen:!1,occluded:!1},eP=eD?2*ed.length:ed.length;for(let em=0;em<eP;++em){let eP=this.attemptAnchorPlacement(ed[em%ed.length],eo,ew,eT,eb,eL,eR,eE,ev,eC,em>=ed.length,ec,e_,eg,ex,eM,eA,eI);if(eP&&(eS=eP.placedGlyphBoxes)&&eS.box&&eS.box.length){eV=!0,eq=eP.shift;break}}return eS};o(()=>c(e1,eS.iconBox,eo.WritingMode.horizontal),()=>{let ec=eS.verticalTextBox;return ec&&G(ec),eg.allowVerticalPlacement&&!(eX&&eX.box&&eX.box.length)&&eN>0&&ec?c(ec,eS.verticalIconBox,eo.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),eX&&(eV=eX.box,eG=eX.offscreen,eZ=eX.occluded);let em=i(!(!eX||!eX.box));if(!eV&&this.prevPlacement){let eo=this.prevPlacement.variableOffsets[eF];eo&&(this.variableOffsets[eF]=eo,this.markUsedJustification(eg,eo.anchor,ec,em))}}else{let s=(ed,em)=>{let ex=eg.getSymbolInstanceTextSize(eA,ec,this.transform.zoom,e_),eb=this.collisionIndex.placeCollisionBox(eg,ex,ed,new eo.Point(0,0),eD,eE,ev,eC.predicate);return eb&&eb.box&&eb.box.length&&(this.markUsedOrientation(eg,em,ec),this.placedOrientations[eF]=em),eb};o(()=>s(e1,eo.WritingMode.horizontal),()=>{let ec=eS.verticalTextBox;return eg.allowVerticalPlacement&&eN>0&&ec?(G(ec),s(ec,eo.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),i(!!(eX&&eX.box&&eX.box.length))}}if(eV=(eH=eX)&&eH.box&&eH.box.length>0,eG=eH&&eH.offscreen,eZ=eH&&eH.occluded,ec.useRuntimeCollisionCircles){let ed=eg.text.placedSymbolArray.get(ec.centerJustifiedTextSymbolIndex>=0?ec.centerJustifiedTextSymbolIndex:ec.verticalPlacedTextSymbolIndex),e_=eo.evaluateSizeForFeature(eg.textSizeData,eA,ed),eT=ex.get("text-padding");eJ=this.collisionIndex.placeCollisionCircles(eg,eD,ed,eg.lineVertexArray,eg.glyphOffsetArray,e_,ev,eb,ew,em,eR,eC.predicate,ec.collisionCircleDiameter*e_/eo.ONE_EM,eT,this.retainedQueryData[eg.bucketInstanceId].tileID),eV=eD||eJ.circles.length>0&&!eJ.collisionDetected,eG=eG&&eJ.offscreen,eZ=eJ.occluded}if(eS.iconFeatureIndex&&(e0=eS.iconFeatureIndex),eS.iconBox){let i=ed=>{G(ed);let em=eB&&eq?It(eq.x,eq.y,eL,eR,this.transform.angle):new eo.Point(0,0),e_=eg.getSymbolInstanceIconSize(eI,this.transform.zoom,ec.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(eg,e_,ed,em,ek,eE,ev,eC.predicate)};ej=eW&&eW.box&&eW.box.length&&eS.verticalIconBox?(eY=i(eS.verticalIconBox)).box.length>0:(eY=i(eS.iconBox)).box.length>0,eG=eG&&eY.offscreen,e$=eY.occluded}let e2=eP||0===ec.numHorizontalGlyphVertices&&0===eN,e3=ez||0===ec.numIconVertices;if(e2||e3?e3?e2||(ej=ej&&eV):eV=ej&&eV:ej=eV=ej&&eV,eV&&eH&&eH.box&&this.collisionIndex.insertCollisionBox(eH.box,ex.get("text-ignore-placement"),eg.bucketInstanceId,eW&&eW.box&&eQ?eQ:eK,eC.ID),ej&&eY&&this.collisionIndex.insertCollisionBox(eY.box,ex.get("icon-ignore-placement"),eg.bucketInstanceId,e0,eC.ID),eJ&&(eV&&this.collisionIndex.insertCollisionCircles(eJ.circles,ex.get("text-ignore-placement"),eg.bucketInstanceId,eK,eC.ID),em)){let eo=eg.bucketInstanceId,ec=this.collisionCircleArrays[eo];void 0===ec&&(ec=this.collisionCircleArrays[eo]=new Tt);for(let eo=0;eo<eJ.circles.length;eo+=4)ec.circles.push(eJ.circles[eo+0]),ec.circles.push(eJ.circles[eo+1]),ec.circles.push(eJ.circles[eo+2]),ec.circles.push(eJ.collisionDetected?1:0)}let e5="globe"!==eg.projection.name;eO=eO&&(e5||!eZ),eU=eU&&(e5||!e$),this.placements[eF]=new wt(eV||eO,ej||eU,eG||eg.justReloaded),ed.add(eF)};if(eF){let eo=eg.getSortedSymbolIndexes(this.transform.angle);for(let ec=eo.length-1;ec>=0;--ec){let ed=eo[ec];I(eg.symbolInstances.get(ed),ed,eg.collisionArrays[ed])}}else for(let eo=ec.symbolInstanceStart;eo<ec.symbolInstanceEnd;eo++)I(eg.symbolInstances.get(eo),eo,eg.collisionArrays[eo]);if(em&&eg.bucketInstanceId in this.collisionCircleArrays){let ec=this.collisionCircleArrays[eg.bucketInstanceId];eo.invert(ec.invProjMatrix,ev),ec.viewportMatrix=this.collisionIndex.getViewportMatrix()}eg.justReloaded=!1}markUsedJustification(ec,ed,em,e_){let{leftJustifiedTextSymbolIndex:eg,centerJustifiedTextSymbolIndex:ex,rightJustifiedTextSymbolIndex:ev,verticalPlacedTextSymbolIndex:eb,crossTileID:ew}=em,eT=eo.getAnchorJustification(ed),eE=e_===eo.WritingMode.vertical?eb:"left"===eT?eg:"center"===eT?ex:"right"===eT?ev:-1;eg>=0&&(ec.text.placedSymbolArray.get(eg).crossTileID=eE>=0&&eg!==eE?0:ew),ex>=0&&(ec.text.placedSymbolArray.get(ex).crossTileID=eE>=0&&ex!==eE?0:ew),ev>=0&&(ec.text.placedSymbolArray.get(ev).crossTileID=eE>=0&&ev!==eE?0:ew),eb>=0&&(ec.text.placedSymbolArray.get(eb).crossTileID=eE>=0&&eb!==eE?0:ew)}markUsedOrientation(ec,ed,em){let e_=ed===eo.WritingMode.horizontal||ed===eo.WritingMode.horizontalOnly?ed:0,eg=ed===eo.WritingMode.vertical?ed:0,{leftJustifiedTextSymbolIndex:ex,centerJustifiedTextSymbolIndex:ev,rightJustifiedTextSymbolIndex:eb,verticalPlacedTextSymbolIndex:ew}=em,eT=ec.text.placedSymbolArray;ex>=0&&(eT.get(ex).placedOrientation=e_),ev>=0&&(eT.get(ev).placedOrientation=e_),eb>=0&&(eT.get(eb).placedOrientation=e_),ew>=0&&(eT.get(ew).placedOrientation=eg)}commit(eo){this.commitTime=eo,this.zoomAtLastRecencyCheck=this.transform.zoom;let ec=this.prevPlacement,ed=!1;this.prevZoomAdjustment=ec?ec.zoomAdjustment(this.transform.zoom):0;let em=ec?ec.symbolFadeChange(eo):1,e_=ec?ec.opacities:{},eg=ec?ec.variableOffsets:{},ex=ec?ec.placedOrientations:{};for(let eo in this.placements){let ec=this.placements[eo],eg=e_[eo];eg?(this.opacities[eo]=new bt(eg,em,ec.text,ec.icon,null,ec.clipped),ed=ed||ec.text!==eg.text.placed||ec.icon!==eg.icon.placed):(this.opacities[eo]=new bt(null,em,ec.text,ec.icon,ec.skipFade,ec.clipped),ed=ed||ec.text||ec.icon)}for(let eo in e_){let ec=e_[eo];if(!this.opacities[eo]){let e_=new bt(ec,em,!1,!1);e_.isHidden()||(this.opacities[eo]=e_,ed=ed||ec.text.placed||ec.icon.placed)}}for(let eo in eg)this.variableOffsets[eo]||!this.opacities[eo]||this.opacities[eo].isHidden()||(this.variableOffsets[eo]=eg[eo]);for(let eo in ex)this.placedOrientations[eo]||!this.opacities[eo]||this.opacities[eo].isHidden()||(this.placedOrientations[eo]=ex[eo]);ed?this.lastPlacementChangeTime=eo:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=ec?ec.lastPlacementChangeTime:eo)}updateLayerOpacities(eo,ec){let ed=new Set;for(let em of ec){let ec=em.getBucket(eo);ec&&em.latestFeatureIndex&&eo.id===ec.layerIds[0]&&this.updateBucketOpacities(ec,ed,em.collisionBoxArray)}}updateBucketOpacities(ec,ed,em){ec.hasTextData()&&ec.text.opacityVertexArray.clear(),ec.hasIconData()&&ec.icon.opacityVertexArray.clear(),ec.hasIconCollisionBoxData()&&ec.iconCollisionBox.collisionVertexArray.clear(),ec.hasTextCollisionBoxData()&&ec.textCollisionBox.collisionVertexArray.clear();let e_=ec.layers[0].layout,eg=!!ec.layers[0].dynamicFilter(),ex=new bt(null,0,!1,!1,!0),ev=e_.get("text-allow-overlap"),eb=e_.get("icon-allow-overlap"),ew=e_.get("text-variable-anchor"),eT="map"===e_.get("text-rotation-alignment"),eE="map"===e_.get("text-pitch-alignment"),eM="none"!==e_.get("icon-text-fit"),eS=new bt(null,0,ev&&(eb||!ec.hasIconData()||e_.get("icon-optional")),eb&&(ev||!ec.hasTextData()||e_.get("text-optional")),!0);!ec.collisionArrays&&em&&(ec.hasIconCollisionBoxData()||ec.hasTextCollisionBoxData())&&ec.deserializeCollisionBoxes(em);let p=(eo,ec,ed)=>{for(let em=0;em<ec/4;em++)eo.opacityVertexArray.emplaceBack(ed)},eA=0;for(let em=0;em<ec.symbolInstances.length;em++){let e_=ec.symbolInstances.get(em),{numHorizontalGlyphVertices:ev,numVerticalGlyphVertices:eb,crossTileID:eI,numIconVertices:eC}=e_,eP=ed.has(eI),ez=this.opacities[eI];eP?ez=ex:ez||(ez=eS,this.opacities[eI]=ez),ed.add(eI);let ek=ev>0||eb>0,eL=eC>0,eR=this.placedOrientations[eI],eB=eR===eo.WritingMode.vertical,eF=eR===eo.WritingMode.horizontal||eR===eo.WritingMode.horizontalOnly;if(!ek&&!eL||ez.isHidden()||eA++,ek){let eo=kt(ez.text);p(ec.text,ev,eB?eD:eo),p(ec.text,eb,eF?eD:eo);let ed=ez.text.isHidden(),{leftJustifiedTextSymbolIndex:em,centerJustifiedTextSymbolIndex:eg,rightJustifiedTextSymbolIndex:ex,verticalPlacedTextSymbolIndex:ew}=e_,eT=ec.text.placedSymbolArray,eE=ed||eB?1:0;em>=0&&(eT.get(em).hidden=eE),eg>=0&&(eT.get(eg).hidden=eE),ex>=0&&(eT.get(ex).hidden=eE),ew>=0&&(eT.get(ew).hidden=ed||eF?1:0);let eM=this.variableOffsets[eI];eM&&this.markUsedJustification(ec,eM.anchor,e_,eR);let eS=this.placedOrientations[eI];eS&&(this.markUsedJustification(ec,"left",e_,eS),this.markUsedOrientation(ec,eS,e_))}if(eL){let eo=kt(ez.icon),{placedIconSymbolIndex:ed,verticalPlacedIconSymbolIndex:em}=e_,eg=ec.icon.placedSymbolArray,ex=ez.icon.isHidden()?1:0;ed>=0&&(p(ec.icon,eC,eB?eD:eo),eg.get(ed).hidden=ex),em>=0&&(p(ec.icon,e_.numVerticalIconVertices,eF?eD:eo),eg.get(em).hidden=ex)}if(ec.hasIconCollisionBoxData()||ec.hasTextCollisionBoxData()){let ed=ec.collisionArrays[em];if(ed){let em=new eo.Point(0,0),e_=!0;if(ed.textBox||ed.verticalTextBox){if(ew){let eo=this.variableOffsets[eI];eo?(em=Mt(eo.anchor,eo.width,eo.height,eo.textOffset,eo.textScale),eT&&em._rotate(eE?this.transform.angle:-this.transform.angle)):e_=!1}eg&&(e_=!ez.clipped),ed.textBox&&St(ec.textCollisionBox.collisionVertexArray,ez.text.placed,!e_||eB,em.x,em.y),ed.verticalTextBox&&St(ec.textCollisionBox.collisionVertexArray,ez.text.placed,!e_||eF,em.x,em.y)}let ex=e_&&!!(!eF&&ed.verticalIconBox);ed.iconBox&&St(ec.iconCollisionBox.collisionVertexArray,ez.icon.placed,ex,eM?em.x:0,eM?em.y:0),ed.verticalIconBox&&St(ec.iconCollisionBox.collisionVertexArray,ez.icon.placed,!ex,eM?em.x:0,eM?em.y:0)}}}if(ec.fullyClipped=0===eA,ec.sortFeatures(this.transform.angle),this.retainedQueryData[ec.bucketInstanceId]&&(this.retainedQueryData[ec.bucketInstanceId].featureSortOrder=ec.featureSortOrder),ec.hasTextData()&&ec.text.opacityVertexBuffer&&ec.text.opacityVertexBuffer.updateData(ec.text.opacityVertexArray),ec.hasIconData()&&ec.icon.opacityVertexBuffer&&ec.icon.opacityVertexBuffer.updateData(ec.icon.opacityVertexArray),ec.hasIconCollisionBoxData()&&ec.iconCollisionBox.collisionVertexBuffer&&ec.iconCollisionBox.collisionVertexBuffer.updateData(ec.iconCollisionBox.collisionVertexArray),ec.hasTextCollisionBoxData()&&ec.textCollisionBox.collisionVertexBuffer&&ec.textCollisionBox.collisionVertexBuffer.updateData(ec.textCollisionBox.collisionVertexArray),ec.bucketInstanceId in this.collisionCircleArrays){let eo=this.collisionCircleArrays[ec.bucketInstanceId];ec.placementInvProjMatrix=eo.invProjMatrix,ec.placementViewportMatrix=eo.viewportMatrix,ec.collisionCircleArray=eo.circles,delete this.collisionCircleArrays[ec.bucketInstanceId]}}symbolFadeChange(eo){return 0===this.fadeDuration?1:(eo-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(eo){return Math.max(0,(this.transform.zoom-eo)/1.5)}hasTransitions(eo){return this.stale||eo-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(eo,ec){let ed=this.zoomAtLastRecencyCheck===ec?1-this.zoomAdjustment(ec):1;return this.zoomAtLastRecencyCheck=ec,this.commitTime+this.fadeDuration*ed>eo}setStale(){this.stale=!0}};function St(eo,ec,ed,em,e_){eo.emplaceBack(ec?1:0,ed?1:0,em||0,e_||0),eo.emplaceBack(ec?1:0,ed?1:0,em||0,e_||0),eo.emplaceBack(ec?1:0,ed?1:0,em||0,e_||0),eo.emplaceBack(ec?1:0,ed?1:0,em||0,e_||0)}function kt(eo){if(0===eo.opacity&&!eo.placed)return 0;if(1===eo.opacity&&eo.placed)return 4294967295;let ec=eo.placed?1:0,ed=Math.floor(127*eo.opacity);return 33554432*ed+16777216*ec+131072*ed+65536*ec+512*ed+256*ec+2*ed+ec}let eD=0;let Ut=class Ut{constructor(eo){this._sortAcrossTiles="viewport-y"!==eo.layout.get("symbol-z-order")&&void 0!==eo.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(eo,ec,ed,em,e_){let eg=this._bucketParts;for(;this._currentTileIndex<eo.length;)if(ec.getBucketParts(eg,em,eo[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,e_())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,eg.sort((eo,ec)=>eo.sortKey-ec.sortKey));this._currentPartIndex<eg.length;){let eo=eg[this._currentPartIndex];if(ec.placeLayerBucketPart(eo,this._seenCrossTileIDs,ed,0===eo.symbolInstanceStart),this._currentPartIndex++,e_())return!0}return!1}};let Nt=class Nt{constructor(eo,ec,ed,em,e_,eg,ex,ev){this.placement=new Pt(eo,e_,eg,ex,ev),this._currentPlacementIndex=ec.length-1,this._forceFullPlacement=ed,this._showCollisionBoxes=em,this._done=!1}isDone(){return this._done}continuePlacement(ec,ed,em){let e_=eo.exported.now(),n=()=>{let ec=eo.exported.now()-e_;return!this._forceFullPlacement&&ec>2};for(;this._currentPlacementIndex>=0;){let eo=ed[ec[this._currentPlacementIndex]],e_=this.placement.collisionIndex.transform.zoom;if("symbol"===eo.type&&(!eo.minzoom||eo.minzoom<=e_)&&(!eo.maxzoom||eo.maxzoom>e_)){if(this._inProgressLayer||(this._inProgressLayer=new Ut(eo)),this._inProgressLayer.continuePlacement(em[eo.source],this.placement,this._showCollisionBoxes,eo,n))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(eo){return this.placement.commit(eo),this.placement}};let ek=512/eo.EXTENT/2;let Gt=class Gt{constructor(ec,ed,em){this.tileID=ec,this.bucketInstanceId=em,this.index=new eo.KDBush(ed.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let e_=ec.canonical.x*eo.EXTENT,eg=ec.canonical.y*eo.EXTENT;for(let eo=0;eo<ed.length;eo++){let{key:ec,crossTileID:em,tileAnchorX:ex,tileAnchorY:ev}=ed.get(eo),eb=Math.floor((e_+ex)*ek),ew=Math.floor((eg+ev)*ek);this.index.add(eb,ew),this.keys.push(ec),this.crossTileIDs.push(em)}this.index.finish()}findMatches(ec,ed,em){let e_=this.tileID.canonical.z<ed.canonical.z?1:Math.pow(2,this.tileID.canonical.z-ed.canonical.z),eg=ek/Math.pow(2,ed.canonical.z-this.tileID.canonical.z),ex=ed.canonical.x*eo.EXTENT,ev=ed.canonical.y*eo.EXTENT;for(let eo=0;eo<ec.length;eo++){let ed=ec.get(eo);if(ed.crossTileID)continue;let{key:eb,tileAnchorX:ew,tileAnchorY:eT}=ed,eE=Math.floor((ex+ew)*eg),eM=Math.floor((ev+eT)*eg),eS=this.index.range(eE-e_,eM-e_,eE+e_,eM+e_);for(let eo of eS){let ec=this.crossTileIDs[eo];if(this.keys[eo]===eb&&!em.has(ec)){em.add(ec),ed.crossTileID=ec;break}}}}};let Zt=class Zt{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}};let Vt=class Vt{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(eo){let ec=Math.round((eo-this.lng)/360);if(0!==ec)for(let eo in this.indexes){let ed=this.indexes[eo],em={};for(let eo in ed){let e_=ed[eo];e_.tileID=e_.tileID.unwrapTo(e_.tileID.wrap+ec),em[e_.tileID.key]=e_}this.indexes[eo]=em}this.lng=eo}addBucket(eo,ec,ed){if(this.indexes[eo.overscaledZ]&&this.indexes[eo.overscaledZ][eo.key]){if(this.indexes[eo.overscaledZ][eo.key].bucketInstanceId===ec.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(eo.overscaledZ,this.indexes[eo.overscaledZ][eo.key])}for(let eo=0;eo<ec.symbolInstances.length;eo++)ec.symbolInstances.get(eo).crossTileID=0;this.usedCrossTileIDs[eo.overscaledZ]||(this.usedCrossTileIDs[eo.overscaledZ]=new Set);let em=this.usedCrossTileIDs[eo.overscaledZ];for(let ed in this.indexes){let e_=this.indexes[ed];if(Number(ed)>eo.overscaledZ)for(let ed in e_){let eg=e_[ed];eg.tileID.isChildOf(eo)&&eg.findMatches(ec.symbolInstances,eo,em)}else{let eg=e_[eo.scaledTo(Number(ed)).key];eg&&eg.findMatches(ec.symbolInstances,eo,em)}}for(let eo=0;eo<ec.symbolInstances.length;eo++){let e_=ec.symbolInstances.get(eo);e_.crossTileID||(e_.crossTileID=ed.generate(),em.add(e_.crossTileID))}return void 0===this.indexes[eo.overscaledZ]&&(this.indexes[eo.overscaledZ]={}),this.indexes[eo.overscaledZ][eo.key]=new Gt(eo,ec.symbolInstances,ec.bucketInstanceId),!0}removeBucketCrossTileIDs(eo,ec){for(let ed of ec.crossTileIDs)this.usedCrossTileIDs[eo].delete(ed)}removeStaleBuckets(eo){let ec=!1;for(let ed in this.indexes){let em=this.indexes[ed];for(let e_ in em)eo[em[e_].bucketInstanceId]||(this.removeBucketCrossTileIDs(ed,em[e_]),delete em[e_],ec=!0)}return ec}};let Wt=class Wt{constructor(){this.layerIndexes={},this.crossTileIDs=new Zt,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(eo,ec,ed,em){let e_=this.layerIndexes[eo.id];void 0===e_&&(e_=this.layerIndexes[eo.id]=new Vt);let eg=!1,ex={};for(let ev of("globe"!==em.name&&e_.handleWrapJump(ed),ec)){let ec=ev.getBucket(eo);ec&&eo.id===ec.layerIds[0]&&(ec.bucketInstanceId||(ec.bucketInstanceId=++this.maxBucketInstanceId),e_.addBucket(ev.tileID,ec,this.crossTileIDs)&&(eg=!0),ex[ec.bucketInstanceId]=!0)}return e_.removeStaleBuckets(ex)&&(eg=!0),eg}pruneUnusedLayers(eo){let ec={};for(let ed in eo.forEach(eo=>{ec[eo]=!0}),this.layerIndexes)ec[ed]||delete this.layerIndexes[ed]}};let Xt=(ec,ed)=>eo.emitValidationErrors(ec,ed&&ed.filter(eo=>"source.canvas"!==eo.identifier)),eL=eo.pick(eC,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),eR=eo.pick(eC,["setCenter","setZoom","setBearing","setPitch"]),eB={version:8,layers:[],sources:{}},eF={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};let Kt=class Kt extends eo.Evented{constructor(ec,ed={}){super(),this.map=ec,this.dispatcher=new S(Ue(),this),this.imageManager=new y,this.imageManager.setEventedParent(this),this.glyphManager=new eo.GlyphManager(ec._requestManager,ed.localFontFamily?eo.LocalGlyphMode.all:ed.localIdeographFontFamily?eo.LocalGlyphMode.ideographs:eo.LocalGlyphMode.none,ed.localFontFamily||ed.localIdeographFontFamily),this.crossTileSymbolIndex=new Wt,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",eo.getReferrer());let em=this;this._rtlTextPluginCallback=Kt.registerForPluginStateChange(ec=>{em.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:ec.pluginStatus,pluginURL:ec.pluginURL},(ec,ed)=>{if(eo.triggerPluginCompletionEvent(ec),ed&&ed.every(eo=>eo))for(let eo in em._sourceCaches){let ec=em._sourceCaches[eo],ed=ec.getSource().type;"vector"!==ed&&"geojson"!==ed||ec.reload()}})}),this.on("data",eo=>{if("source"!==eo.dataType||"metadata"!==eo.sourceDataType)return;let ec=this.getSource(eo.sourceId);if(ec&&ec.vectorLayerIds)for(let eo in this._layers){let ed=this._layers[eo];ed.source===ec.id&&this._validateLayer(ed)}})}loadURL(ec,ed={}){this.fire(new eo.Event("dataloading",{dataType:"style"}));let em="boolean"==typeof ed.validate?ed.validate:!eo.isMapboxURL(ec);ec=this.map._requestManager.normalizeStyleURL(ec,ed.accessToken);let e_=this.map._requestManager.transformRequest(ec,eo.ResourceType.Style);this._request=eo.getJSON(e_,(ec,ed)=>{this._request=null,ec?this.fire(new eo.ErrorEvent(ec)):ed&&this._load(ed,em)})}loadJSON(ec,ed={}){this.fire(new eo.Event("dataloading",{dataType:"style"})),this._request=eo.exported.frame(()=>{this._request=null,this._load(ec,!1!==ed.validate)})}loadEmpty(){this.fire(new eo.Event("dataloading",{dataType:"style"})),this._load(eB,!1)}_updateLayerCount(eo,ec){let ed=ec?1:-1;eo.is3D()&&(this._num3DLayers+=ed),"circle"===eo.type&&(this._numCircleLayers+=ed),"symbol"===eo.type&&(this._numSymbolLayers+=ed)}_load(ec,ed){if(ed&&Xt(this,eo.validateStyle(ec)))return;for(let ed in this._loaded=!0,this.stylesheet=eo.clone$1(ec),this._updateMapProjection(),ec.sources)this.addSource(ed,ec.sources[ed],{validate:!1});this._changed=!1,ec.sprite?this._loadSprite(ec.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(ec.glyphs);let em=je(this.stylesheet.layers);for(let ec of(this._order=em.map(eo=>eo.id),this._layers={},this._serializedLayers={},em)){let ed=eo.createStyleLayer(ec);ed.setEventedParent(this,{layer:{id:ed.id}}),this._layers[ed.id]=ed,this._serializedLayers[ed.id]=ed.serialize(),this._updateLayerCount(ed,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new w(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new eo.Event("data",{dataType:"style"})),this.fire(new eo.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(eo){eo?this.stylesheet.projection=eo:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(ec){this._spriteRequest=function(ec,ed,em){let e_,eg,ex;let ev=eo.exported.devicePixelRatio>1?"@2x":"",eb=eo.getJSON(ed.transformRequest(ed.normalizeSpriteURL(ec,ev,".json"),eo.ResourceType.SpriteJSON),(eo,ec)=>{eb=null,ex||(ex=eo,e_=ec,h())}),ew=eo.getImage(ed.transformRequest(ed.normalizeSpriteURL(ec,ev,".png"),eo.ResourceType.SpriteImage),(eo,ec)=>{ew=null,ex||(ex=eo,eg=ec,h())});function h(){if(ex)em(ex);else if(e_&&eg){let ec=eo.exported.getImageData(eg),ed={};for(let em in e_){let{width:eg,height:ex,x:ev,y:eb,sdf:ew,pixelRatio:eT,stretchX:eE,stretchY:eM,content:eS}=e_[em],eA=new eo.RGBAImage({width:eg,height:ex});eo.RGBAImage.copy(ec,eA,{x:ev,y:eb},{x:0,y:0},{width:eg,height:ex}),ed[em]={data:eA,pixelRatio:eT,sdf:ew,stretchX:eE,stretchY:eM,content:eS}}em(null,ed)}}return{cancel(){eb&&(eb.cancel(),eb=null),ew&&(ew.cancel(),ew=null)}}}(ec,this.map._requestManager,(ec,ed)=>{if(this._spriteRequest=null,ec)this.fire(new eo.ErrorEvent(ec));else if(ed)for(let eo in ed)this.imageManager.addImage(eo,ed[eo]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new eo.Event("data",{dataType:"style"}))})}_validateLayer(ec){let ed=this.getSource(ec.source);if(!ed)return;let em=ec.sourceLayer;em&&("geojson"===ed.type||ed.vectorLayerIds&&-1===ed.vectorLayerIds.indexOf(em))&&this.fire(new eo.ErrorEvent(Error(`Source layer "${em}" does not exist on source "${ed.id}" as specified by style layer "${ec.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(let eo in this._sourceCaches)if(!this._sourceCaches[eo].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(eo){let ec=[];for(let ed of eo){let eo=this._layers[ed];"custom"!==eo.type&&ec.push(eo.serialize())}return ec}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(let eo in this._sourceCaches)if(this._sourceCaches[eo].hasTransition())return!0;for(let eo in this._layers)if(this._layers[eo].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(eo){return!!this.terrain&&("function"==typeof eo.isLayerDraped?eo.isLayerDraped():eF[eo.type])}_checkLoaded(){if(!this._loaded)throw Error("Style is not done loading")}update(ec){if(!this._loaded)return;let ed=this._changed;if(this._changed){let eo=Object.keys(this._updatedLayers),ed=Object.keys(this._removedLayers);for(let ec in(eo.length||ed.length)&&this._updateWorkerLayers(eo,ed),this._updatedSources){let eo=this._updatedSources[ec];"reload"===eo?this._reloadSource(ec):"clear"===eo&&this._clearSource(ec)}for(let eo in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[eo].updateTransitions(ec);this.light.updateTransitions(ec),this.fog&&this.fog.updateTransitions(ec),this._resetUpdates()}let em={};for(let eo in this._sourceCaches){let ec=this._sourceCaches[eo];em[eo]=ec.used,ec.used=!1}for(let eo of this._order){let ed=this._layers[eo];if(ed.recalculate(ec,this._availableImages),!ed.isHidden(ec.zoom)){let eo=this._getLayerSourceCache(ed);eo&&(eo.used=!0)}let em=this.map.painter;if(em){let eo=ed.getProgramIds();if(!eo)continue;let e_=ed.getProgramConfiguration(ec.zoom);for(let ec of eo)em.useProgram(ec,e_)}}for(let ec in em){let ed=this._sourceCaches[ec];em[ec]!==ed.used&&ed.getSource().fire(new eo.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ed.getSource().id}))}this.light.recalculate(ec),this.terrain&&this.terrain.recalculate(ec),this.fog&&this.fog.recalculate(ec),this.z=ec.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),ed&&this.fire(new eo.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){let eo=Object.keys(this._changedImages);if(eo.length){for(let ec in this._sourceCaches)this._sourceCaches[ec].reloadTilesForDependencies(["icons","patterns"],eo);this._changedImages={}}}_updateWorkerLayers(eo,ec){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(eo),removedIds:ec})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(ec){if(this._checkLoaded(),Xt(this,eo.validateStyle(ec)))return!1;(ec=eo.clone$1(ec)).layers=je(ec.layers);let ed=(function(eo,ec){if(!eo)return[{command:eC.setStyle,args:[ec]}];let ed=[];try{if(!t(eo.version,ec.version))return[{command:eC.setStyle,args:[ec]}];t(eo.center,ec.center)||ed.push({command:eC.setCenter,args:[ec.center]}),t(eo.zoom,ec.zoom)||ed.push({command:eC.setZoom,args:[ec.zoom]}),t(eo.bearing,ec.bearing)||ed.push({command:eC.setBearing,args:[ec.bearing]}),t(eo.pitch,ec.pitch)||ed.push({command:eC.setPitch,args:[ec.pitch]}),t(eo.sprite,ec.sprite)||ed.push({command:eC.setSprite,args:[ec.sprite]}),t(eo.glyphs,ec.glyphs)||ed.push({command:eC.setGlyphs,args:[ec.glyphs]}),t(eo.transition,ec.transition)||ed.push({command:eC.setTransition,args:[ec.transition]}),t(eo.light,ec.light)||ed.push({command:eC.setLight,args:[ec.light]}),t(eo.fog,ec.fog)||ed.push({command:eC.setFog,args:[ec.fog]}),t(eo.projection,ec.projection)||ed.push({command:eC.setProjection,args:[ec.projection]});let em={},e_=[];!function(eo,ec,ed,em){let e_;for(e_ in ec=ec||{},eo=eo||{})eo.hasOwnProperty(e_)&&(ec.hasOwnProperty(e_)||Ve(e_,ed,em));for(e_ in ec){var eg,ex;if(!ec.hasOwnProperty(e_))continue;let ev=ec[e_];eo.hasOwnProperty(e_)?t(eo[e_],ev)||("geojson"===eo[e_].type&&"geojson"===ev.type&&function(eo,ec,ed){let em;for(em in eo[ed])if(eo[ed].hasOwnProperty(em)&&"data"!==em&&!t(eo[ed][em],ec[ed][em]))return!1;for(em in ec[ed])if(ec[ed].hasOwnProperty(em)&&"data"!==em&&!t(eo[ed][em],ec[ed][em]))return!1;return!0}(eo,ec,e_)?ed.push({command:eC.setGeoJSONSourceData,args:[e_,ev.data]}):(eg=e_,ex=ec,Ve(eg,ed,em),Ze(eg,ex,ed))):Ze(e_,ec,ed)}}(eo.sources,ec.sources,e_,em);let eg=[];eo.layers&&eo.layers.forEach(eo=>{eo.source&&em[eo.source]?ed.push({command:eC.removeLayer,args:[eo.id]}):eg.push(eo)});let ex=eo.terrain;ex&&em[ex.source]&&(ed.push({command:eC.setTerrain,args:[void 0]}),ex=void 0),ed=ed.concat(e_),t(ex,ec.terrain)||ed.push({command:eC.setTerrain,args:[ec.terrain]}),function(eo,ec,ed){let em,e_,eg,ex,ev,eb,ew;ec=ec||[];let eT=(eo=eo||[]).map($e),eE=ec.map($e),eM=eo.reduce(He,{}),eS=ec.reduce(He,{}),eA=eT.slice(),eI=Object.create(null);for(em=0,e_=0;em<eT.length;em++)eg=eT[em],eS.hasOwnProperty(eg)?e_++:(ed.push({command:eC.removeLayer,args:[eg]}),eA.splice(eA.indexOf(eg,e_),1));for(em=0,e_=0;em<eE.length;em++)eg=eE[eE.length-1-em],eA[eA.length-1-em]!==eg&&(eM.hasOwnProperty(eg)?(ed.push({command:eC.removeLayer,args:[eg]}),eA.splice(eA.lastIndexOf(eg,eA.length-e_),1)):e_++,eb=eA[eA.length-em],ed.push({command:eC.addLayer,args:[eS[eg],eb]}),eA.splice(eA.length-em,0,eg),eI[eg]=!0);for(em=0;em<eE.length;em++)if(ex=eM[eg=eE[em]],ev=eS[eg],!eI[eg]&&!t(ex,ev)){if(t(ex.source,ev.source)&&t(ex["source-layer"],ev["source-layer"])&&t(ex.type,ev.type)){for(ew in qe(ex.layout,ev.layout,ed,eg,null,eC.setLayoutProperty),qe(ex.paint,ev.paint,ed,eg,null,eC.setPaintProperty),t(ex.filter,ev.filter)||ed.push({command:eC.setFilter,args:[eg,ev.filter]}),t(ex.minzoom,ev.minzoom)&&t(ex.maxzoom,ev.maxzoom)||ed.push({command:eC.setLayerZoomRange,args:[eg,ev.minzoom,ev.maxzoom]}),ex)ex.hasOwnProperty(ew)&&"layout"!==ew&&"paint"!==ew&&"filter"!==ew&&"metadata"!==ew&&"minzoom"!==ew&&"maxzoom"!==ew&&(0===ew.indexOf("paint.")?qe(ex[ew],ev[ew],ed,eg,ew.slice(6),eC.setPaintProperty):t(ex[ew],ev[ew])||ed.push({command:eC.setLayerProperty,args:[eg,ew,ev[ew]]}));for(ew in ev)ev.hasOwnProperty(ew)&&!ex.hasOwnProperty(ew)&&"layout"!==ew&&"paint"!==ew&&"filter"!==ew&&"metadata"!==ew&&"minzoom"!==ew&&"maxzoom"!==ew&&(0===ew.indexOf("paint.")?qe(ex[ew],ev[ew],ed,eg,ew.slice(6),eC.setPaintProperty):t(ex[ew],ev[ew])||ed.push({command:eC.setLayerProperty,args:[eg,ew,ev[ew]]}))}else ed.push({command:eC.removeLayer,args:[eg]}),eb=eA[eA.lastIndexOf(eg)+1],ed.push({command:eC.addLayer,args:[ev,eb]})}}(eg,ec.layers,ed)}catch(eo){console.warn("Unable to compute style diff:",eo),ed=[{command:eC.setStyle,args:[ec]}]}return ed})(this.serialize(),ec).filter(eo=>!(eo.command in eR));if(0===ed.length)return!1;let em=ed.filter(eo=>!(eo.command in eL));if(em.length>0)throw Error(`Unimplemented: ${em.map(eo=>eo.command).join(", ")}.`);return ed.forEach(eo=>{"setTransition"!==eo.command&&"setProjection"!==eo.command&&this[eo.command].apply(this,eo.args)}),this.stylesheet=ec,this._updateMapProjection(),!0}addImage(ec,ed){return this.getImage(ec)?this.fire(new eo.ErrorEvent(Error("An image with this name already exists."))):(this.imageManager.addImage(ec,ed),this._afterImageUpdated(ec),this)}updateImage(eo,ec){this.imageManager.updateImage(eo,ec)}getImage(eo){return this.imageManager.getImage(eo)}removeImage(ec){return this.getImage(ec)?(this.imageManager.removeImage(ec),this._afterImageUpdated(ec),this):this.fire(new eo.ErrorEvent(Error("No image with this name exists.")))}_afterImageUpdated(ec){this._availableImages=this.imageManager.listImages(),this._changedImages[ec]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new eo.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(ec,ed,em={}){if(this._checkLoaded(),void 0!==this.getSource(ec))throw Error("There is already a source with this ID");if(!ed.type)throw Error(`The type property must be defined, but only the following properties were given: ${Object.keys(ed).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(ed.type)>=0&&this._validate(eo.validateSource,`sources.${ec}`,ed,null,em))return;this.map&&this.map._collectResourceTiming&&(ed.collectResourceTiming=!0);let e_=De(ec,ed,this.dispatcher,this);e_.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(ec),source:e_.serialize(),sourceId:ec}));let n=ed=>{let em=(ed?"symbol:":"other:")+ec,eg=this._sourceCaches[em]=new eo.SourceCache(em,e_,ed);(ed?this._symbolSourceCaches:this._otherSourceCaches)[ec]=eg,eg.style=this,eg.onAdd(this.map)};n(!1),"vector"!==ed.type&&"geojson"!==ed.type||n(!0),e_.onAdd&&e_.onAdd(this.map),this._changed=!0}removeSource(ec){this._checkLoaded();let ed=this.getSource(ec);if(!ed)throw Error("There is no source with this ID");for(let ed in this._layers)if(this._layers[ed].source===ec)return this.fire(new eo.ErrorEvent(Error(`Source "${ec}" cannot be removed while layer "${ed}" is using it.`)));if(this.terrain&&this.terrain.get().source===ec)return this.fire(new eo.ErrorEvent(Error(`Source "${ec}" cannot be removed while terrain is using it.`)));let em=this._getSourceCaches(ec);for(let ec of em)delete this._sourceCaches[ec.id],delete this._updatedSources[ec.id],ec.fire(new eo.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:ec.getSource().id})),ec.setEventedParent(null),ec.clearTiles();return delete this._otherSourceCaches[ec],delete this._symbolSourceCaches[ec],ed.setEventedParent(null),ed.onRemove&&ed.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(eo,ec){this._checkLoaded(),this.getSource(eo).setData(ec),this._changed=!0}getSource(eo){let ec=this._getSourceCache(eo);return ec&&ec.getSource()}_getSources(){let eo=[];for(let ec in this._otherSourceCaches){let ed=this._getSourceCache(ec);ed&&eo.push(ed.getSource())}return eo}addLayer(ec,ed,em={}){let e_;this._checkLoaded();let eg=ec.id;if(this.getLayer(eg))return void this.fire(new eo.ErrorEvent(Error(`Layer with id "${eg}" already exists on this map`)));if("custom"===ec.type){if(Xt(this,eo.validateCustomStyleLayer(ec)))return;e_=eo.createStyleLayer(ec)}else{if("object"==typeof ec.source&&(this.addSource(eg,ec.source),ec=eo.clone$1(ec),ec=eo.extend(ec,{source:eg})),this._validate(eo.validateLayer,`layers.${eg}`,ec,{arrayIndex:-1},em))return;e_=eo.createStyleLayer(ec),this._validateLayer(e_),e_.setEventedParent(this,{layer:{id:eg}}),this._serializedLayers[e_.id]=e_.serialize(),this._updateLayerCount(e_,!0)}let ex=ed?this._order.indexOf(ed):this._order.length;if(ed&&-1===ex)return void this.fire(new eo.ErrorEvent(Error(`Layer with id "${ed}" does not exist on this map.`)));this._order.splice(ex,0,eg),this._layerOrderChanged=!0,this._layers[eg]=e_;let ev=this._getLayerSourceCache(e_);if(this._removedLayers[eg]&&e_.source&&ev&&"custom"!==e_.type){let eo=this._removedLayers[eg];delete this._removedLayers[eg],eo.type!==e_.type?this._updatedSources[e_.source]="clear":(this._updatedSources[e_.source]="reload",ev.pause())}this._updateLayer(e_),e_.onAdd&&e_.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(ec,ed){if(this._checkLoaded(),this._changed=!0,!this._layers[ec])return void this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style and cannot be moved.`)));if(ec===ed)return;let em=this._order.indexOf(ec);this._order.splice(em,1);let e_=ed?this._order.indexOf(ed):this._order.length;ed&&-1===e_?this.fire(new eo.ErrorEvent(Error(`Layer with id "${ed}" does not exist on this map.`))):(this._order.splice(e_,0,ec),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(ec){this._checkLoaded();let ed=this._layers[ec];if(!ed)return void this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style and cannot be removed.`)));ed.setEventedParent(null),this._updateLayerCount(ed,!1);let em=this._order.indexOf(ec);this._order.splice(em,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[ec]=ed,delete this._layers[ec],delete this._serializedLayers[ec],delete this._updatedLayers[ec],delete this._updatedPaintProps[ec],ed.onRemove&&ed.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(eo){return this._layers[eo]}hasLayer(eo){return eo in this._layers}hasLayerType(eo){for(let ec in this._layers)if(this._layers[ec].type===eo)return!0;return!1}setLayerZoomRange(ec,ed,em){this._checkLoaded();let e_=this.getLayer(ec);e_?e_.minzoom===ed&&e_.maxzoom===em||(null!=ed&&(e_.minzoom=ed),null!=em&&(e_.maxzoom=em),this._updateLayer(e_)):this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(ec,ed,em={}){this._checkLoaded();let e_=this.getLayer(ec);if(e_){if(!t(e_.filter,ed))return null==ed?(e_.filter=void 0,void this._updateLayer(e_)):void(this._validate(eo.validateFilter,`layers.${e_.id}.filter`,ed,{layerType:e_.type},em)||(e_.filter=eo.clone$1(ed),this._updateLayer(e_)))}else this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style and cannot be filtered.`)))}getFilter(ec){let ed=this.getLayer(ec);return ed&&eo.clone$1(ed.filter)}setLayoutProperty(ec,ed,em,e_={}){this._checkLoaded();let eg=this.getLayer(ec);eg?t(eg.getLayoutProperty(ed),em)||(eg.setLayoutProperty(ed,em,e_),this._updateLayer(eg)):this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(ec,ed){let em=this.getLayer(ec);if(em)return em.getLayoutProperty(ed);this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style.`)))}setPaintProperty(ec,ed,em,e_={}){this._checkLoaded();let eg=this.getLayer(ec);eg?t(eg.getPaintProperty(ed),em)||(eg.setPaintProperty(ed,em,e_)&&this._updateLayer(eg),this._changed=!0,this._updatedPaintProps[ec]=!0):this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(eo,ec){let ed=this.getLayer(eo);return ed&&ed.getPaintProperty(ec)}setFeatureState(ec,ed){this._checkLoaded();let em=ec.source,e_=ec.sourceLayer,eg=this.getSource(em);if(!eg)return void this.fire(new eo.ErrorEvent(Error(`The source '${em}' does not exist in the map's style.`)));let ex=eg.type;if("geojson"===ex&&e_)return void this.fire(new eo.ErrorEvent(Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===ex&&!e_)return void this.fire(new eo.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")));void 0===ec.id&&this.fire(new eo.ErrorEvent(Error("The feature id parameter must be provided.")));let ev=this._getSourceCaches(em);for(let eo of ev)eo.setFeatureState(e_,ec.id,ed)}removeFeatureState(ec,ed){this._checkLoaded();let em=ec.source,e_=this.getSource(em);if(!e_)return void this.fire(new eo.ErrorEvent(Error(`The source '${em}' does not exist in the map's style.`)));let eg=e_.type,ex="vector"===eg?ec.sourceLayer:void 0;if("vector"===eg&&!ex)return void this.fire(new eo.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")));if(ed&&"string"!=typeof ec.id&&"number"!=typeof ec.id)return void this.fire(new eo.ErrorEvent(Error("A feature id is required to remove its specific state property.")));let ev=this._getSourceCaches(em);for(let eo of ev)eo.removeFeatureState(ex,ec.id,ed)}getFeatureState(ec){this._checkLoaded();let ed=ec.source,em=ec.sourceLayer,e_=this.getSource(ed);if(e_){if("vector"!==e_.type||em)return void 0===ec.id&&this.fire(new eo.ErrorEvent(Error("The feature id parameter must be provided."))),this._getSourceCaches(ed)[0].getFeatureState(em,ec.id);this.fire(new eo.ErrorEvent(Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new eo.ErrorEvent(Error(`The source '${ed}' does not exist in the map's style.`)))}getTransition(){return eo.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){let ec={};for(let eo in this._sourceCaches){let ed=this._sourceCaches[eo].getSource();ec[ed.id]||(ec[ed.id]=ed.serialize())}return eo.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:ec,layers:this._serializeLayers(this._order)},eo=>void 0!==eo)}_updateLayer(eo){this._updatedLayers[eo.id]=!0;let ec=this._getLayerSourceCache(eo);eo.source&&!this._updatedSources[eo.source]&&ec&&"raster"!==ec.getSource().type&&(this._updatedSources[eo.source]="reload",ec.pause()),this._changed=!0,eo.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(eo){let t=eo=>"fill-extrusion"===this._layers[eo].type,ec={},ed=[];for(let em=this._order.length-1;em>=0;em--){let e_=this._order[em];if(t(e_))for(let eg of(ec[e_]=em,eo)){let eo=eg[e_];if(eo)for(let ec of eo)ed.push(ec)}}ed.sort((eo,ec)=>ec.intersectionZ-eo.intersectionZ);let em=[];for(let e_=this._order.length-1;e_>=0;e_--){let eg=this._order[e_];if(t(eg))for(let eo=ed.length-1;eo>=0;eo--){let eg=ed[eo].feature;if(ec[eg.layer.id]<e_)break;em.push(eg),ed.pop()}else for(let ec of eo){let eo=ec[eg];if(eo)for(let ec of eo)em.push(ec.feature)}}return em}queryRenderedFeatures(ec,ed,em){ed&&ed.filter&&this._validate(eo.validateFilter,"queryRenderedFeatures.filter",ed.filter,null,ed);let e_={};if(ed&&ed.layers){if(!Array.isArray(ed.layers))return this.fire(new eo.ErrorEvent(Error("parameters.layers must be an Array."))),[];for(let ec of ed.layers){let ed=this._layers[ec];if(!ed)return this.fire(new eo.ErrorEvent(Error(`The layer '${ec}' does not exist in the map's style and cannot be queried for features.`))),[];e_[ed.source]=!0}}let eg=[];ed.availableImages=this._availableImages;let ex=ed&&ed.layers?ed.layers.some(eo=>{let ec=this.getLayer(eo);return ec&&ec.is3D()}):this.has3DLayers(),ev=L.createFromScreenPoints(ec,em);for(let ec in this._sourceCaches){let eb=this._sourceCaches[ec].getSource().id;ed.layers&&!e_[eb]||eg.push(function(ec,ed,em,e_,eg,ex,ev,eb=!1){let ew=ec.tilesIn(e_,ev,eb);ew.sort(Re);let eT=[];for(let e_ of ew)eT.push({wrappedTileID:e_.tile.tileID.wrapped().key,queryResults:e_.tile.queryRenderedFeatures(ed,em,ec._state,e_,eg,ex,function(ec,ed){let em=eo.identity([]);return eo.scale(em,em,[.5*ec.width,-(.5*ec.height),1]),eo.translate(em,em,[1,-1,0]),eo.multiply(em,em,ec.calculateProjMatrix(ed.toUnwrapped())),Float32Array.from(em)}(ec.transform,e_.tile.tileID),eb)});let eE=function(eo){let ec={},ed={};for(let em of eo){let eo=em.queryResults,e_=em.wrappedTileID,eg=ed[e_]=ed[e_]||{};for(let ed in eo){let em=eo[ed],e_=eg[ed]=eg[ed]||{},ex=ec[ed]=ec[ed]||[];for(let eo of em)e_[eo.featureIndex]||(e_[eo.featureIndex]=!0,ex.push(eo))}}return ec}(eT);for(let eo in eE)eE[eo].forEach(eo=>{let ed=eo.feature,em=ed.layer;em&&"background"!==em.type&&"sky"!==em.type&&(ed.source=em.source,em["source-layer"]&&(ed.sourceLayer=em["source-layer"]),ed.state=void 0!==ed.id?ec.getFeatureState(em["source-layer"],ed.id):{})});return eE}(this._sourceCaches[ec],this._layers,this._serializedLayers,ev,ed,em,ex,!!this.map._showQueryGeometry))}return this.placement&&eg.push(function(eo,ec,ed,em,e_,eg,ex){let ev={},eb=eg.queryRenderedSymbols(em),ew=[];for(let eo of Object.keys(eb).map(Number))ew.push(ex[eo]);for(let ed of(ew.sort(Re),ew)){let em=ed.featureIndex.lookupSymbolFeatures(eb[ed.bucketInstanceId],ec,ed.bucketIndex,ed.sourceLayerIndex,e_.filter,e_.layers,e_.availableImages,eo);for(let eo in em){let ec=ev[eo]=ev[eo]||[],e_=em[eo];for(let eo of(e_.sort((eo,ec)=>{let em=ed.featureSortOrder;if(em){let ed=em.indexOf(eo.featureIndex);return em.indexOf(ec.featureIndex)-ed}return ec.featureIndex-eo.featureIndex}),e_))ec.push(eo)}}for(let ec in ev)ev[ec].forEach(em=>{let e_=em.feature,eg=ed(eo[ec]);if(!eg)return;let ex=eg.getFeatureState(e_.layer["source-layer"],e_.id);e_.source=e_.layer.source,e_.layer["source-layer"]&&(e_.sourceLayer=e_.layer["source-layer"]),e_.state=ex});return ev}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),ev.screenGeometry,ed,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(eg)}querySourceFeatures(ec,ed){ed&&ed.filter&&this._validate(eo.validateFilter,"querySourceFeatures.filter",ed.filter,null,ed);let em=this._getSourceCaches(ec),e_=[];for(let eo of em)e_=e_.concat(function(eo,ec){let ed=eo.getRenderableIds().map(ec=>eo.getTileByID(ec)),em=[],e_={};for(let eo=0;eo<ed.length;eo++){let eg=ed[eo],ex=eg.tileID.canonical.key;e_[ex]||(e_[ex]=!0,eg.querySourceFeatures(em,ec))}return em}(eo,ed));return e_}addSourceType(eo,ec,ed){return Kt.getSourceType(eo)?ed(Error(`A source type called "${eo}" already exists.`)):(Kt.setSourceType(eo,ec),ec.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:eo,url:ec.workerSourceURL},ed):ed(null,null))}getLight(){return this.light.getLight()}setLight(eo,ec={}){this._checkLoaded();let ed=this.light.getLight(),em=!1;for(let ec in eo)if(!t(eo[ec],ed[ec])){em=!0;break}if(!em)return;let e_=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(eo,ec),this.light.updateTransitions(e_)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(ec,ed=1){if(this._checkLoaded(),!ec)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let em=ec;if(1===ed){if("object"==typeof em.source){let ec="terrain-dem-src";this.addSource(ec,em.source),em=eo.clone$1(em),em=eo.extend(em,{source:ec})}if(this._validate(eo.validateTerrain,"terrain",em))return}if(!this.terrain||this.terrain&&ed!==this.terrain.drapeRenderMode){if(!em)return;this._createTerrain(em,ed)}else{let ec=this.terrain,ed=ec.get();for(let ec of Object.keys(eo.spec.terrain))!em.hasOwnProperty(ec)&&eo.spec.terrain[ec].default&&(em[ec]=eo.spec.terrain[ec].default);for(let eo in em)if(!t(em[eo],ed[eo])){ec.set(em),this.stylesheet.terrain=em;let eo=this._setTransitionParameters({duration:0});ec.updateTransitions(eo);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(eo){let ec=this.fog=new P(eo,this.map.transform);this.stylesheet.fog=eo;let ed=this._setTransitionParameters({duration:0});ec.updateTransitions(ed)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(let eo of this.map._markers)eo._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(eo){if(this._checkLoaded(),!eo)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let ec=this.fog,ed=ec.get();for(let em in 0===Object.keys(eo).length&&ec.set(eo),eo)if(!t(eo[em],ed[em])){ec.set(eo),this.stylesheet.fog=eo;let ed=this._setTransitionParameters({duration:0});ec.updateTransitions(ed);break}}else this._createFog(eo);this._markersNeedUpdate=!0}_setTransitionParameters(ec){return{now:eo.exported.now(),transition:eo.extend(ec,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;let eo=this._order.filter(eo=>this.isLayerDraped(this._layers[eo])),ec=this._order.filter(eo=>!this.isLayerDraped(this._layers[eo]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...eo),this._drapedFirstOrder.push(...ec)}_createTerrain(eo,ec){let ed=this.terrain=new ew(eo,ec);this.stylesheet.terrain=eo,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();let em=this._setTransitionParameters({duration:0});ed.updateTransitions(em)}_force3DLayerUpdate(){for(let eo in this._layers){let ec=this._layers[eo];"fill-extrusion"===ec.type&&this._updateLayer(ec)}}_forceSymbolLayerUpdate(){for(let eo in this._layers){let ec=this._layers[eo];"symbol"===ec.type&&this._updateLayer(ec)}}_validate(ec,ed,em,e_,eg={}){return(!eg||!1!==eg.validate)&&Xt(this,ec.call(eo.validateStyle,eo.extend({key:ed,style:this.serialize(),value:em,styleSpec:eo.spec},e_)))}_remove(){for(let ec in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),eo.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[ec].setEventedParent(null);for(let eo in this._sourceCaches)this._sourceCaches[eo].clearTiles(),this._sourceCaches[eo].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(eo){let ec=this._getSourceCaches(eo);for(let eo of ec)eo.clearTiles()}_reloadSource(eo){let ec=this._getSourceCaches(eo);for(let eo of ec)eo.resume(),eo.reload()}_reloadSources(){for(let eo of this._getSources())eo.reload&&eo.reload()}_updateSources(eo){for(let ec in this._sourceCaches)this._sourceCaches[ec].update(eo)}_generateCollisionBoxes(){for(let eo in this._sourceCaches){let ec=this._sourceCaches[eo];ec.resume(),ec.reload()}}_updatePlacement(ec,ed,em,e_,eg=!1){let ex=!1,ev=!1,eb={};for(let eo of this._order){let ed=this._layers[eo];if("symbol"!==ed.type)continue;if(!eb[ed.source]){let eo=this._getLayerSourceCache(ed);if(!eo)continue;eb[ed.source]=eo.getRenderableIds(!0).map(ec=>eo.getTileByID(ec)).sort((eo,ec)=>ec.tileID.overscaledZ-eo.tileID.overscaledZ||(eo.tileID.isLessThan(ec.tileID)?-1:1))}let em=this.crossTileSymbolIndex.addLayer(ed,eb[ed.source],ec.center.lng,ec.projection);ex=ex||em}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),eg=eg||this._layerOrderChanged||0===em,this._layerOrderChanged&&this.fire(new eo.Event("neworder")),(eg||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(eo.exported.now(),ec.zoom))&&(this.pauseablePlacement=new Nt(ec,this._order,eg,ed,em,e_,this.placement,this.fog&&ec.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,eb),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(eo.exported.now()),ev=!0),ex&&this.pauseablePlacement.placement.setStale()),ev||ex)for(let eo of this._order){let ec=this._layers[eo];"symbol"===ec.type&&this.placement.updateLayerOpacities(ec,eb[ec.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(eo.exported.now())}_releaseSymbolFadeTiles(){for(let eo in this._sourceCaches)this._sourceCaches[eo].releaseSymbolFadeTiles()}getImages(eo,ec,ed){this.imageManager.getImages(ec.icons,ed),this._updateTilesForChangedImages();let o=eo=>{eo&&eo.setDependencies(ec.tileID.key,ec.type,ec.icons)};o(this._otherSourceCaches[ec.source]),o(this._symbolSourceCaches[ec.source])}getGlyphs(eo,ec,ed){this.glyphManager.getGlyphs(ec.stacks,ed)}getResource(ec,ed,em){return eo.makeRequest(ed,em)}_getSourceCache(eo){return this._otherSourceCaches[eo]}_getLayerSourceCache(eo){return"symbol"===eo.type?this._symbolSourceCaches[eo.source]:this._otherSourceCaches[eo.source]}_getSourceCaches(eo){let ec=[];return this._otherSourceCaches[eo]&&ec.push(this._otherSourceCaches[eo]),this._symbolSourceCaches[eo]&&ec.push(this._symbolSourceCaches[eo]),ec}_isSourceCacheLoaded(ec){let ed=this._getSourceCaches(ec);return 0===ed.length?(this.fire(new eo.ErrorEvent(Error(`There is no source with ID '${ec}'`))),!1):ed.every(eo=>eo.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}};Kt.getSourceType=function(eo){return eA[eo]},Kt.setSourceType=function(eo,ec){eA[eo]=ec},Kt.registerForPluginStateChange=eo.registerForPluginStateChange;var eO="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",eU="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",eN="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",eV="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",ej="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let eG={},eZ={},e$=[];hi(eO,e$),hi(eN,e$),hi(eV,e$),hi(ej,e$),eG=ui("",eN),eZ=ui(ej,eV);let eq=ui("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),eX="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var eW={background:ui("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:ui("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:ui("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:ui("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ui("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:ui("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ui("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ui("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ui("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:ui("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:ui("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:ui("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:ui("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:ui("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:ui("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:ui("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ui("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:ui("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:ui("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:ui("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:ui("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:ui("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:ui("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:ui("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:ui("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:ui("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",eU),skyboxGradient:ui("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",eU),skyboxCapture:ui("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ui("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:ui("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function hi(eo,ec){let ed=eo.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let eo of ed)if("#"===(eo=eo.trim())[0]&&eo.includes("if")&&!eo.includes("endif")){eo=eo.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let ed=eo.split(" ");for(let eo of ed)ec.includes(eo)||ec.push(eo)}}function ui(eo,ec){let ed=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,em=ec.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),e_={},eg=[...e$];return hi(eo,eg),hi(ec,eg),{fragmentSource:eo=eo.replace(ed,(eo,ec,ed,em,eg)=>(e_[eg]=!0,"define"===ec?`
#ifndef HAS_UNIFORM_u_${eg}
varying ${ed} ${em} ${eg};
#else
uniform ${ed} ${em} u_${eg};
#endif
`:`
#ifdef HAS_UNIFORM_u_${eg}
    ${ed} ${em} ${eg} = u_${eg};
#endif
`)),vertexSource:ec=ec.replace(ed,(eo,ec,ed,em,eg)=>{let ex="float"===em?"vec2":"vec4",ev=eg.match(/color/)?"color":ex;return e_[eg]?"define"===ec?`
#ifndef HAS_UNIFORM_u_${eg}
uniform lowp float u_${eg}_t;
attribute ${ed} ${ex} a_${eg};
varying ${ed} ${em} ${eg};
#else
uniform ${ed} ${em} u_${eg};
#endif
`:"vec4"===ev?`
#ifndef HAS_UNIFORM_u_${eg}
    ${eg} = a_${eg};
#else
    ${ed} ${em} ${eg} = u_${eg};
#endif
`:`
#ifndef HAS_UNIFORM_u_${eg}
    ${eg} = unpack_mix_${ev}(a_${eg}, u_${eg}_t);
#else
    ${ed} ${em} ${eg} = u_${eg};
#endif
`:"define"===ec?`
#ifndef HAS_UNIFORM_u_${eg}
uniform lowp float u_${eg}_t;
attribute ${ed} ${ex} a_${eg};
#else
uniform ${ed} ${em} u_${eg};
#endif
`:"vec4"===ev?`
#ifndef HAS_UNIFORM_u_${eg}
    ${ed} ${em} ${eg} = a_${eg};
#else
    ${ed} ${em} ${eg} = u_${eg};
#endif
`:`
#ifndef HAS_UNIFORM_u_${eg}
    ${ed} ${em} ${eg} = unpack_mix_${ev}(a_${eg}, u_${eg}_t);
#else
    ${ed} ${em} ${eg} = u_${eg};
#endif
`}),staticAttributes:em,usedDefines:eg}}let _i=class _i{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(eo,ec,ed,em,e_,eg,ex){this.context=eo;let ev=this.boundPaintVertexBuffers.length!==em.length;for(let eo=0;!ev&&eo<em.length;eo++)this.boundPaintVertexBuffers[eo]!==em[eo]&&(ev=!0);let eb=this.boundDynamicVertexBuffers.length!==ex.length;for(let eo=0;!eb&&eo<ex.length;eo++)this.boundDynamicVertexBuffers[eo]!==ex[eo]&&(eb=!0);if(!eo.extVertexArrayObject||!this.vao||this.boundProgram!==ec||this.boundLayoutVertexBuffer!==ed||ev||eb||this.boundIndexBuffer!==e_||this.boundVertexOffset!==eg)this.freshBind(ec,ed,em,e_,eg,ex);else{for(let ec of(eo.bindVertexArrayOES.set(this.vao),ex))ec&&ec.bind();e_&&e_.dynamicDraw&&e_.bind()}}freshBind(eo,ec,ed,em,e_,eg){let ex;let ev=eo.numAttributes,eb=this.context,ew=eb.gl;if(eb.extVertexArrayObject)this.vao&&this.destroy(),this.vao=eb.extVertexArrayObject.createVertexArrayOES(),eb.bindVertexArrayOES.set(this.vao),ex=0,this.boundProgram=eo,this.boundLayoutVertexBuffer=ec,this.boundPaintVertexBuffers=ed,this.boundIndexBuffer=em,this.boundVertexOffset=e_,this.boundDynamicVertexBuffers=eg;else{ex=eb.currentNumAttributes||0;for(let eo=ev;eo<ex;eo++)ew.disableVertexAttribArray(eo)}for(let em of(ec.enableAttributes(ew,eo),ec.bind(),ec.setVertexAttribPointers(ew,eo,e_),ed))em.enableAttributes(ew,eo),em.bind(),em.setVertexAttribPointers(ew,eo,e_);for(let ec of eg)ec&&(ec.enableAttributes(ew,eo),ec.bind(),ec.setVertexAttribPointers(ew,eo,e_));em&&em.bind(),eb.currentNumAttributes=ev}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}};function mi(ec,ed,em){if(!ed.needsDEMTextureUpload)return;let e_=ec.context,eg=e_.gl;e_.pixelStoreUnpackPremultiplyAlpha.set(!1),ed.demTexture=ed.demTexture||ec.getTileTexture(em.stride);let ex=em.getPixels();ed.demTexture?ed.demTexture.update(ex,{premultiply:!1}):ed.demTexture=new eo.Texture(e_,ex,eg.RGBA,{premultiply:!1}),ed.needsDEMTextureUpload=!1}let gi=ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_image0:new eo.Uniform1i(ec),u_skirt_height:new eo.Uniform1f(ec)}),vi=(eo,ec)=>({u_matrix:eo,u_image0:0,u_skirt_height:ec}),xi=(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA)=>({u_proj_matrix:Float32Array.from(eo),u_globe_matrix:ec,u_normalize_matrix:Float32Array.from(em),u_merc_matrix:ed,u_zoom_transition:e_,u_merc_center:eg,u_image0:0,u_frustum_tl:ex,u_frustum_tr:ev,u_frustum_br:eb,u_frustum_bl:ew,u_globe_pos:eT,u_globe_radius:eE,u_viewport:eM,u_grid_matrix:eA?Float32Array.from(eA):new Float32Array(9),u_skirt_height:eS});function yi(eo,ec){return null!=eo&&null!=ec&&!(!eo.hasData()||!ec.hasData())&&null!=eo.demTexture&&null!=ec.demTexture&&eo.tileID.key!==ec.tileID.key}let eH=new class{constructor(){this.operations={}}newMorphing(eo,ec,ed,em,e_){if(eo in this.operations){let ec=this.operations[eo];ec.to.tileID.key!==ed.tileID.key&&(ec.queued=ed)}else this.operations[eo]={startTime:em,phase:0,duration:e_,from:ec,to:ed,queued:null}}getMorphValuesForProxy(eo){if(!(eo in this.operations))return null;let ec=this.operations[eo];return{from:ec.from,to:ec.to,phase:ec.phase}}update(eo){for(let ec in this.operations){let ed=this.operations[ec];for(ed.phase=(eo-ed.startTime)/ed.duration;ed.phase>=1||!this._validOp(ed);)if(!this._nextOp(ed,eo)){delete this.operations[ec];break}}}_nextOp(eo,ec){return!!eo.queued&&(eo.from=eo.to,eo.to=eo.queued,eo.queued=null,eo.phase=0,eo.startTime=ec,!0)}_validOp(eo){return eo.from.hasData()&&eo.to.hasData()}},eJ={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Ti(eo){return 6*Math.pow(1.5,22-eo)}let Ci=eo=>({u_matrix:eo});function Mi(ec,ed,em,e_,eg){if(eg>0){let ex=eo.exported.now(),ev=(ex-ec.timeAdded)/eg,eb=ed?(ex-ed.timeAdded)/eg:-1,ew=em.getSource(),eT=e_.coveringZoomLevel({tileSize:ew.tileSize,roundZoom:ew.roundZoom}),eE=!ed||Math.abs(ed.tileID.overscaledZ-eT)>Math.abs(ec.tileID.overscaledZ-eT),eM=eE&&ec.refreshedUponExpiration?1:eo.clamp(eE?ev:1-eb,0,1);return ec.refreshedUponExpiration&&ev>=1&&(ec.refreshedUponExpiration=!1),ed?{opacity:1,mix:1-eM}:{opacity:eM,mix:0}}return{opacity:1,mix:0}}let Ii=class Ii extends eo.SourceCache{constructor(eo){let ec={type:"raster-dem",maxzoom:eo.transform.maxZoom},ed=new S(Ue(),null),em=De("mock-dem",ec,ed,eo.style);super("mock-dem",em,!1),em.setEventedParent(this),this._sourceLoaded=!0}_loadTile(eo,ec){eo.state="loaded",ec(null)}};let Pi=class Pi extends eo.SourceCache{constructor(eo){let ec=De("proxy",{type:"geojson",maxzoom:eo.transform.maxZoom},new S(Ue(),null),eo.style);super("proxy",ec,!1),ec.setEventedParent(this),this.map=this.getSource().map=eo,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(ec,ed,em){if(ec.freezeTileCoverage)return;this.transform=ec;let e_=ec.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((ed,em)=>{if(ed[em.key]="",!this._tiles[em.key]){let ed=new eo.Tile(em,this._source.tileSize*em.overscaleFactor(),ec.tileZoom);ed.state="loaded",this._tiles[em.key]=ed}return ed},{});for(let eo in this._tiles)eo in e_||(this.freeFBO(eo),this._tiles[eo].unloadVectorData(),delete this._tiles[eo])}freeFBO(eo){let ec=this.proxyCachedFBO[eo];if(void 0!==ec){let ed=Object.values(ec);this.renderCachePool.push(...ed),delete this.proxyCachedFBO[eo]}}deallocRenderCache(){this.renderCache.forEach(eo=>eo.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}};let Si=class Si extends eo.OverscaledTileID{constructor(eo,ec,ed){super(eo.overscaledZ,eo.wrap,eo.canonical.z,eo.canonical.x,eo.canonical.y),this.proxyTileKey=ec,this.projMatrix=ed}};let Di=class Di extends eo.Elevation{constructor(ec,ed){super(),this.painter=ec,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[em,e_,eg]=function(ec){let ed=new eo.StructArrayLayout2i4,em=new eo.StructArrayLayout3ui6;ed.reserve(17161),em.reserve(33800);let e_=eo.EXTENT/128,eg=eo.EXTENT+e_/2,ex=eg+e_;for(let ec=-e_;ec<ex;ec+=e_)for(let em=-e_;em<ex;em+=e_){let e_=em<0||em>eg||ec<0||ec>eg?24575:0,ex=eo.clamp(Math.round(em),0,eo.EXTENT),ev=eo.clamp(Math.round(ec),0,eo.EXTENT);ed.emplaceBack(ex+e_,ev)}let l=(eo,ec)=>{let ed=131*ec+eo;em.emplaceBack(ed+1,ed,ed+131),em.emplaceBack(ed+131,ed+131+1,ed+1)};for(let eo=1;eo<129;eo++)for(let ec=1;ec<129;ec++)l(ec,eo);return[0,129].forEach(eo=>{for(let ec=0;ec<130;ec++)l(ec,eo),l(eo,ec)}),[ed,em,32768]}(),ex=ec.context;this.gridBuffer=ex.createVertexBuffer(em,eo.posAttributes.members),this.gridIndexBuffer=ex.createIndexBuffer(e_),this.gridSegments=eo.SegmentVector.simpleSegment(0,0,em.length,e_.length),this.gridNoSkirtSegments=eo.SegmentVector.simpleSegment(0,0,em.length,eg),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Pi(ed.map),this.orthoMatrix=eo.create(),eo.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,eo.EXTENT,0,eo.EXTENT,0,1);let ev=ex.gl;this._overlapStencilMode=new eo.StencilMode({func:ev.GEQUAL,mask:255},0,255,ev.KEEP,ev.KEEP,ev.REPLACE),this._previousZoom=ec.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=ed,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ii(ed.map)}set style(eo){eo.on("data",this._onStyleDataEvent.bind(this)),eo.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=eo,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(ec,ed,em){if(ec&&ec.terrain){this._style!==ec&&(this.style=ec),this.enabled=!0;let e_=ec.terrain.properties;this.sourceCache=0===ec.terrain.drapeRenderMode?this._mockSourceCache:ec._getSourceCache(e_.get("source")),this._exaggeration=e_.get("exaggeration");let n=()=>{this.sourceCache.used&&eo.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let ec=this.getScaledDemTileSize();this.sourceCache.update(ed,ec,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,n(),this._initializing=!0),n(),ed.updateElevation(!0,em),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(ed),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(eo){this._findCoveringTileCache[eo]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){let ec=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==ec.efficiency&&eo.warnOnce(`Terrain render cache efficiency is not optimal (${ec.efficiency}%) and performance
                may be affected negatively, consider placing all background, fill and line layers before layer
                with id '${ec.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(eo){eo.coord&&"source"===eo.dataType?this._clearRenderCacheForTile(eo.sourceCacheId,eo.coord):"style"===eo.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let eo in this._style._sourceCaches)this._style._sourceCaches[eo].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(eo=>eo.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let eo=2*this.proxySourceCache.getSource().tileSize;return[eo,eo]}set useVertexMorphing(eo){this._useVertexMorphing=eo}updateTileBinding(ec){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let ed=this.proxySourceCache,em=this.painter.transform;this._initializing&&(this._initializing=0===em._centerAltitude&&-1===this.getAtPointOrZero(eo.MercatorCoordinate.fromLngLat(em.center),-1),this._emptyDEMTextureDirty=!this._initializing);let e_=this.proxyCoords=ed.getIds().map(eo=>{let ec=ed.getTileByID(eo).tileID;return ec.projMatrix=em.calculateProjMatrix(ec.toUnwrapped()),ec});(function(ec,ed){let em=ed.transform.pointCoordinate(ed.transform.getCameraPoint()),e_=new eo.Point(em.x,em.y);ec.sort((ec,ed)=>{if(ed.overscaledZ-ec.overscaledZ)return ed.overscaledZ-ec.overscaledZ;let em=new eo.Point(ec.canonical.x+(1<<ec.canonical.z)*ec.wrap,ec.canonical.y),eg=new eo.Point(ed.canonical.x+(1<<ed.canonical.z)*ed.wrap,ed.canonical.y),ex=e_.mult(1<<ec.canonical.z);return ex.x-=.5,ex.y-=.5,ex.distSqr(em)-ex.distSqr(eg)})})(e_,this.painter),this._previousZoom=em.zoom;let eg=this.proxyToSource||{};this.proxyToSource={},e_.forEach(eo=>{this.proxyToSource[eo.key]={}}),this.terrainTileForTile={};let ex=this._style._sourceCaches;for(let eo in ex){let ed=ex[eo];if(!ed.used||(ed!==this.sourceCache&&this.resetTileLookupCache(ed.id),this._setupProxiedCoordsForOrtho(ed,ec[eo],eg),ed.usedForTerrain))continue;let em=ec[eo];ed.getSource().reparseOverscaled&&this._assignTerrainTiles(em)}this.proxiedCoords[ed.id]=e_.map(eo=>new Si(eo,eo.key,this.orthoMatrix)),this._assignTerrainTiles(e_),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(eg),this.renderingToTexture=!1,this._updateTimestamp=eo.exported.now();let ev={};for(let eo of(this._visibleDemTiles=[],this.proxyCoords)){let ec=this.terrainTileForTile[eo.key];if(!ec)continue;let ed=ec.tileID.key;ed in ev||(this._visibleDemTiles.push(ec),ev[ed]=ed)}}_assignTerrainTiles(eo){this._initializing||eo.forEach(eo=>{if(this.terrainTileForTile[eo.key])return;let ec=this._findTileCoveringTileID(eo,this.sourceCache);ec&&(this.terrainTileForTile[eo.key]=ec)})}_prepareDEMTextures(){let eo=this.painter.context,ec=eo.gl;for(let ed in this.terrainTileForTile){let em=this.terrainTileForTile[ed],e_=em.dem;e_&&(!em.demTexture||em.needsDEMTextureUpload)&&(eo.activeTexture.set(ec.TEXTURE1),mi(this.painter,em,e_))}}_prepareDemTileUniforms(eo,ec,ed,em){if(!ec||null==ec.demTexture)return!1;let e_=eo.tileID.canonical,eg=Math.pow(2,ec.tileID.canonical.z-e_.z),ex=em||"";return ed[`u_dem_tl${ex}`]=[e_.x*eg%1,e_.y*eg%1],ed[`u_dem_scale${ex}`]=eg,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let ec=this.painter.context,ed=ec.gl;if(!this._emptyDepthBufferTexture){let em=new eo.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new eo.Texture(ec,em,ed.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let eo=0,ec=this._visibleDemTiles.reduce((ec,ed)=>{if(!ed.dem)return ec;let em=ed.dem.tree.minimums[0];return em>0&&eo++,ec+em},0);return eo?ec/eo:0}_updateEmptyDEMTexture(){let ec=this.painter.context,ed=ec.gl;ec.activeTexture.set(ed.TEXTURE2);let em=this._getLoadedAreaMinimum(),e_=new eo.RGBAImage({width:1,height:1},new Uint8Array(eo.DEMData.pack(em,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let eg=this._emptyDEMTexture;return eg?eg.update(e_,{premultiply:!1}):eg=this._emptyDEMTexture=new eo.Texture(ec,e_,ed.RGBA,{premultiply:!1}),eg}setupElevationDraw(ec,ed,em){var e_;let eg=this.painter.context,ex=eg.gl,ev=(e_=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:eo.DEMData.getUnpackVector(e_),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});ev.u_dem_size=this.sourceCache.getSource().tileSize,ev.u_exaggeration=this.exaggeration();let eb=null,ew=null,eT=1;if(em&&em.morphing&&this._useVertexMorphing){let eo=em.morphing.srcDemTile,ed=em.morphing.dstDemTile;eT=em.morphing.phase,eo&&ed&&(this._prepareDemTileUniforms(ec,eo,ev,"_prev")&&(ew=eo),this._prepareDemTileUniforms(ec,ed,ev)&&(eb=ed))}if(ew&&eb?(eg.activeTexture.set(ex.TEXTURE2),eb.demTexture.bind(ex.NEAREST,ex.CLAMP_TO_EDGE,ex.NEAREST),eg.activeTexture.set(ex.TEXTURE4),ew.demTexture.bind(ex.NEAREST,ex.CLAMP_TO_EDGE,ex.NEAREST),ev.u_dem_lerp=eT):(eb=this.terrainTileForTile[ec.tileID.key],eg.activeTexture.set(ex.TEXTURE2),(this._prepareDemTileUniforms(ec,eb,ev)?eb.demTexture:this.emptyDEMTexture).bind(ex.NEAREST,ex.CLAMP_TO_EDGE)),eg.activeTexture.set(ex.TEXTURE3),em&&em.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(ex.NEAREST,ex.CLAMP_TO_EDGE),this._depthFBO&&(ev.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(ex.NEAREST,ex.CLAMP_TO_EDGE),ev.u_depth_size_inv=[1,1]),em&&em.useMeterToDem&&eb){let ec=(1<<eb.tileID.canonical.z)*eo.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;ev.u_meter_to_dem=ec}if(em&&em.labelPlaneMatrixInv&&(ev.u_label_plane_matrix_inv=em.labelPlaneMatrixInv),ed.setTerrainUniformValues(eg,ev),"globe"===this.painter.transform.projection.name){let eo=this.globeUniformValues(this.painter.transform,ec.tileID.canonical,em&&em.useDenormalizedUpVectorScale);ed.setGlobeUniformValues(eg,eo)}}globeUniformValues(ec,ed,em){let e_=ec.projection;return{u_tile_tl_up:e_.upVector(ed,0,0),u_tile_tr_up:e_.upVector(ed,eo.EXTENT,0),u_tile_br_up:e_.upVector(ed,eo.EXTENT,eo.EXTENT),u_tile_bl_up:e_.upVector(ed,0,eo.EXTENT),u_tile_up_scale:em?eo.globeMetersToEcef(1):e_.upVectorScale(ed,ec.center.lat,ec.worldSize).metersToTile}}renderToBackBuffer(ec){let ed=this.painter,em=this.painter.context;0!==ec.length&&(em.bindFramebuffer.set(null),em.viewport.set([0,0,ed.width,ed.height]),ed.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(ec,ed,em,e_,eg){if("globe"===ec.transform.projection.name)!function(ec,ed,em,e_,eg){let ex,ev;let eb=ec.context,ew=eb.gl,eT=ec.options.showTerrainWireframe?2:0,eE=ec.transform,eM=eo.globeUseCustomAntiAliasing(ec,eb,eE),d=(eo,ed)=>{if(ev===eo)return;let em=[eJ[eo],"PROJECTION_GLOBE_VIEW"];eM&&em.push("CUSTOM_ANTIALIASING"),ed&&em.push(eJ[eT]),ex=ec.useProgram("globeRaster",null,em),ev=eo},eS=ec.colorModeForRenderPass(),eA=new eo.DepthMode(ew.LEQUAL,eo.DepthMode.ReadWrite,ec.depthRangeFor3D);eH.update(eg);let eI=eo.calculateGlobeMercatorMatrix(eE),eC=[eo.mercatorXfromLng(eE.center.lng),eo.mercatorYfromLat(eE.center.lat)],eP=ec.globeSharedBuffers,ez=[eE.width*eo.exported.devicePixelRatio,eE.height*eo.exported.devicePixelRatio],eD=Float32Array.from(eE.globeMatrix),ek={useDenormalizedUpVectorScale:!0};if((eT?[!1,!0]:[!1]).forEach(eT=>{let eE=ec.transform,eM=Ti(eE.zoom)*ed.exaggeration();ev=-1;let eL=eT?ew.LINES:ew.TRIANGLES;for(let ev of e_){let e_=em.getTile(ev),eR=eo.StencilMode.disabled,eB=ed.prevTerrainTileForTile[ev.key],eF=ed.terrainTileForTile[ev.key];yi(eB,eF)&&eH.newMorphing(ev.key,eB,eF,eg,250),eb.activeTexture.set(ew.TEXTURE0),e_.texture.bind(ew.LINEAR,ew.CLAMP_TO_EDGE);let eO=eH.getMorphValuesForProxy(ev.key),eU=eO?1:0;eO&&eo.extend$1(ek,{morphing:{srcDemTile:eO.from,dstDemTile:eO.to,phase:eo.easeCubicInOut(eO.phase)}});let eN=eo.tileCornersToBounds(ev.canonical),eV=eo.getLatitudinalLod(eN.getCenter().lat),ej=eo.getGridMatrix(ev.canonical,eN,eV,eE.worldSize/eE._pixelsPerMercatorPixel),eG=eo.globeNormalizeECEF(eo.globeTileBounds(ev.canonical)),eZ=xi(eE.projMatrix,eD,eI,eG,eo.globeToMercatorTransition(eE.zoom),eC,eE.frustumCorners.TL,eE.frustumCorners.TR,eE.frustumCorners.BR,eE.frustumCorners.BL,eE.globeCenterInViewSpace,eE.globeRadius,ez,eM,ej);if(d(eU,eT),ed.setupElevationDraw(e_,ex,ek),ec.prepareDrawProgram(eb,ex,ev.toUnwrapped()),eP){let[ed,em,e_]=eT?eP.getWirefameBuffers(ec.context,eV):eP.getGridBuffers(eV,0!==eM);ex.draw(eb,eL,eA,eR,eS,eo.CullFaceMode.backCCW,eZ,"globe_raster",ed,em,e_)}}}),eP){let eg=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];for(let ev of(eM&&eg.push("CUSTOM_ANTIALIASING"),ex=ec.useProgram("globeRaster",null,eg),e_)){let{x:e_,y:eg,z:eT}=ev.canonical,eM=0===eg,eI=eg===(1<<eT)-1,[eD,eL,eR,eB]=eP.getPoleBuffers(eT);if(eB&&(eM||eI)){let eg=em.getTile(ev);eb.activeTexture.set(ew.TEXTURE0),eg.texture.bind(ew.LINEAR,ew.CLAMP_TO_EDGE);let eP=eo.globePoleMatrixForTile(eT,e_,eE),eF=eo.globeNormalizeECEF(eo.globeTileBounds(ev.canonical)),C=(ec,ed)=>ec.draw(eb,ew.TRIANGLES,eA,eo.StencilMode.disabled,eS,eo.CullFaceMode.disabled,xi(eE.projMatrix,eP,eP,eF,0,eC,eE.frustumCorners.TL,eE.frustumCorners.TR,eE.frustumCorners.BR,eE.frustumCorners.BL,eE.globeCenterInViewSpace,eE.globeRadius,ez,0),"globe_pole_raster",ed,eR,eB);ed.setupElevationDraw(eg,ex,ek),ec.prepareDrawProgram(eb,ex,ev.toUnwrapped()),eM&&C(ex,eD),eI&&(eP=eo.scale(eo.create(),eP,[1,-1,1]),C(ex,eL))}}}}(ec,ed,em,e_,eg);else{let ex,ev;let eb=ec.context,ew=eb.gl,eT=ec.options.showTerrainWireframe?2:0,u=(eo,ed)=>{if(ev===eo)return;let em=[eJ[eo]];ed&&em.push(eJ[eT]),ex=ec.useProgram("terrainRaster",null,em),ev=eo},eE=ec.colorModeForRenderPass(),eM=new eo.DepthMode(ew.LEQUAL,eo.DepthMode.ReadWrite,ec.depthRangeFor3D);eH.update(eg);let eS=ec.transform,eA=Ti(eS.zoom)*ed.exaggeration();(eT?[!1,!0]:[!1]).forEach(eT=>{ev=-1;let eI=eT?ew.LINES:ew.TRIANGLES,[eC,eP]=eT?ed.getWirefameBuffer():[ed.gridIndexBuffer,ed.gridSegments];for(let ev of e_){let e_;let ez=em.getTile(ev),eD=eo.StencilMode.disabled,ek=ed.prevTerrainTileForTile[ev.key],eL=ed.terrainTileForTile[ev.key];yi(ek,eL)&&eH.newMorphing(ev.key,ek,eL,eg,250),eb.activeTexture.set(ew.TEXTURE0),ez.texture.bind(ew.LINEAR,ew.CLAMP_TO_EDGE,ew.LINEAR_MIPMAP_NEAREST);let eR=eH.getMorphValuesForProxy(ev.key),eB=eR?1:0;eR&&(e_={morphing:{srcDemTile:eR.from,dstDemTile:eR.to,phase:eo.easeCubicInOut(eR.phase)}});let eF=vi(ev.projMatrix,!function(eo,ec){let ed=1<<eo.z;return!ec&&(0===eo.x||eo.x===ed-1)||0===eo.y||eo.y===ed-1}(ev.canonical,eS.renderWorldCopies)?eA:eA/10);u(eB,eT),ed.setupElevationDraw(ez,ex,e_),ec.prepareDrawProgram(eb,ex,ev.toUnwrapped()),ex.draw(eb,eI,eM,eD,eE,eo.CullFaceMode.backCCW,eF,"terrain_raster",ed.gridBuffer,eC,eP)}})}}(ed,this,this.proxySourceCache,ec,this._updateTimestamp),this.renderingToTexture=!0,ed.gpuTimingDeferredRenderEnd(),ec.splice(0,ec.length))}renderBatch(ec){if(0===this._drapedRenderBatches.length)return ec+1;this.renderingToTexture=!0;let ed=this.painter,em=this.painter.context,e_=this.proxySourceCache,eg=this.proxiedCoords[e_.id],ex=this._drapedRenderBatches.shift(),ev=[],eb=ed.style.order,ew=0;for(let eT of eg){let eg;let eE=e_.getTileByID(eT.proxyTileKey),eM=e_.proxyCachedFBO[eT.key]?e_.proxyCachedFBO[eT.key][ec]:void 0,eS=void 0!==eM?e_.renderCache[eM]:this.pool[ew++],eA=void 0!==eM;if(eE.texture=eS.tex,eA&&!eS.dirty){ev.push(eE.tileID);continue}em.bindFramebuffer.set(eS.fb.framebuffer),this.renderedToTile=!1,eS.dirty&&(em.clear({color:eo.Color.transparent,stencil:0}),eS.dirty=!1);for(let eo=ex.start;eo<=ex.end;++eo){let ec=ed.style._layers[eb[eo]];if(ec.isHidden(ed.transform.zoom))continue;let e_=ed.style._getLayerSourceCache(ec),ex=e_?this.proxyToSource[eT.key][e_.id]:[eT];ex&&(em.viewport.set([0,0,eS.fb.width,eS.fb.height]),eg!==(e_?e_.id:null)&&(this._setupStencil(eS,ex,ec,e_),eg=e_?e_.id:null),ed.renderLayer(ed,e_,ec,ex))}this.renderedToTile?(eS.dirty=!0,ev.push(eE.tileID)):eA||--ew,5===ew&&(ew=0,this.renderToBackBuffer(ev))}return this.renderToBackBuffer(ev),this.renderingToTexture=!1,em.bindFramebuffer.set(null),em.viewport.set([0,0,ed.width,ed.height]),ex.end+1}postRender(){}renderCacheEfficiency(eo){let ec=eo.order.length;if(0===ec)return{efficiency:100};let ed,em=0,e_=0,eg=!1;for(let ex=0;ex<ec;++ex){let ec=eo._layers[eo.order[ex]];this._style.isLayerDraped(ec)?(eg&&++em,++e_):eg||(eg=!0,ed=ec.id)}return 0===e_?{efficiency:100}:{efficiency:100*(1-em/e_),firstUndrapedLayer:ed}}getMinElevationBelowMSL(){let eo=0;return this._visibleDemTiles.filter(eo=>eo.dem).forEach(ec=>{eo=Math.min(eo,ec.dem.tree.minimums[0])}),0===eo?eo:(eo-30)*this._exaggeration}raycast(eo,ec,ed){if(!this._visibleDemTiles)return null;let em=this._visibleDemTiles.filter(eo=>eo.dem).map(em=>{let e_=em.tileID,eg=1<<e_.overscaledZ,{x:ex,y:ev}=e_.canonical,eb=ex/eg,ew=(ex+1)/eg,eT=ev/eg,eE=(ev+1)/eg;return{minx:eb,miny:eT,maxx:ew,maxy:eE,t:em.dem.tree.raycastRoot(eb,eT,ew,eE,eo,ec,ed),tile:em}});for(let e_ of(em.sort((eo,ec)=>(null!==eo.t?eo.t:Number.MAX_VALUE)-(null!==ec.t?ec.t:Number.MAX_VALUE)),em)){if(null==e_.t)break;let em=e_.tile.dem.tree.raycast(e_.minx,e_.miny,e_.maxx,e_.maxy,eo,ec,ed);if(null!=em)return em}return null}_createFBO(){let ec=this.painter.context,ed=ec.gl,em=this.drapeBufferSize;ec.activeTexture.set(ed.TEXTURE0);let e_=new eo.Texture(ec,{width:em[0],height:em[1],data:null},ed.RGBA);e_.bind(ed.LINEAR,ed.CLAMP_TO_EDGE);let eg=ec.createFramebuffer(em[0],em[1],!1);return eg.colorAttachment.set(e_.texture),eg.depthAttachment=new we(ec,eg.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=ec.createRenderbuffer(ec.gl.DEPTH_STENCIL,em[0],em[1]),this._stencilRef=0,eg.depthAttachment.set(this._sharedDepthStencil),ec.clear({stencil:0})):eg.depthAttachment.set(this._sharedDepthStencil),ec.extTextureFilterAnisotropic&&!ec.extTextureFilterAnisotropicForceOff&&ed.texParameterf(ed.TEXTURE_2D,ec.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ec.extTextureFilterAnisotropicMax),{fb:eg,tex:e_,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(let eo in this._style._sourceCaches)if(this._style._sourceCaches[eo].hasTransition())return!0;return this._style.order.some(eo=>{let ec=this._style._layers[eo],ed=ec.isHidden(this.painter.transform.zoom);return"custom"===ec.type?!ed&&ec.shouldRedrape():!ed&&ec.hasTransition()})}_clearLineLayersFromRenderCache(){let ec=!1;for(let eo of this._style._getSources())if(eo instanceof Ce){ec=!0;break}if(!ec)return;let ed={};for(let ec=0;ec<this._style.order.length;++ec){let em=this._style._layers[this._style.order[ec]],e_=this._style._getLayerSourceCache(em);if(e_&&!ed[e_.id]&&!em.isHidden(this.painter.transform.zoom)&&"line"===em.type&&em.widthExpression() instanceof eo.ZoomDependentExpression)for(let eo of(ed[e_.id]=!0,this.proxyCoords)){let ec=this.proxyToSource[eo.key][e_.id];if(ec)for(let eo of ec)this._clearRenderCacheForTile(e_.id,eo)}}}_clearRasterLayersFromRenderCache(){let eo=!1;for(let ec in this._style._sourceCaches)if(this._style._sourceCaches[ec]._source instanceof Me){eo=!0;break}if(!eo)return;let ec={};for(let eo=0;eo<this._style.order.length;++eo){let ed=this._style._layers[this._style.order[eo]],em=this._style._getLayerSourceCache(ed);if(!em||ec[em.id]||ed.isHidden(this.painter.transform.zoom)||"raster"!==ed.type)continue;let e_=ed.paint.get("raster-fade-duration");for(let eo of this.proxyCoords){let ec=this.proxyToSource[eo.key][em.id];if(ec)for(let eo of ec){let ec=Mi(em.getTile(eo),em.findLoadedParent(eo,0),em,this.painter.transform,e_);(1!==ec.opacity||0!==ec.mix)&&this._clearRenderCacheForTile(em.id,eo)}}}}_setupDrapedRenderBatches(){let eo=this._style.order,ec=eo.length;if(0===ec)return;let ed=[],em,e_=0,eg=this._style._layers[eo[e_]];for(;!this._style.isLayerDraped(eg)&&eg.isHidden(this.painter.transform.zoom)&&++e_<ec;)eg=this._style._layers[eo[e_]];for(;e_<ec;++e_){let ec=this._style._layers[eo[e_]];ec.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(ec)?void 0===em&&(em=e_):void 0!==em&&(ed.push({start:em,end:e_-1}),em=void 0))}void 0!==em&&ed.push({start:em,end:e_-1}),this._drapedRenderBatches=ed}_setupRenderCache(eo){let ec=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,ec.renderCache.length>ec.renderCachePool.length){let eo=Object.values(ec.proxyCachedFBO);ec.proxyCachedFBO={};for(let ed=0;ed<eo.length;++ed){let em=Object.values(eo[ed]);ec.renderCachePool.push(...em)}}return}this._clearRasterLayersFromRenderCache();let ed=this.proxyCoords,em=this._tilesDirty;for(let e_=ed.length-1;e_>=0;e_--){let eg=ed[e_];if(ec.getTileByID(eg.key),void 0!==ec.proxyCachedFBO[eg.key]){let ed=eo[eg.key],e_=this.proxyToSource[eg.key],ex=0;for(let eo in e_){let ec=e_[eo],eg=ed[eo];if(!eg||eg.length!==ec.length||ec.some((ec,ed)=>ec!==eg[ed]||em[eo]&&em[eo].hasOwnProperty(ec.key))){ex=-1;break}++ex}for(let eo in ec.proxyCachedFBO[eg.key])ec.renderCache[ec.proxyCachedFBO[eg.key][eo]].dirty=ex<0||ex!==Object.values(ed).length}}let e_=[...this._drapedRenderBatches];for(let eo of(e_.sort((eo,ec)=>ec.end-ec.start-(eo.end-eo.start)),e_))for(let em of ed){if(ec.proxyCachedFBO[em.key])continue;let ed=ec.renderCachePool.pop();void 0===ed&&ec.renderCache.length<50&&(ed=ec.renderCache.length,ec.renderCache.push(this._createFBO())),void 0!==ed&&(ec.proxyCachedFBO[em.key]={},ec.proxyCachedFBO[em.key][eo.start]=ed,ec.renderCache[ed].dirty=!0)}this._tilesDirty={}}_setupStencil(eo,ec,ed,em){let e_;if(!em||!this._sourceTilesOverlap[em.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let eg=this.painter.context,ex=eg.gl;if(ec.length<=1)return void(this._overlapStencilType=!1);if(ed.isTileClipped())e_=ec.length,this._overlapStencilMode.test={func:ex.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(ec[0].overscaledZ>ec[ec.length-1].overscaledZ))return void(this._overlapStencilType=!1);e_=1,this._overlapStencilMode.test={func:ex.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+e_>255&&(eg.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=e_,this._overlapStencilMode.ref=this._stencilRef,ed.isTileClipped()&&this._renderTileClippingMasks(ec,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(ec){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[ec.key]),this._overlapStencilMode):eo.StencilMode.disabled}_renderTileClippingMasks(ec,ed){let em=this.painter,e_=this.painter.context,eg=e_.gl;em._tileClippingMaskIDs={},e_.setColorMode(eo.ColorMode.disabled),e_.setDepthMode(eo.DepthMode.disabled);let ex=em.useProgram("clippingMask");for(let ev of ec){let ec=em._tileClippingMaskIDs[ev.key]=--ed;ex.draw(e_,eg.TRIANGLES,eo.DepthMode.disabled,new eo.StencilMode({func:eg.ALWAYS,mask:0},ec,255,eg.KEEP,eg.KEEP,eg.REPLACE),eo.ColorMode.disabled,eo.CullFaceMode.disabled,Ci(ev.projMatrix),"$clipping",em.tileExtentBuffer,em.quadTriangleIndexBuffer,em.tileExtentSegments)}}pointCoordinate(ec){let ed=this.painter.transform;if(ec.x<0||ec.x>ed.width||ec.y<0||ec.y>ed.height)return null;let em=[ec.x,ec.y,1,1];eo.transformMat4$1(em,em,ed.pixelMatrixInverse),eo.scale$1(em,em,1/em[3]),em[0]/=ed.worldSize,em[1]/=ed.worldSize;let e_=ed._camera.position,eg=eo.mercatorZfromAltitude(1,ed.center.lat),ex=[e_[0],e_[1],e_[2]/eg,0],ev=eo.subtract([],em.slice(0,3),ex);eo.normalize(ev,ev);let eb=this.raycast(ex,ev,this._exaggeration);return null!==eb&&eb?(eo.scaleAndAdd(ex,ex,ev,eb),ex[3]=ex[2],ex[2]*=eg,ex):null}drawDepth(){let ec=this.painter,ed=ec.context,em=this.proxySourceCache,e_=Math.ceil(ec.width),eg=Math.ceil(ec.height);if(this._depthFBO&&(this._depthFBO.width!==e_||this._depthFBO.height!==eg)&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let ec=ed.gl,em=ed.createFramebuffer(e_,eg,!0);ed.activeTexture.set(ec.TEXTURE0);let ex=new eo.Texture(ed,{width:e_,height:eg,data:null},ec.RGBA);ex.bind(ec.NEAREST,ec.CLAMP_TO_EDGE),em.colorAttachment.set(ex.texture);let ev=ed.createRenderbuffer(ed.gl.DEPTH_COMPONENT16,e_,eg);em.depthAttachment.set(ev),this._depthFBO=em,this._depthTexture=ex}ed.bindFramebuffer.set(this._depthFBO.framebuffer),ed.viewport.set([0,0,e_,eg]),function(ec,ed,em,e_){if("globe"===ec.transform.projection.name)return;let eg=ec.context,ex=eg.gl;eg.clear({depth:1});let ev=ec.useProgram("terrainDepth"),eb=new eo.DepthMode(ex.LESS,eo.DepthMode.ReadWrite,ec.depthRangeFor3D);for(let ec of e_){let e_=em.getTile(ec),ew=vi(ec.projMatrix,0);ed.setupElevationDraw(e_,ev),ev.draw(eg,ex.TRIANGLES,eb,eo.StencilMode.disabled,eo.ColorMode.unblended,eo.CullFaceMode.backCCW,ew,"terrain_depth",ed.gridBuffer,ed.gridIndexBuffer,ed.gridNoSkirtSegments)}}(ec,this,em,this.proxyCoords)}_setupProxiedCoordsForOrtho(eo,ec,ed){if(eo.getSource() instanceof Pe)return this._setupProxiedCoordsForImageSource(eo,ec,ed);this._findCoveringTileCache[eo.id]=this._findCoveringTileCache[eo.id]||{};let em=this.proxiedCoords[eo.id]=[],e_=this.proxyCoords;for(let ec=0;ec<e_.length;ec++){let eg=e_[ec],ex=this._findTileCoveringTileID(eg,eo);if(ex){let ec=this._createProxiedId(eg,ex,ed[eg.key]&&ed[eg.key][eo.id]);em.push(ec),this.proxyToSource[eg.key][eo.id]=[ec]}}let eg=!1;for(let e_=0;e_<ec.length;e_++){let ex=eo.getTile(ec[e_]);if(!ex||!ex.hasData())continue;let ev=this._findTileCoveringTileID(ex.tileID,this.proxySourceCache);if(ev&&ev.tileID.canonical.z!==ex.tileID.canonical.z){let ec=this.proxyToSource[ev.tileID.key][eo.id],e_=this._createProxiedId(ev.tileID,ex,ed[ev.tileID.key]&&ed[ev.tileID.key][eo.id]);ec?ec.splice(ec.length-1,0,e_):this.proxyToSource[ev.tileID.key][eo.id]=[e_],em.push(e_),eg=!0}}this._sourceTilesOverlap[eo.id]=eg}_setupProxiedCoordsForImageSource(ec,ed,em){if(!ec.getSource().loaded())return;let e_=this.proxiedCoords[ec.id]=[],eg=this.proxyCoords,ex=ec.getSource(),ev=new eo.Point(ex.tileID.x,ex.tileID.y)._div(1<<ex.tileID.z),eb=ex.coordinates.map(eo.MercatorCoordinate.fromLngLat).reduce((eo,ec)=>(eo.min.x=Math.min(eo.min.x,ec.x-ev.x),eo.min.y=Math.min(eo.min.y,ec.y-ev.y),eo.max.x=Math.max(eo.max.x,ec.x-ev.x),eo.max.y=Math.max(eo.max.y,ec.y-ev.y),eo),{min:new eo.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new eo.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),c=(ec,ed)=>{let em=ec.wrap+ec.canonical.x/(1<<ec.canonical.z),e_=ec.canonical.y/(1<<ec.canonical.z),eg=eo.EXTENT/(1<<ec.canonical.z),ex=ed.wrap+ed.canonical.x/(1<<ed.canonical.z),ev=ed.canonical.y/(1<<ed.canonical.z);return em+eg<ex+eb.min.x||em>ex+eb.max.x||e_+eg<ev+eb.min.y||e_>ev+eb.max.y};for(let eo=0;eo<eg.length;eo++){let ex=eg[eo];for(let eo=0;eo<ed.length;eo++){let eg=ec.getTile(ed[eo]);if(!eg||!eg.hasData()||c(ex,eg.tileID))continue;let ev=this._createProxiedId(ex,eg,em[ex.key]&&em[ex.key][ec.id]),eb=this.proxyToSource[ex.key][ec.id];eb?eb.push(ev):this.proxyToSource[ex.key][ec.id]=[ev],e_.push(ev)}}}_createProxiedId(ec,ed,em){let e_=this.orthoMatrix;if(em){let eo=em.find(eo=>eo.key===ed.tileID.key);if(eo)return eo}if(ed.tileID.key!==ec.key){let em,eg,ex;let ev=ec.canonical.z-ed.tileID.canonical.z;e_=eo.create();let eb=ed.tileID.wrap-ec.wrap<<ec.overscaledZ;ev>0?(eg=(em=eo.EXTENT>>ev)*((ed.tileID.canonical.x<<ev)-ec.canonical.x+eb),ex=em*((ed.tileID.canonical.y<<ev)-ec.canonical.y)):(em=eo.EXTENT<<-ev,eg=eo.EXTENT*(ed.tileID.canonical.x-(ec.canonical.x+eb<<-ev)),ex=eo.EXTENT*(ed.tileID.canonical.y-(ec.canonical.y<<-ev))),eo.ortho(e_,0,em,0,em,0,1),eo.translate(e_,e_,[eg,ex,0])}return new Si(ed.tileID,ec.key,e_)}_findTileCoveringTileID(ec,ed){let em=ed.getTile(ec);if(em&&em.hasData())return em;let e_=this._findCoveringTileCache[ed.id],eg=e_[ec.key];if((em=eg?ed.getTileByID(eg):null)&&em.hasData()||null===eg)return em;let ex=em?em.tileID:ec,ev=ex.overscaledZ,eb=ed.getSource().minzoom,ew=[];if(!eg){let e_=ed.getSource().maxzoom;if(ec.canonical.z>=e_){let em=ec.canonical.z-e_;ed.getSource().reparseOverscaled?(ev=Math.max(ec.canonical.z+2,ed.transform.tileZoom),ex=new eo.OverscaledTileID(ev,ec.wrap,e_,ec.canonical.x>>em,ec.canonical.y>>em)):0!==em&&(ev=e_,ex=new eo.OverscaledTileID(ev,ec.wrap,e_,ec.canonical.x>>em,ec.canonical.y>>em))}ex.key!==ec.key&&(ew.push(ex.key),em=ed.getTile(ex))}let h=eo=>{ew.forEach(ec=>{e_[ec]=eo}),ew.length=0};for(ev-=1;ev>=eb&&(!em||!em.hasData());ev--){em&&h(em.tileID.key);let eo=ex.calculateScaledKey(ev);if((em=ed.getTileByID(eo))&&em.hasData())break;let ec=e_[eo];if(null===ec)break;void 0===ec?ew.push(eo):em=ed.getTileByID(ec)}return h(em?em.tileID.key:null),em&&em.hasData()?em:null}findDEMTileFor(eo){return this.enabled?this._findTileCoveringTileID(eo,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(eo,ec){let ed=this._tilesDirty[eo];ed||(ed=this._tilesDirty[eo]={}),ed[ec.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){let ec=function(ec){let ed=0,em=new eo.StructArrayLayout2ui4;for(let eo=1;eo<129;eo++){for(let ec=1;ec<129;ec++)ed=131*eo+ec,em.emplaceBack(ed,ed+1),em.emplaceBack(ed,ed+131),em.emplaceBack(ed+1,ed+131),128===eo&&em.emplaceBack(ed+131,ed+131+1);em.emplaceBack(ed+1,ed+1+131)}return em}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(ec),this.wireframeSegments=eo.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,ec.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}};let Li=class Li{static cacheKey(eo,ec,ed,em){let e_=`${ec}${em?em.cacheKey:""}`;for(let ec of ed)eo.usedDefines.includes(ec)&&(e_+=`/${ec}`);return e_}constructor(ec,ed,em,e_,eg,ex){let ev=ec.gl;this.program=ev.createProgram();let eb=function(eo){let ec=[];for(let ed=0;ed<eo.length;ed++){if(null===eo[ed])continue;let em=eo[ed].split(" ");ec.push(em.pop())}return ec}(em.staticAttributes),ew=e_?e_.getBinderAttributes():[],eT=eb.concat(ew),eE=e_?e_.defines():[];eE=eE.concat(ex.map(eo=>`#define ${eo}`));let eM=ec.isWebGL2?"#version 300 es\n":"",eS=eM+eE.concat(ec.extStandardDerivatives&&0===eM.length?"#extension GL_OES_standard_derivatives : enable\n".concat(eX):eX,eX,eO,eq.fragmentSource,eZ.fragmentSource,em.fragmentSource).join("\n"),eA=eM+eE.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",eO,eq.vertexSource,eZ.vertexSource,eG.vertexSource,em.vertexSource).join("\n"),eI=ev.createShader(ev.FRAGMENT_SHADER);if(ev.isContextLost())return void(this.failedToCreate=!0);ev.shaderSource(eI,eS),ev.compileShader(eI),ev.attachShader(this.program,eI);let eC=ev.createShader(ev.VERTEX_SHADER);if(ev.isContextLost())this.failedToCreate=!0;else{ev.shaderSource(eC,eA),ev.compileShader(eC),ev.attachShader(this.program,eC),this.attributes={},this.numAttributes=eT.length;for(let eo=0;eo<this.numAttributes;eo++)eT[eo]&&(ev.bindAttribLocation(this.program,eo,eT[eo]),this.attributes[eT[eo]]=eo);ev.linkProgram(this.program),ev.deleteShader(eC),ev.deleteShader(eI),this.fixedUniforms=eg(ec),this.binderUniforms=e_?e_.getUniforms(ec):[],ex.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new eo.Uniform1i(ec),u_dem_prev:new eo.Uniform1i(ec),u_dem_unpack:new eo.Uniform4f(ec),u_dem_tl:new eo.Uniform2f(ec),u_dem_scale:new eo.Uniform1f(ec),u_dem_tl_prev:new eo.Uniform2f(ec),u_dem_scale_prev:new eo.Uniform1f(ec),u_dem_size:new eo.Uniform1f(ec),u_dem_lerp:new eo.Uniform1f(ec),u_exaggeration:new eo.Uniform1f(ec),u_depth:new eo.Uniform1i(ec),u_depth_size_inv:new eo.Uniform2f(ec),u_meter_to_dem:new eo.Uniform1f(ec),u_label_plane_matrix_inv:new eo.UniformMatrix4f(ec)}),ex.includes("GLOBE")&&(this.globeUniforms={u_tile_tl_up:new eo.Uniform3f(ec),u_tile_tr_up:new eo.Uniform3f(ec),u_tile_br_up:new eo.Uniform3f(ec),u_tile_bl_up:new eo.Uniform3f(ec),u_tile_up_scale:new eo.Uniform1f(ec)}),ex.includes("FOG")&&(this.fogUniforms={u_fog_matrix:new eo.UniformMatrix4f(ec),u_fog_range:new eo.Uniform2f(ec),u_fog_color:new eo.Uniform4f(ec),u_fog_horizon_blend:new eo.Uniform1f(ec),u_fog_temporal_offset:new eo.Uniform1f(ec),u_frustum_tl:new eo.Uniform3f(ec),u_frustum_tr:new eo.Uniform3f(ec),u_frustum_br:new eo.Uniform3f(ec),u_frustum_bl:new eo.Uniform3f(ec),u_globe_pos:new eo.Uniform3f(ec),u_globe_radius:new eo.Uniform1f(ec),u_globe_transition:new eo.Uniform1f(ec),u_is_globe:new eo.Uniform1i(ec),u_viewport:new eo.Uniform2f(ec)})}}setTerrainUniformValues(eo,ec){if(!this.terrainUniforms)return;let ed=this.terrainUniforms;if(!this.failedToCreate)for(let em in eo.program.set(this.program),ec)ed[em]&&ed[em].set(this.program,em,ec[em])}setGlobeUniformValues(eo,ec){if(!this.globeUniforms)return;let ed=this.globeUniforms;if(!this.failedToCreate)for(let em in eo.program.set(this.program),ec)ed[em]&&ed[em].set(this.program,em,ec[em])}setFogUniformValues(eo,ec){if(!this.fogUniforms)return;let ed=this.fogUniforms;if(!this.failedToCreate)for(let em in eo.program.set(this.program),ec)ed[em].set(this.program,em,ec[em])}draw(eo,ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA){let eI=eo.gl;if(this.failedToCreate)return;for(let ec of(eo.program.set(this.program),eo.setDepthMode(ed),eo.setStencilMode(em),eo.setColorMode(e_),eo.setCullFace(eg),Object.keys(this.fixedUniforms)))this.fixedUniforms[ec].set(this.program,ec,ex[ec]);eS&&eS.setUniforms(this.program,eo,this.binderUniforms,eE,{zoom:eM});let eC={[eI.LINES]:2,[eI.TRIANGLES]:3,[eI.LINE_STRIP]:1}[ec];for(let ed of eT.get()){let em=ed.vaos||(ed.vaos={});(em[ev]||(em[ev]=new _i)).bind(eo,this,eb,eS?eS.getPaintVertexBuffers():[],ew,ed.vertexOffset,eA||[]),eI.drawElements(ec,ed.primitiveLength*eC,eI.UNSIGNED_SHORT,ed.primitiveOffset*eC*2)}}};function Ai(eo,ec){let ed=Math.pow(2,ec.tileID.overscaledZ),em=ec.tileSize*Math.pow(2,eo.transform.tileZoom)/ed,e_=em*(ec.tileID.canonical.x+ec.tileID.wrap*ed),eg=em*ec.tileID.canonical.y;return{u_image:0,u_texsize:ec.imageAtlasTexture.size,u_tile_units_to_pixels:1/D(ec,1,eo.transform.tileZoom),u_pixel_coord_upper:[e_>>16,eg>>16],u_pixel_coord_lower:[65535&e_,65535&eg]}}let eY=eo.create(),Ri=(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE)=>{let eM=ed.style.light,eS=eM.properties.get("position"),eA=[eS.x,eS.y,eS.z],eI=eo.create$1();"viewport"===eM.properties.get("anchor")&&(eo.fromRotation(eI,-ed.transform.angle),eo.transformMat3(eA,eA,eI));let eC=eM.properties.get("color"),eP=ed.transform,ez={u_matrix:ec,u_lightpos:eA,u_lightintensity:eM.properties.get("intensity"),u_lightcolor:[eC.r,eC.g,eC.b],u_vertical_gradient:+em,u_opacity:e_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:eY,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:eg,u_edge_radius:ex};return"globe"===eP.projection.name&&(ez.u_tile_id=[ev.canonical.x,ev.canonical.y,1<<ev.canonical.z],ez.u_zoom_transition=ew,ez.u_inv_rot_matrix=eE,ez.u_merc_center=eT,ez.u_up_dir=eP.projection.upVector(new eo.CanonicalTileID(0,0,0),eT[0]*eo.EXTENT,eT[1]*eo.EXTENT),ez.u_height_lift=eb),ez},Oi=(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM)=>{let eS=Ri(ec,ed,em,e_,eg,ex,ev,ew,eT,eE,eM),eA={u_height_factor:-Math.pow(2,ev.overscaledZ)/eb.tileSize/8};return eo.extend(eS,Ai(ed,eb),eA)},Bi=eo=>({u_matrix:eo}),ki=(ec,ed,em)=>eo.extend(Bi(ec),Ai(ed,em)),Fi=(eo,ec)=>({u_matrix:eo,u_world:ec}),Ui=(ec,ed,em,e_)=>eo.extend(ki(ec,ed,em),{u_world:e_}),eK=eo.create(),ji=(ec,ed,em,e_,eg,ex)=>{let ev;let eb=ec.transform,ew="globe"===eb.projection.name;if("map"===ex.paint.get("circle-pitch-alignment")){if(ew){let ec=eo.globePixelsToTileUnits(eb.zoom,ed.canonical)*eb._pixelsPerMercatorPixel;ev=Float32Array.from([ec,0,0,ec])}else ev=eb.calculatePixelsToTileUnitsMatrix(em)}else ev=new Float32Array([eb.pixelsToGLUnits[0],0,0,eb.pixelsToGLUnits[1]]);let eT={u_camera_to_center_distance:eb.cameraToCenterDistance,u_matrix:ec.translatePosMatrix(ed.projMatrix,em,ex.paint.get("circle-translate"),ex.paint.get("circle-translate-anchor")),u_device_pixel_ratio:eo.exported.devicePixelRatio,u_extrude_scale:ev,u_inv_rot_matrix:eK,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(ew){eT.u_inv_rot_matrix=e_,eT.u_merc_center=eg,eT.u_tile_id=[ed.canonical.x,ed.canonical.y,1<<ed.canonical.z],eT.u_zoom_transition=eo.globeToMercatorTransition(eb.zoom);let ec=eg[0]*eo.EXTENT,em=eg[1]*eo.EXTENT;eT.u_up_dir=eb.projection.upVector(new eo.CanonicalTileID(0,0,0),ec,em)}return eT},Gi=eo=>{let ec=[];return"map"===eo.paint.get("circle-pitch-alignment")&&ec.push("PITCH_WITH_MAP"),"map"===eo.paint.get("circle-pitch-scale")&&ec.push("SCALE_WITH_MAP"),ec},Zi=(ec,ed,em,e_)=>{let eg=eo.EXTENT/em.tileSize;return{u_matrix:ec,u_camera_to_center_distance:ed.getCameraToCenterDistance(e_),u_extrude_scale:[ed.pixelsToGLUnits[0]/eg,ed.pixelsToGLUnits[1]/eg]}},Vi=(eo,ec,ed=1)=>({u_matrix:eo,u_color:ec,u_overlay:0,u_overlay_scale:ed}),eQ=eo.create(),Xi=(ec,ed,em,e_,eg,ex,ev)=>{let eb=ec.transform,ew="globe"===eb.projection.name,eT=ew?eo.globePixelsToTileUnits(eb.zoom,ed.canonical)*eb._pixelsPerMercatorPixel:D(em,1,ex),eE={u_matrix:ed.projMatrix,u_extrude_scale:eT,u_intensity:ev,u_inv_rot_matrix:eQ,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(ew){eE.u_inv_rot_matrix=e_,eE.u_merc_center=eg,eE.u_tile_id=[ed.canonical.x,ed.canonical.y,1<<ed.canonical.z],eE.u_zoom_transition=eo.globeToMercatorTransition(eb.zoom);let ec=eg[0]*eo.EXTENT,em=eg[1]*eo.EXTENT;eE.u_up_dir=eb.projection.upVector(new eo.CanonicalTileID(0,0,0),ec,em)}return eE},qi=(eo,ec,ed,em,e_,eg,ex)=>{let ev=eo.transform,eb=ev.calculatePixelsToTileUnitsMatrix(ec);return{u_matrix:Yi(eo,ec,ed,em),u_pixels_to_tile_units:eb,u_device_pixel_ratio:eg,u_units_to_pixels:[1/ev.pixelsToGLUnits[0],1/ev.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:e_,u_texsize:Ki(ed)?ec.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Hi(ec,eo.transform),u_alpha_discard_threshold:0,u_trim_offset:ex}},$i=(eo,ec,ed,em,e_)=>{let eg=eo.transform;return{u_matrix:Yi(eo,ec,ed,em),u_texsize:ec.imageAtlasTexture.size,u_pixels_to_tile_units:eg.calculatePixelsToTileUnitsMatrix(ec),u_device_pixel_ratio:e_,u_image:0,u_tile_units_to_pixels:Hi(ec,eg),u_units_to_pixels:[1/eg.pixelsToGLUnits[0],1/eg.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Hi(eo,ec){return 1/D(eo,1,ec.tileZoom)}function Yi(eo,ec,ed,em){return eo.translatePosMatrix(em||ec.tileID.projMatrix,ec,ed.paint.get("line-translate"),ed.paint.get("line-translate-anchor"))}function Ki(eo){let ec=eo.paint.get("line-dasharray").value;return ec.value||"constant"!==ec.kind}let Ji=(eo,ec,ed,em,e_,eg)=>{var ex,ev;return{u_matrix:eo,u_tl_parent:ec,u_scale_parent:ed,u_fade_t:em.mix,u_opacity:em.opacity*e_.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:e_.paint.get("raster-brightness-min"),u_brightness_high:e_.paint.get("raster-brightness-max"),u_saturation_factor:(ev=e_.paint.get("raster-saturation"))>0?1-1/(1.001-ev):-ev,u_contrast_factor:(ex=e_.paint.get("raster-contrast"))>0?1/(1-ex):1+ex,u_spin_weights:function(eo){eo*=Math.PI/180;let ec=Math.sin(eo),ed=Math.cos(eo);return[(2*ed+1)/3,(-Math.sqrt(3)*ec-ed+1)/3,(Math.sqrt(3)*ec-ed+1)/3]}(e_.paint.get("raster-hue-rotate")),u_perspective_transform:eg}},e0=eo.create(),to=(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC)=>{let eP=eg.transform,ez={u_is_size_zoom_constant:+("constant"===ec||"source"===ec),u_is_size_feature_constant:+("constant"===ec||"camera"===ec),u_size_t:ed?ed.uSizeT:0,u_size:ed?ed.uSize:0,u_camera_to_center_distance:eP.cameraToCenterDistance,u_rotate_symbol:+em,u_aspect_ratio:eP.width/eP.height,u_fade_change:eg.options.fadeDuration?eg.symbolFadeChange:1,u_matrix:ex,u_label_plane_matrix:ev,u_coord_matrix:eb,u_is_text:+ew,u_pitch_with_map:+e_,u_texsize:eT,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:e0,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:e0,u_up_vector:[0,-1,0]};return"globe"===eC.name&&(ez.u_tile_id=[eE.canonical.x,eE.canonical.y,1<<eE.canonical.z],ez.u_zoom_transition=eM,ez.u_inv_rot_matrix=eA,ez.u_merc_center=eS,ez.u_camera_forward=eP._camera.forward(),ez.u_ecef_origin=eo.globeECEFOrigin(eP.globeMatrix,eE.toUnwrapped()),ez.u_tile_matrix=Float32Array.from(eP.globeMatrix),ez.u_up_vector=eI),ez},io=(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC,eP)=>eo.extend(to(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eM,eS,eA,eI,eC,eP),{u_gamma_scale:e_?eg.transform.cameraToCenterDistance*Math.cos(eg.terrain?0:eg.transform._pitch):1,u_device_pixel_ratio:eo.exported.devicePixelRatio,u_is_halo:+eE}),oo=(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM,eS,eA,eI,eC)=>eo.extend(io(ec,ed,em,e_,eg,ex,ev,eb,!0,ew,!0,eE,eM,eS,eA,eI,eC),{u_texsize_icon:eT,u_texture_icon:1}),ro=(eo,ec,ed)=>({u_matrix:eo,u_opacity:ec,u_color:ed}),no=(ec,ed,em,e_,eg)=>eo.extend(function(eo,ec,ed){let em=ec.imageManager.getPattern(eo.toString()),{width:e_,height:eg}=ec.imageManager.getPixelSize(),ex=Math.pow(2,ed.tileID.overscaledZ),ev=ed.tileSize*Math.pow(2,ec.transform.tileZoom)/ex,eb=ev*(ed.tileID.canonical.x+ed.tileID.wrap*ex),ew=ev*ed.tileID.canonical.y;return{u_image:0,u_pattern_tl:em.tl,u_pattern_br:em.br,u_texsize:[e_,eg],u_pattern_size:em.displaySize,u_tile_units_to_pixels:1/D(ed,1,ec.transform.tileZoom),u_pixel_coord_upper:[eb>>16,ew>>16],u_pixel_coord_lower:[65535&eb,65535&ew]}}(e_,em,eg),{u_matrix:ec,u_opacity:ed}),e1={fillExtrusion:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_lightpos:new eo.Uniform3f(ec),u_lightintensity:new eo.Uniform1f(ec),u_lightcolor:new eo.Uniform3f(ec),u_vertical_gradient:new eo.Uniform1f(ec),u_opacity:new eo.Uniform1f(ec),u_edge_radius:new eo.Uniform1f(ec),u_ao:new eo.Uniform2f(ec),u_tile_id:new eo.Uniform3f(ec),u_zoom_transition:new eo.Uniform1f(ec),u_inv_rot_matrix:new eo.UniformMatrix4f(ec),u_merc_center:new eo.Uniform2f(ec),u_up_dir:new eo.Uniform3f(ec),u_height_lift:new eo.Uniform1f(ec)}),fillExtrusionPattern:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_lightpos:new eo.Uniform3f(ec),u_lightintensity:new eo.Uniform1f(ec),u_lightcolor:new eo.Uniform3f(ec),u_vertical_gradient:new eo.Uniform1f(ec),u_height_factor:new eo.Uniform1f(ec),u_edge_radius:new eo.Uniform1f(ec),u_ao:new eo.Uniform2f(ec),u_tile_id:new eo.Uniform3f(ec),u_zoom_transition:new eo.Uniform1f(ec),u_inv_rot_matrix:new eo.UniformMatrix4f(ec),u_merc_center:new eo.Uniform2f(ec),u_up_dir:new eo.Uniform3f(ec),u_height_lift:new eo.Uniform1f(ec),u_image:new eo.Uniform1i(ec),u_texsize:new eo.Uniform2f(ec),u_pixel_coord_upper:new eo.Uniform2f(ec),u_pixel_coord_lower:new eo.Uniform2f(ec),u_tile_units_to_pixels:new eo.Uniform1f(ec),u_opacity:new eo.Uniform1f(ec)}),fill:ec=>({u_matrix:new eo.UniformMatrix4f(ec)}),fillPattern:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_image:new eo.Uniform1i(ec),u_texsize:new eo.Uniform2f(ec),u_pixel_coord_upper:new eo.Uniform2f(ec),u_pixel_coord_lower:new eo.Uniform2f(ec),u_tile_units_to_pixels:new eo.Uniform1f(ec)}),fillOutline:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_world:new eo.Uniform2f(ec)}),fillOutlinePattern:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_world:new eo.Uniform2f(ec),u_image:new eo.Uniform1i(ec),u_texsize:new eo.Uniform2f(ec),u_pixel_coord_upper:new eo.Uniform2f(ec),u_pixel_coord_lower:new eo.Uniform2f(ec),u_tile_units_to_pixels:new eo.Uniform1f(ec)}),circle:ec=>({u_camera_to_center_distance:new eo.Uniform1f(ec),u_extrude_scale:new eo.UniformMatrix2f(ec),u_device_pixel_ratio:new eo.Uniform1f(ec),u_matrix:new eo.UniformMatrix4f(ec),u_inv_rot_matrix:new eo.UniformMatrix4f(ec),u_merc_center:new eo.Uniform2f(ec),u_tile_id:new eo.Uniform3f(ec),u_zoom_transition:new eo.Uniform1f(ec),u_up_dir:new eo.Uniform3f(ec)}),collisionBox:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_camera_to_center_distance:new eo.Uniform1f(ec),u_extrude_scale:new eo.Uniform2f(ec)}),collisionCircle:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_inv_matrix:new eo.UniformMatrix4f(ec),u_camera_to_center_distance:new eo.Uniform1f(ec),u_viewport_size:new eo.Uniform2f(ec)}),debug:ec=>({u_color:new eo.UniformColor(ec),u_matrix:new eo.UniformMatrix4f(ec),u_overlay:new eo.Uniform1i(ec),u_overlay_scale:new eo.Uniform1f(ec)}),clippingMask:ec=>({u_matrix:new eo.UniformMatrix4f(ec)}),heatmap:ec=>({u_extrude_scale:new eo.Uniform1f(ec),u_intensity:new eo.Uniform1f(ec),u_matrix:new eo.UniformMatrix4f(ec),u_inv_rot_matrix:new eo.UniformMatrix4f(ec),u_merc_center:new eo.Uniform2f(ec),u_tile_id:new eo.Uniform3f(ec),u_zoom_transition:new eo.Uniform1f(ec),u_up_dir:new eo.Uniform3f(ec)}),heatmapTexture:ec=>({u_image:new eo.Uniform1i(ec),u_color_ramp:new eo.Uniform1i(ec),u_opacity:new eo.Uniform1f(ec)}),hillshade:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_image:new eo.Uniform1i(ec),u_latrange:new eo.Uniform2f(ec),u_light:new eo.Uniform2f(ec),u_shadow:new eo.UniformColor(ec),u_highlight:new eo.UniformColor(ec),u_accent:new eo.UniformColor(ec)}),hillshadePrepare:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_image:new eo.Uniform1i(ec),u_dimension:new eo.Uniform2f(ec),u_zoom:new eo.Uniform1f(ec),u_unpack:new eo.Uniform4f(ec)}),line:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_pixels_to_tile_units:new eo.UniformMatrix2f(ec),u_device_pixel_ratio:new eo.Uniform1f(ec),u_units_to_pixels:new eo.Uniform2f(ec),u_dash_image:new eo.Uniform1i(ec),u_gradient_image:new eo.Uniform1i(ec),u_image_height:new eo.Uniform1f(ec),u_texsize:new eo.Uniform2f(ec),u_tile_units_to_pixels:new eo.Uniform1f(ec),u_alpha_discard_threshold:new eo.Uniform1f(ec),u_trim_offset:new eo.Uniform2f(ec)}),linePattern:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_texsize:new eo.Uniform2f(ec),u_pixels_to_tile_units:new eo.UniformMatrix2f(ec),u_device_pixel_ratio:new eo.Uniform1f(ec),u_image:new eo.Uniform1i(ec),u_units_to_pixels:new eo.Uniform2f(ec),u_tile_units_to_pixels:new eo.Uniform1f(ec),u_alpha_discard_threshold:new eo.Uniform1f(ec)}),raster:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_tl_parent:new eo.Uniform2f(ec),u_scale_parent:new eo.Uniform1f(ec),u_fade_t:new eo.Uniform1f(ec),u_opacity:new eo.Uniform1f(ec),u_image0:new eo.Uniform1i(ec),u_image1:new eo.Uniform1i(ec),u_brightness_low:new eo.Uniform1f(ec),u_brightness_high:new eo.Uniform1f(ec),u_saturation_factor:new eo.Uniform1f(ec),u_contrast_factor:new eo.Uniform1f(ec),u_spin_weights:new eo.Uniform3f(ec),u_perspective_transform:new eo.Uniform2f(ec)}),symbolIcon:ec=>({u_is_size_zoom_constant:new eo.Uniform1i(ec),u_is_size_feature_constant:new eo.Uniform1i(ec),u_size_t:new eo.Uniform1f(ec),u_size:new eo.Uniform1f(ec),u_camera_to_center_distance:new eo.Uniform1f(ec),u_rotate_symbol:new eo.Uniform1i(ec),u_aspect_ratio:new eo.Uniform1f(ec),u_fade_change:new eo.Uniform1f(ec),u_matrix:new eo.UniformMatrix4f(ec),u_label_plane_matrix:new eo.UniformMatrix4f(ec),u_coord_matrix:new eo.UniformMatrix4f(ec),u_is_text:new eo.Uniform1i(ec),u_pitch_with_map:new eo.Uniform1i(ec),u_texsize:new eo.Uniform2f(ec),u_tile_id:new eo.Uniform3f(ec),u_zoom_transition:new eo.Uniform1f(ec),u_inv_rot_matrix:new eo.UniformMatrix4f(ec),u_merc_center:new eo.Uniform2f(ec),u_camera_forward:new eo.Uniform3f(ec),u_tile_matrix:new eo.UniformMatrix4f(ec),u_up_vector:new eo.Uniform3f(ec),u_ecef_origin:new eo.Uniform3f(ec),u_texture:new eo.Uniform1i(ec)}),symbolSDF:ec=>({u_is_size_zoom_constant:new eo.Uniform1i(ec),u_is_size_feature_constant:new eo.Uniform1i(ec),u_size_t:new eo.Uniform1f(ec),u_size:new eo.Uniform1f(ec),u_camera_to_center_distance:new eo.Uniform1f(ec),u_rotate_symbol:new eo.Uniform1i(ec),u_aspect_ratio:new eo.Uniform1f(ec),u_fade_change:new eo.Uniform1f(ec),u_matrix:new eo.UniformMatrix4f(ec),u_label_plane_matrix:new eo.UniformMatrix4f(ec),u_coord_matrix:new eo.UniformMatrix4f(ec),u_is_text:new eo.Uniform1i(ec),u_pitch_with_map:new eo.Uniform1i(ec),u_texsize:new eo.Uniform2f(ec),u_texture:new eo.Uniform1i(ec),u_gamma_scale:new eo.Uniform1f(ec),u_device_pixel_ratio:new eo.Uniform1f(ec),u_tile_id:new eo.Uniform3f(ec),u_zoom_transition:new eo.Uniform1f(ec),u_inv_rot_matrix:new eo.UniformMatrix4f(ec),u_merc_center:new eo.Uniform2f(ec),u_camera_forward:new eo.Uniform3f(ec),u_tile_matrix:new eo.UniformMatrix4f(ec),u_up_vector:new eo.Uniform3f(ec),u_ecef_origin:new eo.Uniform3f(ec),u_is_halo:new eo.Uniform1i(ec)}),symbolTextAndIcon:ec=>({u_is_size_zoom_constant:new eo.Uniform1i(ec),u_is_size_feature_constant:new eo.Uniform1i(ec),u_size_t:new eo.Uniform1f(ec),u_size:new eo.Uniform1f(ec),u_camera_to_center_distance:new eo.Uniform1f(ec),u_rotate_symbol:new eo.Uniform1i(ec),u_aspect_ratio:new eo.Uniform1f(ec),u_fade_change:new eo.Uniform1f(ec),u_matrix:new eo.UniformMatrix4f(ec),u_label_plane_matrix:new eo.UniformMatrix4f(ec),u_coord_matrix:new eo.UniformMatrix4f(ec),u_is_text:new eo.Uniform1i(ec),u_pitch_with_map:new eo.Uniform1i(ec),u_texsize:new eo.Uniform2f(ec),u_texsize_icon:new eo.Uniform2f(ec),u_texture:new eo.Uniform1i(ec),u_texture_icon:new eo.Uniform1i(ec),u_gamma_scale:new eo.Uniform1f(ec),u_device_pixel_ratio:new eo.Uniform1f(ec),u_is_halo:new eo.Uniform1i(ec)}),background:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_opacity:new eo.Uniform1f(ec),u_color:new eo.UniformColor(ec)}),backgroundPattern:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_opacity:new eo.Uniform1f(ec),u_image:new eo.Uniform1i(ec),u_pattern_tl:new eo.Uniform2f(ec),u_pattern_br:new eo.Uniform2f(ec),u_texsize:new eo.Uniform2f(ec),u_pattern_size:new eo.Uniform2f(ec),u_pixel_coord_upper:new eo.Uniform2f(ec),u_pixel_coord_lower:new eo.Uniform2f(ec),u_tile_units_to_pixels:new eo.Uniform1f(ec)}),terrainRaster:gi,terrainDepth:gi,skybox:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_sun_direction:new eo.Uniform3f(ec),u_cubemap:new eo.Uniform1i(ec),u_opacity:new eo.Uniform1f(ec),u_temporal_offset:new eo.Uniform1f(ec)}),skyboxGradient:ec=>({u_matrix:new eo.UniformMatrix4f(ec),u_color_ramp:new eo.Uniform1i(ec),u_center_direction:new eo.Uniform3f(ec),u_radius:new eo.Uniform1f(ec),u_opacity:new eo.Uniform1f(ec),u_temporal_offset:new eo.Uniform1f(ec)}),skyboxCapture:ec=>({u_matrix_3f:new eo.UniformMatrix3f(ec),u_sun_direction:new eo.Uniform3f(ec),u_sun_intensity:new eo.Uniform1f(ec),u_color_tint_r:new eo.Uniform4f(ec),u_color_tint_m:new eo.Uniform4f(ec),u_luminance:new eo.Uniform1f(ec)}),globeRaster:ec=>({u_proj_matrix:new eo.UniformMatrix4f(ec),u_globe_matrix:new eo.UniformMatrix4f(ec),u_normalize_matrix:new eo.UniformMatrix4f(ec),u_merc_matrix:new eo.UniformMatrix4f(ec),u_zoom_transition:new eo.Uniform1f(ec),u_merc_center:new eo.Uniform2f(ec),u_image0:new eo.Uniform1i(ec),u_grid_matrix:new eo.UniformMatrix3f(ec),u_skirt_height:new eo.Uniform1f(ec),u_frustum_tl:new eo.Uniform3f(ec),u_frustum_tr:new eo.Uniform3f(ec),u_frustum_br:new eo.Uniform3f(ec),u_frustum_bl:new eo.Uniform3f(ec),u_globe_pos:new eo.Uniform3f(ec),u_globe_radius:new eo.Uniform1f(ec),u_viewport:new eo.Uniform2f(ec)}),globeAtmosphere:ec=>({u_frustum_tl:new eo.Uniform3f(ec),u_frustum_tr:new eo.Uniform3f(ec),u_frustum_br:new eo.Uniform3f(ec),u_frustum_bl:new eo.Uniform3f(ec),u_horizon:new eo.Uniform1f(ec),u_transition:new eo.Uniform1f(ec),u_fadeout_range:new eo.Uniform1f(ec),u_color:new eo.Uniform4f(ec),u_high_color:new eo.Uniform4f(ec),u_space_color:new eo.Uniform4f(ec),u_star_intensity:new eo.Uniform1f(ec),u_star_density:new eo.Uniform1f(ec),u_star_size:new eo.Uniform1f(ec),u_temporal_offset:new eo.Uniform1f(ec),u_horizon_angle:new eo.Uniform1f(ec),u_rotation_matrix:new eo.UniformMatrix4f(ec)})};function lo(ec,ed,e_,eg,ex,ev,eb){let ew=ec.context,eT=ew.gl,eE=ec.transform,eM=ec.useProgram("collisionBox"),eS=[],eA=0,eI=0;for(let em=0;em<eg.length;em++){let eC=eg[em],eP=ed.getTile(eC),ez=eP.getBucket(e_);if(!ez)continue;let eD=function(eo,ec,ed){if(ec.projection.name===ed.projection.name)return eo.projMatrix;let em=ed.clone();return em.setProjection(ec.projection),gt(em,ec.getProjection(),eo)}(eC,ez,eE),ek=eD;0===ex[0]&&0===ex[1]||(ek=ec.translatePosMatrix(eD,eP,ex,ev));let eL=eb?ez.textCollisionBox:ez.iconCollisionBox,eR=ez.collisionCircleArray;if(eR.length>0){let ec=eo.create(),ed=ek;eo.mul(ec,ez.placementInvProjMatrix,eE.glCoordMatrix),eo.mul(ec,ec,ez.placementViewportMatrix),eS.push({circleArray:eR,circleOffset:eI,transform:ed,invTransform:ec,projection:ez.getProjection()}),eA+=eR.length/4,eI=eA}eL&&(ec.terrain&&ec.terrain.setupElevationDraw(eP,eM),eM.draw(ew,eT.LINES,eo.DepthMode.disabled,eo.StencilMode.disabled,ec.colorModeForRenderPass(),eo.CullFaceMode.disabled,Zi(ek,eE,eP,ez.getProjection()),e_.id,eL.layoutVertexBuffer,eL.indexBuffer,eL.segments,null,eE.zoom,null,[eL.collisionVertexBuffer,eL.collisionVertexBufferExt]))}if(!eb||!eS.length)return;let eC=ec.useProgram("collisionCircle"),eP=new eo.StructArrayLayout2f1f2i16;eP.resize(4*eA),eP._trim();let ez=0;for(let eo of eS)for(let ec=0;ec<eo.circleArray.length/4;ec++){let ed=4*ec,em=eo.circleArray[ed+0],e_=eo.circleArray[ed+1],eg=eo.circleArray[ed+2],ex=eo.circleArray[ed+3];eP.emplace(ez++,em,e_,eg,ex,0),eP.emplace(ez++,em,e_,eg,ex,1),eP.emplace(ez++,em,e_,eg,ex,2),eP.emplace(ez++,em,e_,eg,ex,3)}(!em||em.length<2*eA)&&(em=function(ec){let ed=2*ec,em=new eo.StructArrayLayout3ui6;em.resize(ed),em._trim();for(let eo=0;eo<ed;eo++){let ec=6*eo;em.uint16[ec+0]=4*eo+0,em.uint16[ec+1]=4*eo+1,em.uint16[ec+2]=4*eo+2,em.uint16[ec+3]=4*eo+2,em.uint16[ec+4]=4*eo+3,em.uint16[ec+5]=4*eo+0}return em}(eA));let eD=ew.createIndexBuffer(em,!0),ek=ew.createVertexBuffer(eP,eo.collisionCircleLayout.members,!0);for(let ed of eS){let em={u_matrix:ed.transform,u_inv_matrix:ed.invTransform,u_camera_to_center_distance:eE.getCameraToCenterDistance(ed.projection),u_viewport_size:[eE.width,eE.height]};eC.draw(ew,eT.TRIANGLES,eo.DepthMode.disabled,eo.StencilMode.disabled,ec.colorModeForRenderPass(),eo.CullFaceMode.disabled,em,e_.id,ek,eD,eo.SegmentVector.simpleSegment(0,2*ed.circleOffset,ed.circleArray.length,ed.circleArray.length/2),null,eE.zoom)}ek.destroy(),eD.destroy()}let e2=eo.create();function po(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE,eM){let eS=ec.context,eA=eS.gl,eI=ec.transform,eC="map"===eb,eP="map"===ew,ez=eC&&"point"!==em.layout.get("symbol-placement"),eD=eC&&!eP&&!ez,ek=void 0!==em.layout.get("symbol-sort-key").constantOr(1),eL=!1,eR=ec.depthModeForSublayer(0,eo.DepthMode.ReadOnly),eB=[eo.mercatorXfromLng(eI.center.lng),eo.mercatorYfromLat(eI.center.lat)],eF=em.layout.get("text-variable-anchor"),eO="globe"===eI.projection.name,eU=[],eN=[0,-1,0],eV=eN;for(let eb of((eO||eI.mercatorFromTransition)&&!eC&&(eV=function(ec){let ed=ec._camera.getWorldToCamera(ec.worldSize,1),em=eo.multiply([],ed,ec.globeMatrix);eo.invert(em,em);let e_=[0,0,0],eg=[0,1,0,0];return eo.transformMat4$1(eg,eg,em),e_[0]=eg[0],e_[1]=eg[1],e_[2]=eg[2],eo.normalize(e_,e_),e_}(eI)),e_)){let e_;let ew=ed.getTile(eb),eE=ew.getBucket(em);if(!eE||"mercator"===eE.projection.name&&eO)continue;let eM=eg?eE.text:eE.icon;if(!eM||eE.fullyClipped||!eM.segments.get().length)continue;let eS=eM.programConfigurations.get(em.id),eR=eg||eE.sdfIcons,ej=eg?eE.textSizeData:eE.iconSizeData,eG=eP||0!==eI.pitch,eZ=eo.evaluateSizeForZoom(ej,eI.zoom),e$,eq,eX,eW,eH=[0,0],eJ=null;if(eg)eq=ew.glyphAtlasTexture,eX=eA.LINEAR,e$=ew.glyphAtlasTexture.size,eE.iconsInText&&(eH=ew.imageAtlasTexture.size,eJ=ew.imageAtlasTexture,eW=eG||ec.options.rotating||ec.options.zooming||"composite"===ej.kind||"camera"===ej.kind?eA.LINEAR:eA.NEAREST);else{let eo=1!==em.layout.get("icon-size").constantOr(0)||eE.iconsNeedLinear;eq=ew.imageAtlasTexture,eX=eR||ec.options.rotating||ec.options.zooming||eo||eG?eA.LINEAR:eA.NEAREST,e$=ew.imageAtlasTexture.size}let eY="globe"===eE.projection.name,eK=eY?eV:eN,eQ=eY?eo.globeToMercatorTransition(eI.zoom):0,e0=xt(eb,eE.getProjection(),eI),e1=eI.calculatePixelsToTileUnitsMatrix(ew),e3=et(e0,ew.tileID.canonical,eP,eC,eI,eE.getProjection(),e1),e5=ec.terrain&&eP&&ez?eo.invert(eo.create(),e3):e2,e4=it(e0,ew.tileID.canonical,eP,eC,eI,eE.getProjection(),e1),e6=eF&&eE.hasTextData(),e8="none"!==em.layout.get("icon-text-fit")&&e6&&eE.hasIconData();if(ez){let ed=eI.elevation,em=ed?ed.getAtTileOffsetFunc(eb,eI.center.lat,eI.worldSize,eE.getProjection()):null,e_=tt(e0,ew.tileID.canonical,eP,eC,eI,eE.getProjection(),e1);!function(ec,ed,em,e_,eg,ex,ev,eb,ew,eT){let eE=em.transform,eM=e_?ec.textSizeData:ec.iconSizeData,eS=eo.evaluateSizeForZoom(eM,em.transform.zoom),eA="globe"===eE.projection.name,eI=[256/em.width*2+1,256/em.height*2+1],eC=e_?ec.text.dynamicLayoutVertexArray:ec.icon.dynamicLayoutVertexArray;eC.clear();let eP=null;eA&&(eP=e_?ec.text.globeExtVertexArray:ec.icon.globeExtVertexArray);let ez=ec.lineVertexArray,eD=e_?ec.text.placedSymbolArray:ec.icon.placedSymbolArray,ek=em.transform.width/em.transform.height,eL,eR=!1;for(let e_=0;e_<eD.length;e_++){let eA=eD.get(e_),{numGlyphs:eB,writingMode:eF}=eA;if(eF!==eo.WritingMode.vertical||eR||eL===eo.WritingMode.horizontal||(eR=!0),eL=eF,(eA.hidden||eF===eo.WritingMode.vertical)&&!eR){dt(eB,eC);continue}eR=!1;let eO=new eo.Point(eA.tileAnchorX,eA.tileAnchorY),{x:eU,y:eN,z:eV}=eE.projection.projectTilePoint(eO.x,eO.y,eT.canonical);if(ew){let[eo,ec,ed]=ew(eO);eU+=eo,eN+=ec,eV+=ed}let ej=[eU,eN,eV,1];if(eo.transformMat4$1(ej,ej,ed),!function(eo,ec){let ed=eo[0]/eo[3],em=eo[1]/eo[3];return ed>=-ec[0]&&ed<=ec[0]&&em>=-ec[1]&&em<=ec[1]}(ej,eI)){dt(eB,eC);continue}let eG=rt(em.transform.cameraToCenterDistance,ej[3]),eZ=eo.evaluateSizeForFeature(eM,eS,eA),e$=ev?eZ/eG:eZ*eG,eq=ot(eU,eN,eV,eg);if(eq[3]<=0){dt(eB,eC);continue}let eX={},eW=ev?null:ew,eH=ct(eA,e$,!1,eb,ed,eg,ex,ec.glyphOffsetArray,ez,eC,eP,eq,eO,eX,ek,eW,eE.projection,eT,ev);eR=eH.useVertical,eW&&eH.needsFlipping&&(eX={}),(eH.notEnoughRoom||eR||eH.needsFlipping&&ct(eA,e$,!0,eb,ed,eg,ex,ec.glyphOffsetArray,ez,eC,eP,eq,eO,eX,ek,eW,eE.projection,eT,ev).notEnoughRoom)&&dt(eB,eC)}e_?(ec.text.dynamicLayoutVertexBuffer.updateData(eC),eP&&ec.text.globeExtVertexBuffer.updateData(eP)):(ec.icon.dynamicLayoutVertexBuffer.updateData(eC),eP&&ec.icon.globeExtVertexBuffer.updateData(eP))}(eE,e0,ec,eg,e_,e4,eP,eT,em,eb)}let e9=ez||eg&&eF||e8,e7=ec.translatePosMatrix(e0,ew,ex,ev),tr=e9?e2:e3,ts=ec.translatePosMatrix(e4,ew,ex,ev,!0),tl=eE.getProjection().createInversionMatrix(eI,eb.canonical),td=[];ec.terrainRenderModeElevated()&&eP&&td.push("PITCH_WITH_MAP_TERRAIN"),eY&&td.push("PROJECTION_GLOBE_VIEW"),e9&&td.push("PROJECTED_POS_ON_VIEWPORT");let tp=eR&&0!==em.paint.get(eg?"text-halo-width":"icon-halo-width").constantOr(1);e_=eR?eE.iconsInText?oo(ej.kind,eZ,eD,eP,ec,e7,tr,ts,e$,eH,eb,eQ,eB,tl,eK,eE.getProjection()):io(ej.kind,eZ,eD,eP,ec,e7,tr,ts,eg,e$,!0,eb,eQ,eB,tl,eK,eE.getProjection()):to(ej.kind,eZ,eD,eP,ec,e7,tr,ts,eg,e$,eb,eQ,eB,tl,eK,eE.getProjection());let tm={program:ec.useProgram(eE.iconsInText&&eg?"symbolTextAndIcon":eR?"symbolSDF":"symbolIcon",eS,td),buffers:eM,uniformValues:e_,atlasTexture:eq,atlasTextureIcon:eJ,atlasInterpolation:eX,atlasInterpolationIcon:eW,isSDF:eR,hasHalo:tp,tile:ew,labelPlaneMatrixInv:e5};if(ek&&eE.canOverlap){eL=!0;let ec=eM.segments.get();for(let ed of ec)eU.push({segments:new eo.SegmentVector([ed]),sortKey:ed.sortKey,state:tm})}else eU.push({segments:eM.segments,sortKey:0,state:tm})}for(let eo of(eL&&eU.sort((eo,ec)=>eo.sortKey-ec.sortKey),eU)){let ed=eo.state;if(ec.terrain&&ec.terrain.setupElevationDraw(ed.tile,ed.program,{useDepthForOcclusion:!eO,labelPlaneMatrixInv:ed.labelPlaneMatrixInv}),eS.activeTexture.set(eA.TEXTURE0),ed.atlasTexture.bind(ed.atlasInterpolation,eA.CLAMP_TO_EDGE),ed.atlasTextureIcon&&(eS.activeTexture.set(eA.TEXTURE1),ed.atlasTextureIcon&&ed.atlasTextureIcon.bind(ed.atlasInterpolationIcon,eA.CLAMP_TO_EDGE)),ed.isSDF){let e_=ed.uniformValues;ed.hasHalo&&(e_.u_is_halo=1,mo(ed.buffers,eo.segments,em,ec,ed.program,eR,eE,eM,e_)),e_.u_is_halo=0}mo(ed.buffers,eo.segments,em,ec,ed.program,eR,eE,eM,ed.uniformValues)}}function mo(ec,ed,em,e_,eg,ex,ev,eb,ew){let eT=e_.context,eE=[ec.dynamicLayoutVertexBuffer,ec.opacityVertexBuffer,ec.globeExtVertexBuffer];eg.draw(eT,eT.gl.TRIANGLES,ex,ev,eb,eo.CullFaceMode.disabled,ew,em.id,ec.layoutVertexBuffer,ec.indexBuffer,ed,em.paint,e_.transform.zoom,ec.programConfigurations.get(em.id),eE)}function fo(ec,ed,em,e_,eg,ex,ev){let eb,ew,eT,eE,eM;let eS=ec.context.gl,eA=em.paint.get("fill-pattern"),eI=eA&&eA.constantOr(1);for(let eC of(ev?(ew=eI&&!em.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",eb=eS.LINES):(ew=eI?"fillPattern":"fill",eb=eS.TRIANGLES),e_)){let e_=ed.getTile(eC);if(eI&&!e_.patternsLoaded())continue;let eP=e_.getBucket(em);if(!eP)continue;ec.prepareDrawTile();let ez=eP.programConfigurations.get(em.id),eD=ec.useProgram(ew,ez);eI&&(ec.context.activeTexture.set(eS.TEXTURE0),e_.imageAtlasTexture.bind(eS.LINEAR,eS.CLAMP_TO_EDGE),ez.updatePaintBuffers());let ek=eA.constantOr(null);if(ek&&e_.imageAtlas){let eo=e_.imageAtlas.patternPositions[ek.toString()];eo&&ez.setConstantPatternPositions(eo)}let eL=ec.translatePosMatrix(eC.projMatrix,e_,em.paint.get("fill-translate"),em.paint.get("fill-translate-anchor"));if(ev){eE=eP.indexBuffer2,eM=eP.segments2;let eo=ec.terrain&&ec.terrain.renderingToTexture?ec.terrain.drapeBufferSize:[eS.drawingBufferWidth,eS.drawingBufferHeight];eT="fillOutlinePattern"===ew&&eI?Ui(eL,ec,e_,eo):Fi(eL,eo)}else eE=eP.indexBuffer,eM=eP.segments,eT=eI?ki(eL,ec,e_):Bi(eL);ec.prepareDrawProgram(ec.context,eD,eC.toUnwrapped()),eD.draw(ec.context,eb,eg,ec.stencilModeForClipping(eC),ex,eo.CullFaceMode.disabled,eT,em.id,eP.layoutVertexBuffer,eE,eM,em.paint,ec.transform.zoom,ez)}}function go(ec,ed,em,e_,eg,ex,ev){let eb=ec.context,ew=eb.gl,eT=ec.transform,eE=em.paint.get("fill-extrusion-pattern"),eM=eE.constantOr(1),eS=em.paint.get("fill-extrusion-opacity"),eA=[em.paint.get("fill-extrusion-ambient-occlusion-intensity"),em.paint.get("fill-extrusion-ambient-occlusion-radius")],eI=em.layout.get("fill-extrusion-edge-radius"),eC=eI>0&&!em.paint.get("fill-extrusion-rounded-roof"),eP=eC?0:eI,ez="globe"===eT.projection.name?eo.fillExtrusionHeightLift():0,eD="globe"===eT.projection.name,ek=eD?eo.globeToMercatorTransition(eT.zoom):0,eL=[eo.mercatorXfromLng(eT.center.lng),eo.mercatorYfromLat(eT.center.lat)],eR=[];for(let eI of(eD&&eR.push("PROJECTION_GLOBE_VIEW"),eA[0]>0&&eR.push("FAUX_AO"),eC&&eR.push("ZERO_ROOF_RADIUS"),e_)){let e_=ed.getTile(eI),eC=e_.getBucket(em);if(!eC||eC.projection.name!==eT.projection.name)continue;let eB=eC.programConfigurations.get(em.id),eF=ec.useProgram(eM?"fillExtrusionPattern":"fillExtrusion",eB,eR);if(ec.terrain){let eg=ec.terrain;if(ec.style.terrainSetForDrapingOnly())eg.setupElevationDraw(e_,eF,{useMeterToDem:!0});else{if(!eC.enableTerrain)continue;if(eg.setupElevationDraw(e_,eF,{useMeterToDem:!0}),function(ec,ed,em,e_,eg,ex){let ev,eb,ew;let eT=[ec=>{let ed=ec.canonical.x-1,em=ec.wrap;return ed<0&&(ed=(1<<ec.canonical.z)-1,em--),new eo.OverscaledTileID(ec.overscaledZ,em,ec.canonical.z,ed,ec.canonical.y)},ec=>{let ed=ec.canonical.x+1,em=ec.wrap;return ed===1<<ec.canonical.z&&(ed=0,em++),new eo.OverscaledTileID(ec.overscaledZ,em,ec.canonical.z,ed,ec.canonical.y)},ec=>new eo.OverscaledTileID(ec.overscaledZ,ec.wrap,ec.canonical.z,ec.canonical.x,(0===ec.canonical.y?1<<ec.canonical.z:ec.canonical.y)-1),ec=>new eo.OverscaledTileID(ec.overscaledZ,ec.wrap,ec.canonical.z,ec.canonical.x,ec.canonical.y===(1<<ec.canonical.z)-1?0:ec.canonical.y+1)],l=eo=>{let ec=ed.getSource().minzoom,o=eo=>{let ec=ed.getTileByID(eo);if(ec&&ec.hasData())return ec.getBucket(eg)};for(let ed of[0,-1,1]){if(eo.overscaledZ+ed<ec)continue;let em=o(eo.calculateScaledKey(eo.overscaledZ+ed));if(em)return em}},eE=[0,0,0],h=(ec,ed)=>(eE[0]=Math.min(ec.min.y,ed.min.y),eE[1]=Math.max(ec.max.y,ed.max.y),eE[2]=eo.EXTENT-ed.min.x>ec.max.x?ed.min.x-eo.EXTENT:ec.max.x,eE),u=(ec,ed)=>(eE[0]=Math.min(ec.min.x,ed.min.x),eE[1]=Math.max(ec.max.x,ed.max.x),eE[2]=eo.EXTENT-ed.min.y>ec.max.y?ed.min.y-eo.EXTENT:ec.max.y,eE),eM=[(eo,ec)=>h(eo,ec),(eo,ec)=>h(ec,eo),(eo,ec)=>u(eo,ec),(eo,ec)=>u(ec,eo)],eS=new eo.Point(0,0),g=(ec,ed,e_,eg,eT)=>{let eE=[[eg?e_:ec,eg?ec:e_,0],[eg?e_:ed,eg?ed:e_,0]],eM=eT<0?eo.EXTENT+eT:eT,eS=[eg?eM:(ec+ed)/2,eg?(ec+ed)/2:eM,0];return 0===e_&&eT<0||0!==e_&&eT>0?ex.getForTilePoints(ew,[eS],!0,eb):eE.push(eS),ex.getForTilePoints(em,eE,!0,ev),Math.max(eE[0][2],eE[1][2],eS[2])/ex.exaggeration()};for(let ec=0;ec<4;ec++){let ed=(ec<2?1:5)-ec,eg=e_.borders[ec];if(0===eg.length)continue;let eE=ew=eT[ec](em),eA=l(eE);if(!(eA&&eA instanceof eo.FillExtrusionBucket&&eA.enableTerrain)||e_.borderDoneWithNeighborZ[ec]===eA.canonical.z&&eA.borderDoneWithNeighborZ[ed]===e_.canonical.z||!(eb=ex.findDEMTileFor(eE))||!eb.dem)continue;if(!ev){let eo=ex.findDEMTileFor(em);if(!eo||!eo.dem)return;ev=eo}let eI=eA.borders[ed],eC=0,eP=eA.borderDoneWithNeighborZ[ed]!==e_.canonical.z;if(e_.canonical.z===eA.canonical.z){for(let em=0;em<eg.length;em++){let ex;let ev=e_.featuresOnBorder[eg[em]],eb=ev.borders[ec];for(;eC<eI.length&&!((ex=eA.featuresOnBorder[eI[eC]]).borders[ed][1]>eb[0]+3);)eP&&eA.encodeCentroid(void 0,ex,!1),eC++;if(ex&&eC<eI.length){let em=eC,eg=0;for(;!(ex.borders[ed][0]>eb[1]-3)&&(eg++,++eC!==eI.length);)ex=eA.featuresOnBorder[eI[eC]];if(ex=eA.featuresOnBorder[eI[em]],ev.intersectsCount()>1||ex.intersectsCount()>1||1!==eg){1!==eg&&(eC=em),e_.encodeCentroid(void 0,ev,!1),eP&&eA.encodeCentroid(void 0,ex,!1);continue}let ew=eM[ec](ev,ex),eT=ec%2?eo.EXTENT-1:0;eS.x=g(ew[0],Math.min(eo.EXTENT-1,ew[1]),eT,ec<2,ew[2]),eS.y=0,e_.encodeCentroid(eS,ev,!1),eP&&eA.encodeCentroid(eS,ex,!1)}else e_.encodeCentroid(void 0,ev,!1)}e_.borderDoneWithNeighborZ[ec]=eA.canonical.z,e_.needsCentroidUpdate=!0,eP&&(eA.borderDoneWithNeighborZ[ed]=e_.canonical.z,eA.needsCentroidUpdate=!0)}else{for(let eo of eg)e_.encodeCentroid(void 0,e_.featuresOnBorder[eo],!1);if(eP){for(let eo of eI)eA.encodeCentroid(void 0,eA.featuresOnBorder[eo],!1);eA.borderDoneWithNeighborZ[ed]=e_.canonical.z,eA.needsCentroidUpdate=!0}e_.borderDoneWithNeighborZ[ec]=eA.canonical.z,e_.needsCentroidUpdate=!0}}(e_.needsCentroidUpdate||!e_.centroidVertexBuffer&&0!==e_.centroidVertexArray.length)&&e_.uploadCentroid(ec)}(eb,ed,eI,eC,em,eg),!eC.centroidVertexBuffer){let eo=eF.attributes.a_centroid_pos;void 0!==eo&&ew.vertexAttrib2f(eo,0,0)}}}eM&&(ec.context.activeTexture.set(ew.TEXTURE0),e_.imageAtlasTexture.bind(ew.LINEAR,ew.CLAMP_TO_EDGE),eB.updatePaintBuffers());let eO=eE.constantOr(null);if(eO&&e_.imageAtlas){let eo=e_.imageAtlas.patternPositions[eO.toString()];eo&&eB.setConstantPatternPositions(eo)}let eU=ec.translatePosMatrix(eI.projMatrix,e_,em.paint.get("fill-extrusion-translate"),em.paint.get("fill-extrusion-translate-anchor")),eN=eT.projection.createInversionMatrix(eT,eI.canonical),eV=em.paint.get("fill-extrusion-vertical-gradient"),ej=eM?Oi(eU,ec,eV,eS,eA,eP,eI,e_,ez,ek,eL,eN):Ri(eU,ec,eV,eS,eA,eP,eI,ez,ek,eL,eN);ec.prepareDrawProgram(eb,eF,eI.toUnwrapped());let eG=[];ec.terrain&&eG.push(eC.centroidVertexBuffer),eD&&eG.push(eC.layoutVertexExtBuffer),eF.draw(eb,eb.gl.TRIANGLES,eg,ex,ev,eo.CullFaceMode.backCCW,ej,em.id,eC.layoutVertexBuffer,eC.indexBuffer,eC.segments,em.paint,ec.transform.zoom,eB,eG)}}let e3=new eo.Color(1,0,0,1),e5=new eo.Color(0,1,0,1),e4=new eo.Color(0,0,1,1),e6=new eo.Color(1,0,1,1),e8=new eo.Color(0,1,1,1);function Co(eo,ec,ed,em){Io(eo,0,ec+ed/2,eo.transform.width,ed,em)}function Mo(eo,ec,ed,em){Io(eo,ec-ed/2,0,ed,eo.transform.height,em)}function Io(ec,ed,em,e_,eg,ex){let ev=ec.context,eb=ev.gl;eb.enable(eb.SCISSOR_TEST),eb.scissor(ed*eo.exported.devicePixelRatio,em*eo.exported.devicePixelRatio,e_*eo.exported.devicePixelRatio,eg*eo.exported.devicePixelRatio),ev.clear({color:ex}),eb.disable(eb.SCISSOR_TEST)}let e9=eo.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:e7}=e9;function Do(eo,ec,ed,em){eo.emplaceBack(ec,ed,em)}let Lo=class Lo{constructor(ec){this.vertexArray=new eo.StructArrayLayout3f12,this.indices=new eo.StructArrayLayout3ui6,Do(this.vertexArray,-1,-1,1),Do(this.vertexArray,1,-1,1),Do(this.vertexArray,-1,1,1),Do(this.vertexArray,1,1,1),Do(this.vertexArray,-1,-1,-1),Do(this.vertexArray,1,-1,-1),Do(this.vertexArray,-1,1,-1),Do(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=ec.createVertexBuffer(this.vertexArray,e7),this.indexBuffer=ec.createIndexBuffer(this.indices),this.segment=eo.SegmentVector.simpleSegment(0,0,36,12)}};function Ao(ec,ed,em,e_,eg,ex){let ev=ec.gl,eb=ed.paint.get("sky-atmosphere-color"),ew=ed.paint.get("sky-atmosphere-halo-color"),eT=ed.paint.get("sky-atmosphere-sun-intensity"),eE={u_matrix_3f:eo.fromMat4(eo.create$1(),e_),u_sun_direction:eg,u_sun_intensity:eT,u_color_tint_r:[eb.r,eb.g,eb.b,eb.a],u_color_tint_m:[ew.r,ew.g,ew.b,ew.a],u_luminance:5e-5};ev.framebufferTexture2D(ev.FRAMEBUFFER,ev.COLOR_ATTACHMENT0,ev.TEXTURE_CUBE_MAP_POSITIVE_X+ex,ed.skyboxTexture,0),em.draw(ec,ev.TRIANGLES,eo.DepthMode.disabled,eo.StencilMode.disabled,eo.ColorMode.unblended,eo.CullFaceMode.frontCW,eE,"skyboxCapture",ed.skyboxGeometry.vertexBuffer,ed.skyboxGeometry.indexBuffer,ed.skyboxGeometry.segment)}let tr=eo.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);let Ro=class Ro{constructor(ec){let ed=new eo.StructArrayLayout5f20;ed.emplaceBack(-1,1,1,0,0),ed.emplaceBack(1,1,1,1,0),ed.emplaceBack(1,-1,1,1,1),ed.emplaceBack(-1,-1,1,0,1);let em=new eo.StructArrayLayout3ui6;em.emplaceBack(0,1,2),em.emplaceBack(2,3,0),this.vertexBuffer=ec.createVertexBuffer(ed,tr.members),this.indexBuffer=ec.createIndexBuffer(em),this.segments=eo.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}};let ts={symbol:function(ec,ed,em,e_,eg){if("translucent"!==ec.renderPass)return;let ex=eo.StencilMode.disabled,ev=ec.colorModeForRenderPass();em.layout.get("text-variable-anchor")&&function(ec,ed,em,e_,eg,ex,ev){let eb=ed.transform,ew="map"===eg,eT="map"===ex;for(let ed of ec){let ec=e_.getTile(ed),eg=ec.getBucket(em);if(!eg||!eg.text||!eg.text.segments.get().length)continue;let ex=eo.evaluateSizeForZoom(eg.textSizeData,eb.zoom),eE=xt(ed,eg.getProjection(),eb),eM=eb.calculatePixelsToTileUnitsMatrix(ec),eS=et(eE,ec.tileID.canonical,eT,ew,eb,eg.getProjection(),eM),eA="none"!==em.layout.get("icon-text-fit")&&eg.hasIconData();if(ex){let em=Math.pow(2,eb.zoom-ec.tileID.overscaledZ);(function(ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE){let eM=ec.text.placedSymbolArray,eS=ec.text.dynamicLayoutVertexArray,eA=ec.icon.dynamicLayoutVertexArray,eI={},eC=ec.getProjection(),eP=xt(eb,eC,ex),ez=ex.elevation,eD=eC.upVectorScale(eb.canonical,ex.center.lat,ex.worldSize).metersToTile;eS.clear();for(let eA=0;eA<eM.length;eA++){let ek=eM.get(eA),{tileAnchorX:eL,tileAnchorY:eR,numGlyphs:eB}=ek,eF=ek.hidden||!ek.crossTileID||ec.allowVerticalPlacement&&!ek.placedOrientation?null:e_[ek.crossTileID];if(eF){let e_=0,eM=0,eA=0;if(ez){let eo=ez?ez.getAtTileOffset(eb,eL,eR):0,[ec,ed,em]=eC.upVector(eb.canonical,eL,eR);e_=eo*ec*eD,eM=eo*ed*eD,eA=eo*em*eD}let[eO,eU,eN,eV]=ot(ek.projectedAnchorX+e_,ek.projectedAnchorY+eM,ek.projectedAnchorZ+eA,em?eP:ev),ej=rt(ex.getCameraToCenterDistance(eC),eV),eG=eg.evaluateSizeForFeature(ec.textSizeData,eT,ek)*ej/eo.ONE_EM;em&&(eG*=ec.tilePixelRatio/ew);let eZ=function({width:ec,height:ed,anchor:em,textOffset:e_,textScale:eg},ex){let{horizontalAlign:ev,verticalAlign:eb}=eo.getAnchorAlignment(em),ew=eo.evaluateVariableOffset(em,e_);return new eo.Point((-(ev-.5)*ec/eg+ew[0])*ex,(-(eb-.5)*ed/eg+ew[1])*ex)}(eF,eG);em?({x:eO,y:eU,z:eN}=eC.projectTilePoint(eL+eZ.x,eR+eZ.y,eb.canonical),[eO,eU,eN]=ot(eO+e_,eU+eM,eN+eA,ev)):(ed&&eZ._rotate(-ex.angle),eO+=eZ.x,eU+=eZ.y,eN=0);let e$=ec.allowVerticalPlacement&&ek.placedOrientation===eo.WritingMode.vertical?Math.PI/2:0;for(let ec=0;ec<eB;ec++)eo.addDynamicAttributes(eS,eO,eU,eN,e$);eE&&ek.associatedIconIndex>=0&&(eI[ek.associatedIconIndex]={x:eO,y:eU,z:eN,angle:e$})}else dt(eB,eS)}if(eE){eA.clear();let ed=ec.icon.placedSymbolArray;for(let ec=0;ec<ed.length;ec++){let em=ed.get(ec),{numGlyphs:e_}=em,eg=eI[ec];if(em.hidden||!eg)dt(e_,eA);else{let{x:ec,y:ed,z:em,angle:ex}=eg;for(let eg=0;eg<e_;eg++)eo.addDynamicAttributes(eA,ec,ed,em,ex)}}ec.icon.dynamicLayoutVertexBuffer.updateData(eA)}ec.text.dynamicLayoutVertexBuffer.updateData(eS)})(eg,ew,eT,ev,eo.symbolSize,eb,eS,ed,em,ex,eA)}}}(e_,ec,em,ed,em.layout.get("text-rotation-alignment"),em.layout.get("text-pitch-alignment"),eg),0!==em.paint.get("icon-opacity").constantOr(1)&&po(ec,ed,em,e_,!1,em.paint.get("icon-translate"),em.paint.get("icon-translate-anchor"),em.layout.get("icon-rotation-alignment"),em.layout.get("icon-pitch-alignment"),em.layout.get("icon-keep-upright"),ex,ev),0!==em.paint.get("text-opacity").constantOr(1)&&po(ec,ed,em,e_,!0,em.paint.get("text-translate"),em.paint.get("text-translate-anchor"),em.layout.get("text-rotation-alignment"),em.layout.get("text-pitch-alignment"),em.layout.get("text-keep-upright"),ex,ev),ed.map.showCollisionBoxes&&(lo(ec,ed,em,e_,em.paint.get("text-translate"),em.paint.get("text-translate-anchor"),!0),lo(ec,ed,em,e_,em.paint.get("icon-translate"),em.paint.get("icon-translate-anchor"),!1))},circle:function(ec,ed,em,e_){if("translucent"!==ec.renderPass)return;let eg=em.paint.get("circle-opacity"),ex=em.paint.get("circle-stroke-width"),ev=em.paint.get("circle-stroke-opacity"),eb=void 0!==em.layout.get("circle-sort-key").constantOr(1);if(0===eg.constantOr(1)&&(0===ex.constantOr(1)||0===ev.constantOr(1)))return;let ew=ec.context,eT=ew.gl,eE=ec.transform,eM=ec.depthModeForSublayer(0,eo.DepthMode.ReadOnly),eS=eo.StencilMode.disabled,eA=ec.colorModeForRenderPass(),eI="globe"===eE.projection.name,eC=[eo.mercatorXfromLng(eE.center.lng),eo.mercatorYfromLat(eE.center.lat)],eP=[];for(let eg=0;eg<e_.length;eg++){let ex=e_[eg],ev=ed.getTile(ex),ew=ev.getBucket(em);if(!ew||ew.projection.name!==eE.projection.name)continue;let eT=ew.programConfigurations.get(em.id),eM=Gi(em);eI&&eM.push("PROJECTION_GLOBE_VIEW");let eS=ec.useProgram("circle",eT,eM),eA=ew.layoutVertexBuffer,ez=ew.globeExtVertexBuffer,eD=ew.indexBuffer,ek=eE.projection.createInversionMatrix(eE,ex.canonical),eL={programConfiguration:eT,program:eS,layoutVertexBuffer:eA,globeExtVertexBuffer:ez,indexBuffer:eD,uniformValues:ji(ec,ex,ev,ek,eC,em),tile:ev};if(eb){let ec=ew.segments.get();for(let ed of ec)eP.push({segments:new eo.SegmentVector([ed]),sortKey:ed.sortKey,state:eL})}else eP.push({segments:ew.segments,sortKey:0,state:eL})}eb&&eP.sort((eo,ec)=>eo.sortKey-ec.sortKey);let ez={useDepthForOcclusion:!eI};for(let ed of eP){let{programConfiguration:e_,program:eg,layoutVertexBuffer:ex,globeExtVertexBuffer:ev,indexBuffer:eb,uniformValues:eI,tile:eC}=ed.state,eP=ed.segments;ec.terrain&&ec.terrain.setupElevationDraw(eC,eg,ez),ec.prepareDrawProgram(ew,eg,eC.tileID.toUnwrapped()),eg.draw(ew,eT.TRIANGLES,eM,eS,eA,eo.CullFaceMode.disabled,eI,em.id,ex,eb,eP,em.paint,eE.zoom,e_,[ev])}},heatmap:function(ec,ed,em,e_){if(0!==em.paint.get("heatmap-opacity")){if("offscreen"===ec.renderPass){let eg=ec.context,ex=eg.gl,ev=eo.StencilMode.disabled,eb=new eo.ColorMode([ex.ONE,ex.ONE],eo.Color.transparent,[!0,!0,!0,!0]);(function(eo,ec,ed,em){let e_=eo.gl,eg=ec.width*em,ex=ec.height*em;eo.activeTexture.set(e_.TEXTURE1),eo.viewport.set([0,0,eg,ex]);let ev=ed.heatmapFbo;if(!ev||ev&&(ev.width!==eg||ev.height!==ex)){ev&&ev.destroy();let ec=e_.createTexture();e_.bindTexture(e_.TEXTURE_2D,ec),e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_WRAP_S,e_.CLAMP_TO_EDGE),e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_WRAP_T,e_.CLAMP_TO_EDGE),e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_MIN_FILTER,e_.LINEAR),e_.texParameteri(e_.TEXTURE_2D,e_.TEXTURE_MAG_FILTER,e_.LINEAR),ev=ed.heatmapFbo=eo.createFramebuffer(eg,ex,!1),function(eo,ec,ed,em,e_,eg){let ex=eo.gl;ex.texImage2D(ex.TEXTURE_2D,0,eo.isWebGL2&&eo.extRenderToTextureHalfFloat?ex.RGBA16F:ex.RGBA,e_,eg,0,ex.RGBA,eo.extRenderToTextureHalfFloat?eo.isWebGL2?ex.HALF_FLOAT:eo.extTextureHalfFloat.HALF_FLOAT_OES:ex.UNSIGNED_BYTE,null),em.colorAttachment.set(ed)}(eo,0,ec,ev,eg,ex)}else e_.bindTexture(e_.TEXTURE_2D,ev.colorAttachment.get()),eo.bindFramebuffer.set(ev.framebuffer)})(eg,ec,em,"globe"===ec.transform.projection.name?.5:.25),eg.clear({color:eo.Color.transparent});let ew=ec.transform,eT="globe"===ew.projection.name,eE=eT?["PROJECTION_GLOBE_VIEW"]:null,eM=eT?eo.CullFaceMode.frontCCW:eo.CullFaceMode.disabled,eS=[eo.mercatorXfromLng(ew.center.lng),eo.mercatorYfromLat(ew.center.lat)];for(let eA=0;eA<e_.length;eA++){let eI=e_[eA];if(ed.hasRenderableParent(eI))continue;let eC=ed.getTile(eI),eP=eC.getBucket(em);if(!eP||eP.projection.name!==ew.projection.name)continue;let ez=eP.programConfigurations.get(em.id),eD=ec.useProgram("heatmap",ez,eE),{zoom:ek}=ec.transform;ec.terrain&&ec.terrain.setupElevationDraw(eC,eD),ec.prepareDrawProgram(eg,eD,eI.toUnwrapped());let eL=ew.projection.createInversionMatrix(ew,eI.canonical);eD.draw(eg,ex.TRIANGLES,eo.DepthMode.disabled,ev,eb,eM,Xi(ec,eI,eC,eL,eS,ek,em.paint.get("heatmap-intensity")),em.id,eP.layoutVertexBuffer,eP.indexBuffer,eP.segments,em.paint,ec.transform.zoom,ez,eT?[eP.globeExtVertexBuffer]:null)}eg.viewport.set([0,0,ec.width,ec.height])}else"translucent"===ec.renderPass&&(ec.context.setColorMode(ec.colorModeForRenderPass()),function(ec,ed){let em=ec.context,e_=em.gl,eg=ed.heatmapFbo;if(!eg)return;em.activeTexture.set(e_.TEXTURE0),e_.bindTexture(e_.TEXTURE_2D,eg.colorAttachment.get()),em.activeTexture.set(e_.TEXTURE1);let ex=ed.colorRampTexture;ex||(ex=ed.colorRampTexture=new eo.Texture(em,ed.colorRamp,e_.RGBA)),ex.bind(e_.LINEAR,e_.CLAMP_TO_EDGE),ec.useProgram("heatmapTexture").draw(em,e_.TRIANGLES,eo.DepthMode.disabled,eo.StencilMode.disabled,ec.colorModeForRenderPass(),eo.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:ed.paint.get("heatmap-opacity")},ed.id,ec.viewportBuffer,ec.quadTriangleIndexBuffer,ec.viewportSegments,ed.paint,ec.transform.zoom)}(ec,em))}},line:function(ec,ed,em,e_){if("translucent"!==ec.renderPass)return;let eg=em.paint.get("line-opacity"),ex=em.paint.get("line-width");if(0===eg.constantOr(1)||0===ex.constantOr(1))return;let ev=ec.depthModeForSublayer(0,eo.DepthMode.ReadOnly),eb=ec.colorModeForRenderPass(),ew=ec.terrain&&ec.terrain.renderingToTexture?1:eo.exported.devicePixelRatio,eT=em.paint.get("line-dasharray"),eE=eT.constantOr(1),eM=em.layout.get("line-cap"),eS=em.paint.get("line-pattern"),eA=eS.constantOr(1),eI=em.paint.get("line-gradient"),eC=eA?"linePattern":"line",eP=ec.context,ez=eP.gl,eD=(eo=>{let ec=[];Ki(eo)&&ec.push("RENDER_LINE_DASH"),eo.paint.get("line-gradient")&&ec.push("RENDER_LINE_GRADIENT");let ed=eo.paint.get("line-trim-offset");0===ed[0]&&0===ed[1]||ec.push("RENDER_LINE_TRIM_OFFSET");let em=eo.paint.get("line-pattern").constantOr(1),e_=1!==eo.paint.get("line-opacity").constantOr(1);return!em&&e_&&ec.push("RENDER_LINE_ALPHA_DISCARD"),ec})(em),ek=eD.includes("RENDER_LINE_ALPHA_DISCARD");for(let eg of(ec.terrain&&ec.terrain.clipOrMaskOverlapStencilType()&&(ek=!1),e_)){let e_=ed.getTile(eg);if(eA&&!e_.patternsLoaded())continue;let ex=e_.getBucket(em);if(!ex)continue;ec.prepareDrawTile();let eL=ex.programConfigurations.get(em.id),eR=ec.useProgram(eC,eL,eD),eB=eS.constantOr(null);if(eB&&e_.imageAtlas){let eo=e_.imageAtlas.patternPositions[eB.toString()];eo&&eL.setConstantPatternPositions(eo)}let eF=eT.constantOr(null),eO=eM.constantOr(null);if(!eA&&eF&&eO&&e_.lineAtlas){let eo=e_.lineAtlas.getDash(eF,eO);eo&&eL.setConstantPatternPositions(eo)}let[eU,eN]=em.paint.get("line-trim-offset");("round"===eO||"square"===eO)&&eU!==eN&&(0===eU&&(eU-=1),1===eN&&(eN+=1));let eV=ec.terrain?eg.projMatrix:null,ej=eA?$i(ec,e_,em,eV,ew):qi(ec,e_,em,eV,ex.lineClipsArray.length,ew,[eU,eN]);if(eI){let e_=ex.gradients[em.id],ev=e_.texture;if(em.gradientVersion!==e_.version){let eb=256;if(em.stepInterpolant){let em=ed.getSource().maxzoom,e_=eg.canonical.z===em?Math.ceil(1<<ec.transform.maxZoom-eg.canonical.z):1;eb=eo.clamp(eo.nextPowerOfTwo(ex.maxLineLength/eo.EXTENT*1024*e_),256,eP.maxTextureSize)}e_.gradient=eo.renderColorRamp({expression:em.gradientExpression(),evaluationKey:"lineProgress",resolution:eb,image:e_.gradient||void 0,clips:ex.lineClipsArray}),e_.texture?e_.texture.update(e_.gradient):e_.texture=new eo.Texture(eP,e_.gradient,ez.RGBA),e_.version=em.gradientVersion,ev=e_.texture}eP.activeTexture.set(ez.TEXTURE1),ev.bind(em.stepInterpolant?ez.NEAREST:ez.LINEAR,ez.CLAMP_TO_EDGE)}eE&&(eP.activeTexture.set(ez.TEXTURE0),e_.lineAtlasTexture.bind(ez.LINEAR,ez.REPEAT),eL.updatePaintBuffers()),eA&&(eP.activeTexture.set(ez.TEXTURE0),e_.imageAtlasTexture.bind(ez.LINEAR,ez.CLAMP_TO_EDGE),eL.updatePaintBuffers()),ec.prepareDrawProgram(eP,eR,eg.toUnwrapped());let D=ed=>{eR.draw(eP,ez.TRIANGLES,ev,ed,eb,eo.CullFaceMode.disabled,ej,em.id,ex.layoutVertexBuffer,ex.indexBuffer,ex.segments,em.paint,ec.transform.zoom,eL,[ex.layoutVertexBuffer2])};if(ek){let ed=ec.stencilModeForClipping(eg).ref;0===ed&&ec.terrain&&eP.clear({stencil:0});let em={func:ez.EQUAL,mask:255};ej.u_alpha_discard_threshold=.8,D(new eo.StencilMode(em,ed,255,ez.KEEP,ez.KEEP,ez.INVERT)),ej.u_alpha_discard_threshold=0,D(new eo.StencilMode(em,ed,255,ez.KEEP,ez.KEEP,ez.KEEP))}else D(ec.stencilModeForClipping(eg))}ek&&(ec.resetStencilClippingMasks(),ec.terrain&&eP.clear({stencil:0}))},fill:function(ec,ed,em,e_){let eg=em.paint.get("fill-color"),ex=em.paint.get("fill-opacity");if(0===ex.constantOr(1))return;let ev=ec.colorModeForRenderPass(),eb=em.paint.get("fill-pattern"),ew=ec.opaquePassEnabledForLayer()&&!eb.constantOr(1)&&1===eg.constantOr(eo.Color.transparent).a&&1===ex.constantOr(0)?"opaque":"translucent";if(ec.renderPass===ew){let eg=ec.depthModeForSublayer(1,"opaque"===ec.renderPass?eo.DepthMode.ReadWrite:eo.DepthMode.ReadOnly);fo(ec,ed,em,e_,eg,ev,!1)}if("translucent"===ec.renderPass&&em.paint.get("fill-antialias")){let eg=ec.depthModeForSublayer(em.getPaintProperty("fill-outline-color")?2:0,eo.DepthMode.ReadOnly);fo(ec,ed,em,e_,eg,ev,!0)}},"fill-extrusion":function(ec,ed,em,e_){let eg=em.paint.get("fill-extrusion-opacity");if(0!==eg&&"translucent"===ec.renderPass){let ex=new eo.DepthMode(ec.context.gl.LEQUAL,eo.DepthMode.ReadWrite,ec.depthRangeFor3D);if(1!==eg||em.paint.get("fill-extrusion-pattern").constantOr(1))go(ec,ed,em,e_,ex,eo.StencilMode.disabled,eo.ColorMode.disabled),go(ec,ed,em,e_,ex,ec.stencilModeFor3D(),ec.colorModeForRenderPass()),ec.resetStencilClippingMasks();else{let eg=ec.colorModeForRenderPass();go(ec,ed,em,e_,ex,eo.StencilMode.disabled,eg)}}},hillshade:function(ec,ed,em,e_){if("offscreen"!==ec.renderPass&&"translucent"!==ec.renderPass)return;let eg=ec.context,ex=ec.depthModeForSublayer(0,eo.DepthMode.ReadOnly),ev=ec.colorModeForRenderPass(),eb=ec.terrain&&ec.terrain.renderingToTexture,[ew,eT]="translucent"!==ec.renderPass||eb?[{},e_]:ec.stencilConfigForOverlap(e_);for(let e_ of eT){let eg=ed.getTile(e_);if(eg.needsHillshadePrepare&&"offscreen"===ec.renderPass)!function(ec,ed,em,e_,eg,ex){let ev=ec.context,eb=ev.gl;if(!ed.dem)return;let ew=ed.dem;if(ev.activeTexture.set(eb.TEXTURE1),mi(ec,ed,ew),!ed.demTexture)return;ed.demTexture.bind(eb.NEAREST,eb.CLAMP_TO_EDGE);let eT=ew.dim;ev.activeTexture.set(eb.TEXTURE0);let eE=ed.fbo;if(!eE){let ec=new eo.Texture(ev,{width:eT,height:eT,data:null},eb.RGBA);ec.bind(eb.LINEAR,eb.CLAMP_TO_EDGE),(eE=ed.fbo=ev.createFramebuffer(eT,eT,!0)).colorAttachment.set(ec.texture)}ev.bindFramebuffer.set(eE.framebuffer),ev.viewport.set([0,0,eT,eT]);let{tileBoundsBuffer:eM,tileBoundsIndexBuffer:eS,tileBoundsSegments:eA}=ec.getMercatorTileBoundsBuffers();ec.useProgram("hillshadePrepare").draw(ev,eb.TRIANGLES,e_,eg,ex,eo.CullFaceMode.disabled,((ec,ed)=>{let em=ed.stride,e_=eo.create();return eo.ortho(e_,0,eo.EXTENT,-eo.EXTENT,0,0,1),eo.translate(e_,e_,[0,-eo.EXTENT,0]),{u_matrix:e_,u_image:1,u_dimension:[em,em],u_zoom:ec.overscaledZ,u_unpack:ed.unpackVector}})(ed.tileID,ew),em.id,eM,eS,eA),ed.needsHillshadePrepare=!1}(ec,eg,em,ex,eo.StencilMode.disabled,ev);else if("translucent"===ec.renderPass){let ed=eb&&ec.terrain?ec.terrain.stencilModeForRTTOverlap(e_):ew[e_.overscaledZ];!function(ec,ed,em,e_,eg,ex,ev){let eb=ec.context,ew=eb.gl,eT=em.fbo;if(!eT)return;ec.prepareDrawTile();let eE=ec.useProgram("hillshade");eb.activeTexture.set(ew.TEXTURE0),ew.bindTexture(ew.TEXTURE_2D,eT.colorAttachment.get());let eM=((ec,ed,em,e_)=>{let eg=em.paint.get("hillshade-shadow-color"),ex=em.paint.get("hillshade-highlight-color"),ev=em.paint.get("hillshade-accent-color"),eb=em.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===em.paint.get("hillshade-illumination-anchor")&&(eb-=ec.transform.angle);let ew=!ec.options.moving;return{u_matrix:e_||ec.transform.calculateProjMatrix(ed.tileID.toUnwrapped(),ew),u_image:0,u_latrange:function(ec,ed){let em=Math.pow(2,ed.canonical.z),e_=ed.canonical.y;return[new eo.MercatorCoordinate(0,e_/em).toLngLat().lat,new eo.MercatorCoordinate(0,(e_+1)/em).toLngLat().lat]}(0,ed.tileID),u_light:[em.paint.get("hillshade-exaggeration"),eb],u_shadow:eg,u_highlight:ex,u_accent:ev}})(ec,em,e_,ec.terrain?ed.projMatrix:null);ec.prepareDrawProgram(eb,eE,ed.toUnwrapped());let{tileBoundsBuffer:eS,tileBoundsIndexBuffer:eA,tileBoundsSegments:eI}=ec.getTileBoundsBuffers(em);eE.draw(eb,ew.TRIANGLES,eg,ex,ev,eo.CullFaceMode.disabled,eM,e_.id,eS,eA,eI)}(ec,e_,eg,em,ex,ed,ev)}}eg.viewport.set([0,0,ec.width,ec.height]),ec.resetStencilClippingMasks()},raster:function(ec,ed,em,e_,eg,ex){if("translucent"!==ec.renderPass||0===em.paint.get("raster-opacity")||!e_.length)return;let ev=ec.context,eb=ev.gl,ew=ed.getSource(),eT=ec.useProgram("raster"),eE=ec.colorModeForRenderPass(),eM=ec.terrain&&ec.terrain.renderingToTexture,[eS,eA]=ew instanceof Pe||eM?[{},e_]:ec.stencilConfigForOverlap(e_),eI=eA[eA.length-1].overscaledZ,eC=!ec.options.moving;for(let e_ of eA){let eg,eA;let eP=eM?eo.DepthMode.disabled:ec.depthModeForSublayer(e_.overscaledZ-eI,1===em.paint.get("raster-opacity")?eo.DepthMode.ReadWrite:eo.DepthMode.ReadOnly,eb.LESS),ez=e_.toUnwrapped(),eD=ed.getTile(e_);if(eM&&(!eD||!eD.hasData()))continue;let ek=eM?e_.projMatrix:ec.transform.calculateProjMatrix(ez,eC),eL=ec.terrain&&eM?ec.terrain.stencilModeForRTTOverlap(e_):eS[e_.overscaledZ],eR=ex?0:em.paint.get("raster-fade-duration");eD.registerFadeDuration(eR);let eB=ed.findLoadedParent(e_,0),eF=Mi(eD,eB,ed,ec.transform,eR);ec.terrain&&ec.terrain.prepareDrawTile();let eO="nearest"===em.paint.get("raster-resampling")?eb.NEAREST:eb.LINEAR;ev.activeTexture.set(eb.TEXTURE0),eD.texture.bind(eO,eb.CLAMP_TO_EDGE),ev.activeTexture.set(eb.TEXTURE1),eB?(eB.texture.bind(eO,eb.CLAMP_TO_EDGE),eg=Math.pow(2,eB.tileID.overscaledZ-eD.tileID.overscaledZ),eA=[eD.tileID.canonical.x*eg%1,eD.tileID.canonical.y*eg%1]):eD.texture.bind(eO,eb.CLAMP_TO_EDGE),eD.texture.useMipmap&&ev.extTextureFilterAnisotropic&&ec.transform.pitch>20&&eb.texParameterf(eb.TEXTURE_2D,ev.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ev.extTextureFilterAnisotropicMax);let eU=Ji(ek,eA||[0,0],eg||1,eF,em,ew instanceof Pe?ew.perspectiveTransform:[0,0]);if(ec.prepareDrawProgram(ev,eT,ez),ew instanceof Pe)ew.boundsBuffer&&ew.boundsSegments&&eT.draw(ev,eb.TRIANGLES,eP,eo.StencilMode.disabled,eE,eo.CullFaceMode.disabled,eU,em.id,ew.boundsBuffer,ec.quadTriangleIndexBuffer,ew.boundsSegments);else{let{tileBoundsBuffer:ed,tileBoundsIndexBuffer:e_,tileBoundsSegments:eg}=ec.getTileBoundsBuffers(eD);eT.draw(ev,eb.TRIANGLES,eP,eL,eE,eo.CullFaceMode.disabled,eU,em.id,ed,e_,eg)}}ec.resetStencilClippingMasks()},background:function(ec,ed,em,e_){let eg=em.paint.get("background-color"),ex=em.paint.get("background-opacity");if(0===ex)return;let ev=ec.context,eb=ev.gl,ew=ec.transform,eT=ew.tileSize,eE=em.paint.get("background-pattern");if(ec.isPatternMissing(eE))return;let eM=!eE&&1===eg.a&&1===ex&&ec.opaquePassEnabledForLayer()?"opaque":"translucent";if(ec.renderPass!==eM)return;let eS=eo.StencilMode.disabled,eA=ec.depthModeForSublayer(0,"opaque"===eM?eo.DepthMode.ReadWrite:eo.DepthMode.ReadOnly),eI=ec.colorModeForRenderPass(),eC=ec.useProgram(eE?"backgroundPattern":"background"),eP,ez=e_;for(let eM of(ez||(ez=Object.values(eP=ec.getBackgroundTiles()).map(eo=>eo.tileID)),eE&&(ev.activeTexture.set(eb.TEXTURE0),ec.imageManager.bind(ec.context)),ez)){let ez=eM.toUnwrapped(),eD=e_?eM.projMatrix:ec.transform.calculateProjMatrix(ez);ec.prepareDrawTile();let ek=ed?ed.getTile(eM):eP?eP[eM.key]:new eo.Tile(eM,eT,ew.zoom,ec),eL=eE?no(eD,ex,ec,eE,{tileID:eM,tileSize:eT}):ro(eD,ex,eg);ec.prepareDrawProgram(ev,eC,ez);let{tileBoundsBuffer:eR,tileBoundsIndexBuffer:eB,tileBoundsSegments:eF}=ec.getTileBoundsBuffers(ek);eC.draw(ev,eb.TRIANGLES,eA,eS,eI,eo.CullFaceMode.disabled,eL,em.id,eR,eB,eF)}},sky:function(ec,ed,em){let e_=ec.transform,eg="mercator"===e_.projection.name||"globe"===e_.projection.name?1:eo.smoothstep(7,8,e_.zoom),ex=em.paint.get("sky-opacity")*eg;if(0===ex)return;let ev=ec.context,eb=em.paint.get("sky-type"),ew=new eo.DepthMode(ev.gl.LEQUAL,eo.DepthMode.ReadOnly,[0,1]),eT=ec.frameCounter/1e3%1;"atmosphere"===eb?"offscreen"===ec.renderPass?em.needsSkyboxCapture(ec)&&(function(ec,ed,em,e_){let eg=ec.context,ex=eg.gl,ev=ed.skyboxFbo;if(!ev){ev=ed.skyboxFbo=eg.createFramebuffer(32,32,!1),ed.skyboxGeometry=new Lo(eg),ed.skyboxTexture=eg.gl.createTexture(),ex.bindTexture(ex.TEXTURE_CUBE_MAP,ed.skyboxTexture),ex.texParameteri(ex.TEXTURE_CUBE_MAP,ex.TEXTURE_WRAP_S,ex.CLAMP_TO_EDGE),ex.texParameteri(ex.TEXTURE_CUBE_MAP,ex.TEXTURE_WRAP_T,ex.CLAMP_TO_EDGE),ex.texParameteri(ex.TEXTURE_CUBE_MAP,ex.TEXTURE_MIN_FILTER,ex.LINEAR),ex.texParameteri(ex.TEXTURE_CUBE_MAP,ex.TEXTURE_MAG_FILTER,ex.LINEAR);for(let eo=0;eo<6;++eo)ex.texImage2D(ex.TEXTURE_CUBE_MAP_POSITIVE_X+eo,0,ex.RGBA,32,32,0,ex.RGBA,ex.UNSIGNED_BYTE,null)}eg.bindFramebuffer.set(ev.framebuffer),eg.viewport.set([0,0,32,32]);let eb=ed.getCenter(ec,!0),ew=ec.useProgram("skyboxCapture"),eT=new Float64Array(16);eo.identity(eT),eo.rotateY(eT,eT,-(.5*Math.PI)),Ao(eg,ed,ew,eT,eb,0),eo.identity(eT),eo.rotateY(eT,eT,.5*Math.PI),Ao(eg,ed,ew,eT,eb,1),eo.identity(eT),eo.rotateX(eT,eT,-(.5*Math.PI)),Ao(eg,ed,ew,eT,eb,2),eo.identity(eT),eo.rotateX(eT,eT,.5*Math.PI),Ao(eg,ed,ew,eT,eb,3),eo.identity(eT),Ao(eg,ed,ew,eT,eb,4),eo.identity(eT),eo.rotateY(eT,eT,Math.PI),Ao(eg,ed,ew,eT,eb,5),eg.viewport.set([0,0,ec.width,ec.height])}(ec,em),em.markSkyboxValid(ec)):"sky"===ec.renderPass&&function(ec,ed,em,e_,eg){let ex=ec.context,ev=ex.gl,eb=ec.transform,ew=ec.useProgram("skybox");ex.activeTexture.set(ev.TEXTURE0),ev.bindTexture(ev.TEXTURE_CUBE_MAP,ed.skyboxTexture);let eT={u_matrix:eb.skyboxMatrix,u_sun_direction:ed.getCenter(ec,!1),u_cubemap:0,u_opacity:e_,u_temporal_offset:eg};ec.prepareDrawProgram(ex,ew),ew.draw(ex,ev.TRIANGLES,em,eo.StencilMode.disabled,ec.colorModeForRenderPass(),eo.CullFaceMode.backCW,eT,"skybox",ed.skyboxGeometry.vertexBuffer,ed.skyboxGeometry.indexBuffer,ed.skyboxGeometry.segment)}(ec,em,ew,ex,eT):"gradient"===eb&&"sky"===ec.renderPass&&function(ec,ed,em,e_,eg){var ex,ev,eb;let ew=ec.context,eT=ew.gl,eE=ec.transform,eM=ec.useProgram("skyboxGradient");ed.skyboxGeometry||(ed.skyboxGeometry=new Lo(ew)),ew.activeTexture.set(eT.TEXTURE0);let eS=ed.colorRampTexture;eS||(eS=ed.colorRampTexture=new eo.Texture(ew,ed.colorRamp,eT.RGBA)),eS.bind(eT.LINEAR,eT.CLAMP_TO_EDGE);let eA=(ex=eE.skyboxMatrix,ev=ed.getCenter(ec,!1),eb=ed.paint.get("sky-gradient-radius"),{u_matrix:ex,u_color_ramp:0,u_center_direction:ev,u_radius:eo.degToRad(eb),u_opacity:e_,u_temporal_offset:eg});ec.prepareDrawProgram(ew,eM),eM.draw(ew,eT.TRIANGLES,em,eo.StencilMode.disabled,ec.colorModeForRenderPass(),eo.CullFaceMode.backCW,eA,"skyboxGradient",ed.skyboxGeometry.vertexBuffer,ed.skyboxGeometry.indexBuffer,ed.skyboxGeometry.segment)}(ec,em,ew,ex,eT)},debug:function(ec,ed,em){for(let e_=0;e_<em.length;e_++)!function(ec,ed,em){let e_=ec.context,eg=ec.transform,ex=e_.gl,ev="globe"===eg.projection.name,eb=em.projMatrix;if(ev&&eo.globeToMercatorTransition(eg.zoom)>0){let ec=eo.transitionTileAABBinECEF(em.canonical,eg),ed=eo.globeDenormalizeECEF(ec);eb=eo.multiply(new Float32Array(16),eg.globeMatrix,ed),eo.multiply(eb,eg.projMatrix,eb)}let ew=ec.useProgram("debug",null,ev?["PROJECTION_GLOBE_VIEW"]:null),eT=ed.getTileByID(em.key);ec.terrain&&ec.terrain.setupElevationDraw(eT,ew);let eE=eo.DepthMode.disabled,eM=eo.StencilMode.disabled,eS=ec.colorModeForRenderPass(),eA="$debug";e_.activeTexture.set(ex.TEXTURE0),ec.emptyTexture.bind(ex.LINEAR,ex.CLAMP_TO_EDGE),ev?eT._makeGlobeTileDebugBuffers(ec.context,eg):eT._makeDebugTileBoundsBuffers(ec.context,eg.projection);let eI=eT._tileDebugBuffer||ec.debugBuffer,eC=eT._tileDebugIndexBuffer||ec.debugIndexBuffer,eP=eT._tileDebugSegments||ec.debugSegments;ew.draw(e_,ex.LINE_STRIP,eE,eM,eS,eo.CullFaceMode.disabled,Vi(eb,eo.Color.red),eA,eI,eC,eP,null,null,null,[eT._globeTileDebugBorderBuffer]);let ez=eT.latestRawTileData,eD=Math.floor((ez&&ez.byteLength||0)/1024),ek=ed.getTile(em).tileSize,eL=512/Math.min(ek,512)*(em.overscaledZ/eg.zoom)*.5,eR=em.canonical.toString();em.overscaledZ!==em.canonical.z&&(eR+=` => ${em.overscaledZ}`),function(eo,ec){eo.initDebugOverlayCanvas();let ed=eo.debugOverlayCanvas,em=eo.context.gl,e_=eo.debugOverlayCanvas.getContext("2d");e_.clearRect(0,0,ed.width,ed.height),e_.shadowColor="white",e_.shadowBlur=2,e_.lineWidth=1.5,e_.strokeStyle="white",e_.textBaseline="top",e_.font="bold 36px Open Sans, sans-serif",e_.fillText(ec,5,5),e_.strokeText(ec,5,5),eo.debugOverlayTexture.update(ed),eo.debugOverlayTexture.bind(em.LINEAR,em.CLAMP_TO_EDGE)}(ec,eR+=` ${eD}kb`);let eB=eT._tileDebugTextBuffer||ec.debugBuffer,eF=eT._tileDebugTextIndexBuffer||ec.quadTriangleIndexBuffer,eO=eT._tileDebugTextSegments||ec.debugSegments;ew.draw(e_,ex.TRIANGLES,eE,eM,eo.ColorMode.alphaBlended,eo.CullFaceMode.disabled,Vi(eb,eo.Color.transparent,eL),eA,eB,eF,eO,null,null,null,[eT._globeTileDebugTextBuffer])}(ec,ed,em[e_])},custom:function(ec,ed,em,e_){let eg=ec.context,ex=em.implementation;if(!ec.transform.projection.unsupportedLayers||!ec.transform.projection.unsupportedLayers.includes("custom")||ec.terrain&&(ec.terrain.renderingToTexture||"offscreen"===ec.renderPass)&&em.isLayerDraped()){if("offscreen"===ec.renderPass){let ed=ex.prerender;if(ed){if(ec.setCustomLayerDefaults(),eg.setColorMode(ec.colorModeForRenderPass()),"globe"===ec.transform.projection.name){let em=ec.transform.pointMerc;ed.call(ex,eg.gl,ec.transform.customLayerMatrix(),ec.transform.getProjection(),ec.transform.globeToMercatorMatrix(),eo.globeToMercatorTransition(ec.transform.zoom),[em.x,em.y],ec.transform.pixelsPerMeterRatio)}else ed.call(ex,eg.gl,ec.transform.customLayerMatrix());eg.setDirty(),ec.setBaseState()}}else if("translucent"===ec.renderPass){if(ec.terrain&&ec.terrain.renderingToTexture){let ed=ex.renderToTile;if(ed){let em=e_[0].canonical,ev=new eo.MercatorCoordinate(em.x+e_[0].wrap*(1<<em.z),em.y,em.z);eg.setDepthMode(eo.DepthMode.disabled),eg.setStencilMode(eo.StencilMode.disabled),eg.setColorMode(ec.colorModeForRenderPass()),ec.setCustomLayerDefaults(),ed.call(ex,eg.gl,ev),eg.setDirty(),ec.setBaseState()}return}ec.setCustomLayerDefaults(),eg.setColorMode(ec.colorModeForRenderPass()),eg.setStencilMode(eo.StencilMode.disabled);let ed="3d"===ex.renderingMode?new eo.DepthMode(ec.context.gl.LEQUAL,eo.DepthMode.ReadWrite,ec.depthRangeFor3D):ec.depthModeForSublayer(0,eo.DepthMode.ReadOnly);if(eg.setDepthMode(ed),"globe"===ec.transform.projection.name){let ed=ec.transform.pointMerc;ex.render(eg.gl,ec.transform.customLayerMatrix(),ec.transform.getProjection(),ec.transform.globeToMercatorMatrix(),eo.globeToMercatorTransition(ec.transform.zoom),[ed.x,ed.y],ec.transform.pixelsPerMeterRatio)}else ex.render(eg.gl,ec.transform.customLayerMatrix());eg.setDirty(),ec.setBaseState(),eg.bindFramebuffer.set(null)}}else eo.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};let Bo=class Bo{constructor(ec,ed,em=!1){this.context=new Ee(ec,em),this.transform=ed,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=eo.SourceCache.maxUnderzooming+eo.SourceCache.maxOverzooming+1,this.depthEpsilon=1/65536,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(eo,ec){let ed=!!eo&&!!eo.terrain&&this.transform.projection.supportsTerrain;if(!(ed||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Di(this,eo));let em=this._terrain;this.transform.elevation=ed?em:null,em.update(eo,this.transform,ec)}_updateFog(eo){let ec=eo.fog;if(!ec||"globe"===this.transform.projection.name||1>ec.getOpacity(this.transform.pitch)||.03>ec.properties.get("horizon-blend"))return void(this.transform.fogCullDistSq=null);let[ed,em]=ec.getFovAdjustedRange(this.transform._fov);if(ed>em)return void(this.transform.fogCullDistSq=null);let e_=ed+.78*(em-ed);this.transform.fogCullDistSq=e_*e_}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(ec,ed){if(this.width=ec*eo.exported.devicePixelRatio,this.height=ed*eo.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let eo of this.style.order)this.style._layers[eo].resize()}setup(){let ec=this.context,ed=new eo.StructArrayLayout2i4;ed.emplaceBack(0,0),ed.emplaceBack(eo.EXTENT,0),ed.emplaceBack(0,eo.EXTENT),ed.emplaceBack(eo.EXTENT,eo.EXTENT),this.tileExtentBuffer=ec.createVertexBuffer(ed,eo.posAttributes.members),this.tileExtentSegments=eo.SegmentVector.simpleSegment(0,0,4,2);let em=new eo.StructArrayLayout2i4;em.emplaceBack(0,0),em.emplaceBack(eo.EXTENT,0),em.emplaceBack(0,eo.EXTENT),em.emplaceBack(eo.EXTENT,eo.EXTENT),this.debugBuffer=ec.createVertexBuffer(em,eo.posAttributes.members),this.debugSegments=eo.SegmentVector.simpleSegment(0,0,4,5);let e_=new eo.StructArrayLayout2i4;e_.emplaceBack(-1,-1),e_.emplaceBack(1,-1),e_.emplaceBack(-1,1),e_.emplaceBack(1,1),this.viewportBuffer=ec.createVertexBuffer(e_,eo.posAttributes.members),this.viewportSegments=eo.SegmentVector.simpleSegment(0,0,4,2);let eg=new eo.StructArrayLayout4i8;eg.emplaceBack(0,0,0,0),eg.emplaceBack(eo.EXTENT,0,eo.EXTENT,0),eg.emplaceBack(0,eo.EXTENT,0,eo.EXTENT),eg.emplaceBack(eo.EXTENT,eo.EXTENT,eo.EXTENT,eo.EXTENT),this.mercatorBoundsBuffer=ec.createVertexBuffer(eg,eo.boundsAttributes.members),this.mercatorBoundsSegments=eo.SegmentVector.simpleSegment(0,0,4,2);let ex=new eo.StructArrayLayout3ui6;ex.emplaceBack(0,1,2),ex.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=ec.createIndexBuffer(ex);let ev=new eo.StructArrayLayout1ui2;for(let eo of[0,1,3,2,0])ev.emplaceBack(eo);this.debugIndexBuffer=ec.createIndexBuffer(ev),this.emptyTexture=new eo.Texture(ec,new eo.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),ec.gl.RGBA),this.identityMat=eo.create();let eb=this.context.gl;this.stencilClearMode=new eo.StencilMode({func:eb.ALWAYS,mask:0},0,255,eb.ZERO,eb.ZERO,eb.ZERO),this.loadTimeStamps.push(eo.window.performance.now()),this.atmosphereBuffer=new Ro(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(eo){return eo._makeTileBoundsBuffers(this.context,this.transform.projection),eo._tileBoundsBuffer?{tileBoundsBuffer:eo._tileBoundsBuffer,tileBoundsIndexBuffer:eo._tileBoundsIndexBuffer,tileBoundsSegments:eo._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let ec=this.context,ed=ec.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(ec,ed.TRIANGLES,eo.DepthMode.disabled,this.stencilClearMode,eo.ColorMode.disabled,eo.CullFaceMode.disabled,Ci(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(ec,ed,em){if(!ed||this.currentStencilSource===ed.id||!ec.isTileClipped()||!em||0===em.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let eo=!1;for(let ec of em)if(void 0===this._tileClippingMaskIDs[ec.key]){eo=!0;break}if(!eo)return}this.currentStencilSource=ed.id;let e_=this.context,eg=e_.gl;this.nextStencilID+em.length>256&&this.clearStencil(),e_.setColorMode(eo.ColorMode.disabled),e_.setDepthMode(eo.DepthMode.disabled);let ex=this.useProgram("clippingMask");for(let ec of(this._tileClippingMaskIDs={},em)){let em=ed.getTile(ec),ev=this._tileClippingMaskIDs[ec.key]=this.nextStencilID++,{tileBoundsBuffer:eb,tileBoundsIndexBuffer:ew,tileBoundsSegments:eT}=this.getTileBoundsBuffers(em);ex.draw(e_,eg.TRIANGLES,eo.DepthMode.disabled,new eo.StencilMode({func:eg.ALWAYS,mask:0},ev,255,eg.KEEP,eg.KEEP,eg.REPLACE),eo.ColorMode.disabled,eo.CullFaceMode.disabled,Ci(ec.projMatrix),"$clipping",eb,ew,eT)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let ec=this.nextStencilID++,ed=this.context.gl;return new eo.StencilMode({func:ed.NOTEQUAL,mask:255},ec,255,ed.KEEP,ed.KEEP,ed.REPLACE)}stencilModeForClipping(ec){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(ec);let ed=this.context.gl;return new eo.StencilMode({func:ed.EQUAL,mask:255},this._tileClippingMaskIDs[ec.key],0,ed.KEEP,ed.KEEP,ed.REPLACE)}stencilConfigForOverlap(ec){let ed=this.context.gl,em=ec.sort((eo,ec)=>ec.overscaledZ-eo.overscaledZ),e_=em[em.length-1].overscaledZ,eg=em[0].overscaledZ-e_+1;if(eg>1){this.currentStencilSource=void 0,this.nextStencilID+eg>256&&this.clearStencil();let ec={};for(let em=0;em<eg;em++)ec[em+e_]=new eo.StencilMode({func:ed.GEQUAL,mask:255},em+this.nextStencilID,255,ed.KEEP,ed.KEEP,ed.REPLACE);return this.nextStencilID+=eg,[ec,em]}return[{[e_]:eo.StencilMode.disabled},em]}colorModeForRenderPass(){let ec=this.context.gl;if(this._showOverdrawInspector){let ed=1/8;return new eo.ColorMode([ec.CONSTANT_COLOR,ec.ONE],new eo.Color(ed,ed,ed,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?eo.ColorMode.unblended:eo.ColorMode.alphaBlended}depthModeForSublayer(ec,ed,em){if(!this.opaquePassEnabledForLayer())return eo.DepthMode.disabled;let e_=1-((1+this.currentLayer)*this.numSublayers+ec)*this.depthEpsilon;return new eo.DepthMode(em||this.context.gl.LEQUAL,ed,[e_,e_])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(ec,ed){this.style=ec,this.options=ed,this.imageManager=ec.imageManager,this.glyphManager=ec.glyphManager,this.symbolFadeChange=ec.placement.symbolFadeChange(eo.exported.now()),this.imageManager.beginFrame();let em=this.style.order,e_=this.style._sourceCaches;for(let eo in e_){let ec=e_[eo];ec.used&&ec.prepare(this.context)}let eg={},ex={},ev={};for(let eo in e_){let ec=e_[eo];eg[eo]=ec.getVisibleCoordinates(),ex[eo]=eg[eo].slice().reverse(),ev[eo]=ec.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let eo=0;eo<em.length;eo++)if(this.style._layers[em[eo]].is3D()){this.opaquePassCutoff=eo;break}if(this.terrain&&(this.terrain.updateTileBinding(ev),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new eo.GlobeSharedBuffers(this.context)),!eo.isMapAuthenticated(this.context.gl))return;for(let eo of(this.renderPass="offscreen",em)){let ed=this.style._layers[eo],em=ec._getLayerSourceCache(ed);if(!ed.hasOffscreenPass()||ed.isHidden(this.transform.zoom))continue;let e_=em?ex[em.id]:void 0;("custom"===ed.type||ed.isSky()||e_&&e_.length)&&this.renderLayer(this,em,ed,e_)}this.depthRangeFor3D=[0,1-(ec.order.length+2)*this.numSublayers*this.depthEpsilon];let eb=this.terrain;if(eb&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&eb.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:ed.showOverdrawInspector?eo.Color.black:eo.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=ed.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=em.length-1;this.currentLayer>=0;this.currentLayer--){let eo=this.style._layers[em[this.currentLayer]],ed=ec._getLayerSourceCache(eo);if(eo.isSky())continue;let e_=ed?ex[ed.id]:void 0;this._renderTileClippingMasks(eo,ed,e_),this.renderLayer(this,ed,eo,e_)}if(this.style.fog&&this.transform.projection.supportsFog&&function(ec,ed){var em,e_,eg;let ex=ec.context,ev=ex.gl,eb=ec.transform,ew=new eo.DepthMode(ev.LEQUAL,eo.DepthMode.ReadOnly,[0,1]),eT=ec.useProgram("globeAtmosphere",null,"globe"===eb.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),eE=eo.globeToMercatorTransition(eb.zoom),eM=ed.properties.get("color").toArray01(),eS=ed.properties.get("high-color").toArray01(),eA=ed.properties.get("space-color").toArray01PremultipliedAlpha(),eI=eo.identity$1([]);eo.rotateY$1(eI,eI,-eo.degToRad(eb._center.lng)),eo.rotateX$1(eI,eI,eo.degToRad(eb._center.lat)),eo.rotateZ$1(eI,eI,eb.angle),eo.rotateX$1(eI,eI,-eb._pitch);let eC=eo.fromQuat(new Float32Array(16),eI),eP=eo.mapValue(ed.properties.get("star-intensity"),0,1,0,.25),ez=eo.mapValue(ed.properties.get("horizon-blend"),0,1,5e-4,.25),eD=eo.globeUseCustomAntiAliasing(ec,ex,eb)&&5e-4===ez?eb.worldSize/(2*Math.PI*1.025)-1:eb.globeRadius,ek=ec.frameCounter/1e3%1,eL=eo.length(eb.globeCenterInViewSpace),eR=Math.sqrt(Math.pow(eL,2)-Math.pow(eD,2)),eB=Math.acos(eR/eL),eF=(em=eb.frustumCorners.TL,e_=eb.frustumCorners.TR,eg=eb.frustumCorners.BR,{u_frustum_tl:em,u_frustum_tr:e_,u_frustum_br:eg,u_frustum_bl:eb.frustumCorners.BL,u_horizon:eb.frustumCorners.horizon,u_transition:eE,u_fadeout_range:ez,u_color:eM,u_high_color:eS,u_space_color:eA,u_star_intensity:eP,u_star_size:5*eo.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:ek,u_horizon_angle:eB,u_rotation_matrix:eC});ec.prepareDrawProgram(ex,eT);let eO=ec.atmosphereBuffer;eO&&eT.draw(ex,ev.TRIANGLES,ew,eo.StencilMode.disabled,eo.ColorMode.alphaBlended,eo.CullFaceMode.backCW,eF,"skybox",eO.vertexBuffer,eO.indexBuffer,eO.segments)}(this,this.style.fog),this.renderPass="sky",(eo.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<em.length;this.currentLayer++){let eo=this.style._layers[em[this.currentLayer]],ed=ec._getLayerSourceCache(eo);eo.isSky()&&this.renderLayer(this,ed,eo,ed?ex[ed.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<em.length;){let eo=this.style._layers[em[this.currentLayer]],ed=ec._getLayerSourceCache(eo);if(eo.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(eo)){if(eo.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}let e_=ed?("symbol"===eo.type?ev:ex)[ed.id]:void 0;this._renderTileClippingMasks(eo,ed,ed?eg[ed.id]:void 0),this.renderLayer(this,ed,eo,e_),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ed=null;eo.values(this.style._layers).forEach(eo=>{let em=ec._getLayerSourceCache(eo);em&&!eo.isHidden(this.transform.zoom)&&(!ed||ed.getSource().maxzoom<em.getSource().maxzoom)&&(ed=em)}),ed&&this.options.showTileBoundaries&&ts.debug(this,ed,ed.getVisibleCoordinates())}this.options.showPadding&&function(eo){var ec,ed;let em=eo.transform.padding;Co(eo,eo.transform.height-(em.top||0),3,e3),Co(eo,em.bottom||0,3,e5),Mo(eo,em.left||0,3,e4),Mo(eo,eo.transform.width-(em.right||0),3,e6);let e_=eo.transform.centerPoint;ec=e_.x,ed=eo.transform.height-e_.y,Io(eo,ec-1,ed-10,2,20,e8),Io(eo,ec-10,ed-1,20,2,e8)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(eo.window.performance.now()),this.saveCanvasCopy())}renderLayer(eo,ec,ed,em){ed.isHidden(this.transform.zoom)||("background"===ed.type||"sky"===ed.type||"custom"===ed.type||em&&em.length)&&(this.id=ed.id,this.gpuTimingStart(ed),eo.transform.projection.unsupportedLayers&&eo.transform.projection.unsupportedLayers.includes(ed.type)&&(!eo.terrain||"custom"!==ed.type)||ts[ed.type](eo,ec,ed,em,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(eo){if(!this.options.gpuTiming)return;let ec=this.context.extTimerQuery,ed=this.gpuTimers[eo.id];ed||(ed=this.gpuTimers[eo.id]={calls:0,cpuTime:0,query:ec.createQueryEXT()}),ed.calls++,ec.beginQueryEXT(ec.TIME_ELAPSED_EXT,ed.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let eo=this.context.extTimerQuery,ec=eo.createQueryEXT();this.deferredRenderGpuTimeQueries.push(ec),eo.beginQueryEXT(eo.TIME_ELAPSED_EXT,ec)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;let eo=this.context.extTimerQuery;eo.endQueryEXT(eo.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;let eo=this.context.extTimerQuery;eo.endQueryEXT(eo.TIME_ELAPSED_EXT)}collectGpuTimers(){let eo=this.gpuTimers;return this.gpuTimers={},eo}collectDeferredRenderGpuQueries(){let eo=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],eo}queryGpuTimers(eo){let ec={};for(let ed in eo){let em=eo[ed],e_=this.context.extTimerQuery,eg=e_.getQueryObjectEXT(em.query,e_.QUERY_RESULT_EXT)/1e6;e_.deleteQueryEXT(em.query),ec[ed]=eg}return ec}queryGpuTimeDeferredRender(eo){if(!this.options.gpuTimingDeferredRender)return 0;let ec=this.context.extTimerQuery,ed=0;for(let em of eo)ed+=ec.getQueryObjectEXT(em,ec.QUERY_RESULT_EXT)/1e6,ec.deleteQueryEXT(em);return ed}translatePosMatrix(ec,ed,em,e_,eg){if(!em[0]&&!em[1])return ec;let ex=eg?"map"===e_?this.transform.angle:0:"viewport"===e_?-this.transform.angle:0;if(ex){let eo=Math.sin(ex),ec=Math.cos(ex);em=[em[0]*ec-em[1]*eo,em[0]*eo+em[1]*ec]}let ev=[eg?em[0]:D(ed,em[0],this.transform.zoom),eg?em[1]:D(ed,em[1],this.transform.zoom),0],eb=new Float32Array(16);return eo.translate(eb,ec,ev),eb}saveTileTexture(eo){let ec=this._tileTextures[eo.size[0]];ec?ec.push(eo):this._tileTextures[eo.size[0]]=[eo]}getTileTexture(eo){let ec=this._tileTextures[eo];return ec&&ec.length>0?ec.pop():null}isPatternMissing(eo){return null===eo||void 0!==eo&&!this.imageManager.getPattern(eo.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){let eo=this.terrain&&this.terrain.renderingToTexture,ec=this.terrain&&0===this.terrain.exaggeration(),ed=this.style&&this.style.fog,em=[];return this.terrainRenderModeElevated()&&em.push("TERRAIN"),"globe"===this.transform.projection.name&&em.push("GLOBE"),ec&&em.push("ZERO_EXAGGERATION"),ed&&!eo&&0!==ed.getOpacity(this.transform.pitch)&&em.push("FOG"),eo&&em.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&em.push("OVERDRAW_INSPECTOR"),em}useProgram(eo,ec,ed){this.cache=this.cache||{};let em=this.currentGlobalDefines().concat(ed||[]),e_=Li.cacheKey(eW[eo],eo,em,ec);return this.cache[e_]||(this.cache[e_]=new Li(this.context,eo,eW[eo],ec,e1[eo],em)),this.cache[e_]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let eo=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(eo.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=eo.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new eo.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(ec,ed,em){if(this.terrain&&this.terrain.renderingToTexture)return;let e_=this.style.fog;if(e_){let eg=e_.getOpacity(this.transform.pitch),ex=((ec,ed,em,e_,eg,ex,ev,eb,ew,eT,eE)=>{let eM=ec.transform,eS=ed.properties.get("color").toArray01();eS[3]=e_;let eA=ec.frameCounter/1e3%1;return{u_fog_matrix:em?eM.calculateFogTileMatrix(em):ec.identityMat,u_fog_range:ed.getFovAdjustedRange(eM._fov),u_fog_color:eS,u_fog_horizon_blend:ed.properties.get("horizon-blend"),u_fog_temporal_offset:eA,u_frustum_tl:eg,u_frustum_tr:ex,u_frustum_br:ev,u_frustum_bl:eb,u_globe_pos:ew,u_globe_radius:eT,u_viewport:eE,u_globe_transition:eo.globeToMercatorTransition(eM.zoom),u_is_globe:+("globe"===eM.projection.name)}})(this,e_,em,eg,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*eo.exported.devicePixelRatio,this.transform.height*eo.exported.devicePixelRatio]);ed.setFogUniformValues(ec,ex)}}setTileLoadedFlag(eo){this.tileLoaded=eo}saveCanvasCopy(){let eo=this.canvasCopy();eo&&(this.frameCopies.push(eo),this.tileLoaded=!1)}canvasCopy(){let eo=this.context.gl,ec=eo.createTexture();return eo.bindTexture(eo.TEXTURE_2D,ec),eo.copyTexImage2D(eo.TEXTURE_2D,0,eo.RGBA,0,0,eo.drawingBufferWidth,eo.drawingBufferHeight,0),ec}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let eo=this.style&&this.style.fog;return!!eo&&0!==eo.getOpacity(this.transform.pitch)}getBackgroundTiles(){let ec=this._backgroundTiles,ed=this._backgroundTiles={},em=this.transform.coveringTiles({tileSize:512});for(let e_ of em)ed[e_.key]=ec[e_.key]||new eo.Tile(e_,512,this.transform.tileZoom,this);return ed}clearBackgroundTiles(){this._backgroundTiles={}}};let ko=class ko{constructor(eo=0,ec=0,ed=0,em=0){if(isNaN(eo)||eo<0||isNaN(ec)||ec<0||isNaN(ed)||ed<0||isNaN(em)||em<0)throw Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=eo,this.bottom=ec,this.left=ed,this.right=em}interpolate(ec,ed,em){return null!=ed.top&&null!=ec.top&&(this.top=eo.number(ec.top,ed.top,em)),null!=ed.bottom&&null!=ec.bottom&&(this.bottom=eo.number(ec.bottom,ed.bottom,em)),null!=ed.left&&null!=ec.left&&(this.left=eo.number(ec.left,ed.left,em)),null!=ed.right&&null!=ec.right&&(this.right=eo.number(ec.right,ed.right,em)),this}getCenter(ec,ed){let em=eo.clamp((this.left+ec-this.right)/2,0,ec),e_=eo.clamp((this.top+ed-this.bottom)/2,0,ed);return new eo.Point(em,e_)}equals(eo){return this.top===eo.top&&this.bottom===eo.bottom&&this.left===eo.left&&this.right===eo.right}clone(){return new ko(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}};function Fo(ec,ed){let em=eo.getColumn(ec,3);eo.fromQuat(ec,ed),eo.setColumn(ec,3,em)}function Uo(ec,ed){let em=eo.identity$1([]);return eo.rotateZ$1(em,em,-ed),eo.rotateX$1(em,em,-ec),em}function No(ec,ed){let em=[ec[0],ec[1],0],e_=[ed[0],ed[1],0];if(eo.length(em)>=1e-15){let ec=eo.normalize([],em);eo.scale$2(e_,ec,eo.dot(e_,ec)),ed[0]=e_[0],ed[1]=e_[1]}let eg=eo.cross([],ed,ec);if(1e-15>eo.len(eg))return null;let ex=Math.atan2(-eg[1],eg[0]);return Uo(Math.atan2(Math.sqrt(ec[0]*ec[0]+ec[1]*ec[1]),-ec[2]),ex)}let jo=class jo{constructor(eo,ec){this.position=eo,this.orientation=ec}get position(){return this._position}set position(ec){if(ec){let ed=ec instanceof eo.MercatorCoordinate?ec:new eo.MercatorCoordinate(ec[0],ec[1],ec[2]);this._renderWorldCopies&&(ed.x=eo.wrap(ed.x,0,1)),this._position=ed}else this._position=null}lookAtPoint(ec,ed){if(this.orientation=null,!this.position)return;let em=this.position,e_=this._elevation?this._elevation.getAtPointOrZero(eo.MercatorCoordinate.fromLngLat(ec)):0,eg=eo.MercatorCoordinate.fromLngLat(ec,e_),ex=[eg.x-em.x,eg.y-em.y,eg.z-em.z];ed||(ed=[0,0,1]),ed[2]=Math.abs(ed[2]),this.orientation=No(ex,ed)}setPitchBearing(ec,ed){this.orientation=Uo(eo.degToRad(ec),eo.degToRad(-ed))}};let Go=class Go{constructor(ec,ed){this._transform=eo.identity([]),this.orientation=ed,this.position=ec}get mercatorPosition(){let ec=this.position;return new eo.MercatorCoordinate(ec[0],ec[1],ec[2])}get position(){let ec=eo.getColumn(this._transform,3);return[ec[0],ec[1],ec[2]]}set position(ec){ec&&eo.setColumn(this._transform,3,[ec[0],ec[1],ec[2],1])}get orientation(){return this._orientation}set orientation(ec){this._orientation=ec||eo.identity$1([]),ec&&Fo(this._transform,this._orientation)}getPitchBearing(){let eo=this.forward(),ec=this.right();return{bearing:Math.atan2(-ec[1],ec[0]),pitch:Math.atan2(Math.sqrt(eo[0]*eo[0]+eo[1]*eo[1]),-eo[2])}}setPitchBearing(eo,ec){this._orientation=Uo(eo,ec),Fo(this._transform,this._orientation)}forward(){let ec=eo.getColumn(this._transform,2);return[-ec[0],-ec[1],-ec[2]]}up(){let ec=eo.getColumn(this._transform,1);return[-ec[0],-ec[1],-ec[2]]}right(){let ec=eo.getColumn(this._transform,0);return[ec[0],ec[1],ec[2]]}getCameraToWorld(ec,ed){let em=new Float64Array(16);return eo.invert(em,this.getWorldToCamera(ec,ed)),em}getWorldToCameraPosition(ec,ed,em){let e_=this.position;eo.scale$2(e_,e_,-ec);let eg=new Float64Array(16);return eo.fromScaling(eg,[em,em,em]),eo.translate(eg,eg,e_),eg[10]*=ed,eg}getWorldToCamera(ec,ed){let em=new Float64Array(16),e_=new Float64Array(4),eg=this.position;return eo.conjugate(e_,this._orientation),eo.scale$2(eg,eg,-ec),eo.fromQuat(em,e_),eo.translate(em,em,eg),em[1]*=-1,em[5]*=-1,em[9]*=-1,em[13]*=-1,em[8]*=ed,em[9]*=ed,em[10]*=ed,em[11]*=ed,em}getCameraToClipPerspective(ec,ed,em,e_){let eg=new Float64Array(16);return eo.perspective(eg,ec,ed,em,e_),eg}getDistanceToElevation(ec,ed=!1){let em=0===ec?0:eo.mercatorZfromAltitude(ec,ed?eo.latFromMercatorY(this.position[1]):this.position[1]),e_=this.forward();return(em-this.position[2])/e_[2]}clone(){return new Go([...this.position],[...this.orientation])}};function Zo(ec,ed){let em=Wo(ec.projection,ec.zoom,ec.width,ec.height),e_=function(ec,ed,em,e_,eg){let ex=new eo.LngLat(em.lng-180*tl,em.lat),ev=new eo.LngLat(em.lng+180*tl,em.lat),eb=ec.project(ex.lng,ex.lat),ew=ec.project(ev.lng,ev.lat),eT=-Math.atan2(ew.y-eb.y,ew.x-eb.x),eE=eo.MercatorCoordinate.fromLngLat(em);eE.y=eo.clamp(eE.y,-1+tl,1-tl);let eM=eE.toLngLat(),eS=ec.project(eM.lng,eM.lat),eA=eo.MercatorCoordinate.fromLngLat(eM);eA.x+=tl;let eI=eA.toLngLat(),eC=ec.project(eI.lng,eI.lat),eP=$o(eC.x-eS.x,eC.y-eS.y,eT),ez=eo.MercatorCoordinate.fromLngLat(eM);ez.y+=tl;let eD=ez.toLngLat(),ek=ec.project(eD.lng,eD.lat),eL=$o(ek.x-eS.x,ek.y-eS.y,eT),eR=Math.abs(eP.x)/Math.abs(eL.y),eB=eo.identity([]);eo.rotateZ(eB,eB,-eT*(1-(eg?0:e_)));let eF=eo.identity([]);return eo.scale(eF,eF,[1,1-(1-eR)*e_,1]),eF[4]=-eL.x/eL.y*e_,eo.rotateZ(eF,eF,eT),eo.multiply(eF,eB,eF),eF}(ec.projection,0,ec.center,em,ed),eg=Vo(ec);return eo.scale(e_,e_,[eg,eg,1]),e_}function Vo(ec){let ed=ec.projection,em=Wo(ec.projection,ec.zoom,ec.width,ec.height),e_=qo(ed,ec.center),eg=qo(ed,eo.LngLat.convert(ed.center));return Math.pow(2,e_*em+(1-em)*eg)}function Wo(ec,ed,em,e_,eg=1/0){let ex=ec.range;if(!ex)return 0;let ev=Math.min(eg,Math.max(em,e_)),eb=Math.log(ev/1024)/Math.LN2;return eo.smoothstep(ex[0]+eb,ex[1]+eb,ed)}let tl=1/4e4;function qo(ec,ed){let em=eo.clamp(ed.lat,-eo.MAX_MERCATOR_LATITUDE,eo.MAX_MERCATOR_LATITUDE),e_=new eo.LngLat(ed.lng-180*tl,em),eg=new eo.LngLat(ed.lng+180*tl,em),ex=ec.project(e_.lng,em),ev=ec.project(eg.lng,em),eb=eo.MercatorCoordinate.fromLngLat(e_),ew=eo.MercatorCoordinate.fromLngLat(eg),eT=ev.x-ex.x,eE=ev.y-ex.y,eM=ew.x-eb.x,eS=ew.y-eb.y,eA=Math.sqrt((eM*eM+eS*eS)/(eT*eT+eE*eE));return Math.log(eA)/Math.LN2}function $o(eo,ec,ed){let em=Math.cos(ed),e_=Math.sin(ed);return{x:eo*em-ec*e_,y:eo*e_+ec*em}}let Ho=class Ho{constructor(ec,ed,em,e_,eg,ex,ev){this.tileSize=512,this._renderWorldCopies=void 0===eg||eg,this._minZoom=ec||0,this._maxZoom=ed||22,this._minPitch=null==em?0:em,this._maxPitch=null==e_?60:e_,this.setProjection(ex),this.setMaxBounds(ev),this.width=0,this.height=0,this._center=new eo.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new ko,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Go,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){let eo=new Ho(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return eo._elevation=this._elevation,eo._centerAltitude=this._centerAltitude,eo._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,eo.tileSize=this.tileSize,eo.mercatorFromTransition=this.mercatorFromTransition,eo.width=this.width,eo.height=this.height,eo.cameraElevationReference=this.cameraElevationReference,eo._center=this._center,eo._setZoom(this.zoom),eo._seaLevelZoom=this._seaLevelZoom,eo.angle=this.angle,eo._fov=this._fov,eo._pitch=this._pitch,eo._nearZ=this._nearZ,eo._farZ=this._farZ,eo._averageElevation=this._averageElevation,eo._unmodified=this._unmodified,eo._edgeInsets=this._edgeInsets.clone(),eo._camera=this._camera.clone(),eo._calcMatrices(),eo.freezeTileCoverage=this.freezeTileCoverage,eo.frustumCorners=this.frustumCorners,eo}get elevation(){return this._elevation}set elevation(eo){this._elevation!==eo&&(this._elevation=eo,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(eo,ec=!1){let ed=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||ed)&&this._updateCameraOnTerrain(),(eo||ed)&&this._constrainCamera(ec),this._calcMatrices()}getProjection(){return eo.pick(this.projection,["name","center","parallels"])}setProjection(ec){this.projectionOptions=ec||{name:"mercator"};let ed=this.projection?this.getProjection():void 0;this.projection=eo.getProjection(this.projectionOptions);let em=!t(ed,this.getProjection());return em&&this._calcMatrices(),this.mercatorFromTransition=!1,em}setMercatorFromTransition(){let ec=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=eo.getProjection({name:"mercator"});let ed=ec!==this.projection.name;return ed&&this._calcMatrices(),ed}get minZoom(){return this._minZoom}set minZoom(eo){this._minZoom!==eo&&(this._minZoom=eo,this.zoom=Math.max(this.zoom,eo))}get maxZoom(){return this._maxZoom}set maxZoom(eo){this._maxZoom!==eo&&(this._maxZoom=eo,this.zoom=Math.min(this.zoom,eo))}get minPitch(){return this._minPitch}set minPitch(eo){this._minPitch!==eo&&(this._minPitch=eo,this.pitch=Math.max(this.pitch,eo))}get maxPitch(){return this._maxPitch}set maxPitch(eo){this._maxPitch!==eo&&(this._maxPitch=eo,this.pitch=Math.min(this.pitch,eo))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(eo){void 0===eo?eo=!0:null===eo&&(eo=!1),this._renderWorldCopies=eo}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let eo=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(eo))}get cameraWorldSize(){let eo=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(eo))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return eo.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new eo.Point(this.width,this.height)}get bearing(){return eo.wrap(this.rotation,-180,180)}set bearing(eo){this.rotation=eo}get rotation(){return-this.angle/Math.PI*180}set rotation(ec){var ed,em,e_,eg,ex,ev,eb,ew,eT,eE;let eM=-ec*Math.PI/180;this.angle!==eM&&(this._unmodified=!1,this.angle=eM,this._calcMatrices(),this.rotationMatrix=(ed=new eo.ARRAY_TYPE(4),eo.ARRAY_TYPE!=Float32Array&&(ed[1]=0,ed[2]=0),ed[0]=1,ed[3]=1,ed),em=this.rotationMatrix,e_=this.rotationMatrix,eg=this.angle,ex=e_[0],ev=e_[1],eb=e_[2],ew=e_[3],eT=Math.sin(eg),eE=Math.cos(eg),em[0]=ex*eE+eb*eT,em[1]=ev*eE+ew*eT,em[2]=-(ex*eT)+eb*eE,em[3]=-(ev*eT)+ew*eE)}get pitch(){return this._pitch/Math.PI*180}set pitch(ec){let ed=eo.clamp(ec,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==ed&&(this._unmodified=!1,this._pitch=ed,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let eo=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/eo)}set fov(ec){ec=Math.max(.01,Math.min(60,ec)),this._fov!==ec&&(this._unmodified=!1,this._fov=eo.degToRad(ec),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(eo){this._averageElevation=eo,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(eo){let ec=Math.min(Math.max(eo,this.minZoom),this.maxZoom);this._zoom!==ec&&(this._unmodified=!1,this._setZoom(ec),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(eo){this._zoom=eo,this.scale=this.zoomScale(eo),this.tileZoom=Math.floor(eo),this.zoomFraction=eo-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let eo=this._elevation;this._centerAltitude=eo.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=eo.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let ec=this._elevation,ed=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],em=this.horizonLineFromTop(),e_=0,eg=0;for(let ex=0;ex<ed.length;ex++){let ev=new eo.Point(ed[ex][0]*this.width,em+ed[ex][1]*(this.height-em)),eb=ec.pointCoordinate(ev);if(!eb)continue;let ew=1/Math.hypot(eb[0]-this._camera.position[0],eb[1]-this._camera.position[1]);e_+=eb[3]*ew,eg+=ew}return 0===eg?NaN:e_/eg}get center(){return this._center}set center(eo){eo.lat===this._center.lat&&eo.lng===this._center.lng||(this._unmodified=!1,this._center=eo,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;let eo=this._seaLevelZoom,ec=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),ed=this.pixelsPerMeter/this.worldSize*ec,em=this._mercatorZfromZoom(eo),e_=this._mercatorZfromZoom(this._maxZoom),eg=Math.max(em-ed,e_);this._setZoom(this._zoomFromMercatorZ(eg))}get padding(){return this._edgeInsets.toJSON()}set padding(eo){this._edgeInsets.equals(eo)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,eo,1),this._calcMatrices())}computeZoomRelativeTo(ec){let ed;let em=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,ec.toAltitude()));ed=ec.z<this._camera.position[2]?[em.x,em.y,em.z]:[ec.x,ec.y,ec.z];let e_=eo.length(eo.sub([],this._camera.position,ed));return eo.clamp(this._zoomFromMercatorZ(e_),this._minZoom,this._maxZoom)}setFreeCameraOptions(ec){if(!this.height||!ec.position&&!ec.orientation)return;this._updateCameraState();let ed=!1;if(ec.orientation&&!eo.exactEquals(ec.orientation,this._camera.orientation)&&(ed=this._setCameraOrientation(ec.orientation)),ec.position){let em=[ec.position.x,ec.position.y,ec.position.z];eo.exactEquals$1(em,this._camera.position)||(this._setCameraPosition(em),ed=!0)}ed&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let ec=this._camera.position,ed=new jo;return ed.position=new eo.MercatorCoordinate(ec[0],ec[1],ec[2]),ed.orientation=this._camera.orientation,ed._elevation=this.elevation,ed._renderWorldCopies=this.renderWorldCopies,ed}_setCameraOrientation(ec){if(!eo.length$1(ec))return!1;eo.normalize$1(ec,ec);let ed=eo.transformQuat([],[0,0,-1],ec),em=eo.transformQuat([],[0,-1,0],ec);if(em[2]<0)return!1;let e_=No(ed,em);return!!e_&&(this._camera.orientation=e_,!0)}_setCameraPosition(ec){let ed=this.zoomScale(this.minZoom)*this.tileSize,em=this.zoomScale(this.maxZoom)*this.tileSize,e_=this.cameraToCenterDistance;ec[2]=eo.clamp(ec[2],e_/em,e_/ed),this._camera.position=ec}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(eo){return this._edgeInsets.equals(eo)}interpolatePadding(eo,ec,ed){this._unmodified=!1,this._edgeInsets.interpolate(eo,ec,ed),this._constrain(),this._calcMatrices()}coveringZoomLevel(eo){let ec=(eo.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/eo.tileSize));return Math.max(0,ec)}getVisibleUnwrappedCoordinates(ec){let ed=[new eo.UnwrappedTileID(0,ec)];if(this.renderWorldCopies){let em=this.pointCoordinate(new eo.Point(0,0)),e_=this.pointCoordinate(new eo.Point(this.width,0)),eg=this.pointCoordinate(new eo.Point(this.width,this.height)),ex=this.pointCoordinate(new eo.Point(0,this.height)),ev=Math.floor(Math.min(em.x,e_.x,eg.x,ex.x)),eb=Math.floor(Math.max(em.x,e_.x,eg.x,ex.x));for(let em=ev-1;em<=eb+1;em++)0!==em&&ed.push(new eo.UnwrappedTileID(em,ec))}return ed}coveringTiles(ec){let ed=this.coveringZoomLevel(ec),em=ed,e_=this.elevation&&!ec.isTerrainDEM,eg="mercator"===this.projection.name;if(void 0!==ec.minzoom&&ed<ec.minzoom)return[];void 0!==ec.maxzoom&&ed>ec.maxzoom&&(ed=ec.maxzoom);let ex=this.locationCoordinate(this.center),ev=this.center.lat,eb=1<<ed,ew=[eb*ex.x,eb*ex.y,0],eT="globe"===this.projection.name,eE=!eT,eM=eo.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,ed,eE),eS=eT?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),eA=eb*eo.mercatorZfromAltitude(1,this.center.lat),eI=this._camera.position[2]/eo.mercatorZfromAltitude(1,this.center.lat),eC=[eb*eS.x,eb*eS.y,eI*(eE?1:eA)],eP=this.cameraToCenterDistance/ec.tileSize*(ec.roundZoom?1:.502),ez=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?ed:0,eD=ec.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,ek=ec.isTerrainDEM?-eD:this._elevation?this._elevation.getMinElevationBelowMSL():0,eL=this.projection.isReprojectedInTileSpace?Vo(this):1,w=ec=>{let ed=1/4e4,em=new eo.MercatorCoordinate(ec.x+ed,ec.y,ec.z),e_=new eo.MercatorCoordinate(ec.x,ec.y+ed,ec.z),eg=ec.toLngLat(),ex=em.toLngLat(),ev=e_.toLngLat(),eb=this.locationCoordinate(eg),ew=this.locationCoordinate(ex),eT=this.locationCoordinate(ev),eE=Math.hypot(ew.x-eb.x,ew.y-eb.y),eM=Math.hypot(eT.x-eb.x,eT.y-eb.y);return Math.sqrt(eE*eM)*eL/ed},T=ec=>({aabb:eo.tileAABB(this,eb,0,0,0,ec,ek,eD,this.projection),zoom:0,x:0,y:0,minZ:ek,maxZ:eD,wrap:ec,fullyVisible:!1}),eR=[],eB=[],eF=ed,eO=ec.reparseOverscaled?em:ed,P=eo=>eo*eo,eU=P((eI-this._centerAltitude)*eA),D=eo=>{if(!this._elevation||!eo.tileID||!eg)return;let ec=this._elevation.getMinMaxForTile(eo.tileID),ed=eo.aabb;ec?(ed.min[2]=ec.min,ed.max[2]=ec.max,ed.center[2]=(ed.min[2]+ed.max[2])/2):(eo.shouldSplit=L(eo),eo.shouldSplit||(ed.min[2]=ed.max[2]=ed.center[2]=this._centerAltitude))},L=ec=>{if(ec.zoom<ez)return!0;if(ec.zoom===eF)return!1;if(null!=ec.shouldSplit)return ec.shouldSplit;let ed=ec.aabb.distanceX(eC),eg=ec.aabb.distanceY(eC),ex=eU,eb=1;if(eT){ex=P(ec.aabb.distanceZ(eC));let ed=Math.pow(2,ec.zoom),em=eo.latFromMercatorY((ec.y+1)/ed),e_=eo.latFromMercatorY(ec.y/ed),eg=Math.min(Math.max(ev,em),e_),ew=eo.circumferenceAtLatitude(eg)/eo.circumferenceAtLatitude(ev);if(eb=eg===ev?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,ew/this._mercatorScaleRatio),this.zoom<=eo.GLOBE_ZOOM_THRESHOLD_MIN&&ec.zoom===eF-1&&ew>=.9)return!0}else if(e_&&(ex=P(ec.aabb.distanceZ(eC)*eA)),this.projection.isReprojectedInTileSpace&&em<=5){let ed=Math.pow(2,ec.zoom),em=w(new eo.MercatorCoordinate((ec.x+.5)/ed,(ec.y+.5)/ed));eb=em>.85?1:em}let ew=ed*ed+eg*eg+ex,eE=P((1<<eF-ec.zoom)*eP*eb*((eo,ec)=>{if(ec*P(.707)<eo)return 1;let ed=Math.sqrt(ec/eo);return ed/(1.4144271570014144+(Math.pow(1.1,ed-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(ex,eU),ew));return ew<eE};if(this.renderWorldCopies)for(let eo=1;eo<=3;eo++)eR.push(T(-eo)),eR.push(T(eo));for(eR.push(T(0));eR.length>0;){let em=eR.pop(),ex=em.x,ev=em.y,eE=em.fullyVisible;if(!eE){let eo=em.aabb.intersects(eM);if(0===eo)continue;eE=2===eo}if(em.zoom!==eF&&L(em))for(let ec=0;ec<4;ec++){let ed=(ex<<1)+ec%2,ew=(ev<<1)+(ec>>1),eM={aabb:eg?em.aabb.quadrant(ec):eo.tileAABB(this,eb,em.zoom+1,ed,ew,em.wrap,em.minZ,em.maxZ,this.projection),zoom:em.zoom+1,x:ed,y:ew,wrap:em.wrap,fullyVisible:eE,tileID:void 0,shouldSplit:void 0,minZ:em.minZ,maxZ:em.maxZ};e_&&!eT&&(eM.tileID=new eo.OverscaledTileID(em.zoom+1===eF?eO:em.zoom+1,em.wrap,em.zoom+1,ed,ew),D(eM)),eR.push(eM)}else{let e_=em.zoom===eF?eO:em.zoom;if(ec.minzoom&&ec.minzoom>e_)continue;let eg=ew[0]-(.5+ex+(em.wrap<<em.zoom))*(1<<ed-em.zoom),eb=ew[1]-.5-ev,eT=em.tileID?em.tileID:new eo.OverscaledTileID(e_,em.wrap,em.zoom,ex,ev);eB.push({tileID:eT,distanceSq:eg*eg+eb*eb})}}if(this.fogCullDistSq){let ed=this.fogCullDistSq,em=this.horizonLineFromTop();eB=eB.filter(e_=>{let eg=[0,0,0,1],ex=[eo.EXTENT,eo.EXTENT,0,1],ev=this.calculateFogTileMatrix(e_.tileID.toUnwrapped());eo.transformMat4$1(eg,eg,ev),eo.transformMat4$1(ex,ex,ev);let eb=eo.getAABBPointSquareDist(eg,ex);if(0===eb)return!0;let ew=!1,eT=this._elevation;if(eT&&eb>ed&&0!==em){let ed;let eg=this.calculateProjMatrix(e_.tileID.toUnwrapped());ec.isTerrainDEM||(ed=eT.getMinMaxForTile(e_.tileID)),ed||(ed={min:ek,max:eD});let ex=eo.furthestTileCorner(this.rotation),ev=[ex[0]*eo.EXTENT,ex[1]*eo.EXTENT,ed.max];eo.transformMat4(ev,ev,eg),ew=(1-ev[1])*this.height*.5<em}return eb<ed||ew})}return eB.sort((eo,ec)=>eo.distanceSq-ec.distanceSq).map(eo=>eo.tileID)}resize(eo,ec){this.width=eo,this.height=ec,this.pixelsToGLUnits=[2/eo,-2/ec],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(eo){return Math.pow(2,eo)}scaleZoom(eo){return Math.log(eo)/Math.LN2}project(ec){let ed=eo.clamp(ec.lat,-eo.MAX_MERCATOR_LATITUDE,eo.MAX_MERCATOR_LATITUDE),em=this.projection.project(ec.lng,ed);return new eo.Point(em.x*this.worldSize,em.y*this.worldSize)}unproject(eo){return this.projection.unproject(eo.x/this.worldSize,eo.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/eo.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(ec,ed){let em,e_;let eg=this.centerPoint;if("globe"===this.projection.name){let eo=this.worldSize;em=(ed.x-eg.x)/eo,e_=(ed.y-eg.y)/eo}else{let eo=this.pointCoordinate(ed),ec=this.pointCoordinate(eg);em=eo.x-ec.x,e_=eo.y-ec.y}let ex=this.locationCoordinate(ec);this.setLocation(new eo.MercatorCoordinate(ex.x-em,ex.y-e_))}setLocation(eo){this.center=this.coordinateLocation(eo),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(eo){return this.projection.locationPoint(this,eo)}locationPoint3D(eo){return this.projection.locationPoint(this,eo,!0)}pointLocation(eo){return this.coordinateLocation(this.pointCoordinate(eo))}pointLocation3D(eo){return this.coordinateLocation(this.pointCoordinate3D(eo))}locationCoordinate(ec,ed){let em=ed?eo.mercatorZfromAltitude(ed,ec.lat):void 0,e_=this.projection.project(ec.lng,ec.lat);return new eo.MercatorCoordinate(e_.x,e_.y,em)}coordinateLocation(eo){return this.projection.unproject(eo.x,eo.y)}pointRayIntersection(ec,ed){let em=null!=ed?ed:this._centerAltitude,e_=[ec.x,ec.y,0,1],eg=[ec.x,ec.y,1,1];eo.transformMat4$1(e_,e_,this.pixelMatrixInverse),eo.transformMat4$1(eg,eg,this.pixelMatrixInverse);let ex=eg[3];eo.scale$1(e_,e_,1/e_[3]),eo.scale$1(eg,eg,1/ex);let ev=e_[2],eb=eg[2];return{p0:e_,p1:eg,t:ev===eb?0:(em-ev)/(eb-ev)}}screenPointToMercatorRay(ec){let ed=[ec.x,ec.y,0,1],em=[ec.x,ec.y,1,1];return eo.transformMat4$1(ed,ed,this.pixelMatrixInverse),eo.transformMat4$1(em,em,this.pixelMatrixInverse),eo.scale$1(ed,ed,1/ed[3]),eo.scale$1(em,em,1/em[3]),ed[2]=eo.mercatorZfromAltitude(ed[2],this._center.lat)*this.worldSize,em[2]=eo.mercatorZfromAltitude(em[2],this._center.lat)*this.worldSize,eo.scale$1(ed,ed,1/this.worldSize),eo.scale$1(em,em,1/this.worldSize),new eo.Ray([ed[0],ed[1],ed[2]],eo.normalize([],eo.sub([],em,ed)))}rayIntersectionCoordinate(ec){let{p0:ed,p1:em,t:e_}=ec,eg=eo.mercatorZfromAltitude(ed[2],this._center.lat),ex=eo.mercatorZfromAltitude(em[2],this._center.lat);return new eo.MercatorCoordinate(eo.number(ed[0],em[0],e_)/this.worldSize,eo.number(ed[1],em[1],e_)/this.worldSize,eo.number(eg,ex,e_))}pointCoordinate(eo,ec=this._centerAltitude){return this.projection.pointCoordinate(this,eo.x,eo.y,ec)}pointCoordinate3D(ec){if(!this.elevation)return this.pointCoordinate(ec);let ed=this.projection.pointCoordinate3D(this,ec.x,ec.y);if(ed)return new eo.MercatorCoordinate(ed[0],ed[1],ed[2]);let em=0,e_=this.horizonLineFromTop();if(ec.y>e_)return this.pointCoordinate(ec);let eg=.02*e_,ex=ec.clone();for(let ec=0;ec<10&&e_-em>eg;ec++){ex.y=eo.number(em,e_,.66);let ec=this.projection.pointCoordinate3D(this,ex.x,ex.y);ec?(e_=ex.y,ed=ec):em=ex.y}return ed?new eo.MercatorCoordinate(ed[0],ed[1],ed[2]):this.pointCoordinate(ec)}isPointAboveHorizon(eo){return this.projection.isPointAboveHorizon(this,eo)}isPointOnSurface(ec){if(ec.y<0||ec.y>this.height||ec.x<0||ec.x>this.width)return!1;if(this.elevation||this.zoom>=eo.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(ec);let ed=this.pointCoordinate(ec);return ed.y>=0&&ed.y<=1}_coordinatePoint(ec,ed){let em=ed&&this.elevation?this.elevation.getAtPointOrZero(ec,this._centerAltitude):this._centerAltitude,e_=[ec.x*this.worldSize,ec.y*this.worldSize,em+ec.toAltitude(),1];return eo.transformMat4$1(e_,e_,this.pixelMatrix),e_[3]>0?new eo.Point(e_[0]/e_[3],e_[1]/e_[3]):new eo.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:ec,left:ed}=this._edgeInsets,em=this.height-this._edgeInsets.bottom,e_=this.width-this._edgeInsets.right,eg=this.pointLocation3D(new eo.Point(ed,ec)),ex=this.pointLocation3D(new eo.Point(e_,ec)),ev=this.pointLocation3D(new eo.Point(e_,em)),eb=this.pointLocation3D(new eo.Point(ed,em)),ew=Math.min(eg.lng,ex.lng,ev.lng,eb.lng),eT=Math.max(eg.lng,ex.lng,ev.lng,eb.lng),eE=Math.min(eg.lat,ex.lat,ev.lat,eb.lat),eM=Math.max(eg.lat,ex.lat,ev.lat,eb.lat),eS=Math.pow(2,-this.zoom)/16*270,eA="globe"===this.projection.name?1:4,m=(ec,ed,em,e_,eg)=>{let ex=(ec+em)/2,ev=(ed+e_)/2,eb=new eo.Point(ex,ev),{lng:eI,lat:eC}=this.pointLocation3D(eb),eP=Math.max(0,ew-eI,eE-eC,eI-eT,eC-eM);ew=Math.min(ew,eI),eT=Math.max(eT,eI),eE=Math.min(eE,eC),eM=Math.max(eM,eC),(eg<eA||eP>eS)&&(m(ec,ed,ex,ev,eg+1),m(ex,ev,em,e_,eg+1))};if(m(ed,ec,e_,ec,1),m(e_,ec,e_,em,1),m(e_,em,ed,em,1),m(ed,em,ed,ec,1),"globe"===this.projection.name){let[ec,ed]=eo.polesInViewport(this);ec?(eM=90,eT=180,ew=-180):ed&&(eE=-90,eT=180,ew=-180)}return new eo.LngLatBounds(new eo.LngLat(ew,eE),new eo.LngLat(eT,eM))}_getBoundsRectangular(ec,ed){let{top:em,left:e_}=this._edgeInsets,eg=this.height-this._edgeInsets.bottom,ex=this.width-this._edgeInsets.right,ev=new eo.Point(e_,em),eb=new eo.Point(ex,em),ew=new eo.Point(ex,eg),eT=new eo.Point(e_,eg),eE=this.pointCoordinate(ev,ec),eM=this.pointCoordinate(eb,ec),eS=this.pointCoordinate(ew,ed),eA=this.pointCoordinate(eT,ed),m=(eo,ec)=>(ec.y-eo.y)/(ec.x-eo.x);return eE.y>1&&eM.y>=0?eE=new eo.MercatorCoordinate((1-eA.y)/m(eA,eE)+eA.x,1):eE.y<0&&eM.y<=1&&(eE=new eo.MercatorCoordinate(-eA.y/m(eA,eE)+eA.x,0)),eM.y>1&&eE.y>=0?eM=new eo.MercatorCoordinate((1-eS.y)/m(eS,eM)+eS.x,1):eM.y<0&&eE.y<=1&&(eM=new eo.MercatorCoordinate(-eS.y/m(eS,eM)+eS.x,0)),(new eo.LngLatBounds).extend(this.coordinateLocation(eE)).extend(this.coordinateLocation(eM)).extend(this.coordinateLocation(eA)).extend(this.coordinateLocation(eS))}_getBoundsRectangularTerrain(){let eo=this.elevation;if(!eo.visibleDemTiles.length||eo.isUsingMockSource())return this._getBoundsRectangular(0,0);let ec=eo.visibleDemTiles.reduce((eo,ec)=>{if(ec.dem){let ed=ec.dem.tree;eo.min=Math.min(eo.min,ed.minimums[0]),eo.max=Math.max(eo.max,ed.maximums[0])}return eo},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(ec.min*eo.exaggeration(),ec.max*eo.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(eo=!0){let ec=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,ed=this.height/2-ec*(1-this._horizonShift);return eo?Math.max(0,ed):ed}getMaxBounds(){return this.maxBounds}setMaxBounds(ec){this.maxBounds=ec,this.minLat=-eo.MAX_MERCATOR_LATITUDE,this.maxLat=eo.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,ec&&(this.minLat=ec.getSouth(),this.maxLat=ec.getNorth(),this.minLng=ec.getWest(),this.maxLng=ec.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=eo.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=eo.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=eo.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=eo.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(eo,ec){return this.projection.createTileMatrix(this,ec,eo)}calculateDistanceTileData(ec){let ed=ec.key,em=this._distanceTileDataCache;if(em[ed])return em[ed];let e_=ec.canonical,eg=1/this.height,ex=this.cameraWorldSize,ev=ex/this.zoomScale(e_.z),eb=(e_.x+Math.pow(2,e_.z)*ec.wrap)*ev,ew=e_.y*ev,eT=this.point;eT.x*=ex/this.worldSize,eT.y*=ex/this.worldSize;let eE=this.angle,eM=Math.sin(-eE),eS=-Math.cos(-eE);return em[ed]={bearing:[eM,eS],center:[(eT.x-eb)*eg,(eT.y-ew)*eg],scale:ev/eo.EXTENT*eg},em[ed]}calculateFogTileMatrix(ec){let ed=ec.key,em=this._fogTileMatrixCache;if(em[ed])return em[ed];let e_=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,ec);return eo.multiply(e_,this.worldToFogMatrix,e_),em[ed]=new Float32Array(e_),em[ed]}calculateProjMatrix(ec,ed=!1){let em=ec.key,e_=ed?this._alignedProjMatrixCache:this._projMatrixCache;if(e_[em])return e_[em];let eg=this.calculatePosMatrix(ec,this.worldSize);return eo.multiply(eg,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:ed?this.alignedProjMatrix:this.projMatrix,eg),e_[em]=new Float32Array(eg),e_[em]}calculatePixelsToTileUnitsMatrix(ec){let ed=ec.tileID.key,em=this._pixelsToTileUnitsCache;if(em[ed])return em[ed];let e_=function(ec,ed){var em,e_,eg,ex,ev,eb,ew,eT;let{scale:eE}=ec.tileTransform,eM=eE*eo.EXTENT/(ec.tileSize*Math.pow(2,ed.zoom-ec.tileID.overscaledZ+ec.tileID.canonical.z));return em=new Float32Array(4),ex=(e_=ed.inverseAdjustmentMatrix)[1],ev=e_[2],eb=e_[3],eT=(eg=[eM,eM])[1],em[0]=e_[0]*(ew=eg[0]),em[1]=ex*ew,em[2]=ev*eT,em[3]=eb*eT,em}(ec,this);return em[ed]=e_,em[ed]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){let ec=1/this.worldSize,ed=eo.fromScaling([],[ec,ec,ec]);return eo.multiply(ed,ed,this.globeMatrix),ed}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;let ec=this._elevation;this._updateCameraState();let ed=eo.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,em=this._computeCameraPosition(ed),e_=this._camera.forward(),eg=eo.mercatorZfromAltitude(1,this._center.lat);em[2]/=eg,e_[2]/=eg,eo.normalize(e_,e_);let ex=ec.raycast(em,e_,ec.exaggeration());if(ex){let ec=eo.scaleAndAdd([],em,e_,ex),ed=new eo.MercatorCoordinate(ec[0],ec[1],eo.mercatorZfromAltitude(ec[2],eo.latFromMercatorY(ec[1]))),ev=(ed.z+eo.length([ed.x-em[0],ed.y-em[1],ed.z-em[2]*eg]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(ev),this._centerAltitude=ed.toAltitude(),this._center=this.coordinateLocation(ed),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(ec=!1){if(!this._elevation)return;let ed=this._elevation,em=eo.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,e_=this._computeCameraPosition(em),eg=ed.getAtPointOrZero(new eo.MercatorCoordinate(...e_)),ex=this.pixelsPerMeter/this.worldSize*eg,ev=this._minimumHeightOverTerrain(),eb=e_[2]-ex;if(eb<=ev){if(eb<0||ec){let ec=this.locationCoordinate(this._center,this._centerAltitude),ed=[e_[0],e_[1],ec.z-e_[2]],em=eo.length(ed);ed[2]-=(ev-eb)/this._pixelsPerMercatorPixel;let eg=eo.length(ed);if(0===eg)return;eo.scale$2(ed,ed,em/eg*this._pixelsPerMercatorPixel),this._camera.position=[e_[0],e_[1],ec.z*this._pixelsPerMercatorPixel-ed[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let ec="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||ec){let ed=this.center;return ed.lat=eo.clamp(ed.lat,this.minLat,this.maxLat),!this.maxBounds&&(this.renderWorldCopies||ec)||(ed.lng=eo.clamp(ed.lng,this.minLng,this.maxLng)),this.center=ed,void(this._constraining=!1)}let ed=this._unmodified,{x:em,y:e_}=this.point,eg=0,ex=em,ev=e_,eb=this.width/2,ew=this.height/2,eT=this.worldMinY*this.scale,eE=this.worldMaxY*this.scale;if(e_-ew<eT&&(ev=eT+ew),e_+ew>eE&&(ev=eE-ew),eE-eT<this.height&&(eg=Math.max(eg,this.height/(eE-eT)),ev=(eE+eT)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let eo=this.worldMinX*this.scale,ec=this.worldMaxX*this.scale,ed=this.worldSize/2-(eo+ec)/2;(ex=(em+ed+this.worldSize)%this.worldSize-ed)-eb<eo&&(ex=eo+eb),ex+eb>ec&&(ex=ec-eb),ec-eo<this.width&&(eg=Math.max(eg,this.width/(ec-eo)),ex=(ec+eo)/2)}ex===em&&ev===e_||(this.center=this.unproject(new eo.Point(ex,ev))),eg&&(this.zoom+=this.scaleZoom(eg)),this._constrainCamera(),this._unmodified=ed,this._constraining=!1}_minZoomForBounds(){let eo=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(eo=Math.max(eo,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),eo}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let ec=this.centerOffset,ed=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=eo.mercatorZfromAltitude(1,this.center.lat)/eo.mercatorZfromAltitude(1,eo.GLOBE_SCALE_MATCH_LATITUDE));let em=Wo(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,em),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let e_="meters"===this.projection.zAxisUnit?ed:1,eg=this._camera.getWorldToCamera(this.worldSize,e_),ex=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);ex[8]=-(2*ec.x)/this.width,ex[9]=2*ec.y/this.height;let ev=eo.mul([],ex,eg);if(this.projection.isReprojectedInTileSpace){let ec=this.locationCoordinate(this.center),ed=eo.identity([]);eo.translate(ed,ed,[ec.x*this.worldSize,ec.y*this.worldSize,0]),eo.multiply(ed,ed,Zo(this)),eo.translate(ed,ed,[-ec.x*this.worldSize,-ec.y*this.worldSize,0]),eo.multiply(ev,ev,ed),this.inverseAdjustmentMatrix=function(eo){let ec=Zo(eo,!0);return v([],[ec[0],ec[1],ec[4],ec[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=eo.scale([],ev,[this.worldSize,this.worldSize,this.worldSize/e_,1]),this.projMatrix=ev,this.invProjMatrix=eo.invert(new Float64Array(16),this.projMatrix);let eb=eo.invert([],ex);this.frustumCorners=eo.FrustumCorners.fromInvProjectionMatrix(eb,this.horizonLineFromTop(),this.height);let ew=new Float32Array(16);eo.identity(ew),eo.scale(ew,ew,[1,-1,1]),eo.rotateX(ew,ew,this._pitch),eo.rotateZ(ew,ew,this.angle);let eT=eo.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),eE=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;eT[8]=-(2*ec.x)/this.width,eT[9]=2*(ec.y+eE)/this.height,this.skyboxMatrix=eo.multiply(ew,eT,ew);let eM=this.point,eS=eM.x,eA=eM.y,eI=this.width%2/2,eC=this.height%2/2,eP=Math.cos(this.angle),ez=Math.sin(this.angle),eD=eS-Math.round(eS)+eP*eI+ez*eC,ek=eA-Math.round(eA)+eP*eC+ez*eI,eL=new Float64Array(ev);if(eo.translate(eL,eL,[eD>.5?eD-1:eD,ek>.5?ek-1:ek,0]),this.alignedProjMatrix=eL,ev=eo.create(),eo.scale(ev,ev,[this.width/2,-this.height/2,1]),eo.translate(ev,ev,[1,-1,0]),this.labelPlaneMatrix=ev,ev=eo.create(),eo.scale(ev,ev,[1,-1,1]),eo.translate(ev,ev,[-1,-1,0]),eo.scale(ev,ev,[2/this.width,2/this.height,1]),this.glCoordMatrix=ev,this.pixelMatrix=eo.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},!(ev=eo.invert(new Float64Array(16),this.pixelMatrix)))throw Error("failed to invert matrix");if(this.pixelMatrixInverse=ev,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=eo.calculateGlobeMatrix(this);let ec=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=eo.transformMat4(ec,ec,eg),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=ev;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let ec=this.cameraWorldSizeForFog,ed=this.cameraPixelsPerMeter,em=this._camera.position,e_=1/this.height/this._pixelsPerMercatorPixel,eg=[ec,ec,ed];eo.scale$2(eg,eg,e_),eo.scale$2(em,em,-1),eo.multiply$2(em,em,eg);let ex=eo.create();eo.translate(ex,ex,em),eo.scale(ex,ex,eg),this.mercatorFogMatrix=ex,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(ec,ed,e_)}_computeCameraPosition(eo){let ec=(eo=eo||this.pixelsPerMeter)/this.pixelsPerMeter,ed=this._camera.forward(),em=this.point,e_=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*ec-eo/this.worldSize*this._centerAltitude;return[em.x/this.worldSize-ed[0]*e_,em.y/this.worldSize-ed[1]*e_,eo/this.worldSize*this._centerAltitude-ed[2]*e_]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(ec){let ed=this._maxCameraBoundsDistance()*Math.cos(this._pitch),em=this._camera.position[2],e_=ec[2],eg=1;this.projection.wrap&&(this.center=this.center.wrap()),e_>0&&(eg=Math.min((ed-em)/e_,1)),this._camera.position=eo.scaleAndAdd([],this._camera.position,ec,eg),this._updateStateFromCamera()}_updateStateFromCamera(){let ec=this._camera.position,ed=this._camera.forward(),{pitch:em,bearing:e_}=this._camera.getPitchBearing(),eg=eo.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,ex=this._mercatorZfromZoom(this._maxZoom)*Math.cos(eo.degToRad(this._maxPitch)),ev=Math.max((ec[2]-eg)/Math.cos(em),ex),eb=this._zoomFromMercatorZ(ev);eo.scaleAndAdd(ec,ec,ed,ev),this._pitch=eo.clamp(em,eo.degToRad(this.minPitch),eo.degToRad(this.maxPitch)),this.angle=eo.wrap(e_,-Math.PI,Math.PI),this._setZoom(eo.clamp(eb,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new eo.MercatorCoordinate(ec[0],ec[1],ec[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(eo){return Math.pow(2,eo)*this.tileSize}_mercatorZfromZoom(eo){return this.cameraToCenterDistance/this._worldSizeFromZoom(eo)}_minimumHeightOverTerrain(){let eo=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(eo)}_zoomFromMercatorZ(eo){return this.scaleZoom(this.cameraToCenterDistance/(eo*this.tileSize))}zoomFromMercatorZAdjusted(ec){let ed=0,em=eo.GLOBE_ZOOM_THRESHOLD_MAX,e_=0,eg=1/0;for(;em-ed>1e-6&&em>ed;){let eo=ed+.5*(em-ed),ex=this.tileSize*Math.pow(2,eo),ev=this.getCameraToCenterDistance(this.projection,eo,ex),eb=this.scaleZoom(ev/(ec*this.tileSize)),ew=Math.abs(eo-eb);ew<eg&&(eg=ew,e_=eo),eo<eb?ed=eo:em=eo}return e_}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(eo.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(ec,ed){let em=Math.min(ec.x,ed.x),e_=Math.max(ec.x,ed.x),eg=Math.min(ec.y,ed.y),ex=Math.max(ec.y,ed.y);if(eg<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;let ev=[new eo.Point(em,eg),new eo.Point(e_,ex),new eo.Point(em,ex),new eo.Point(e_,eg)],eb=this.renderWorldCopies?-3:0,ew=this.renderWorldCopies?4:1;for(let eo of ev){let ec=this.pointRayIntersection(eo);if(ec.t<0)return!0;let ed=this.rayIntersectionCoordinate(ec);if(ed.x<eb||ed.y<0||ed.x>ew||ed.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+eo.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new eo.Point(0,0),new eo.Point(this.width,this.height))}zoomDeltaToMovement(ec,ed){let em=eo.length(eo.sub([],this._camera.position,ec)),e_=this._zoomFromMercatorZ(em)+ed;return em-this._mercatorZfromZoom(e_)}getCameraPoint(){if("globe"===this.projection.name){let ec=function([ec,ed,em],e_){let eg=[ec,ed,em,1];eo.transformMat4$1(eg,eg,e_);let ex=eg[3]=Math.max(eg[3],1e-6);return eg[0]/=ex,eg[1]/=ex,eg[2]/=ex,eg}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new eo.Point(ec[0],ec[1])}{let ec=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new eo.Point(0,ec))}}getCameraToCenterDistance(eo,ec=this.zoom,ed=this.worldSize){let em=Wo(eo,ec,this.width,this.height,1024),e_=eo.pixelSpaceConversion(this.center.lat,ed,em);return .5/Math.tan(.5*this._fov)*this.height*e_}getWorldToCameraMatrix(){let ec=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&eo.multiply(ec,ec,this.globeMatrix),ec}};function Yo(eo,ec){let ed=!1,em=null,r=()=>{em=null,ed&&(eo(),em=setTimeout(r,ec),ed=!1)};return()=>(ed=!0,em||r(),em)}let Ko=class Ko{constructor(ec){this._hashName=ec&&encodeURIComponent(ec),eo.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Yo(this._updateHashUnthrottled.bind(this),300)}addTo(ec){return this._map=ec,eo.window.addEventListener("hashchange",this._onHashChange,!1),ec.on("moveend",this._updateHash),this}remove(){return this._map&&(this._map.off("moveend",this._updateHash),eo.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0),this}getHashString(){let ec=this._map;if(!ec)return"";let ed=Jo(ec);if(this._hashName){let ec=this._hashName,em=!1,e_=eo.window.location.hash.slice(1).split("&").map(eo=>{let e_=eo.split("=")[0];return e_===ec?(em=!0,`${e_}=${ed}`):eo}).filter(eo=>eo);return em||e_.push(`${ec}=${ed}`),`#${e_.join("&")}`}return`#${ed}`}_getCurrentHash(){let ec=eo.window.location.hash.replace("#","");if(this._hashName){let eo;return ec.split("&").map(eo=>eo.split("=")).forEach(ec=>{ec[0]===this._hashName&&(eo=ec)}),(eo&&eo[1]||"").split("/")}return ec.split("/")}_onHashChange(){let eo=this._map;if(!eo)return!1;let ec=this._getCurrentHash();if(ec.length>=3&&!ec.some(eo=>isNaN(eo))){let ed=eo.dragRotate.isEnabled()&&eo.touchZoomRotate.isEnabled()?+(ec[3]||0):eo.getBearing();return eo.jumpTo({center:[+ec[2],+ec[1]],zoom:+ec[0],bearing:ed,pitch:+(ec[4]||0)}),!0}return!1}_updateHashUnthrottled(){let ec=eo.window.location.href.replace(/(#.+)?$/,this.getHashString());eo.window.history.replaceState(eo.window.history.state,null,ec)}};function Jo(eo,ec){let ed=eo.getCenter(),em=Math.round(100*eo.getZoom())/100,e_=Math.ceil((em*Math.LN2+Math.log(512/360/.5))/Math.LN10),eg=Math.pow(10,e_),ex=Math.round(ed.lng*eg)/eg,ev=Math.round(ed.lat*eg)/eg,eb=eo.getBearing(),ew=eo.getPitch(),eT=ec?`/${ex}/${ev}/${em}`:`${em}/${ev}/${ex}`;return(eb||ew)&&(eT+="/"+Math.round(10*eb)/10),ew&&(eT+=`/${Math.round(ew)}`),eT}let td={linearity:.3,easing:eo.bezier(0,0,.3,1)},tp=eo.extend({deceleration:2500,maxSpeed:1400},td),tm=eo.extend({deceleration:20,maxSpeed:1400},td),t_=eo.extend({deceleration:1e3,maxSpeed:360},td),tg=eo.extend({deceleration:1e3,maxSpeed:90},td);let rr=class rr{constructor(eo){this._map=eo,this.clear()}clear(){this._inertiaBuffer=[]}record(ec){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:eo.exported.now(),settings:ec})}_drainInertiaBuffer(){let ec=this._inertiaBuffer,ed=eo.exported.now();for(;ec.length>0&&ed-ec[0].time>160;)ec.shift()}_onMoveEnd(ec){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let ed={zoom:0,bearing:0,pitch:0,pan:new eo.Point(0,0),pinchAround:void 0,around:void 0};for(let{settings:eo}of this._inertiaBuffer)ed.zoom+=eo.zoomDelta||0,ed.bearing+=eo.bearingDelta||0,ed.pitch+=eo.pitchDelta||0,eo.panDelta&&ed.pan._add(eo.panDelta),eo.around&&(ed.around=eo.around),eo.pinchAround&&(ed.pinchAround=eo.pinchAround);let em=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,e_={};if(ed.pan.mag()){let eg=sr(ed.pan.mag(),em,eo.extend({},tp,ec||{}));e_.offset=ed.pan.mult(eg.amount/ed.pan.mag()),e_.center=this._map.transform.center,nr(e_,eg)}if(ed.zoom){let eo=sr(ed.zoom,em,tm);e_.zoom=this._map.transform.zoom+eo.amount,nr(e_,eo)}if(ed.bearing){let ec=sr(ed.bearing,em,t_);e_.bearing=this._map.transform.bearing+eo.clamp(ec.amount,-179,179),nr(e_,ec)}if(ed.pitch){let eo=sr(ed.pitch,em,tg);e_.pitch=this._map.transform.pitch+eo.amount,nr(e_,eo)}if(e_.zoom||e_.bearing){let eo=void 0===ed.pinchAround?ed.around:ed.pinchAround;e_.around=eo?this._map.unproject(eo):this._map.getCenter()}return this.clear(),e_.noMoveStart=!0,e_}};function nr(eo,ec){(!eo.duration||eo.duration<ec.duration)&&(eo.duration=ec.duration,eo.easing=ec.easing)}function sr(ec,ed,em){let{maxSpeed:e_,linearity:eg,deceleration:ex}=em,ev=eo.clamp(ec*eg/(ed/1e3),-e_,e_),eb=Math.abs(ev)/(ex*eg);return{easing:em.easing,duration:1e3*eb,amount:ev*(eb/2)}}let ar=class ar extends eo.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(ec,ed,em,e_={}){let eg=p(ed.getCanvasContainer(),em),ex=ed.unproject(eg);super(ec,eo.extend({point:eg,lngLat:ex,originalEvent:em},e_)),this._defaultPrevented=!1,this.target=ed}};let lr=class lr extends eo.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(ec,ed,em){let e_="touchend"===ec?em.changedTouches:em.touches,eg=m(ed.getCanvasContainer(),e_),ex=eg.map(eo=>ed.unproject(eo)),ev=eg.reduce((eo,ec,ed,em)=>eo.add(ec.div(em.length)),new eo.Point(0,0));super(ec,{points:eg,point:ev,lngLats:ex,lngLat:ed.unproject(ev),originalEvent:em}),this._defaultPrevented=!1}};let cr=class cr extends eo.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(eo,ec,ed){super(eo,{originalEvent:ed}),this._defaultPrevented=!1}};let hr=class hr{constructor(eo,ec){this._map=eo,this._clickTolerance=ec.clickTolerance}reset(){this._mousedownPos=void 0}wheel(eo){return this._firePreventable(new cr(eo.type,this._map,eo))}mousedown(eo,ec){return this._mousedownPos=ec,this._firePreventable(new ar(eo.type,this._map,eo))}mouseup(eo){this._map.fire(new ar(eo.type,this._map,eo))}preclick(ec){let ed=eo.extend({},ec);ed.type="preclick",this._map.fire(new ar(ed.type,this._map,ed))}click(eo,ec){this._mousedownPos&&this._mousedownPos.dist(ec)>=this._clickTolerance||(this.preclick(eo),this._map.fire(new ar(eo.type,this._map,eo)))}dblclick(eo){return this._firePreventable(new ar(eo.type,this._map,eo))}mouseover(eo){this._map.fire(new ar(eo.type,this._map,eo))}mouseout(eo){this._map.fire(new ar(eo.type,this._map,eo))}touchstart(eo){return this._firePreventable(new lr(eo.type,this._map,eo))}touchmove(eo){this._map.fire(new lr(eo.type,this._map,eo))}touchend(eo){this._map.fire(new lr(eo.type,this._map,eo))}touchcancel(eo){this._map.fire(new lr(eo.type,this._map,eo))}_firePreventable(eo){if(this._map.fire(eo),eo.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}};let ur=class ur{constructor(eo){this._map=eo}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(eo){this._map.fire(new ar(eo.type,this._map,eo))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ar("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(eo){this._delayContextMenu?this._contextMenuEvent=eo:this._map.fire(new ar(eo.type,this._map,eo)),this._map.listens("contextmenu")&&eo.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}};let _r=class _r{constructor(eo,ec){this._map=eo,this._el=eo.getCanvasContainer(),this._container=eo.getContainer(),this._clickTolerance=ec.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(eo,ec){this.isEnabled()&&eo.shiftKey&&0===eo.button&&(h(),this._startPos=this._lastPos=ec,this._active=!0)}mousemoveWindow(eo,ec){if(!this._active)return;let ed=this._startPos,em=this._lastPos;if(!ed||!em||em.equals(ec)||!this._box&&ec.dist(ed)<this._clickTolerance)return;this._lastPos=ec,this._box||(this._box=n("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",eo));let e_=Math.min(ed.x,ec.x),eg=Math.max(ed.x,ec.x),ex=Math.min(ed.y,ec.y),ev=Math.max(ed.y,ec.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${e_}px,${ex}px)`,this._box.style.width=eg-e_+"px",this._box.style.height=ev-ex+"px")})}mouseupWindow(ec,ed){if(!this._active)return;let em=this._startPos;if(em&&0===ec.button){if(this.reset(),d(),em.x!==ed.x||em.y!==ed.y)return this._map.fire(new eo.Event("boxzoomend",{originalEvent:ec})),{cameraAnimation:eo=>eo.fitScreenCoordinates(em,ed,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",ec)}}keydown(eo){this._active&&27===eo.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",eo))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),u(),delete this._startPos,delete this._lastPos}_fireEvent(ec,ed){return this._map.fire(new eo.Event(ec,{originalEvent:ed}))}};function dr(eo,ec){let ed={};for(let em=0;em<eo.length;em++)ed[eo[em].identifier]=ec[em];return ed}let pr=class pr{constructor(eo){this.reset(),this.numTouches=eo.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(ec,ed,em){(this.centroid||em.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=ec.timeStamp),em.length===this.numTouches&&(this.centroid=function(ec){let ed=new eo.Point(0,0);for(let eo of ec)ed._add(eo);return ed.div(ec.length)}(ed),this.touches=dr(em,ed)))}touchmove(eo,ec,ed){if(this.aborted||!this.centroid)return;let em=dr(ed,ec);for(let eo in this.touches){let ec=em[eo];(!ec||ec.dist(this.touches[eo])>30)&&(this.aborted=!0)}}touchend(eo,ec,ed){if((!this.centroid||eo.timeStamp-this.startTime>500)&&(this.aborted=!0),0===ed.length){let eo=!this.aborted&&this.centroid;if(this.reset(),eo)return eo}}};let mr=class mr{constructor(eo){this.singleTap=new pr(eo),this.numTaps=eo.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(eo,ec,ed){this.singleTap.touchstart(eo,ec,ed)}touchmove(eo,ec,ed){this.singleTap.touchmove(eo,ec,ed)}touchend(eo,ec,ed){let em=this.singleTap.touchend(eo,ec,ed);if(em){let ec=eo.timeStamp-this.lastTime<500,ed=!this.lastTap||30>this.lastTap.dist(em);if(ec&&ed||this.reset(),this.count++,this.lastTime=eo.timeStamp,this.lastTap=em,this.count===this.numTaps)return this.reset(),em}}};let fr=class fr{constructor(){this._zoomIn=new mr({numTouches:1,numTaps:2}),this._zoomOut=new mr({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(eo,ec,ed){this._zoomIn.touchstart(eo,ec,ed),this._zoomOut.touchstart(eo,ec,ed)}touchmove(eo,ec,ed){this._zoomIn.touchmove(eo,ec,ed),this._zoomOut.touchmove(eo,ec,ed)}touchend(eo,ec,ed){let em=this._zoomIn.touchend(eo,ec,ed),e_=this._zoomOut.touchend(eo,ec,ed);return em?(this._active=!0,eo.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ec=>ec.easeTo({duration:300,zoom:ec.getZoom()+1,around:ec.unproject(em)},{originalEvent:eo})}):e_?(this._active=!0,eo.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:ec=>ec.easeTo({duration:300,zoom:ec.getZoom()-1,around:ec.unproject(e_)},{originalEvent:eo})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let tx={0:1,2:2};let vr=class vr{constructor(eo){this.reset(),this._clickTolerance=eo.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(eo,ec){return!1}_move(eo,ec){return{}}mousedown(eo,ec){if(this._lastPoint)return;let ed=f(eo);this._correctButton(eo,ed)&&(this._lastPoint=ec,this._eventButton=ed)}mousemoveWindow(eo,ec){let ed=this._lastPoint;if(ed){if(eo.preventDefault(),null!=this._eventButton&&function(eo,ec){let ed=tx[ec];return void 0===eo.buttons||(eo.buttons&ed)!==ed}(eo,this._eventButton))this.reset();else if(this._moved||!(ec.dist(ed)<this._clickTolerance))return this._moved=!0,this._lastPoint=ec,this._move(ed,ec)}}mouseupWindow(eo){this._lastPoint&&f(eo)===this._eventButton&&(this._moved&&d(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let xr=class xr extends vr{mousedown(eo,ec){super.mousedown(eo,ec),this._lastPoint&&(this._active=!0)}_correctButton(eo,ec){return 0===ec&&!eo.ctrlKey}_move(eo,ec){return{around:ec,panDelta:ec.sub(eo)}}};let yr=class yr extends vr{_correctButton(eo,ec){return 0===ec&&eo.ctrlKey||2===ec}_move(eo,ec){let ed=.8*(ec.x-eo.x);if(ed)return this._active=!0,{bearingDelta:ed}}contextmenu(eo){eo.preventDefault()}};let br=class br extends vr{_correctButton(eo,ec){return 0===ec&&eo.ctrlKey||2===ec}_move(eo,ec){let ed=-.5*(ec.y-eo.y);if(ed)return this._active=!0,{pitchDelta:ed}}contextmenu(eo){eo.preventDefault()}};let wr=class wr{constructor(ec,ed){this._map=ec,this._el=ec.getCanvasContainer(),this._minTouches=1,this._clickTolerance=ed.clickTolerance||1,this.reset(),eo.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new eo.Point(0,0)}touchstart(eo,ec,ed){return this._calculateTransform(eo,ec,ed)}touchmove(ec,ed,em){if(this._active&&!(em.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===em.length&&!eo.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return ec.cancelable&&ec.preventDefault(),this._calculateTransform(ec,ed,em)}}touchend(eo,ec,ed){this._calculateTransform(eo,ec,ed),this._active&&ed.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(ec,ed,em){em.length>0&&(this._active=!0);let e_=dr(em,ed),eg=new eo.Point(0,0),ex=new eo.Point(0,0),ev=0;for(let eo in e_){let ec=e_[eo],ed=this._touches[eo];ed&&(eg._add(ec),ex._add(ec.sub(ed)),ev++,e_[eo]=ec)}if(this._touches=e_,ev<this._minTouches||!ex.mag())return;let eb=ex.div(ev);return this._sum._add(eb),this._sum.mag()<this._clickTolerance?void 0:{around:eg.div(ev),panDelta:eb}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=n("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}};let Tr=class Tr{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(eo){}_move(eo,ec,ed){return{}}touchstart(eo,ec,ed){this._firstTwoTouches||ed.length<2||(this._firstTwoTouches=[ed[0].identifier,ed[1].identifier],this._start([ec[0],ec[1]]))}touchmove(eo,ec,ed){let em=this._firstTwoTouches;if(!em)return;eo.preventDefault();let[e_,eg]=em,ex=Er(ed,ec,e_),ev=Er(ed,ec,eg);if(!ex||!ev)return;let eb=this._aroundCenter?null:ex.add(ev).div(2);return this._move([ex,ev],eb,eo)}touchend(eo,ec,ed){if(!this._firstTwoTouches)return;let[em,e_]=this._firstTwoTouches,eg=Er(ed,ec,em),ex=Er(ed,ec,e_);eg&&ex||(this._active&&d(),this.reset())}touchcancel(){this.reset()}enable(eo){this._enabled=!0,this._aroundCenter=!!eo&&"center"===eo.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};function Er(eo,ec,ed){for(let em=0;em<eo.length;em++)if(eo[em].identifier===ed)return ec[em]}function Cr(eo,ec){return Math.log(eo/ec)/Math.LN2}let Mr=class Mr extends Tr{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(eo){this._startDistance=this._distance=eo[0].dist(eo[1])}_move(eo,ec){let ed=this._distance;if(this._distance=eo[0].dist(eo[1]),this._active||!(.1>Math.abs(Cr(this._distance,this._startDistance))))return this._active=!0,{zoomDelta:Cr(this._distance,ed),pinchAround:ec}}};function Ir(eo,ec){return 180*eo.angleWith(ec)/Math.PI}let Pr=class Pr extends Tr{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(eo){this._startVector=this._vector=eo[0].sub(eo[1]),this._minDiameter=eo[0].dist(eo[1])}_move(eo,ec){let ed=this._vector;if(this._vector=eo[0].sub(eo[1]),ed&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ir(this._vector,ed),pinchAround:ec}}_isBelowThreshold(eo){this._minDiameter=Math.min(this._minDiameter,eo.mag());let ec=25/(Math.PI*this._minDiameter)*360,ed=this._startVector;if(!ed)return!1;let em=Ir(eo,ed);return Math.abs(em)<ec}};function Sr(eo){return Math.abs(eo.y)>Math.abs(eo.x)}let Dr=class Dr extends Tr{constructor(eo){super(),this._map=eo}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(eo){this._lastPoints=eo,Sr(eo[0].sub(eo[1]))&&(this._valid=!1)}_move(ec,ed,em){let e_=this._lastPoints;if(!e_)return;let eg=ec[0].sub(e_[0]),ex=ec[1].sub(e_[1]);return this._map._cooperativeGestures&&!eo.isFullscreen()&&em.touches.length<3||(this._valid=this.gestureBeginsVertically(eg,ex,em.timeStamp),!this._valid)?void 0:(this._lastPoints=ec,this._active=!0,{pitchDelta:-((eg.y+ex.y)/2*.5)})}gestureBeginsVertically(eo,ec,ed){if(void 0!==this._valid)return this._valid;let em=eo.mag()>=2,e_=ec.mag()>=2;if(!em&&!e_)return;if(!em||!e_)return null==this._firstMove&&(this._firstMove=ed),ed-this._firstMove<100&&void 0;let eg=eo.y>0==ec.y>0;return Sr(eo)&&Sr(ec)&&eg}};let Ar=class Ar{constructor(){this._panStep=100,this._bearingStep=15,this._pitchStep=10,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(eo){if(eo.altKey||eo.ctrlKey||eo.metaKey)return;let ec=0,ed=0,em=0,e_=0,eg=0;switch(eo.keyCode){case 61:case 107:case 171:case 187:ec=1;break;case 189:case 109:case 173:ec=-1;break;case 37:eo.shiftKey?ed=-1:(eo.preventDefault(),e_=-1);break;case 39:eo.shiftKey?ed=1:(eo.preventDefault(),e_=1);break;case 38:eo.shiftKey?em=1:(eo.preventDefault(),eg=-1);break;case 40:eo.shiftKey?em=-1:(eo.preventDefault(),eg=1);break;default:return}return this._rotationDisabled&&(ed=0,em=0),{cameraAnimation:ex=>{let ev=ex.getZoom();ex.easeTo({duration:300,easeId:"keyboardHandler",easing:zr,zoom:ec?Math.round(ev)+ec*(eo.shiftKey?2:1):ev,bearing:ex.getBearing()+ed*this._bearingStep,pitch:ex.getPitch()+em*this._pitchStep,offset:[-e_*this._panStep,-eg*this._panStep],center:ex.getCenter()},{originalEvent:eo})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}};function zr(eo){return eo*(2-eo)}let Or=class Or{constructor(ec,ed){this._map=ec,this._el=ec.getCanvasContainer(),this._handler=ed,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,eo.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(eo){this._defaultZoomRate=eo}setWheelZoomRate(eo){this._wheelZoomRate=eo}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(eo){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!eo&&"center"===eo.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(ec){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(ec.ctrlKey||ec.metaKey||this.isZooming()||eo.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let ed=ec.deltaMode===eo.window.WheelEvent.DOM_DELTA_LINE?40*ec.deltaY:ec.deltaY,em=eo.exported.now(),e_=em-(this._lastWheelEventTime||0);this._lastWheelEventTime=em,0!==ed&&ed%4.000244140625==0?this._type="wheel":0!==ed&&4>Math.abs(ed)?this._type="trackpad":e_>400?(this._type=null,this._lastValue=ed,this._timeout=setTimeout(this._onTimeout,40,ec)):this._type||(this._type=200>Math.abs(e_*ed)?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,ed+=this._lastValue)),ec.shiftKey&&ed&&(ed/=4),this._type&&(this._lastWheelEvent=ec,this._delta-=ed,this._active||this._start(ec)),ec.preventDefault()}_onTimeout(eo){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(eo)}_start(eo){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let ec=p(this._el,eo);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:ec,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let ec=this._map.transform;"wheel"===this._type&&ec.projection.wrap&&(ec._center.lng>=180||ec._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let i=()=>ec._terrainEnabled()&&this._aroundCoord?ec.computeZoomRelativeTo(this._aroundCoord):ec.zoom;if(0!==this._delta){let eo="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,ed=2/(1+Math.exp(-Math.abs(this._delta*eo)));this._delta<0&&0!==ed&&(ed=1/ed);let em=i(),e_=Math.pow(2,em),eg="number"==typeof this._targetZoom?ec.zoomScale(this._targetZoom):e_;this._targetZoom=Math.min(ec.maxZoom,Math.max(ec.minZoom,ec.scaleZoom(eg*ed))),"wheel"===this._type&&(this._startZoom=em,this._easing=this._smoothOutEasing(200)),this._delta=0}let ed="number"==typeof this._targetZoom?this._targetZoom:i(),em=this._startZoom,e_=this._easing,eg,ex=!1;if("wheel"===this._type&&em&&e_){let ec=Math.min((eo.exported.now()-this._lastWheelEventTime)/200,1),ev=e_(ec);eg=eo.number(em,ed,ev),ec<1?this._frameId||(this._frameId=!0):ex=!0}else eg=ed,ex=!0;return this._active=!0,ex&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ex,zoomDelta:eg-i(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(ec){let ed=eo.ease;if(this._prevEase){let ec=this._prevEase,em=(eo.exported.now()-ec.start)/ec.duration,e_=ec.easing(em+.01)-ec.easing(em),eg=.27/Math.sqrt(e_*e_+1e-4)*.01,ex=Math.sqrt(.0729-eg*eg);ed=eo.bezier(eg,ex,.25,1)}return this._prevEase={start:eo.exported.now(),duration:ec,easing:ed},ed}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=n("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(eo.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}};let Br=class Br{constructor(eo,ec){this._clickZoom=eo,this._tapZoom=ec}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}};let kr=class kr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(eo,ec){return eo.preventDefault(),{cameraAnimation:ed=>{ed.easeTo({duration:300,zoom:ed.getZoom()+(eo.shiftKey?-1:1),around:ed.unproject(ec)},{originalEvent:eo})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let Fr=class Fr{constructor(){this._tap=new mr({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(eo,ec,ed){this._swipePoint||(this._tapTime&&eo.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?ed.length>0&&(this._swipePoint=ec[0],this._swipeTouch=ed[0].identifier):this._tap.touchstart(eo,ec,ed))}touchmove(eo,ec,ed){if(this._tapTime){if(this._swipePoint){if(ed[0].identifier!==this._swipeTouch)return;let em=ec[0],e_=em.y-this._swipePoint.y;return this._swipePoint=em,eo.preventDefault(),this._active=!0,{zoomDelta:e_/128}}}else this._tap.touchmove(eo,ec,ed)}touchend(eo,ec,ed){this._tapTime?this._swipePoint&&0===ed.length&&this.reset():this._tap.touchend(eo,ec,ed)&&(this._tapTime=eo.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}};let Ur=class Ur{constructor(eo,ec,ed){this._el=eo,this._mousePan=ec,this._touchPan=ed}enable(eo){this._inertiaOptions=eo||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}};let Nr=class Nr{constructor(eo,ec,ed){this._pitchWithRotate=eo.pitchWithRotate,this._mouseRotate=ec,this._mousePitch=ed}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}};let jr=class jr{constructor(eo,ec,ed,em){this._el=eo,this._touchZoom=ec,this._touchRotate=ed,this._tapDragZoom=em,this._rotationDisabled=!1,this._enabled=!0}enable(eo){this._touchZoom.enable(eo),this._rotationDisabled||this._touchRotate.enable(eo),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}};let Gr=eo=>eo.zoom||eo.drag||eo.pitch||eo.rotate;let Zr=class Zr extends eo.Event{};let Vr=class Vr{constructor(){this.constants=[1,1,.01],this.radius=0}setup(ec,ed){let em=eo.sub([],ed,ec);this.radius=eo.length(em[2]<0?eo.div([],em,this.constants):[em[0],em[1],0])}projectRay(ec){eo.div(ec,ec,this.constants),eo.normalize(ec,ec),eo.mul$1(ec,ec,this.constants);let ed=eo.scale$2([],ec,this.radius);if(ed[2]>0){let ec=eo.scale$2([],[0,0,1],eo.dot(ed,[0,0,1])),em=eo.scale$2([],eo.normalize([],[ed[0],ed[1],0]),this.radius),e_=eo.add([],ed,eo.scale$2([],eo.sub([],eo.add([],em,ec),ed),2));ed[0]=e_[0],ed[1]=e_[1]}return ed}};function Wr(eo){return eo.panDelta&&eo.panDelta.mag()||eo.zoomDelta||eo.bearingDelta||eo.pitchDelta}let Xr=class Xr{constructor(ec,ed){this._map=ec,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new rr(ec),this._bearingSnap=ed.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Vr,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(ed),eo.bindAll(["handleEvent","handleWindowEvent"],this);let em=this._el;for(let[ec,ed,e_]of(this._listeners=[[em,"touchstart",{passive:!0}],[em,"touchmove",{passive:!1}],[em,"touchend",void 0],[em,"touchcancel",void 0],[em,"mousedown",void 0],[em,"mousemove",void 0],[em,"mouseup",void 0],[eo.window.document,"mousemove",{capture:!0}],[eo.window.document,"mouseup",void 0],[em,"mouseover",void 0],[em,"mouseout",void 0],[em,"dblclick",void 0],[em,"click",void 0],[em,"keydown",{capture:!1}],[em,"keyup",void 0],[em,"wheel",{passive:!1}],[em,"contextmenu",void 0],[eo.window,"blur",void 0]],this._listeners))ec.addEventListener(ed,ec===eo.window.document?this.handleWindowEvent:this.handleEvent,e_)}destroy(){for(let[ec,ed,em]of this._listeners)ec.removeEventListener(ed,ec===eo.window.document?this.handleWindowEvent:this.handleEvent,em)}_addDefaultHandlers(eo){let ec=this._map,ed=ec.getCanvasContainer();this._add("mapEvent",new hr(ec,eo));let em=ec.boxZoom=new _r(ec,eo);this._add("boxZoom",em);let e_=new fr,eg=new kr;ec.doubleClickZoom=new Br(eg,e_),this._add("tapZoom",e_),this._add("clickZoom",eg);let ex=new Fr;this._add("tapDragZoom",ex);let ev=ec.touchPitch=new Dr(ec);this._add("touchPitch",ev);let eb=new yr(eo),ew=new br(eo);ec.dragRotate=new Nr(eo,eb,ew),this._add("mouseRotate",eb,["mousePitch"]),this._add("mousePitch",ew,["mouseRotate"]);let eT=new xr(eo),eE=new wr(ec,eo);ec.dragPan=new Ur(ed,eT,eE),this._add("mousePan",eT),this._add("touchPan",eE,["touchZoom","touchRotate"]);let eM=new Pr,eS=new Mr;ec.touchZoomRotate=new jr(ed,eS,eM,ex),this._add("touchRotate",eM,["touchPan","touchZoom"]),this._add("touchZoom",eS,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ur(ec));let eA=ec.scrollZoom=new Or(ec,this);this._add("scrollZoom",eA,["mousePan"]);let eI=ec.keyboard=new Ar;for(let ed of(this._add("keyboard",eI),["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"]))eo.interactive&&eo[ed]&&ec[ed].enable(eo[ed])}_add(eo,ec,ed){this._handlers.push({handlerName:eo,handler:ec,allowed:ed}),this._handlersById[eo]=ec}stop(eo){if(!this._updatingCamera){for(let{handler:eo}of this._handlers)eo.reset();this._inertia.clear(),this._fireEvents({},{},eo),this._changes=[]}}isActive(){for(let{handler:eo}of this._handlers)if(eo.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Gr(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(eo,ec,ed){for(let em in eo)if(em!==ed&&(!ec||0>ec.indexOf(em)))return!0;return!1}handleWindowEvent(eo){this.handleEvent(eo,`${eo.type}Window`)}_getMapTouches(eo){let ec=[];for(let ed of eo)this._el.contains(ed.target)&&ec.push(ed);return ec}handleEvent(eo,ec){this._updatingCamera=!0;let ed="renderFrame"===eo.type,em=ed?void 0:eo,e_={needsRenderFrame:!1},eg={},ex={},ev=eo.touches?this._getMapTouches(eo.touches):void 0,eb=ev?m(this._el,ev):ed?void 0:p(this._el,eo);for(let{handlerName:ed,handler:ew,allowed:eT}of this._handlers){let eE;ew.isEnabled()&&(this._blockedByActive(ex,eT,ed)?ew.reset():ew[ec||eo.type]&&(eE=ew[ec||eo.type](eo,eb,ev),this.mergeHandlerResult(e_,eg,eE,ed,em),eE&&eE.needsRenderFrame&&this._triggerRenderFrame()),(eE||ew.isActive())&&(ex[ed]=ew))}let ew={};for(let eo in this._previousActiveHandlers)ex[eo]||(ew[eo]=em);this._previousActiveHandlers=ex,(Object.keys(ew).length||Wr(e_))&&(this._changes.push([e_,eg,ew]),this._triggerRenderFrame()),(Object.keys(ex).length||Wr(e_))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:eT}=e_;eT&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],eT(this._map))}mergeHandlerResult(ec,ed,em,e_,eg){if(!em)return;eo.extend(ec,em);let ex={handlerName:e_,originalEvent:em.originalEvent||eg};void 0!==em.zoomDelta&&(ed.zoom=ex),void 0!==em.panDelta&&(ed.drag=ex),void 0!==em.pitchDelta&&(ed.pitch=ex),void 0!==em.bearingDelta&&(ed.rotate=ex)}_applyChanges(){let ec={},ed={},em={};for(let[e_,eg,ex]of this._changes)e_.panDelta&&(ec.panDelta=(ec.panDelta||new eo.Point(0,0))._add(e_.panDelta)),e_.zoomDelta&&(ec.zoomDelta=(ec.zoomDelta||0)+e_.zoomDelta),e_.bearingDelta&&(ec.bearingDelta=(ec.bearingDelta||0)+e_.bearingDelta),e_.pitchDelta&&(ec.pitchDelta=(ec.pitchDelta||0)+e_.pitchDelta),void 0!==e_.around&&(ec.around=e_.around),void 0!==e_.aroundCoord&&(ec.aroundCoord=e_.aroundCoord),void 0!==e_.pinchAround&&(ec.pinchAround=e_.pinchAround),e_.noInertia&&(ec.noInertia=e_.noInertia),eo.extend(ed,eg),eo.extend(em,ex);this._updateMapTransform(ec,ed,em),this._changes=[]}_updateMapTransform(ec,ed,em){var e_;let eg=this._map,ex=eg.transform,s=eo=>[eo.x,eo.y,eo.z];if((eo=>{let ec=this._eventsInProgress.drag;return ec&&!this._handlersById[ec.handlerName].isActive()})()&&!Wr(ec)){let eo=ex.zoom;ex.cameraElevationReference="sea",ex.recenterOnTerrain(),ex.cameraElevationReference="ground",eo!==ex.zoom&&this._map._update(!0)}if(ex._isCameraConstrained&&eg._stop(!0),!Wr(ec))return void this._fireEvents(ed,em,!0);let{panDelta:ev,zoomDelta:eb,bearingDelta:ew,pitchDelta:eT,around:eE,aroundCoord:eM,pinchAround:eS}=ec;ex._isCameraConstrained&&(eb>0&&(eb=0),ex._isCameraConstrained=!1),void 0!==eS&&(eE=eS),(eb||ed[e_="drag"]&&!this._eventsInProgress[e_])&&eE&&(this._dragOrigin=s(ex.pointCoordinate3D(eE)),this._trackingEllipsoid.setup(ex._camera.position,this._dragOrigin)),ex.cameraElevationReference="sea",eg._stop(!0),eE=eE||eg.transform.centerPoint,ew&&(ex.bearing+=ew),eT&&(ex.pitch+=eT),ex._updateCameraState();let eA=[0,0,0];if(ev){if("mercator"===ex.projection.name){let eo=this._trackingEllipsoid.projectRay(ex.screenPointToMercatorRay(eE).dir),ec=this._trackingEllipsoid.projectRay(ex.screenPointToMercatorRay(eE.sub(ev)).dir);eA[0]=ec[0]-eo[0],eA[1]=ec[1]-eo[1]}else{let ec=ex.pointCoordinate(eE);if("globe"===ex.projection.name){ev=ev.rotate(-ex.angle);let ed=ex._pixelsPerMercatorPixel/ex.worldSize;eA[0]=-ev.x*eo.mercatorScale(eo.latFromMercatorY(ec.y))*ed,eA[1]=-ev.y*eo.mercatorScale(ex.center.lat)*ed}else{let eo=ex.pointCoordinate(eE.sub(ev));ec&&eo&&(eA[0]=eo.x-ec.x,eA[1]=eo.y-ec.y)}}}let eI=ex.zoom,eC=[0,0,0];if(eb){let ec=s(eM||ex.pointCoordinate3D(eE)),ed={dir:eo.normalize([],eo.sub([],ec,ex._camera.position))};if(ed.dir[2]<0){let em=ex.zoomDeltaToMovement(ec,eb);eo.scale$2(eC,ed.dir,em)}}let eP=eo.add(eA,eA,eC);ex._translateCameraConstrained(eP),eb&&Math.abs(ex.zoom-eI)>1e-4&&ex.recenterOnTerrain(),ex.cameraElevationReference="ground",this._map._update(),ec.noInertia||this._inertia.record(ec),this._fireEvents(ed,em,!0)}_fireEvents(ec,ed,em){let e_;let eg=Gr(this._eventsInProgress),ex=Gr(ec),ev={};for(let eo in ec){let{originalEvent:ed}=ec[eo];this._eventsInProgress[eo]||(ev[`${eo}start`]=ed),this._eventsInProgress[eo]=ec[eo]}for(let eo in!eg&&ex&&this._fireEvent("movestart",ex.originalEvent),ev)this._fireEvent(eo,ev[eo]);for(let eo in ex&&this._fireEvent("move",ex.originalEvent),ec){let{originalEvent:ed}=ec[eo];this._fireEvent(eo,ed)}let eb={};for(let eo in this._eventsInProgress){let{handlerName:ec,originalEvent:em}=this._eventsInProgress[eo];this._handlersById[ec].isActive()||(delete this._eventsInProgress[eo],e_=ed[ec]||em,eb[`${eo}end`]=e_)}for(let eo in eb)this._fireEvent(eo,eb[eo]);let ew=Gr(this._eventsInProgress);if(em&&(eg||ex)&&!ew){var eT,eE;this._updatingCamera=!0;let ec=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions);ec?(0!==(eT=ec.bearing||this._map.getBearing())&&-this._bearingSnap<eT&&eT<this._bearingSnap&&(ec.bearing=0),this._map.easeTo(ec,{originalEvent:e_})):(this._map.fire(new eo.Event("moveend",{originalEvent:e_})),0!==(eE=this._map.getBearing())&&-this._bearingSnap<eE&&eE<this._bearingSnap&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(ec,ed){this._map.fire(new eo.Event(ec,ed?{originalEvent:ed}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(eo=>{this._frameId=void 0,this.handleEvent(new Zr("renderFrame",{timeStamp:eo})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}};let tv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";let $r=class $r extends eo.Evented{constructor(ec,ed){super(),this._moving=!1,this._zooming=!1,this.transform=ec,this._bearingSnap=ed.bearingSnap,this._respectPrefersReducedMotion=!1!==ed.respectPrefersReducedMotion,eo.bindAll(["_renderFrameCallback"],this)}getCenter(){return new eo.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(eo,ec){return this.jumpTo({center:eo},ec)}panBy(ec,ed,em){return ec=eo.Point.convert(ec).mult(-1),this.panTo(this.transform.center,eo.extend({offset:ec},ed),em)}panTo(ec,ed,em){return this.easeTo(eo.extend({center:ec},ed),em)}getZoom(){return this.transform.zoom}setZoom(eo,ec){return this.jumpTo({zoom:eo},ec),this}zoomTo(ec,ed,em){return this.easeTo(eo.extend({zoom:ec},ed),em)}zoomIn(eo,ec){return this.zoomTo(this.getZoom()+1,eo,ec),this}zoomOut(eo,ec){return this.zoomTo(this.getZoom()-1,eo,ec),this}getBearing(){return this.transform.bearing}setBearing(eo,ec){return this.jumpTo({bearing:eo},ec),this}getPadding(){return this.transform.padding}setPadding(eo,ec){return this.jumpTo({padding:eo},ec),this}rotateTo(ec,ed,em){return this.easeTo(eo.extend({bearing:ec},ed),em)}resetNorth(ec,ed){return this.rotateTo(0,eo.extend({duration:1e3},ec),ed),this}resetNorthPitch(ec,ed){return this.easeTo(eo.extend({bearing:0,pitch:0,duration:1e3},ec),ed),this}snapToNorth(eo,ec){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(eo,ec):this}getPitch(){return this.transform.pitch}setPitch(eo,ec){return this.jumpTo({pitch:eo},ec),this}cameraForBounds(ec,ed){ec=eo.LngLatBounds.convert(ec);let em=ed&&ed.bearing||0,e_=ed&&ed.pitch||0,eg=ec.getNorthWest(),ex=ec.getSouthEast();return this._cameraForBounds(this.transform,eg,ex,em,e_,ed)}_extendCameraOptions(ec){let ed={top:0,bottom:0,right:0,left:0};if("number"==typeof(ec=eo.extend({padding:ed,offset:[0,0],maxZoom:this.transform.maxZoom},ec)).padding){let eo=ec.padding;ec.padding={top:eo,bottom:eo,right:eo,left:eo}}return ec.padding=eo.extend(ed,ec.padding),ec}_minimumAABBFrustumDistance(eo,ec){let ed=ec.max[0]-ec.min[0],em=ec.max[1]-ec.min[1];return ed/em>eo.aspect?ed/(2*Math.tan(.5*eo.fovX)*eo.aspect):em/(2*Math.tan(.5*eo.fovY)*eo.aspect)}_cameraForBoundsOnGlobe(ec,ed,em,e_,eg,ex){let ev=ec.clone(),eb=this._extendCameraOptions(ex);ev.bearing=e_,ev.pitch=eg;let ew=eo.LngLat.convert(ed),eT=eo.LngLat.convert(em),eE=.5*(ew.lat+eT.lat),eM=.5*(ew.lng+eT.lng),eS=eo.latLngToECEF(eE,eM),eA=eo.normalize([],eS),eI=eo.normalize([],eo.cross([],eA,[0,1,0])),eC=eo.cross([],eI,eA),eP=[eI[0],eI[1],eI[2],0,eC[0],eC[1],eC[2],0,eA[0],eA[1],eA[2],0,0,0,0,1],ez=[eS,eo.latLngToECEF(ew.lat,ew.lng),eo.latLngToECEF(eT.lat,ew.lng),eo.latLngToECEF(eT.lat,eT.lng),eo.latLngToECEF(ew.lat,eT.lng),eo.latLngToECEF(eE,ew.lng),eo.latLngToECEF(eE,eT.lng),eo.latLngToECEF(ew.lat,eM),eo.latLngToECEF(eT.lat,eM)],eD=eo.Aabb.fromPoints(ez.map(ec=>[eo.dot(eI,ec),eo.dot(eC,ec),eo.dot(eA,ec)])),ek=eo.transformMat4([],eD.center,eP);0===eo.squaredLength(ek)&&eo.set(ek,0,0,1),eo.normalize(ek,ek),eo.scale$2(ek,ek,eo.GLOBE_RADIUS),ev.center=eo.ecefToLatLng(ek);let eL=ev.getWorldToCameraMatrix(),eR=eo.invert(new Float64Array(16),eL);eD=eo.Aabb.applyTransform(eD,eo.multiply([],eL,eP)),eo.transformMat4(ek,ek,eL);let eB=.5*(eD.max[2]-eD.min[2]),eF=this._minimumAABBFrustumDistance(ev,eD),eO=eo.scale$2([],[0,0,1],eB),eU=eo.add(eO,ek,eO),eN=eF+(0===ev.pitch?0:eo.distance(ek,eU)),eV=ev.globeCenterInViewSpace,ej=eo.sub([],ek,[eV[0],eV[1],eV[2]]);eo.normalize(ej,ej),eo.scale$2(ej,ej,eN);let eG=eo.add([],ek,ej);eo.transformMat4(eG,eG,eR);let eZ=eo.earthRadius/eo.GLOBE_RADIUS,e$=eo.length(eG),eq=eo.mercatorZfromAltitude(Math.max(e$*eZ-eo.earthRadius,Number.EPSILON),0),eX=Math.min(ev.zoomFromMercatorZAdjusted(eq),eb.maxZoom);return eX>.5*(eo.GLOBE_ZOOM_THRESHOLD_MIN+eo.GLOBE_ZOOM_THRESHOLD_MAX)?(ev.setProjection({name:"mercator"}),ev.zoom=eX,this._cameraForBounds(ev,ed,em,e_,eg,ex)):{center:ev.center,zoom:eX,bearing:e_,pitch:eg}}queryTerrainElevation(ec,ed){let em=this.transform.elevation;return em?(ed=eo.extend({},{exaggerated:!0},ed),em.getAtPoint(eo.MercatorCoordinate.fromLngLat(ec),null,ed.exaggerated)):null}_cameraForBounds(ec,ed,em,e_,eg,ex){if("globe"===ec.projection.name)return this._cameraForBoundsOnGlobe(ec,ed,em,e_,eg,ex);let ev=ec.clone(),eb=this._extendCameraOptions(ex),ew=ev.padding;ev.bearing=e_,ev.pitch=eg;let eT=eo.LngLat.convert(ed),eE=eo.LngLat.convert(em),eM=new eo.LngLat(eT.lng,eE.lat),eS=new eo.LngLat(eE.lng,eT.lat),eA=ev.project(eT),eI=ev.project(eE),eC=this.queryTerrainElevation(eT),eP=this.queryTerrainElevation(eE),ez=this.queryTerrainElevation(eM),eD=this.queryTerrainElevation(eS),ek=[[eA.x,eA.y,Math.min(eC||0,eP||0,ez||0,eD||0)],[eI.x,eI.y,Math.max(eC||0,eP||0,ez||0,eD||0)]],eL=eo.Aabb.fromPoints(ek),eR=ev.getWorldToCameraMatrix(),eB=eo.invert(new Float64Array(16),eR);eL=eo.Aabb.applyTransform(eL,eR);let eF=eo.sub([],eL.max,eL.min),eO=ew.left||0,eU=ew.right||0,eN=ew.bottom||0,eV=ew.top||0,{left:ej,right:eG,top:eZ,bottom:e$}=eb.padding,eq=.5*(eO+eU),eX=.5*(eV+eN),eW=Math.min(ev.scaleZoom(ev.scale*Math.min((ev.width-(eO+eU+ej+eG))/eF[0],(ev.height-(eN+eV+e$+eZ))/eF[1])),eb.maxZoom),eH=ev.scale/ev.zoomScale(eW);eL=new eo.Aabb([eL.min[0]-(ej+eq)*eH,eL.min[1]-(e$+eX)*eH,eL.min[2]],[eL.max[0]+(eG+eq)*eH,eL.max[1]+(eZ+eX)*eH,eL.max[2]]);let eJ=.5*eF[2],eY=this._minimumAABBFrustumDistance(ev,eL),eK=[0,0,1,0];eo.transformMat4$1(eK,eK,eR),eo.normalize$2(eK,eK);let eQ=eo.scale$2([],eK,eY+eJ),e0=eo.add([],eL.center,eQ),e1=("number"==typeof eb.offset.x&&"number"==typeof eb.offset.y?new eo.Point(eb.offset.x,eb.offset.y):eo.Point.convert(eb.offset)).rotate(-eo.degToRad(e_));eL.center[0]-=e1.x*eH,eL.center[1]+=e1.y*eH,eo.transformMat4(eL.center,eL.center,eB),eo.transformMat4(e0,e0,eB);let e2=[eL.center[0],eL.center[1],e0[2]*ev.pixelsPerMeter];eo.scale$2(e2,e2,1/ev.worldSize);let e3=eo.lngFromMercatorX(e2[0]),e5=eo.latFromMercatorY(e2[1]),e4=Math.min(ev._zoomFromMercatorZ(e2[2]),eb.maxZoom),e6=new eo.LngLat(e3,e5);return ev.mercatorFromTransition&&e4<.5*(eo.GLOBE_ZOOM_THRESHOLD_MIN+eo.GLOBE_ZOOM_THRESHOLD_MAX)?(ev.setProjection({name:"globe"}),ev.zoom=e4,this._cameraForBounds(ev,ed,em,e_,eg,ex)):{center:e6,zoom:e4,bearing:e_,pitch:eg}}fitBounds(eo,ec,ed){let em=this.cameraForBounds(eo,ec);return this._fitInternal(em,ec,ed)}fitScreenCoordinates(ec,ed,em,e_,eg){let ex=eo.Point.convert(ec),ev=eo.Point.convert(ed),eb=new eo.Point(Math.min(ex.x,ev.x),Math.min(ex.y,ev.y)),ew=new eo.Point(Math.max(ex.x,ev.x),Math.max(ex.y,ev.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(ex,ev))return this;let eT=this.transform.pointLocation3D(eb),eE=this.transform.pointLocation3D(ew),eM=this.transform.pointLocation3D(new eo.Point(eb.x,ew.y)),eS=this.transform.pointLocation3D(new eo.Point(ew.x,eb.y)),eA=[Math.min(eT.lng,eE.lng,eM.lng,eS.lng),Math.min(eT.lat,eE.lat,eM.lat,eS.lat)],eI=[Math.max(eT.lng,eE.lng,eM.lng,eS.lng),Math.max(eT.lat,eE.lat,eM.lat,eS.lat)],eC=e_&&e_.pitch?e_.pitch:this.getPitch(),eP=this._cameraForBounds(this.transform,eA,eI,em,eC,e_);return this._fitInternal(eP,e_,eg)}_fitInternal(ec,ed,em){return ec?(delete(ed=eo.extend(ec,ed)).padding,ed.linear?this.easeTo(ed,em):this.flyTo(ed,em)):this}jumpTo(ec,ed){this.stop();let em=ec.preloadOnly?this.transform.clone():this.transform,e_=!1,eg=!1,ex=!1;return"zoom"in ec&&em.zoom!==+ec.zoom&&(e_=!0,em.zoom=+ec.zoom),void 0!==ec.center&&(em.center=eo.LngLat.convert(ec.center)),"bearing"in ec&&em.bearing!==+ec.bearing&&(eg=!0,em.bearing=+ec.bearing),"pitch"in ec&&em.pitch!==+ec.pitch&&(ex=!0,em.pitch=+ec.pitch),null==ec.padding||em.isPaddingEqual(ec.padding)||(em.padding=ec.padding),ec.preloadOnly?(this._preloadTiles(em),this):(this.fire(new eo.Event("movestart",ed)).fire(new eo.Event("move",ed)),e_&&this.fire(new eo.Event("zoomstart",ed)).fire(new eo.Event("zoom",ed)).fire(new eo.Event("zoomend",ed)),eg&&this.fire(new eo.Event("rotatestart",ed)).fire(new eo.Event("rotate",ed)).fire(new eo.Event("rotateend",ed)),ex&&this.fire(new eo.Event("pitchstart",ed)).fire(new eo.Event("pitch",ed)).fire(new eo.Event("pitchend",ed)),this.fire(new eo.Event("moveend",ed)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||eo.warnOnce(tv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(ec,ed){let em=this.transform;if(!em.projection.supportsFreeCamera)return eo.warnOnce(tv),this;this.stop();let e_=em.zoom,eg=em.pitch,ex=em.bearing;em.setFreeCameraOptions(ec);let ev=e_!==em.zoom,eb=eg!==em.pitch,ew=ex!==em.bearing;return this.fire(new eo.Event("movestart",ed)).fire(new eo.Event("move",ed)),ev&&this.fire(new eo.Event("zoomstart",ed)).fire(new eo.Event("zoom",ed)).fire(new eo.Event("zoomend",ed)),ew&&this.fire(new eo.Event("rotatestart",ed)).fire(new eo.Event("rotate",ed)).fire(new eo.Event("rotateend",ed)),eb&&this.fire(new eo.Event("pitchstart",ed)).fire(new eo.Event("pitch",ed)).fire(new eo.Event("pitchend",ed)),this.fire(new eo.Event("moveend",ed)),this}easeTo(ec,ed){let em,e_,eg,ex,ev;this._stop(!1,ec.easeId),(!1===(ec=eo.extend({offset:[0,0],duration:500,easing:eo.ease},ec)).animate||this._prefersReducedMotion(ec))&&(ec.duration=0);let eb=this.transform,ew=this.getZoom(),eT=this.getBearing(),eE=this.getPitch(),eM=this.getPadding(),eS="zoom"in ec?+ec.zoom:ew,eA="bearing"in ec?this._normalizeBearing(ec.bearing,eT):eT,eI="pitch"in ec?+ec.pitch:eE,eC="padding"in ec?ec.padding:eb.padding,eP=eo.Point.convert(ec.offset);if("globe"===eb.projection.name){let ed=eo.MercatorCoordinate.fromLngLat(eb.center),ex=eP.rotate(-eb.angle);ed.x+=ex.x/eb.worldSize,ed.y+=ex.y/eb.worldSize;let ev=ed.toLngLat(),ew=eo.LngLat.convert(ec.center||ev);this._normalizeCenter(ew),em=eb.centerPoint.add(ex),e_=new eo.Point(ed.x,ed.y).mult(eb.worldSize),eg=new eo.Point(eo.mercatorXfromLng(ew.lng),eo.mercatorYfromLat(ew.lat)).mult(eb.worldSize).sub(e_)}else{em=eb.centerPoint.add(eP);let ed=eb.pointLocation(em),ex=eo.LngLat.convert(ec.center||ed);this._normalizeCenter(ex),e_=eb.project(ed),eg=eb.project(ex).sub(e_)}let ez=eb.zoomScale(eS-ew);ec.around&&(ex=eo.LngLat.convert(ec.around),ev=eb.locationPoint(ex));let eD=this._zooming||eS!==ew,ek=this._rotating||eT!==eA,eL=this._pitching||eI!==eE,eR=!eb.isPaddingEqual(eC),T=eb=>eB=>{if(eD&&(eb.zoom=eo.number(ew,eS,eB)),ek&&(eb.bearing=eo.number(eT,eA,eB)),eL&&(eb.pitch=eo.number(eE,eI,eB)),eR&&(eb.interpolatePadding(eM,eC,eB),em=eb.centerPoint.add(eP)),ex)eb.setLocationAtPoint(ex,ev);else{let eo=eb.zoomScale(eb.zoom-ew),ec=eS>ew?Math.min(2,ez):Math.max(.5,ez),ed=Math.pow(ec,1-eB),ex=eb.unproject(e_.add(eg.mult(eB*ed)).mult(eo));eb.setLocationAtPoint(eb.renderWorldCopies?ex.wrap():ex,em)}return ec.preloadOnly||this._fireMoveEvents(ed),eb};if(ec.preloadOnly){let eo=this._emulate(T,ec.duration,eb);return this._preloadTiles(eo),this}let eB={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=eD,this._rotating=ek,this._pitching=eL,this._padding=eR,this._easeId=ec.easeId,this._prepareEase(ed,ec.noMoveStart,eB),this._ease(T(eb),eo=>{eb.recenterOnTerrain(),this._afterEase(ed,eo)},ec),this}_prepareEase(ec,ed,em={}){this._moving=!0,this.transform.cameraElevationReference="sea",ed||em.moving||this.fire(new eo.Event("movestart",ec)),this._zooming&&!em.zooming&&this.fire(new eo.Event("zoomstart",ec)),this._rotating&&!em.rotating&&this.fire(new eo.Event("rotatestart",ec)),this._pitching&&!em.pitching&&this.fire(new eo.Event("pitchstart",ec))}_fireMoveEvents(ec){this.fire(new eo.Event("move",ec)),this._zooming&&this.fire(new eo.Event("zoom",ec)),this._rotating&&this.fire(new eo.Event("rotate",ec)),this._pitching&&this.fire(new eo.Event("pitch",ec))}_afterEase(ec,ed){if(this._easeId&&ed&&this._easeId===ed)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let em=this._zooming,e_=this._rotating,eg=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,em&&this.fire(new eo.Event("zoomend",ec)),e_&&this.fire(new eo.Event("rotateend",ec)),eg&&this.fire(new eo.Event("pitchend",ec)),this.fire(new eo.Event("moveend",ec))}flyTo(ec,ed){if(this._prefersReducedMotion(ec)){let em=eo.pick(ec,["center","zoom","bearing","pitch","around"]);return this.jumpTo(em,ed)}this.stop(),ec=eo.extend({offset:[0,0],speed:1.2,curve:1.42,easing:eo.ease},ec);let em=this.transform,e_=this.getZoom(),eg=this.getBearing(),ex=this.getPitch(),ev=this.getPadding(),eb="zoom"in ec?eo.clamp(+ec.zoom,em.minZoom,em.maxZoom):e_,ew="bearing"in ec?this._normalizeBearing(ec.bearing,eg):eg,eT="pitch"in ec?+ec.pitch:ex,eE="padding"in ec?ec.padding:em.padding,eM=em.zoomScale(eb-e_),eS=eo.Point.convert(ec.offset),eA=em.centerPoint.add(eS),eI=em.pointLocation(eA),eC=eo.LngLat.convert(ec.center||eI);this._normalizeCenter(eC);let eP=em.project(eI),ez=em.project(eC).sub(eP),eD=ec.curve,ek=Math.max(em.width,em.height),eL=ek/eM,eR=ez.mag();if("minZoom"in ec){let ed=eo.clamp(Math.min(ec.minZoom,e_,eb),em.minZoom,em.maxZoom),eg=ek/em.zoomScale(ed-e_);eD=Math.sqrt(eg/eR*2)}let eB=eD*eD;function E(eo){let ec=(eL*eL-ek*ek+(eo?-1:1)*eB*eB*eR*eR)/(2*(eo?eL:ek)*eB*eR);return Math.log(Math.sqrt(ec*ec+1)-ec)}function C(eo){return(Math.exp(eo)-Math.exp(-eo))/2}function M(eo){return(Math.exp(eo)+Math.exp(-eo))/2}let eF=E(0),P=function(eo){return M(eF)/M(eF+eD*eo)},S=function(eo){var ec;return ek*((M(eF)*(C(ec=eF+eD*eo)/M(ec))-C(eF))/eB)/eR},eO=(E(1)-eF)/eD;if(1e-6>Math.abs(eR)||!isFinite(eO)){if(1e-6>Math.abs(ek-eL))return this.easeTo(ec,ed);let eo=eL<ek?-1:1;eO=Math.abs(Math.log(eL/ek))/eD,S=function(){return 0},P=function(ec){return Math.exp(eo*eD*ec)}}ec.duration="duration"in ec?+ec.duration:1e3*eO/("screenSpeed"in ec?+ec.screenSpeed/eD:+ec.speed),ec.maxDuration&&ec.duration>ec.maxDuration&&(ec.duration=0);let eU=eg!==ew,eN=eT!==ex,eV=!em.isPaddingEqual(eE),R=em=>eM=>{let eI=eM*eO,eD=1/P(eI);em.zoom=1===eM?eb:e_+em.scaleZoom(eD),eU&&(em.bearing=eo.number(eg,ew,eM)),eN&&(em.pitch=eo.number(ex,eT,eM)),eV&&(em.interpolatePadding(ev,eE,eM),eA=em.centerPoint.add(eS));let ek=1===eM?eC:em.unproject(eP.add(ez.mult(S(eI))).mult(eD));return em.setLocationAtPoint(em.renderWorldCopies?ek.wrap():ek,eA),em._updateCameraOnTerrain(),ec.preloadOnly||this._fireMoveEvents(ed),em};if(ec.preloadOnly){let eo=this._emulate(R,ec.duration,em);return this._preloadTiles(eo),this}return this._zooming=!0,this._rotating=eU,this._pitching=eN,this._padding=eV,this._prepareEase(ed,!1),this._ease(R(em),()=>this._afterEase(ed),ec),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(eo,ec){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let eo=this._onEaseEnd;this._onEaseEnd=void 0,eo.call(this,ec)}if(!eo){let eo=this.handlers;eo&&eo.stop(!1)}return this}_ease(ec,ed,em){!1===em.animate||0===em.duration?(ec(1),ed()):(this._easeStart=eo.exported.now(),this._easeOptions=em,this._onEaseFrame=ec,this._onEaseEnd=ed,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let ec=Math.min((eo.exported.now()-this._easeStart)/this._easeOptions.duration,1),ed=this._onEaseFrame;ed&&ed(this._easeOptions.easing(ec)),ec<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(ec,ed){ec=eo.wrap(ec,-180,180);let em=Math.abs(ec-ed);return Math.abs(ec-360-ed)<em&&(ec-=360),Math.abs(ec+360-ed)<em&&(ec+=360),ec}_normalizeCenter(eo){let ec=this.transform;if(!ec.renderWorldCopies||ec.maxBounds)return;let ed=eo.lng-ec.center.lng;eo.lng+=ed>180?-360:ed<-180?360:0}_prefersReducedMotion(ec){return this._respectPrefersReducedMotion&&eo.exported.prefersReducedMotion&&!(ec&&ec.essential)}_emulate(eo,ec,ed){let em=Math.ceil(15*ec/1e3),e_=[],eg=eo(ed.clone());for(let eo=0;eo<=em;eo++){let ec=eg(eo/em);e_.push(ec.clone())}return e_}};let Hr=class Hr{constructor(ec={}){this.options=ec,eo.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(eo){let ec=this.options&&this.options.compact;return this._map=eo,this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n("button","mapboxgl-ctrl-attrib-button",this._container),n("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),ec&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===ec&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(eo,ec){let ed=this._map._getUIString(`AttributionControl.${ec}`);eo.setAttribute("aria-label",ed),eo.removeAttribute("title"),eo.firstElementChild&&eo.firstElementChild.setAttribute("title",ed)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let ec=this._editLink;ec||(ec=this._editLink=this._container.querySelector(".mapbox-improve-map"));let ed=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||eo.config.ACCESS_TOKEN}];if(ec){let em=ed.reduce((eo,ec,em)=>(ec.value&&(eo+=`${ec.key}=${ec.value}${em<ed.length-1?"&":""}`),eo),"?");ec.href=`${eo.config.FEEDBACK_URL}/${em}#${Jo(this._map,!0)}`,ec.rel="noopener nofollow",this._setElementTitle(ec,"MapFeedback")}}_updateData(eo){eo&&("metadata"===eo.sourceDataType||"visibility"===eo.sourceDataType||"style"===eo.dataType)&&(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let eo=[];if(this._map.style.stylesheet){let eo=this._map.style.stylesheet;this.styleOwner=eo.owner,this.styleId=eo.id}let ec=this._map.style._sourceCaches;for(let ed in ec){let em=ec[ed];if(em.used){let ec=em.getSource();ec.attribution&&0>eo.indexOf(ec.attribution)&&eo.push(ec.attribution)}}eo.sort((eo,ec)=>eo.length-ec.length),eo=eo.filter((ec,ed)=>{for(let em=ed+1;em<eo.length;em++)if(eo[em].indexOf(ec)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?eo=[...this.options.customAttribution,...eo]:eo.unshift(this.options.customAttribution));let ed=eo.join(" | ");ed!==this._attribHTML&&(this._attribHTML=ed,eo.length?(this._innerContainer.innerHTML=ed,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}};let Yr=class Yr{constructor(){eo.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(eo){this._map=eo,this._container=n("div","mapboxgl-ctrl");let ec=n("a","mapboxgl-ctrl-logo");return ec.target="_blank",ec.rel="noopener nofollow",ec.href="https://www.mapbox.com/",ec.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),ec.setAttribute("rel","noopener nofollow"),this._container.appendChild(ec),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(eo){eo&&"metadata"!==eo.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let eo=this._map.style._sourceCaches;if(0===Object.entries(eo).length)return!0;for(let ec in eo){let ed=eo[ec].getSource();if(ed.hasOwnProperty("mapbox_logo")&&!ed.mapbox_logo)return!1}return!0}_updateCompact(){let eo=this._container.children;if(eo.length){let ec=eo[0];this._map.getCanvasContainer().offsetWidth<250?ec.classList.add("mapboxgl-compact"):ec.classList.remove("mapboxgl-compact")}}};let Kr=class Kr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(eo){let ec=++this._id;return this._queue.push({callback:eo,id:ec,cancelled:!1}),ec}remove(eo){let ec=this._currentlyRunning,ed=ec?this._queue.concat(ec):this._queue;for(let ec of ed)if(ec.id===eo)return void(ec.cancelled=!0)}run(eo=0){let ec=this._currentlyRunning=this._queue;for(let ed of(this._queue=[],ec))if(!ed.cancelled&&(ed.callback(eo),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}};function Jr(ec,ed,em){if(ec=new eo.LngLat(ec.lng,ec.lat),ed){let e_=new eo.LngLat(ec.lng-360,ec.lat),eg=new eo.LngLat(ec.lng+360,ec.lat),ex=360*Math.ceil(Math.abs(ec.lng-em.center.lng)/360),ev=em.locationPoint(ec).distSqr(ed),eb=ed.x<0||ed.y<0||ed.x>em.width||ed.y>em.height;em.locationPoint(e_).distSqr(ed)<ev&&(eb||Math.abs(e_.lng-em.center.lng)<ex)?ec=e_:em.locationPoint(eg).distSqr(ed)<ev&&(eb||Math.abs(eg.lng-em.center.lng)<ex)&&(ec=eg)}for(;Math.abs(ec.lng-em.center.lng)>180;){let eo=em.locationPoint(ec);if(eo.x>=0&&eo.y>=0&&eo.x<=em.width&&eo.y<=em.height)break;ec.lng>em.center.lng?ec.lng-=360:ec.lng+=360}return ec}let tb={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};let en=class en extends eo.Evented{constructor(ec,ed){if(super(),(ec instanceof eo.window.HTMLElement||ed)&&(ec=eo.extend({element:ec},ed)),eo.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=ec&&ec.anchor||"center",this._color=ec&&ec.color||"#3FB1CE",this._scale=ec&&ec.scale||1,this._draggable=ec&&ec.draggable||!1,this._clickTolerance=ec&&ec.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=ec&&ec.rotation||0,this._rotationAlignment=ec&&ec.rotationAlignment||"auto",this._pitchAlignment=ec&&ec.pitchAlignment&&ec.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=ec&&ec.occludedOpacity||.2,ec&&ec.element)this._element=ec.element,this._offset=eo.Point.convert(ec&&ec.offset||[0,0]);else{this._defaultMarker=!0,this._element=n("div");let ed=s("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},this._element),em=s("radialGradient",{id:"shadowGradient"},s("defs",{},ed));s("stop",{offset:"10%","stop-opacity":.4},em),s("stop",{offset:"100%","stop-opacity":.05},em),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},ed),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},ed),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},ed),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},ed),this._offset=eo.Point.convert(ec&&ec.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",eo=>{eo.preventDefault()}),this._element.addEventListener("mousedown",eo=>{eo.preventDefault()});let em=this._element.classList;for(let eo in tb)em.remove(`mapboxgl-marker-anchor-${eo}`);em.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(eo){return eo===this._map||(this.remove(),this._map=eo,eo.getCanvasContainer().appendChild(this._element),eo.on("move",this._updateMoving),eo.on("moveend",this._update),eo.on("remove",this._clearFadeTimer),eo._addMarker(this),this.setDraggable(this._draggable),this._update(),eo.on("click",this._onMapClick)),this}remove(){let eo=this._map;return eo&&(eo.off("click",this._onMapClick),eo.off("move",this._updateMoving),eo.off("moveend",this._update),eo.off("mousedown",this._addDragHandler),eo.off("touchstart",this._addDragHandler),eo.off("mouseup",this._onUp),eo.off("touchend",this._onUp),eo.off("mousemove",this._onMove),eo.off("touchmove",this._onMove),eo.off("remove",this._clearFadeTimer),eo._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(ec){return this._lngLat=eo.LngLat.convert(ec),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(eo){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),eo){if(!("offset"in eo.options)){let ec=Math.sqrt(91.125);eo.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[ec,-1*(24.6+ec)],"bottom-right":[-ec,-1*(24.6+ec)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=eo,eo._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(eo){let ec=eo.code,ed=eo.charCode||eo.keyCode;"Space"!==ec&&"Enter"!==ec&&32!==ed&&13!==ed||this.togglePopup()}_onMapClick(eo){let ec=eo.originalEvent.target,ed=this._element;this._popup&&(ec===ed||ed.contains(ec))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let eo=this._popup;return eo&&(eo.isOpen()?(eo.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(eo.addTo(this._map),this._element.setAttribute("aria-expanded","true"))),this}_behindTerrain(){let eo=this._map,ec=this._pos;if(!eo||!ec)return!1;let ed=eo.unproject(ec),em=eo.getFreeCameraOptions();if(!em.position)return!1;let e_=em.position.toLngLat();return e_.distanceTo(ed)<.9*e_.distanceTo(this._lngLat)}_evaluateOpacity(){let ec;let ed=this._map;if(!ed)return;let em=this._pos;if(!em||em.x<0||em.x>ed.transform.width||em.y<0||em.y>ed.transform.height)return void this._clearFadeTimer();let e_=ed.unproject(em);ed._showingGlobe()&&eo.isLngLatBehindGlobe(ed.transform,this._lngLat)?ec=0:(ec=1-ed._queryFogOpacity(e_),ed.transform._terrainEnabled()&&ed.getTerrain()&&this._behindTerrain()&&(ec*=this._occludedOpacity)),this._element.style.opacity=`${ec}`,this._element.style.pointerEvents=ec>0?"auto":"none",this._popup&&this._popup._setOpacity(ec),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let eo=this._pos;if(!eo||!this._map)return;let ec=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${eo.x}px,${eo.y}px)
            ${tb[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${ec.x}px,${ec.y}px)
        `}_calculateXYTransform(){let ec=this._pos,ed=this._map,em=this.getPitchAlignment();if(!ed||!ec||"map"!==em)return"";if(!ed._showingGlobe()){let eo=ed.getPitch();return eo?`rotateX(${eo}deg)`:""}let e_=eo.radToDeg(eo.globeTiltAtLngLat(ed.transform,this._lngLat)),eg=ec.sub(eo.globeCenterToScreenPoint(ed.transform)),ex=Math.abs(eg.x)+Math.abs(eg.y);if(0===ex)return"";let ev=e_/ex;return`rotateX(${-eg.y*ev}deg) rotateY(${eg.x*ev}deg)`}_calculateZTransform(){let ec=this._pos,ed=this._map;if(!ed||!ec)return"";let em=0,e_=this.getRotationAlignment();if("map"===e_){if(ed._showingGlobe()){let ec=ed.project(new eo.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),e_=ed.project(new eo.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(ec);em=eo.radToDeg(Math.atan2(e_.y,e_.x))-90}else em=-ed.getBearing()}else if("horizon"===e_){let e_=eo.smoothstep(4,6,ed.getZoom()),eg=eo.globeCenterToScreenPoint(ed.transform);eg.y+=e_*ed.transform.height;let ex=ec.sub(eg),ev=eo.radToDeg(Math.atan2(ex.y,ex.x));em=(ev>90?ev-270:ev+90)*(1-e_)}return(em+=this._rotation)?`rotateZ(${em}deg)`:""}_update(ec){eo.window.cancelAnimationFrame(this._updateFrameId);let ed=this._map;ed&&(ed.transform.renderWorldCopies&&(this._lngLat=Jr(this._lngLat,this._pos,ed.transform)),this._pos=ed.project(this._lngLat),!0===ec?this._updateFrameId=eo.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),ed._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(ed._showingGlobe()||ed.getTerrain()||ed.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(ec){return this._offset=eo.Point.convert(ec),this._update(),this}_onMove(ec){let ed=this._map;if(!ed)return;let em=this._pointerdownPos,e_=this._positionDelta;if(em&&e_){if(!this._isDragging){let eo=this._clickTolerance||ed._clickTolerance;if(ec.point.dist(em)<eo)return;this._isDragging=!0}this._pos=ec.point.sub(e_),this._lngLat=ed.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new eo.Event("dragstart"))),this.fire(new eo.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let ec=this._map;ec&&(ec.off("mousemove",this._onMove),ec.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new eo.Event("dragend")),this._state="inactive"}_addDragHandler(eo){let ec=this._map,ed=this._pos;ec&&ed&&this._element.contains(eo.originalEvent.target)&&(eo.preventDefault(),this._positionDelta=eo.point.sub(ed),this._pointerdownPos=eo.point,this._state="pending",ec.on("mousemove",this._onMove),ec.on("touchmove",this._onMove),ec.once("mouseup",this._onUp),ec.once("touchend",this._onUp))}setDraggable(eo){this._draggable=!!eo;let ec=this._map;return ec&&(eo?(ec.on("mousedown",this._addDragHandler),ec.on("touchstart",this._addDragHandler)):(ec.off("mousedown",this._addDragHandler),ec.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(eo){return this._rotation=eo||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(eo){return this._rotationAlignment=eo||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(eo){return this._pitchAlignment=eo||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(eo){return this._occludedOpacity=eo||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}};let tw={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"};function rn(ec=new eo.Point(0,0),ed="bottom"){if("number"==typeof ec){let em=Math.round(Math.sqrt(.5*Math.pow(ec,2)));switch(ed){case"top":return new eo.Point(0,ec);case"top-left":return new eo.Point(em,em);case"top-right":return new eo.Point(-em,em);case"bottom":return new eo.Point(0,-ec);case"bottom-left":return new eo.Point(em,-em);case"bottom-right":return new eo.Point(-em,-em);case"left":return new eo.Point(ec,0);case"right":return new eo.Point(-ec,0)}return new eo.Point(0,0)}return ec instanceof eo.Point||Array.isArray(ec)?eo.Point.convert(ec):eo.Point.convert(ec[ed]||[0,0])}let nn=class nn{constructor(eo){this.jumpTo(eo)}getValue(ec){if(ec<=this._startTime)return this._start;if(ec>=this._endTime)return this._end;let ed=eo.easeCubicInOut((ec-this._startTime)/(this._endTime-this._startTime));return this._start*(1-ed)+this._end*ed}isEasing(eo){return eo>=this._startTime&&eo<=this._endTime}jumpTo(eo){this._startTime=-1/0,this._endTime=-1/0,this._start=eo,this._end=eo}easeTo(eo,ec,ed){this._start=this.getValue(ec),this._end=eo,this._startTime=ec,this._endTime=ec+ed}};let tT={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},tE={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},tM={showCompass:!0,showZoom:!0,visualizePitch:!1};let cn=class cn{constructor(ec,ed,em=!1){this._clickTolerance=10,this.element=ed,this.mouseRotate=new yr({clickTolerance:ec.dragRotate._mouseRotate._clickTolerance}),this.map=ec,em&&(this.mousePitch=new br({clickTolerance:ec.dragRotate._mousePitch._clickTolerance})),eo.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),ed.addEventListener("mousedown",this.mousedown),ed.addEventListener("touchstart",this.touchstart,{passive:!1}),ed.addEventListener("touchmove",this.touchmove),ed.addEventListener("touchend",this.touchend),ed.addEventListener("touchcancel",this.reset)}down(eo,ec){this.mouseRotate.mousedown(eo,ec),this.mousePitch&&this.mousePitch.mousedown(eo,ec),h()}move(eo,ec){let ed=this.map,em=this.mouseRotate.mousemoveWindow(eo,ec),e_=em&&em.bearingDelta;if(e_&&ed.setBearing(ed.getBearing()+e_),this.mousePitch){let em=this.mousePitch.mousemoveWindow(eo,ec),e_=em&&em.pitchDelta;e_&&ed.setPitch(ed.getPitch()+e_)}}off(){let eo=this.element;eo.removeEventListener("mousedown",this.mousedown),eo.removeEventListener("touchstart",this.touchstart,{passive:!1}),eo.removeEventListener("touchmove",this.touchmove),eo.removeEventListener("touchend",this.touchend),eo.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){u(),eo.window.removeEventListener("mousemove",this.mousemove),eo.window.removeEventListener("mouseup",this.mouseup)}mousedown(ec){this.down(eo.extend({},ec,{ctrlKey:!0,preventDefault:()=>ec.preventDefault()}),p(this.element,ec)),eo.window.addEventListener("mousemove",this.mousemove),eo.window.addEventListener("mouseup",this.mouseup)}mousemove(eo){this.move(eo,p(this.element,eo))}mouseup(eo){this.mouseRotate.mouseupWindow(eo),this.mousePitch&&this.mousePitch.mouseupWindow(eo),this.offTemp()}touchstart(eo){1!==eo.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,eo.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>eo.preventDefault()},this._startPos))}touchmove(eo){1!==eo.targetTouches.length?this.reset():(this._lastPos=m(this.element,eo.targetTouches)[0],this.move({preventDefault:()=>eo.preventDefault()},this._lastPos))}touchend(eo){0===eo.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}};let tS={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},tA={maxWidth:100,unit:"metric"},tI={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},tC={version:eo.version,supported:o,setRTLTextPlugin:eo.setRTLTextPlugin,getRTLTextPluginStatus:eo.getRTLTextPluginStatus,Map:class extends $r{constructor(ec){if(eo.LivePerformanceUtils.mark(eo.PerformanceMarkers.create),null!=(ec=eo.extend({},tE,ec)).minZoom&&null!=ec.maxZoom&&ec.minZoom>ec.maxZoom)throw Error("maxZoom must be greater than or equal to minZoom");if(null!=ec.minPitch&&null!=ec.maxPitch&&ec.minPitch>ec.maxPitch)throw Error("maxPitch must be greater than or equal to minPitch");if(null!=ec.minPitch&&ec.minPitch<0)throw Error("minPitch must be greater than or equal to 0");if(null!=ec.maxPitch&&ec.maxPitch>85)throw Error("maxPitch must be less than or equal to 85");if(ec.antialias&&eo.isSafariWithAntialiasingBug(eo.window)&&(ec.antialias=!1,eo.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Ho(ec.minZoom,ec.maxZoom,ec.minPitch,ec.maxPitch,ec.renderWorldCopies),ec),this._interactive=ec.interactive,this._minTileCacheSize=ec.minTileCacheSize,this._maxTileCacheSize=ec.maxTileCacheSize,this._failIfMajorPerformanceCaveat=ec.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=ec.preserveDrawingBuffer,this._antialias=ec.antialias,this._useWebGL2=ec.useWebGL2,this._trackResize=ec.trackResize,this._bearingSnap=ec.bearingSnap,this._refreshExpiredTiles=ec.refreshExpiredTiles,this._fadeDuration=ec.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=ec.crossSourceCollisions,this._collectResourceTiming=ec.collectResourceTiming,this._optimizeForTerrain=ec.optimizeForTerrain,this._language=this._parseLanguage(ec.language),this._worldview=ec.worldview,this._renderTaskQueue=new Kr,this._domRenderTaskQueue=new Kr,this._controls=[],this._markers=[],this._popups=[],this._mapId=eo.uniqueId(),this._locale=eo.extend({},tT,ec.locale),this._clickTolerance=ec.clickTolerance,this._cooperativeGestures=ec.cooperativeGestures,this._performanceMetricsCollection=ec.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new nn(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new eo.RequestManager(ec.transformRequest,ec.accessToken,ec.testMode),this._silenceAuthErrors=!!ec.testMode,"string"==typeof ec.container){if(this._container=eo.window.document.getElementById(ec.container),!this._container)throw Error(`Container '${ec.container}' not found.`)}else{if(!(ec.container instanceof eo.window.HTMLElement))throw Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=ec.container}if(this._container.childNodes.length>0&&eo.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),ec.maxBounds&&this.setMaxBounds(ec.maxBounds),eo.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==eo.window&&(eo.window.addEventListener("online",this._onWindowOnline,!1),eo.window.addEventListener("resize",this._onWindowResize,!1),eo.window.addEventListener("orientationchange",this._onWindowResize,!1),eo.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),eo.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Xr(this,ec),this._localFontFamily=ec.localFontFamily,this._localIdeographFontFamily=ec.localIdeographFontFamily,ec.style&&this.setStyle(ec.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),ec.projection&&this.setProjection(ec.projection),this._hash=ec.hash&&new Ko("string"==typeof ec.hash&&ec.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:ec.center,zoom:ec.zoom,bearing:ec.bearing,pitch:ec.pitch}),ec.bounds&&(this.resize(),this.fitBounds(ec.bounds,eo.extend({},ec.fitBoundsOptions,{duration:0})))),this.resize(),ec.attributionControl&&this.addControl(new Hr({customAttribution:ec.customAttribution})),this._logoControl=new Yr,this.addControl(this._logoControl,ec.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",ec=>{this._update("style"===ec.dataType),this.fire(new eo.Event(`${ec.dataType}data`,ec))}),this.on("dataloading",ec=>{this.fire(new eo.Event(`${ec.dataType}dataloading`,ec))})}_getMapId(){return this._mapId}addControl(ec,ed){if(void 0===ed&&(ed=ec.getDefaultPosition?ec.getDefaultPosition():"top-right"),!ec||!ec.onAdd)return this.fire(new eo.ErrorEvent(Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let em=ec.onAdd(this);this._controls.push(ec);let e_=this._controlPositions[ed];return -1!==ed.indexOf("bottom")?e_.insertBefore(em,e_.firstChild):e_.appendChild(em),this}removeControl(ec){if(!ec||!ec.onRemove)return this.fire(new eo.ErrorEvent(Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let ed=this._controls.indexOf(ec);return ed>-1&&this._controls.splice(ed,1),ec.onRemove(this),this}hasControl(eo){return this._controls.indexOf(eo)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(ec){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let ed=!this._moving;return ed&&this.fire(new eo.Event("movestart",ec)).fire(new eo.Event("move",ec)),this.fire(new eo.Event("resize",ec)),ed&&this.fire(new eo.Event("moveend",ec)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(ec){return this.transform.setMaxBounds(eo.LngLatBounds.convert(ec)),this._update()}setMinZoom(ec){if((ec=null==ec?-2:ec)>=-2&&ec<=this.transform.maxZoom)return this.transform.minZoom=ec,this._update(),this.getZoom()<ec?this.setZoom(ec):this.fire(new eo.Event("zoomstart")).fire(new eo.Event("zoom")).fire(new eo.Event("zoomend")),this;throw Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(ec){if((ec=null==ec?22:ec)>=this.transform.minZoom)return this.transform.maxZoom=ec,this._update(),this.getZoom()>ec?this.setZoom(ec):this.fire(new eo.Event("zoomstart")).fire(new eo.Event("zoom")).fire(new eo.Event("zoomend")),this;throw Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(ec){if((ec=null==ec?0:ec)<0)throw Error("minPitch must be greater than or equal to 0");if(ec>=0&&ec<=this.transform.maxPitch)return this.transform.minPitch=ec,this._update(),this.getPitch()<ec?this.setPitch(ec):this.fire(new eo.Event("pitchstart")).fire(new eo.Event("pitch")).fire(new eo.Event("pitchend")),this;throw Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(ec){if((ec=null==ec?85:ec)>85)throw Error("maxPitch must be less than or equal to 85");if(ec>=this.transform.minPitch)return this.transform.maxPitch=ec,this._update(),this.getPitch()>ec?this.setPitch(ec):this.fire(new eo.Event("pitchstart")).fire(new eo.Event("pitch")).fire(new eo.Event("pitchend")),this;throw Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(eo){return this.transform.renderWorldCopies=eo,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(ec){return"auto"===ec?eo.window.navigator.language:Array.isArray(ec)?0===ec.length?void 0:ec.map(ec=>"auto"===ec?eo.window.navigator.language:ec):ec}setLanguage(eo){let ec=this._parseLanguage(eo);if(!this.style||ec===this._language)return this;for(let eo of(this._language=ec,this.style._reloadSources(),this._controls))eo._setLanguage&&eo._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(eo){return this.style&&eo!==this._worldview&&(this._worldview=eo,this.style._reloadSources()),this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(eo){return this._lazyInitEmptyStyle(),eo?"string"==typeof eo&&(eo={name:eo}):eo=null,this._useExplicitProjection=!!eo,this._prioritizeAndUpdateProjection(eo,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){let ec;if("globe"!==this.getProjection().name)return;let ed=this.transform,em=ed.projection.name;"globe"===em&&ed.zoom>=eo.GLOBE_ZOOM_THRESHOLD_MAX?(ed.setMercatorFromTransition(),ec=!0):"mercator"===em&&ed.zoom<eo.GLOBE_ZOOM_THRESHOLD_MAX&&(ed.setProjection({name:"globe"}),ec=!0),ec&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(eo,ec){return this._updateProjection(eo||ec||{name:"mercator"})}_updateProjection(ec){let ed;if(ed="globe"===ec.name&&this.transform.zoom>=eo.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(ec),this.style.applyProjectionUpdate(),ed){for(let eo in this.painter.clearBackgroundTiles(),this.style._sourceCaches)this.style._sourceCaches[eo].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(ec){return this.transform.locationPoint3D(eo.LngLat.convert(ec))}unproject(ec){return this.transform.pointLocation3D(eo.Point.convert(ec))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(eo,ec,ed){if("mouseenter"===eo||"mouseover"===eo){let em=!1;return{layers:new Set(ec),listener:ed,delegates:{mousemove:e_=>{let eg=ec.filter(eo=>this.getLayer(eo)),ex=eg.length?this.queryRenderedFeatures(e_.point,{layers:eg}):[];ex.length?em||(em=!0,ed.call(this,new ar(eo,this,e_.originalEvent,{features:ex}))):em=!1},mouseout:()=>{em=!1}}}}if("mouseleave"===eo||"mouseout"===eo){let em=!1;return{layers:new Set(ec),listener:ed,delegates:{mousemove:e_=>{let eg=ec.filter(eo=>this.getLayer(eo));(eg.length?this.queryRenderedFeatures(e_.point,{layers:eg}):[]).length?em=!0:em&&(em=!1,ed.call(this,new ar(eo,this,e_.originalEvent)))},mouseout:ec=>{em&&(em=!1,ed.call(this,new ar(eo,this,ec.originalEvent)))}}}}return{layers:new Set(ec),listener:ed,delegates:{[eo]:eo=>{let em=ec.filter(eo=>this.getLayer(eo)),e_=em.length?this.queryRenderedFeatures(eo.point,{layers:em}):[];e_.length&&(eo.features=e_,ed.call(this,eo),delete eo.features)}}}}on(eo,ec,ed){if(void 0===ed)return super.on(eo,ec);Array.isArray(ec)||(ec=[ec]);let em=this._createDelegatedListener(eo,ec,ed);for(let ec in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[eo]=this._delegatedListeners[eo]||[],this._delegatedListeners[eo].push(em),em.delegates)this.on(ec,em.delegates[ec]);return this}once(eo,ec,ed){if(void 0===ed)return super.once(eo,ec);Array.isArray(ec)||(ec=[ec]);let em=this._createDelegatedListener(eo,ec,ed);for(let eo in em.delegates)this.once(eo,em.delegates[eo]);return this}off(eo,ec,ed){if(void 0===ed)return super.off(eo,ec);ec=new Set(Array.isArray(ec)?ec:[ec]);let o=(eo,ec)=>{if(eo.size!==ec.size)return!1;for(let ed of eo)if(!ec.has(ed))return!1;return!0},em=this._delegatedListeners?this._delegatedListeners[eo]:void 0;return em&&(eo=>{for(let em=0;em<eo.length;em++){let e_=eo[em];if(e_.listener===ed&&o(e_.layers,ec)){for(let eo in e_.delegates)this.off(eo,e_.delegates[eo]);return eo.splice(em,1),this}}})(em),this}queryRenderedFeatures(ec,ed){return this.style?(void 0!==ed||void 0===ec||ec instanceof eo.Point||Array.isArray(ec)||(ed=ec,ec=void 0),this.style.queryRenderedFeatures(ec=ec||[[0,0],[this.transform.width,this.transform.height]],ed=ed||{},this.transform)):[]}querySourceFeatures(eo,ec){return this.style.querySourceFeatures(eo,ec)}isPointOnSurface(ec){let{name:ed}=this.transform.projection;return"globe"!==ed&&"mercator"!==ed&&eo.warnOnce(`${ed} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(eo.Point.convert(ec))}setStyle(ec,ed){return!1!==(ed=eo.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},ed)).diff&&ed.localIdeographFontFamily===this._localIdeographFontFamily&&ed.localFontFamily===this._localFontFamily&&this.style&&ec?(this._diffStyle(ec,ed),this):(this._localIdeographFontFamily=ed.localIdeographFontFamily,this._localFontFamily=ed.localFontFamily,this._updateStyle(ec,ed))}_getUIString(eo){let ec=this._locale[eo];if(null==ec)throw Error(`Missing UI string '${eo}'`);return ec}_updateStyle(eo,ec){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),eo&&(this.style=new Kt(this,ec||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof eo?this.style.loadURL(eo):this.style.loadJSON(eo)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Kt(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(ec,ed){if("string"==typeof ec){let em=this._requestManager.normalizeStyleURL(ec),e_=this._requestManager.transformRequest(em,eo.ResourceType.Style);eo.getJSON(e_,(ec,em)=>{ec?this.fire(new eo.ErrorEvent(ec)):em&&this._updateDiff(em,ed)})}else"object"==typeof ec&&this._updateDiff(ec,ed)}_updateDiff(ec,ed){try{this.style.setState(ec)&&this._update(!0)}catch(em){eo.warnOnce(`Unable to perform style diff: ${em.message||em.error||em}.  Rebuilding the style from scratch.`),this._updateStyle(ec,ed)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(eo.warnOnce("There is no style added to the map."),!1)}addSource(eo,ec){return this._lazyInitEmptyStyle(),this.style.addSource(eo,ec),this._update(!0)}isSourceLoaded(eo){return!!this.style&&this.style._isSourceCacheLoaded(eo)}areTilesLoaded(){let eo=this.style&&this.style._sourceCaches;for(let ec in eo){let ed=eo[ec]._tiles;for(let eo in ed){let ec=ed[eo];if("loaded"!==ec.state&&"errored"!==ec.state)return!1}}return!0}addSourceType(eo,ec,ed){this._lazyInitEmptyStyle(),this.style.addSourceType(eo,ec,ed)}removeSource(eo){return this.style.removeSource(eo),this._updateTerrain(),this._update(!0)}getSource(eo){return this.style.getSource(eo)}addImage(ec,ed,{pixelRatio:em=1,sdf:e_=!1,stretchX:eg,stretchY:ex,content:ev}={}){if(this._lazyInitEmptyStyle(),ed instanceof eo.window.HTMLImageElement||eo.window.ImageBitmap&&ed instanceof eo.window.ImageBitmap){let{width:eb,height:ew,data:eT}=eo.exported.getImageData(ed);this.style.addImage(ec,{data:new eo.RGBAImage({width:eb,height:ew},eT),pixelRatio:em,stretchX:eg,stretchY:ex,content:ev,sdf:e_,version:0})}else if(void 0===ed.width||void 0===ed.height)this.fire(new eo.ErrorEvent(Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:eb,height:ew}=ed;this.style.addImage(ec,{data:new eo.RGBAImage({width:eb,height:ew},new Uint8Array(ed.data)),pixelRatio:em,stretchX:eg,stretchY:ex,content:ev,sdf:e_,version:0,userImage:ed}),ed.onAdd&&ed.onAdd(this,ec)}}updateImage(ec,ed){let em=this.style.getImage(ec);if(!em)return void this.fire(new eo.ErrorEvent(Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let e_=ed instanceof eo.window.HTMLImageElement||eo.window.ImageBitmap&&ed instanceof eo.window.ImageBitmap?eo.exported.getImageData(ed):ed,{width:eg,height:ex}=e_;void 0!==eg&&void 0!==ex?eg===em.data.width&&ex===em.data.height?(em.data.replace(e_.data,!(ed instanceof eo.window.HTMLImageElement||eo.window.ImageBitmap&&ed instanceof eo.window.ImageBitmap)),this.style.updateImage(ec,em)):this.fire(new eo.ErrorEvent(Error(`The width and height of the updated image (${eg}, ${ex})
                must be that same as the previous version of the image
                (${em.data.width}, ${em.data.height})`))):this.fire(new eo.ErrorEvent(Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(ec){return ec?!!this.style.getImage(ec):(this.fire(new eo.ErrorEvent(Error("Missing required image id"))),!1)}removeImage(eo){this.style.removeImage(eo)}loadImage(ec,ed){eo.getImage(this._requestManager.transformRequest(ec,eo.ResourceType.Image),(ec,em)=>{ed(ec,em instanceof eo.window.HTMLImageElement?eo.exported.getImageData(em):em)})}listImages(){return this.style.listImages()}addLayer(eo,ec){return this._lazyInitEmptyStyle(),this.style.addLayer(eo,ec),this._update(!0)}moveLayer(eo,ec){return this.style.moveLayer(eo,ec),this._update(!0)}removeLayer(eo){return this.style.removeLayer(eo),this._update(!0)}getLayer(eo){return this.style.getLayer(eo)}setLayerZoomRange(eo,ec,ed){return this.style.setLayerZoomRange(eo,ec,ed),this._update(!0)}setFilter(eo,ec,ed={}){return this.style.setFilter(eo,ec,ed),this._update(!0)}getFilter(eo){return this.style.getFilter(eo)}setPaintProperty(eo,ec,ed,em={}){return this.style.setPaintProperty(eo,ec,ed,em),this._update(!0)}getPaintProperty(eo,ec){return this.style.getPaintProperty(eo,ec)}setLayoutProperty(eo,ec,ed,em={}){return this.style.setLayoutProperty(eo,ec,ed,em),this._update(!0)}getLayoutProperty(eo,ec){return this.style.getLayoutProperty(eo,ec)}setLight(eo,ec={}){return this._lazyInitEmptyStyle(),this.style.setLight(eo,ec),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(eo){return this._lazyInitEmptyStyle(),!eo&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(eo),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(eo){return this._lazyInitEmptyStyle(),this.style.setFog(eo),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(ec){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(eo.LngLat.convert(ec),this.transform):0}setFeatureState(eo,ec){return this.style.setFeatureState(eo,ec),this._update()}removeFeatureState(eo,ec){return this.style.removeFeatureState(eo,ec),this._update()}getFeatureState(eo){return this.style.getFeatureState(eo)}_updateContainerDimensions(){if(!this._container)return;let ec=this._container.getBoundingClientRect().width||400,ed=this._container.getBoundingClientRect().height||300,em,e_,eg,ex=this._container;for(;ex&&(!e_||!eg);){let ec=eo.window.getComputedStyle(ex).transform;ec&&"none"!==ec&&((em=ec.match(/matrix.*\((.+)\)/)[1].split(", "))[0]&&"0"!==em[0]&&"1"!==em[0]&&(e_=em[0]),em[3]&&"0"!==em[3]&&"1"!==em[3]&&(eg=em[3])),ex=ex.parentElement}this._containerWidth=e_?Math.abs(ec/e_):ec,this._containerHeight=eg?Math.abs(ed/eg):ed}_detectMissingCSS(){"rgb(250, 128, 114)"!==eo.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&eo.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let eo=this._container;eo.classList.add("mapboxgl-map"),(this._missingCSSCanary=n("div","mapboxgl-canary",eo)).style.visibility="hidden",this._detectMissingCSS();let ec=this._canvasContainer=n("div","mapboxgl-canvas-container",eo);this._interactive&&ec.classList.add("mapboxgl-interactive"),this._canvas=n("canvas","mapboxgl-canvas",ec),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let ed=this._controlContainer=n("div","mapboxgl-control-container",eo),em=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(eo=>{em[eo]=n("div",`mapboxgl-ctrl-${eo}`,ed)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(ec,ed){let em=eo.exported.devicePixelRatio||1;this._canvas.width=em*Math.ceil(ec),this._canvas.height=em*Math.ceil(ed),this._canvas.style.width=`${ec}px`,this._canvas.style.height=`${ed}px`}_addMarker(eo){this._markers.push(eo)}_removeMarker(eo){let ec=this._markers.indexOf(eo);-1!==ec&&this._markers.splice(ec,1)}_addPopup(eo){this._popups.push(eo)}_removePopup(eo){let ec=this._popups.indexOf(eo);-1!==ec&&this._popups.splice(ec,1)}_setupPainter(){let ec=eo.extend({},o.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),ed=this._useWebGL2&&this._canvas.getContext("webgl2",ec),em=ed||this._canvas.getContext("webgl",ec)||this._canvas.getContext("experimental-webgl",ec);em?(this._useWebGL2&&!ed&&eo.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),eo.storeAuthState(em,!0),this.painter=new Bo(em,this.transform,!!ed),this.on("data",eo=>{"source"===eo.dataType&&this.painter.setTileLoadedFlag(!0)}),eo.exported$1.testSupport(em)):this.fire(new eo.ErrorEvent(Error("Failed to initialize WebGL")))}_contextLost(ec){ec.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new eo.Event("webglcontextlost",{originalEvent:ec}))}_contextRestored(ec){this._setupPainter(),this.resize(),this._update(),this.fire(new eo.Event("webglcontextrestored",{originalEvent:ec}))}_onMapScroll(eo){if(eo.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(eo){return this.style&&(this._styleDirty=this._styleDirty||eo,this._sourcesDirty=!0,this.triggerRepaint()),this}_requestRenderFrame(eo){return this._update(),this._renderTaskQueue.add(eo)}_cancelRenderFrame(eo){this._renderTaskQueue.remove(eo)}_requestDomTask(eo){!this.loaded()||this.loaded()&&!this.isMoving()?eo():this._domRenderTaskQueue.add(eo)}_render(ec){let ed;let em=this.painter.context.extTimerQuery,e_=eo.exported.now();if(this.listens("gpu-timing-frame")&&(ed=em.createQueryEXT(),em.beginQueryEXT(em.TIME_ELAPSED_EXT,ed)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],eo.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],eo.window.performance.now())),this._renderTaskQueue.run(ec),this._domRenderTaskQueue.run(ec),this._removed)return;this._updateProjectionTransition();let eg=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let ec=this.transform.zoom,ed=this.transform.pitch,em=eo.exported.now(),e_=new eo.EvaluationParameters(ec,{now:em,fadeDuration:eg,pitch:ed,transition:this.style.getTransition()});this.style.update(e_)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let ex=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),ex=this._updateAverageElevation(e_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):ex=this._updateAverageElevation(e_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,eg,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:eg,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new eo.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new eo.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),ed){let ec=eo.exported.now()-e_;em.endQueryEXT(em.TIME_ELAPSED_EXT,ed),setTimeout(()=>{let eg=em.getQueryObjectEXT(ed,em.QUERY_RESULT_EXT)/1e6;em.deleteQueryEXT(ed),this.fire(new eo.Event("gpu-timing-frame",{cpuTime:ec,gpuTime:eg})),eo.window.performance.mark("frame-gpu",{startTime:e_,detail:{gpuTime:eg}})},50)}if(this.listens("gpu-timing-layer")){let ec=this.painter.collectGpuTimers();setTimeout(()=>{let ed=this.painter.queryGpuTimers(ec);this.fire(new eo.Event("gpu-timing-layer",{layerTimes:ed}))},50)}if(this.listens("gpu-timing-deferred-render")){let ec=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let ed=this.painter.queryGpuTimeDeferredRender(ec);this.fire(new eo.Event("gpu-timing-deferred-render",{gpuTime:ed}))},50)}let ev=this._sourcesDirty||this._styleDirty||this._placementDirty||ex;if(ev||this._repaint)this.triggerRepaint();else{let ec=!this.isMoving()&&this.loaded();if(ec&&(ex=this._updateAverageElevation(e_,!0)),ex)this.triggerRepaint();else if(this._triggerFrame(!1),ec&&(this.fire(new eo.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let ec=this._calculateSpeedIndex();this.fire(new eo.Event("speedindexcompleted",{speedIndex:ec})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||ev||(this._fullyLoaded=!0,eo.LivePerformanceUtils.mark(eo.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&eo.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(eo){for(let ec of this._markers)eo&&!this.getRenderWorldCopies()&&(ec._lngLat=ec._lngLat.wrap()),ec._update();for(let ec of this._popups)!eo||this.getRenderWorldCopies()||ec._trackPointer||(ec._lngLat=ec._lngLat.wrap()),ec._update()}_updateAverageElevation(eo,ec=!1){let i=eo=>(this.transform.averageElevation=eo,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&i(0);if((ec||eo-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(eo)){let ec=this.transform.averageElevation,ed=this.transform.sampleAverageElevation(),em=!1;this.transform.elevation&&(em=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(ed)?ed=0:this._averageElevationLastSampledAt=eo;let e_=Math.abs(ec-ed);if(e_>1){if(this._isInitialLoad||em)return this._averageElevation.jumpTo(ed),i(ed);this._averageElevation.easeTo(ed,eo,300)}else if(e_>1e-4)return this._averageElevation.jumpTo(ed),i(ed)}return!!this._averageElevation.isEasing(eo)&&i(this._averageElevation.getValue(eo))}_authenticate(){eo.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,ec=>{if(ec&&(ec.message===eo.AUTH_ERR_MSG||401===ec.status)){let ec=this.painter.context.gl;eo.storeAuthState(ec,!1),this._logoControl instanceof Yr&&this._logoControl._updateLogo(),ec&&ec.clear(ec.DEPTH_BUFFER_BIT|ec.COLOR_BUFFER_BIT|ec.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new eo.ErrorEvent(Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),eo.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let eo=this._isDragging();this.painter.updateTerrain(this.style,eo)}_calculateSpeedIndex(){let eo=this.painter.canvasCopy(),ec=this.painter.getCanvasCopiesAndTimestamps();ec.timeStamps.push(performance.now());let ed=this.painter.context.gl,em=ed.createFramebuffer();function r(eo){ed.framebufferTexture2D(ed.FRAMEBUFFER,ed.COLOR_ATTACHMENT0,ed.TEXTURE_2D,eo,0);let ec=new Uint8Array(ed.drawingBufferWidth*ed.drawingBufferHeight*4);return ed.readPixels(0,0,ed.drawingBufferWidth,ed.drawingBufferHeight,ed.RGBA,ed.UNSIGNED_BYTE,ec),ec}return ed.bindFramebuffer(ed.FRAMEBUFFER,em),this._canvasPixelComparison(r(eo),ec.canvasCopies.map(r),ec.timeStamps)}_canvasPixelComparison(eo,ec,ed){let em=ed[1]-ed[0],e_=eo.length/4;for(let eg=0;eg<ec.length;eg++){let ex=ec[eg],ev=0;for(let ec=0;ec<ex.length;ec+=4)ex[ec]===eo[ec]&&ex[ec+1]===eo[ec+1]&&ex[ec+2]===eo[ec+2]&&ex[ec+3]===eo[ec+3]&&(ev+=1);em+=(ed[eg+2]-ed[eg+1])*(1-ev/e_)}return em}remove(){for(let eo of(this._hash&&this._hash.remove(),this._controls))eo.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==eo.window&&(eo.window.removeEventListener("resize",this._onWindowResize,!1),eo.window.removeEventListener("orientationchange",this._onWindowResize,!1),eo.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),eo.window.removeEventListener("online",this._onWindowOnline,!1),eo.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let ec=this.painter.context.gl.getExtension("WEBGL_lose_context");ec&&ec.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),eo.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new eo.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(ec){this._renderNextFrame=this._renderNextFrame||ec,this.style&&!this._frame&&(this._frame=eo.exported.frame(eo=>{let ec=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,ec&&this._render(eo)}))}_preloadTiles(ec){let ed=this.style?Object.values(this.style._sourceCaches):[];return eo.asyncAll(ed,(eo,ed)=>eo._preloadTiles(ec,ed),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(eo){this._trackResize&&this.resize({originalEvent:eo})._update()}_onVisibilityChange(){"hidden"===eo.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(eo){this._showTileBoundaries!==eo&&(this._showTileBoundaries=eo,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(eo){this._showTerrainWireframe!==eo&&(this._showTerrainWireframe=eo,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(eo){this._speedIndexTiming!==eo&&(this._speedIndexTiming=eo,this._update())}get showPadding(){return!!this._showPadding}set showPadding(eo){this._showPadding!==eo&&(this._showPadding=eo,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(eo){this._showCollisionBoxes!==eo&&(this._showCollisionBoxes=eo,eo?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(eo){this._showOverdrawInspector!==eo&&(this._showOverdrawInspector=eo,this._update())}get repaint(){return!!this._repaint}set repaint(eo){this._repaint!==eo&&(this._repaint=eo,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(eo){this._vertices=eo,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(eo){this._showTileAABBs!==eo&&(this._showTileAABBs=eo,eo&&this._update())}_setCacheLimits(ec,ed){eo.setCacheLimits(ec,ed)}get version(){return eo.version}},NavigationControl:class{constructor(ec){this.options=eo.extend({},tM,ec),this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",eo=>eo.preventDefault()),this.options.showZoom&&(eo.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",eo=>{this._map&&this._map.zoomIn({},{originalEvent:eo})}),n("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",eo=>{this._map&&this._map.zoomOut({},{originalEvent:eo})}),n("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(eo.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",eo=>{let ec=this._map;ec&&(this.options.visualizePitch?ec.resetNorthPitch({},{originalEvent:eo}):ec.resetNorth({},{originalEvent:eo}))}),this._compassIcon=n("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let eo=this._map;if(!eo)return;let ec=eo.getZoom(),ed=ec===eo.getMaxZoom(),em=ec===eo.getMinZoom();this._zoomInButton.disabled=ed,this._zoomOutButton.disabled=em,this._zoomInButton.setAttribute("aria-disabled",ed.toString()),this._zoomOutButton.setAttribute("aria-disabled",em.toString())}_rotateCompassArrow(){let eo=this._map;if(!eo)return;let ec=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(eo.transform.pitch*(Math.PI/180)),.5)}) rotateX(${eo.transform.pitch}deg) rotateZ(${eo.transform.angle*(180/Math.PI)}deg)`:`rotate(${eo.transform.angle*(180/Math.PI)}deg)`;eo._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=ec)})}onAdd(eo){return this._map=eo,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),eo.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&eo.on("pitch",this._rotateCompassArrow),eo.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new cn(eo,this._compass,this.options.visualizePitch)),this._container}onRemove(){let eo=this._map;eo&&(this._container.remove(),this.options.showZoom&&eo.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&eo.off("pitch",this._rotateCompassArrow),eo.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(eo,ec){let ed=n("button",eo,this._container);return ed.type="button",ed.addEventListener("click",ec),ed}_setButtonTitle(eo,ec){if(!this._map)return;let ed=this._map._getUIString(`NavigationControl.${ec}`);eo.setAttribute("aria-label",ed),eo.firstElementChild&&eo.firstElementChild.setAttribute("title",ed)}},GeolocateControl:class extends eo.Evented{constructor(ec){super(),this.options=eo.extend({geolocation:eo.window.navigator.geolocation},tS,ec),eo.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Yo(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(eo){return this._map=eo,this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(ec){let i=(eo=!!this.options.geolocation)=>{this._supportsGeolocation=eo,ec(eo)};void 0!==this._supportsGeolocation?ec(this._supportsGeolocation):void 0!==eo.window.navigator.permissions?eo.window.navigator.permissions.query({name:"geolocation"}).then(eo=>i("denied"!==eo.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(eo){let ec=this._map.getMaxBounds(),ed=eo.coords;return!!ec&&(ed.longitude<ec.getWest()||ed.longitude>ec.getEast()||ed.latitude<ec.getSouth()||ed.latitude>ec.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(ec){if(this._map){if(this._isOutOfMapMaxBounds(ec))return this._setErrorState(),this.fire(new eo.Event("outofmaxbounds",ec)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=ec,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(ec),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(ec),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new eo.Event("geolocate",ec)),this._finish()}}_updateCamera(ec){let ed=new eo.LngLat(ec.coords.longitude,ec.coords.latitude),em=ec.coords.accuracy,e_=this._map.getBearing(),eg=eo.extend({bearing:e_},this.options.fitBoundsOptions);this._map.fitBounds(ed.toBounds(em),eg,{geolocateSource:!0})}_updateMarker(ec){if(ec){let ed=new eo.LngLat(ec.coords.longitude,ec.coords.latitude);this._accuracyCircleMarker.setLngLat(ed).addTo(this._map),this._userLocationDotMarker.setLngLat(ed).addTo(this._map),this._accuracy=ec.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let ec=this._map.transform,ed=eo.mercatorZfromAltitude(1,ec._center.lat)*ec.worldSize,em=Math.ceil(2*this._accuracy*ed);this._circleElement.style.width=`${em}px`,this._circleElement.style.height=`${em}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(ec){if(this._map){if(this.options.trackUserLocation){if(1===ec.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let eo=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",eo),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",eo),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===ec.code&&this._noTimeout)return;this._setErrorState()}}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new eo.Event("error",ec)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(ec){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",eo=>eo.preventDefault()),this._geolocateButton=n("button","mapboxgl-ctrl-geolocate",this._container),n("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===ec){eo.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");let ec=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",ec),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",ec)}else{let eo=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",eo),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",eo)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n("div","mapboxgl-user-location"),this._dotElement.appendChild(n("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(n("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new en({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=n("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new en({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",ec=>{ec.geolocateSource||"ACTIVE_LOCK"!==this._watchState||ec.originalEvent&&"resize"===ec.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new eo.Event("trackuserlocationend")))})}}_onDeviceOrientation(eo){this._userLocationDotMarker&&(eo.webkitCompassHeading?this._heading=eo.webkitCompassHeading:!0===eo.absolute&&(this._heading=-1*eo.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return eo.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new eo.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new eo.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new eo.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let eo;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(eo={maximumAge:6e5,timeout:0},this._noTimeout=!0):(eo=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,eo),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let t=()=>{eo.window.addEventListener("ondeviceorientationabsolute"in eo.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==eo.window.DeviceMotionEvent&&"function"==typeof eo.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(eo=>{"granted"===eo&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),eo.window.removeEventListener("deviceorientation",this._onDeviceOrientation),eo.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Hr,ScaleControl:class{constructor(ec){this.options=eo.extend({},tA,ec),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch(eo){return!1}}(),eo.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let eo=this.options.maxWidth||100,ec=this._map,ed=ec._containerHeight/2,em=ec._containerWidth/2-eo/2,e_=ec.unproject([em,ed]),eg=ec.unproject([em+eo,ed]),ex=e_.distanceTo(eg);if("imperial"===this.options.unit){let ec=3.2808*ex;ec>5280?this._setScale(eo,ec/5280,"mile"):this._setScale(eo,ec,"foot")}else"nautical"===this.options.unit?this._setScale(eo,ex/1852,"nautical-mile"):ex>=1e3?this._setScale(eo,ex/1e3,"kilometer"):this._setScale(eo,ex,"meter")}_setScale(eo,ec,ed){this._map._requestDomTask(()=>{let em=function(eo){let ec=Math.pow(10,`${Math.floor(eo)}`.length-1),ed=eo/ec;return ec*(ed=ed>=10?10:ed>=5?5:ed>=3?3:ed>=2?2:ed>=1?1:function(eo){let ec=Math.pow(10,Math.ceil(-Math.log(eo)/Math.LN10));return Math.round(eo*ec)/ec}(ed))}(ec),e_=em/ec;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==ed?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:ed}).format(em):`${em}&nbsp;${tI[ed]}`,this._container.style.width=eo*e_+"px"})}onAdd(eo){return this._map=eo,this._language=eo.getLanguage(),this._container=n("div","mapboxgl-ctrl mapboxgl-ctrl-scale",eo.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(eo){this._language=eo,this._update()}setUnit(eo){this.options.unit=eo,this._update()}},FullscreenControl:class{constructor(ec){this._fullscreen=!1,ec&&ec.container&&(ec.container instanceof eo.window.HTMLElement?this._container=ec.container:eo.warnOnce("Full screen control 'container' must be a DOM element.")),eo.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in eo.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in eo.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(ec){return this._map=ec,this._container||(this._container=this._map.getContainer()),this._controlContainer=n("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",eo.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,eo.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!eo.window.document.fullscreenEnabled&&!eo.window.document.webkitFullscreenEnabled)}_setupUI(){let ec=this._fullscreenButton=n("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n("span","mapboxgl-ctrl-icon",ec).setAttribute("aria-hidden","true"),ec.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),eo.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let eo=this._getTitle();this._fullscreenButton.setAttribute("aria-label",eo),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",eo)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(eo.window.document.fullscreenElement||eo.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?eo.window.document.exitFullscreen?eo.window.document.exitFullscreen():eo.window.document.webkitCancelFullScreen&&eo.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends eo.Evented{constructor(ec){super(),this.options=eo.extend(Object.create(tw),ec),eo.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(ec&&ec.className?ec.className.trim().split(/\s+/):[])}addTo(ec){return this._map&&this.remove(),this._map=ec,this.options.closeOnClick&&ec.on("preclick",this._onClose),this.options.closeOnMove&&ec.on("move",this._onClose),ec.on("remove",this.remove),this._update(),ec._addPopup(this),this._focusFirstElement(),this._trackPointer?(ec.on("mousemove",this._onMouseEvent),ec.on("mouseup",this._onMouseEvent),ec._canvasContainer.classList.add("mapboxgl-track-pointer")):ec.on("move",this._update),this.fire(new eo.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let ec=this._map;return ec&&(ec.off("move",this._update),ec.off("move",this._onClose),ec.off("preclick",this._onClose),ec.off("click",this._onClose),ec.off("remove",this.remove),ec.off("mousemove",this._onMouseEvent),ec.off("mouseup",this._onMouseEvent),ec.off("drag",this._onMouseEvent),ec._canvasContainer&&ec._canvasContainer.classList.remove("mapboxgl-track-pointer"),ec._removePopup(this),this._map=void 0),this.fire(new eo.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(ec){this._lngLat=eo.LngLat.convert(ec),this._pos=null,this._trackPointer=!1,this._update();let ed=this._map;return ed&&(ed.on("move",this._update),ed.off("mousemove",this._onMouseEvent),ed._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let eo=this._map;return eo&&(eo.off("move",this._update),eo.on("mousemove",this._onMouseEvent),eo.on("drag",this._onMouseEvent),eo._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(ec){return this.setDOMContent(eo.window.document.createTextNode(ec))}setHTML(ec){let ed;let em=eo.window.document.createDocumentFragment(),e_=eo.window.document.createElement("body");for(e_.innerHTML=ec;ed=e_.firstChild;)em.appendChild(ed);return this.setDOMContent(em)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(eo){return this.options.maxWidth=eo,this._update(),this}setDOMContent(eo){let ec=this._content;if(ec)for(;ec.hasChildNodes();)ec.firstChild&&ec.removeChild(ec.firstChild);else ec=this._content=n("div","mapboxgl-popup-content",this._container||void 0);if(ec.appendChild(eo),this.options.closeButton){let eo=this._closeButton=n("button","mapboxgl-popup-close-button",ec);eo.type="button",eo.setAttribute("aria-label","Close popup"),eo.setAttribute("aria-hidden","true"),eo.innerHTML="&#215;",eo.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(eo){return this._classList.add(eo),this._updateClassList(),this}removeClassName(eo){return this._classList.delete(eo),this._updateClassList(),this}setOffset(eo){return this.options.offset=eo,this._update(),this}toggleClassName(eo){let ec;return this._classList.delete(eo)?ec=!1:(this._classList.add(eo),ec=!0),this._updateClassList(),ec}_onMouseEvent(eo){this._update(eo.point)}_getAnchor(eo){if(this.options.anchor)return this.options.anchor;let ec=this._map,ed=this._container,em=this._pos;if(!ec||!ed||!em)return"bottom";let e_=ed.offsetWidth,eg=ed.offsetHeight,ex=em.x<e_/2,ev=em.x>ec.transform.width-e_/2;if(em.y+eo<eg)return ex?"top-left":ev?"top-right":"top";if(em.y>ec.transform.height-eg){if(ex)return"bottom-left";if(ev)return"bottom-right"}return ex?"left":ev?"right":"bottom"}_updateClassList(){let eo=this._container;if(!eo)return;let ec=[...this._classList];ec.push("mapboxgl-popup"),this._anchor&&ec.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&ec.push("mapboxgl-popup-track-pointer"),eo.className=ec.join(" ")}_update(ec){let ed=this._map,em=this._content;if(!ed||!this._lngLat&&!this._trackPointer||!em)return;let e_=this._container;if(e_||(e_=this._container=n("div","mapboxgl-popup",ed.getContainer()),this._tip=n("div","mapboxgl-popup-tip",e_),e_.appendChild(em)),this.options.maxWidth&&e_.style.maxWidth!==this.options.maxWidth&&(e_.style.maxWidth=this.options.maxWidth),ed.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Jr(this._lngLat,this._pos,ed.transform)),!this._trackPointer||ec){let eo=this._pos=this._trackPointer&&ec?ec:ed.project(this._lngLat),em=rn(this.options.offset),e_=this._anchor=this._getAnchor(em.y),eg=rn(this.options.offset,e_),ex=eo.add(eg).round();ed._requestDomTask(()=>{this._container&&e_&&(this._container.style.transform=`${tb[e_]} translate(${ex.x}px,${ex.y}px)`)})}if(!this._marker&&ed._showingGlobe()){let ec=eo.isLngLatBehindGlobe(ed.transform,this._lngLat)?0:1;this._setOpacity(ec)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let eo=this._container.querySelector("a[href], [tabindex]:not([tabindex='-1']), [contenteditable]:not([contenteditable='false']), button:not([disabled]), input:not([disabled]), select:not([disabled]), textarea:not([disabled])");eo&&eo.focus()}_onClose(){this.remove()}_setOpacity(eo){this._container&&(this._container.style.opacity=`${eo}`),this._content&&(this._content.style.pointerEvents=eo?"auto":"none")}},Marker:en,Style:Kt,LngLat:eo.LngLat,LngLatBounds:eo.LngLatBounds,Point:eo.Point,MercatorCoordinate:eo.MercatorCoordinate,FreeCameraOptions:jo,Evented:eo.Evented,config:eo.config,prewarm:function(){Ue().acquire(eI)},clearPrewarmedResources:function(){let eo=ed;eo&&(eo.isPreloaded()&&1===eo.numActive()?(eo.release(eI),ed=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return eo.config.ACCESS_TOKEN},set accessToken(t){eo.config.ACCESS_TOKEN=t},get baseApiUrl(){return eo.config.API_URL},set baseApiUrl(t){eo.config.API_URL=t},get workerCount(){return ke.workerCount},set workerCount(e){ke.workerCount=e},get maxParallelImageRequests(){return eo.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){eo.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(ec){eo.clearTileCache(ec)},workerUrl:"",workerClass:null,setNow:eo.exported.setNow,restoreNow:eo.exported.restoreNow};return tC}),ed}()}}]);