"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[358],{7358:function(e,r,t){t.d(r,{qA:function(){return Environment}});var n=t(3428),a=t(2265),o=t(7837),i=t(6375);let isCubeTexture=e=>e&&e.isCubeTexture;let GroundProjectedEnv=class GroundProjectedEnv extends i.Mesh{constructor(e,r){var t,n;let a=isCubeTexture(e),o=null!=(n=a?null==(t=e.image[0])?void 0:t.width:e.image.width)?n:1024,l=Math.floor(Math.log2(o/4)),s=Math.pow(2,l),c=[a?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/(3*Math.max(s,112))}`,`#define CUBEUV_TEXEL_HEIGHT ${1/(4*s)}`,`#define CUBEUV_MAX_MIP ${l}.0`],u=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,f=c.join("\n")+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${parseInt(i.REVISION.replace(/\D+/g,""))>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,d={map:{value:e},height:{value:(null==r?void 0:r.height)||15},radius:{value:(null==r?void 0:r.radius)||100}},p=new i.IcosahedronGeometry(1,16),v=new i.ShaderMaterial({uniforms:d,fragmentShader:f,vertexShader:u,side:i.DoubleSide});super(p,v)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}};let RGBELoader=class RGBELoader extends i.DataTextureLoader{constructor(e){super(e),this.type=i.HalfFloatType}parse(e){let rgbe_error=function(e,r){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(r||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(r||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(r||""));break;default:console.error("THREE.RGBELoader: Error: "+(r||""))}return -1},fgets=function(e,r,t){r=r||1024;let n=e.pos,a=-1,o=0,i="",l=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));for(;0>(a=l.indexOf("\n"))&&o<r&&n<e.byteLength;)i+=l,o+=l.length,n+=128,l+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(n,n+128)));return -1<a&&(!1!==t&&(e.pos+=o+a+1),i+l.slice(0,a))},r=new Uint8Array(e);r.pos=0;let t=function(e){let r,t;let n=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,a=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,l={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};if(e.pos>=e.byteLength||!(r=fgets(e)))return rgbe_error(1,"no header found");if(!(t=r.match(/^#\?(\S+)/)))return rgbe_error(3,"bad initial token");for(l.valid|=1,l.programtype=t[1],l.string+=r+"\n";!1!==(r=fgets(e));){if(l.string+=r+"\n","#"===r.charAt(0)){l.comments+=r+"\n";continue}if((t=r.match(n))&&(l.gamma=parseFloat(t[1])),(t=r.match(a))&&(l.exposure=parseFloat(t[1])),(t=r.match(o))&&(l.valid|=2,l.format=t[1]),(t=r.match(i))&&(l.valid|=4,l.height=parseInt(t[1],10),l.width=parseInt(t[2],10)),2&l.valid&&4&l.valid)break}return 2&l.valid?4&l.valid?l:rgbe_error(3,"missing image size specifier"):rgbe_error(3,"missing format specifier")}(r);if(-1!==t){let e=t.width,n=t.height,a=function(e,r,t){if(r<8||r>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(r!==(e[2]<<8|e[3]))return rgbe_error(3,"wrong scanline width");let n=new Uint8Array(4*r*t);if(!n.length)return rgbe_error(4,"unable to allocate buffer space");let a=0,o=0,i=4*r,l=new Uint8Array(4),s=new Uint8Array(i),c=t;for(;c>0&&o<e.byteLength;){if(o+4>e.byteLength)return rgbe_error(1);if(l[0]=e[o++],l[1]=e[o++],l[2]=e[o++],l[3]=e[o++],2!=l[0]||2!=l[1]||(l[2]<<8|l[3])!=r)return rgbe_error(3,"bad rgbe scanline format");let t=0,u;for(;t<i&&o<e.byteLength;){u=e[o++];let r=u>128;if(r&&(u-=128),0===u||t+u>i)return rgbe_error(3,"bad scanline data");if(r){let r=e[o++];for(let e=0;e<u;e++)s[t++]=r}else s.set(e.subarray(o,o+u),t),t+=u,o+=u}for(let e=0;e<r;e++){let t=0;n[a]=s[e+t],t+=r,n[a+1]=s[e+t],t+=r,n[a+2]=s[e+t],t+=r,n[a+3]=s[e+t],a+=4}c--}return n}(r.subarray(r.pos),e,n);if(-1!==a){let r,o,l;switch(this.type){case i.FloatType:l=a.length/4;let s=new Float32Array(4*l);for(let e=0;e<l;e++)!function(e,r,t,n){let a=e[r+3],o=Math.pow(2,a-128)/255;t[n+0]=e[r+0]*o,t[n+1]=e[r+1]*o,t[n+2]=e[r+2]*o,t[n+3]=1}(a,4*e,s,4*e);r=s,o=i.FloatType;break;case i.HalfFloatType:l=a.length/4;let c=new Uint16Array(4*l);for(let e=0;e<l;e++)!function(e,r,t,n){let a=e[r+3],o=Math.pow(2,a-128)/255;t[n+0]=i.DataUtils.toHalfFloat(Math.min(e[r+0]*o,65504)),t[n+1]=i.DataUtils.toHalfFloat(Math.min(e[r+1]*o,65504)),t[n+2]=i.DataUtils.toHalfFloat(Math.min(e[r+2]*o,65504)),t[n+3]=i.DataUtils.toHalfFloat(1)}(a,4*e,c,4*e);r=c,o=i.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:n,data:r,header:t.string,gamma:t.gamma,exposure:t.exposure,type:o}}}return null}setDataType(e){return this.type=e,this}load(e,r,t,n){return super.load(e,function(e,t){switch(e.type){case i.FloatType:case i.HalfFloatType:"colorSpace"in e?e.colorSpace="srgb-linear":e.encoding=3e3,e.minFilter=i.LinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}r&&r(e,t)},t,n)}};var l={},s=Uint8Array,c=Uint16Array,u=Uint32Array,f=new s([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),d=new s([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),p=new s([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(e,r){for(var t=new c(31),n=0;n<31;++n)t[n]=r+=1<<e[n-1];for(var a=new u(t[30]),n=1;n<30;++n)for(var o=t[n];o<t[n+1];++o)a[o]=o-t[n]<<5|n;return[t,a]},v=freb(f,2),h=v[0],m=v[1];h[28]=258,m[258]=28;for(var g=freb(d,0),b=g[0],y=g[1],F=new c(32768),E=0;E<32768;++E){var U=(43690&E)>>>1|(21845&E)<<1;U=(61680&(U=(52428&U)>>>2|(13107&U)<<2))>>>4|(3855&U)<<4,F[E]=((65280&U)>>>8|(255&U)<<8)>>>1}for(var hMap=function(e,r,t){for(var n,a=e.length,o=0,i=new c(r);o<a;++o)++i[e[o]-1];var l=new c(r);for(o=0;o<r;++o)l[o]=l[o-1]+i[o-1]<<1;if(t){n=new c(1<<r);var s=15-r;for(o=0;o<a;++o)if(e[o])for(var u=o<<4|e[o],f=r-e[o],d=l[e[o]-1]++<<f,p=d|(1<<f)-1;d<=p;++d)n[F[d]>>>s]=u}else for(o=0,n=new c(a);o<a;++o)e[o]&&(n[o]=F[l[e[o]-1]++]>>>15-e[o]);return n},S=new s(288),E=0;E<144;++E)S[E]=8;for(var E=144;E<256;++E)S[E]=9;for(var E=256;E<280;++E)S[E]=7;for(var E=280;E<288;++E)S[E]=8;for(var A=new s(32),E=0;E<32;++E)A[E]=5;var M=hMap(S,9,1),C=hMap(A,5,1),max=function(e){for(var r=e[0],t=1;t<e.length;++t)e[t]>r&&(r=e[t]);return r},bits=function(e,r,t){var n=r/8|0;return(e[n]|e[n+1]<<8)>>(7&r)&t},bits16=function(e,r){var t=r/8|0;return(e[t]|e[t+1]<<8|e[t+2]<<16)>>(7&r)},shft=function(e){return(e/8|0)+(7&e&&1)},slc=function(e,r,t){(null==r||r<0)&&(r=0),(null==t||t>e.length)&&(t=e.length);var n=new(e instanceof c?c:e instanceof u?u:s)(t-r);return n.set(e.subarray(r,t)),n},inflt=function(e,r,t){var n=e.length;if(!n||t&&!t.l&&n<5)return r||new s(0);var a=!r||t,o=!t||t.i;t||(t={}),r||(r=new s(3*n));var cbuf=function(e){var t=r.length;if(e>t){var n=new s(Math.max(2*t,e));n.set(r),r=n}},i=t.f||0,l=t.p||0,c=t.b||0,u=t.l,v=t.d,m=t.m,g=t.n,y=8*n;do{if(!u){t.f=i=bits(e,l,1);var F=bits(e,l+1,3);if(l+=3,F){if(1==F)u=M,v=C,m=9,g=5;else if(2==F){var E=bits(e,l,31)+257,U=bits(e,l+10,15)+4,S=E+bits(e,l+5,31)+1;l+=14;for(var A=new s(S),k=new s(19),I=0;I<U;++I)k[p[I]]=bits(e,l+3*I,7);l+=3*U;for(var _=max(k),P=(1<<_)-1,R=hMap(k,_,1),I=0;I<S;){var x=R[bits(e,l,P)];l+=15&x;var z=x>>>4;if(z<16)A[I++]=z;else{var T=0,O=0;for(16==z?(O=3+bits(e,l,3),l+=2,T=A[I-1]):17==z?(O=3+bits(e,l,7),l+=3):18==z&&(O=11+bits(e,l,127),l+=7);O--;)A[I++]=T}}var L=A.subarray(0,E),B=A.subarray(E);m=max(L),g=max(B),u=hMap(L,m,1),v=hMap(B,g,1)}else throw"invalid block type"}else{var z=shft(l)+4,D=e[z-4]|e[z-3]<<8,N=z+D;if(N>n){if(o)throw"unexpected EOF";break}a&&cbuf(c+D),r.set(e.subarray(z,N),c),t.b=c+=D,t.p=l=8*N;continue}if(l>y){if(o)throw"unexpected EOF";break}}a&&cbuf(c+131072);for(var W=(1<<m)-1,H=(1<<g)-1,X=l;;X=l){var T=u[bits16(e,l)&W],V=T>>>4;if((l+=15&T)>y){if(o)throw"unexpected EOF";break}if(!T)throw"invalid length/literal";if(V<256)r[c++]=V;else if(256==V){X=l,u=null;break}else{var G=V-254;if(V>264){var I=V-257,Z=f[I];G=bits(e,l,(1<<Z)-1)+h[I],l+=Z}var j=v[bits16(e,l)&H],Y=j>>>4;if(!j)throw"invalid distance";l+=15&j;var B=b[Y];if(Y>3){var Z=d[Y];B+=bits16(e,l)&(1<<Z)-1,l+=Z}if(l>y){if(o)throw"unexpected EOF";break}a&&cbuf(c+131072);for(var $=c+G;c<$;c+=4)r[c]=r[c-B],r[c+1]=r[c+1-B],r[c+2]=r[c+2-B],r[c+3]=r[c+3-B];c=$}}t.l=u,t.p=X,t.b=c,u&&(i=1,t.m=m,t.d=v,t.n=g)}while(!i);return c==r.length?r:slc(r,0,c)},wbits=function(e,r,t){t<<=7&r;var n=r/8|0;e[n]|=t,e[n+1]|=t>>>8},wbits16=function(e,r,t){t<<=7&r;var n=r/8|0;e[n]|=t,e[n+1]|=t>>>8,e[n+2]|=t>>>16},hTree=function(e,r){for(var t=[],n=0;n<e.length;++n)e[n]&&t.push({s:n,f:e[n]});var a=t.length,o=t.slice();if(!a)return[I,0];if(1==a){var i=new s(t[0].s+1);return i[t[0].s]=1,[i,1]}t.sort(function(e,r){return e.f-r.f}),t.push({s:-1,f:25001});var l=t[0],u=t[1],f=0,d=1,p=2;for(t[0]={s:-1,f:l.f+u.f,l:l,r:u};d!=a-1;)l=t[t[f].f<t[p].f?f++:p++],u=t[f!=d&&t[f].f<t[p].f?f++:p++],t[d++]={s:-1,f:l.f+u.f,l:l,r:u};for(var v=o[0].s,n=1;n<a;++n)o[n].s>v&&(v=o[n].s);var h=new c(v+1),m=ln(t[d-1],h,0);if(m>r){var n=0,g=0,b=m-r,y=1<<b;for(o.sort(function(e,r){return h[r.s]-h[e.s]||e.f-r.f});n<a;++n){var F=o[n].s;if(h[F]>r)g+=y-(1<<m-h[F]),h[F]=r;else break}for(g>>>=b;g>0;){var E=o[n].s;h[E]<r?g-=1<<r-h[E]++-1:++n}for(;n>=0&&g;--n){var U=o[n].s;h[U]==r&&(--h[U],++g)}m=r}return[new s(h),m]},ln=function(e,r,t){return -1==e.s?Math.max(ln(e.l,r,t+1),ln(e.r,r,t+1)):r[e.s]=t},lc=function(e){for(var r=e.length;r&&!e[--r];);for(var t=new c(++r),n=0,a=e[0],o=1,w=function(e){t[n++]=e},i=1;i<=r;++i)if(e[i]==a&&i!=r)++o;else{if(!a&&o>2){for(;o>138;o-=138)w(32754);o>2&&(w(o>10?o-11<<5|28690:o-3<<5|12305),o=0)}else if(o>3){for(w(a),--o;o>6;o-=6)w(8304);o>2&&(w(o-3<<5|8208),o=0)}for(;o--;)w(a);o=1,a=e[i]}return[t.subarray(0,n),r]},clen=function(e,r){for(var t=0,n=0;n<r.length;++n)t+=e[n]*r[n];return t},wfblk=function(e,r,t){var n=t.length,a=shft(r+2);e[a]=255&n,e[a+1]=n>>>8,e[a+2]=255^e[a],e[a+3]=255^e[a+1];for(var o=0;o<n;++o)e[a+o+4]=t[o];return(a+4+n)*8},wblk=function(e,r,t,n,a,o,i,l,s,u,v){wbits(r,v++,t),++a[256];for(var h,m,g,b,y=hTree(a,15),F=y[0],E=y[1],U=hTree(o,15),M=U[0],C=U[1],k=lc(F),I=k[0],_=k[1],P=lc(M),R=P[0],x=P[1],z=new c(19),T=0;T<I.length;++T)z[31&I[T]]++;for(var T=0;T<R.length;++T)z[31&R[T]]++;for(var O=hTree(z,7),L=O[0],B=O[1],D=19;D>4&&!L[p[D-1]];--D);var N=u+5<<3,W=clen(a,S)+clen(o,A)+i,H=clen(a,F)+clen(o,M)+i+14+3*D+clen(z,L)+(2*z[16]+3*z[17]+7*z[18]);if(N<=W&&N<=H)return wfblk(r,v,e.subarray(s,s+u));if(wbits(r,v,1+(H<W)),v+=2,H<W){h=hMap(F,E,0),m=F,g=hMap(M,C,0),b=M;var X=hMap(L,B,0);wbits(r,v,_-257),wbits(r,v+5,x-1),wbits(r,v+10,D-4),v+=14;for(var T=0;T<D;++T)wbits(r,v+3*T,L[p[T]]);v+=3*D;for(var V=[I,R],G=0;G<2;++G)for(var Z=V[G],T=0;T<Z.length;++T){var j=31&Z[T];wbits(r,v,X[j]),v+=L[j],j>15&&(wbits(r,v,Z[T]>>>5&127),v+=Z[T]>>>12)}}else h=null,m=S,g=null,b=A;for(var T=0;T<l;++T)if(n[T]>255){var j=n[T]>>>18&31;wbits16(r,v,h[j+257]),v+=m[j+257],j>7&&(wbits(r,v,n[T]>>>23&31),v+=f[j]);var Y=31&n[T];wbits16(r,v,g[Y]),v+=b[Y],Y>3&&(wbits16(r,v,n[T]>>>5&8191),v+=d[Y])}else wbits16(r,v,h[n[T]]),v+=m[n[T]];return wbits16(r,v,h[256]),v+m[256]},k=new u([65540,131080,131088,131104,262176,1048704,1048832,2114560,2117632]),I=new s(0),zlv=function(e){if((15&e[0])!=8||e[0]>>>4>7||(e[0]<<8|e[1])%31)throw"invalid zlib data";if(32&e[1])throw"invalid zlib data: preset dictionaries not supported"};function unzlibSync(e,r){return inflt((zlv(e),e.subarray(2,-4)),r)}var _="undefined"!=typeof TextDecoder&&new TextDecoder;try{_.decode(I,{stream:!0})}catch(e){}let P="colorSpace"in new i.Texture;let EXRLoader=class EXRLoader extends i.DataTextureLoader{constructor(e){super(e),this.type=i.HalfFloatType}parse(e){let r={l:0,c:0,lc:0};function getBits(e,t,n,a,o){for(;n<e;)t=t<<8|parseUint8Array(a,o),n+=8;n-=e,r.l=t>>n&(1<<e)-1,r.c=t,r.lc=n}let t=Array(59),n={c:0,lc:0};function getChar(e,r,t,a){e=e<<8|parseUint8Array(t,a),r+=8,n.c=e,n.lc=r}let a={c:0,lc:0};function getCode(e,r,t,o,i,l,s,c,u,f){if(e==r){o<8&&(getChar(t,o,i,s),t=n.c,o=n.lc);var d=t>>(o-=8),d=new Uint8Array([d])[0];if(u.value+d>f)return!1;for(var p=c[u.value-1];d-- >0;)c[u.value++]=p}else{if(!(u.value<f))return!1;c[u.value++]=e}a.c=t,a.lc=o}function Int16(e){var r=65535&e;return r>32767?r-65536:r}let o={a:0,b:0};function wdec14(e,r){var t=Int16(e),n=Int16(r),a=t+(1&n)+(n>>1),i=a-n;o.a=a,o.b=i}function wdec16(e,r){var t=65535&r,n=(65535&e)-(t>>1)&65535;o.a=t+n-32768&65535,o.b=n}function hufUncompress(e,o,i,l,s,c){var u=i.value,f=parseUint32(o,i),d=parseUint32(o,i);i.value+=4;var p=parseUint32(o,i);if(i.value+=4,f<0||f>=65537||d<0||d>=65537)throw"Something wrong with HUF_ENCSIZE";var v=Array(65537),h=Array(16384);!function(e){for(var r=0;r<16384;r++)e[r]={},e[r].len=0,e[r].lit=0,e[r].p=null}(h);var m=l-(i.value-u);if(!function(e,n,a,o,i,l,s){for(var c=0,u=0;i<=l;i++){if(a.value-a.value>o)return!1;getBits(6,c,u,e,a);var f=r.l;if(c=r.c,u=r.lc,s[i]=f,63==f){if(a.value-a.value>o)throw"Something wrong with hufUnpackEncTable";getBits(8,c,u,e,a);var d=r.l+6;if(c=r.c,u=r.lc,i+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)s[i++]=0;i--}else if(f>=59){var d=f-59+2;if(i+d>l+1)throw"Something wrong with hufUnpackEncTable";for(;d--;)s[i++]=0;i--}}!function(e){for(var r=0;r<=58;++r)t[r]=0;for(var r=0;r<65537;++r)t[e[r]]+=1;for(var n=0,r=58;r>0;--r){var a=n+t[r]>>1;t[r]=n,n=a}for(var r=0;r<65537;++r){var o=e[r];o>0&&(e[r]=o|t[o]++<<6)}}(s)}(e,0,i,m,f,d,v),p>8*(l-(i.value-u)))throw"Something wrong with hufUncompress";!function(e,r,t,n){for(;r<=t;r++){var a=e[r]>>6,o=63&e[r];if(a>>o)throw"Invalid table entry";if(o>14){var i=n[a>>o-14];if(i.len)throw"Invalid table entry";if(i.lit++,i.p){var l=i.p;i.p=Array(i.lit);for(var s=0;s<i.lit-1;++s)i.p[s]=l[s]}else i.p=[,];i.p[i.lit-1]=r}else if(o)for(var c=0,s=1<<14-o;s>0;s--){var i=n[(a<<14-o)+c];if(i.len||i.p)throw"Invalid table entry";i.len=o,i.lit=r,c++}}}(v,f,d,h),function(e,r,t,o,i,l,s,c,u,f){for(var d=0,p=0,v=Math.trunc(i.value+(l+7)/8);i.value<v;)for(getChar(d,p,t,i),d=n.c,p=n.lc;p>=14;){var h=r[d>>p-14&16383];if(h.len)p-=h.len,getCode(h.lit,s,d,p,t,o,i,u,f,c),d=a.c,p=a.lc;else{if(!h.p)throw"hufDecode issues";for(m=0;m<h.lit;m++){for(var m,g=63&e[h.p[m]];p<g&&i.value<v;)getChar(d,p,t,i),d=n.c,p=n.lc;if(p>=g&&e[h.p[m]]>>6==(d>>p-g&(1<<g)-1)){p-=g,getCode(h.p[m],s,d,p,t,o,i,u,f,c),d=a.c,p=a.lc;break}}if(m==h.lit)throw"hufDecode issues"}}var b=8-l&7;for(d>>=b,p-=b;p>0;){var h=r[d<<14-p&16383];if(h.len)p-=h.len,getCode(h.lit,s,d,p,t,o,i,u,f,c),d=a.c,p=a.lc;else throw"hufDecode issues"}}(v,h,e,o,i,p,d,c,s,{value:0})}function predictor(e){for(var r=1;r<e.length;r++){var t=e[r-1]+e[r]-128;e[r]=t}}function interleaveScalar(e,r){for(var t=0,n=Math.floor((e.length+1)/2),a=0,o=e.length-1;!(a>o)&&(r[a++]=e[t++],!(a>o));)r[a++]=e[n++]}function decodeRunLength(e){for(var r=e.byteLength,t=[],n=0,a=new DataView(e);r>0;){var o=a.getInt8(n++);if(o<0){var i=-o;r-=i+1;for(var l=0;l<i;l++)t.push(a.getUint8(n++))}else{var i=o;r-=2;for(var s=a.getUint8(n++),l=0;l<i+1;l++)t.push(s)}}return t}function uncompressRAW(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function uncompressRLE(e){var r=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),t=new Uint8Array(decodeRunLength(r)),n=new Uint8Array(t.length);return predictor(t),interleaveScalar(t,n),new DataView(n.buffer)}function uncompressZIP(e){var r=unzlibSync(e.array.slice(e.offset.value,e.offset.value+e.size)),t=new Uint8Array(r.length);return predictor(r),interleaveScalar(r,t),new DataView(t.buffer)}function uncompressPIZ(e){for(var r=e.viewer,t={value:e.offset.value},n=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),a=new Uint8Array(8192),i=0,l=Array(e.channels),s=0;s<e.channels;s++)l[s]={},l[s].start=i,l[s].end=l[s].start,l[s].nx=e.width,l[s].ny=e.lines,l[s].size=e.type,i+=l[s].nx*l[s].ny*l[s].size;var c=parseUint16(r,t),u=parseUint16(r,t);if(u>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(c<=u)for(var s=0;s<u-c+1;s++)a[s+c]=parseUint8(r,t);var f=new Uint16Array(65536),d=function(e,r){for(var t=0,n=0;n<65536;++n)(0==n||e[n>>3]&1<<(7&n))&&(r[t++]=n);for(var a=t-1;t<65536;)r[t++]=0;return a}(a,f),p=parseUint32(r,t);hufUncompress(e.array,r,t,p,n,i);for(var s=0;s<e.channels;++s)for(var v=l[s],h=0;h<l[s].size;++h)!function(e,r,t,n,a,i,l){for(var s=l<16384,c=t>a?a:t,u=1;u<=c;)u<<=1;for(u>>=1,f=u,u>>=1;u>=1;){for(var f,d,p,v,h,m=0,g=0+i*(a-f),b=i*u,y=i*f,F=n*u,E=n*f;m<=g;m+=y){for(var U=m,S=m+n*(t-f);U<=S;U+=E){var A=U+F,M=U+b,C=M+F;s?(wdec14(e[U+r],e[M+r]),d=o.a,v=o.b,wdec14(e[A+r],e[C+r]),p=o.a,h=o.b,wdec14(d,p),e[U+r]=o.a,e[A+r]=o.b,wdec14(v,h)):(wdec16(e[U+r],e[M+r]),d=o.a,v=o.b,wdec16(e[A+r],e[C+r]),p=o.a,h=o.b,wdec16(d,p),e[U+r]=o.a,e[A+r]=o.b,wdec16(v,h)),e[M+r]=o.a,e[C+r]=o.b}if(t&u){var M=U+b;s?wdec14(e[U+r],e[M+r]):wdec16(e[U+r],e[M+r]),d=o.a,e[M+r]=o.b,e[U+r]=d}}if(a&u)for(var U=m,S=m+n*(t-f);U<=S;U+=E){var A=U+F;s?wdec14(e[U+r],e[A+r]):wdec16(e[U+r],e[A+r]),d=o.a,e[A+r]=o.b,e[U+r]=d}f=u,u>>=1}}(n,v.start+h,v.nx,v.size,v.ny,v.nx*v.size,d);!function(e,r,t){for(var n=0;n<t;++n)r[n]=e[r[n]]}(f,n,i);for(var m=0,g=new Uint8Array(n.buffer.byteLength),b=0;b<e.lines;b++)for(var y=0;y<e.channels;y++){var v=l[y],F=v.nx*v.size,E=new Uint8Array(n.buffer,2*v.end,2*F);g.set(E,m),m+=2*F,v.end+=F}return new DataView(g.buffer)}function uncompressPXR(e){var r=unzlibSync(e.array.slice(e.offset.value,e.offset.value+e.size));let t=e.lines*e.channels*e.width,n=1==e.type?new Uint16Array(t):new Uint32Array(t),a=0,o=0,i=[,,,,];for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:i[0]=a,i[1]=i[0]+e.width,a=i[1]+e.width;for(let a=0;a<e.width;++a){let e=r[i[0]++]<<8|r[i[1]++];t+=e,n[o]=t,o++}break;case 2:i[0]=a,i[1]=i[0]+e.width,i[2]=i[1]+e.width,a=i[2]+e.width;for(let a=0;a<e.width;++a){let e=r[i[0]++]<<24|r[i[1]++]<<16|r[i[2]++]<<8;t+=e,n[o]=t,o++}}}return new DataView(n.buffer)}function uncompressDWA(e){var r=e.viewer,t={value:e.offset.value},n=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),a={version:parseInt64(r,t),unknownUncompressedSize:parseInt64(r,t),unknownCompressedSize:parseInt64(r,t),acCompressedSize:parseInt64(r,t),dcCompressedSize:parseInt64(r,t),rleCompressedSize:parseInt64(r,t),rleUncompressedSize:parseInt64(r,t),rleRawSize:parseInt64(r,t),totalAcUncompressedCount:parseInt64(r,t),totalDcUncompressedCount:parseInt64(r,t),acCompression:parseInt64(r,t)};if(a.version<2)throw"EXRLoader.parse: "+u.compression+" version "+a.version+" is unsupported";for(var o=[],l=parseUint16(r,t)-2;l>0;){var s=parseNullTerminatedString(r.buffer,t),c=parseUint8(r,t),f=c>>2&3,d=(c>>4)-1,p=new Int8Array([d])[0],v=parseUint8(r,t);o.push({name:s,index:p,type:v,compression:f}),l-=s.length+3}for(var h=u.channels,m=Array(e.channels),g=0;g<e.channels;++g){var b=m[g]={},y=h[g];b.name=y.name,b.compression=0,b.decoded=!1,b.type=y.pixelType,b.pLinear=y.pLinear,b.width=e.width,b.height=e.lines}for(var F={idx:[,,,]},E=0;E<e.channels;++E)for(var b=m[E],g=0;g<o.length;++g){var U=o[g];b.name==U.name&&(b.compression=U.compression,U.index>=0&&(F.idx[U.index]=E),b.offset=E)}if(a.acCompressedSize>0)switch(a.acCompression){case 0:var S=new Uint16Array(a.totalAcUncompressedCount);hufUncompress(e.array,r,t,a.acCompressedSize,S,a.totalAcUncompressedCount);break;case 1:var A=e.array.slice(t.value,t.value+a.totalAcUncompressedCount),M=unzlibSync(A),S=new Uint16Array(M.buffer);t.value+=a.totalAcUncompressedCount}if(a.dcCompressedSize>0){var C={array:e.array,offset:t,size:a.dcCompressedSize},k=new Uint16Array(uncompressZIP(C).buffer);t.value+=a.dcCompressedSize}if(a.rleRawSize>0){var A=e.array.slice(t.value,t.value+a.rleCompressedSize),M=unzlibSync(A),I=decodeRunLength(M.buffer);t.value+=a.rleCompressedSize}for(var _=0,P=Array(m.length),g=0;g<P.length;++g)P[g]=[];for(var R=0;R<e.lines;++R)for(var x=0;x<m.length;++x)P[x].push(_),_+=m[x].width*e.type*2;!function(e,r,t,n,a,o){var l=new DataView(o.buffer),s=t[e.idx[0]].width,c=t[e.idx[0]].height,u=Math.floor(s/8),f=Math.ceil(s/8),d=Math.ceil(c/8),p=s-(f-1)*8,v=c-(d-1)*8,h={value:0},m=[,,,],g=[,,,],b=[,,,],y=[,,,],F=[,,,];for(let t=0;t<3;++t)F[t]=r[e.idx[t]],m[t]=t<1?0:m[t-1]+f*d,g[t]=new Float32Array(64),b[t]=new Uint16Array(64),y[t]=new Uint16Array(64*f);for(let r=0;r<d;++r){var E,U,S=8;r==d-1&&(S=v);var A=8;for(let e=0;e<f;++e){e==f-1&&(A=p);for(let e=0;e<3;++e)b[e].fill(0),b[e][0]=a[m[e]++],function(e,r,t){for(var n,a=1;a<64;)65280==(n=r[e.value])?a=64:n>>8==255?a+=255&n:(t[a]=n,a++),e.value++}(h,n,b[e]),E=b[e],(U=g[e])[0]=decodeFloat16(E[0]),U[1]=decodeFloat16(E[1]),U[2]=decodeFloat16(E[5]),U[3]=decodeFloat16(E[6]),U[4]=decodeFloat16(E[14]),U[5]=decodeFloat16(E[15]),U[6]=decodeFloat16(E[27]),U[7]=decodeFloat16(E[28]),U[8]=decodeFloat16(E[2]),U[9]=decodeFloat16(E[4]),U[10]=decodeFloat16(E[7]),U[11]=decodeFloat16(E[13]),U[12]=decodeFloat16(E[16]),U[13]=decodeFloat16(E[26]),U[14]=decodeFloat16(E[29]),U[15]=decodeFloat16(E[42]),U[16]=decodeFloat16(E[3]),U[17]=decodeFloat16(E[8]),U[18]=decodeFloat16(E[12]),U[19]=decodeFloat16(E[17]),U[20]=decodeFloat16(E[25]),U[21]=decodeFloat16(E[30]),U[22]=decodeFloat16(E[41]),U[23]=decodeFloat16(E[43]),U[24]=decodeFloat16(E[9]),U[25]=decodeFloat16(E[11]),U[26]=decodeFloat16(E[18]),U[27]=decodeFloat16(E[24]),U[28]=decodeFloat16(E[31]),U[29]=decodeFloat16(E[40]),U[30]=decodeFloat16(E[44]),U[31]=decodeFloat16(E[53]),U[32]=decodeFloat16(E[10]),U[33]=decodeFloat16(E[19]),U[34]=decodeFloat16(E[23]),U[35]=decodeFloat16(E[32]),U[36]=decodeFloat16(E[39]),U[37]=decodeFloat16(E[45]),U[38]=decodeFloat16(E[52]),U[39]=decodeFloat16(E[54]),U[40]=decodeFloat16(E[20]),U[41]=decodeFloat16(E[22]),U[42]=decodeFloat16(E[33]),U[43]=decodeFloat16(E[38]),U[44]=decodeFloat16(E[46]),U[45]=decodeFloat16(E[51]),U[46]=decodeFloat16(E[55]),U[47]=decodeFloat16(E[60]),U[48]=decodeFloat16(E[21]),U[49]=decodeFloat16(E[34]),U[50]=decodeFloat16(E[37]),U[51]=decodeFloat16(E[47]),U[52]=decodeFloat16(E[50]),U[53]=decodeFloat16(E[56]),U[54]=decodeFloat16(E[59]),U[55]=decodeFloat16(E[61]),U[56]=decodeFloat16(E[35]),U[57]=decodeFloat16(E[36]),U[58]=decodeFloat16(E[48]),U[59]=decodeFloat16(E[49]),U[60]=decodeFloat16(E[57]),U[61]=decodeFloat16(E[58]),U[62]=decodeFloat16(E[62]),U[63]=decodeFloat16(E[63]),function(e){let r=.5*Math.cos(3.14159/16),t=.5*Math.cos(3.14159/8),n=.5*Math.cos(3*3.14159/16),a=.5*Math.cos(3*3.14159/8);for(var o=[,,,,],i=[,,,,],l=[,,,,],s=[,,,,],c=0;c<8;++c){var u=8*c;o[0]=t*e[u+2],o[1]=a*e[u+2],o[2]=t*e[u+6],o[3]=a*e[u+6],i[0]=r*e[u+1]+n*e[u+3]+.2777854612564676*e[u+5]+.09754573032714427*e[u+7],i[1]=n*e[u+1]-.09754573032714427*e[u+3]-r*e[u+5]-.2777854612564676*e[u+7],i[2]=.2777854612564676*e[u+1]-r*e[u+3]+.09754573032714427*e[u+5]+n*e[u+7],i[3]=.09754573032714427*e[u+1]-.2777854612564676*e[u+3]+n*e[u+5]-r*e[u+7],l[0]=.35355362513961314*(e[u+0]+e[u+4]),l[3]=.35355362513961314*(e[u+0]-e[u+4]),l[1]=o[0]+o[3],l[2]=o[1]-o[2],s[0]=l[0]+l[1],s[1]=l[3]+l[2],s[2]=l[3]-l[2],s[3]=l[0]-l[1],e[u+0]=s[0]+i[0],e[u+1]=s[1]+i[1],e[u+2]=s[2]+i[2],e[u+3]=s[3]+i[3],e[u+4]=s[3]-i[3],e[u+5]=s[2]-i[2],e[u+6]=s[1]-i[1],e[u+7]=s[0]-i[0]}for(var f=0;f<8;++f)o[0]=t*e[16+f],o[1]=a*e[16+f],o[2]=t*e[48+f],o[3]=a*e[48+f],i[0]=r*e[8+f]+n*e[24+f]+.2777854612564676*e[40+f]+.09754573032714427*e[56+f],i[1]=n*e[8+f]-.09754573032714427*e[24+f]-r*e[40+f]-.2777854612564676*e[56+f],i[2]=.2777854612564676*e[8+f]-r*e[24+f]+.09754573032714427*e[40+f]+n*e[56+f],i[3]=.09754573032714427*e[8+f]-.2777854612564676*e[24+f]+n*e[40+f]-r*e[56+f],l[0]=.35355362513961314*(e[f]+e[32+f]),l[3]=.35355362513961314*(e[f]-e[32+f]),l[1]=o[0]+o[3],l[2]=o[1]-o[2],s[0]=l[0]+l[1],s[1]=l[3]+l[2],s[2]=l[3]-l[2],s[3]=l[0]-l[1],e[0+f]=s[0]+i[0],e[8+f]=s[1]+i[1],e[16+f]=s[2]+i[2],e[24+f]=s[3]+i[3],e[32+f]=s[3]-i[3],e[40+f]=s[2]-i[2],e[48+f]=s[1]-i[1],e[56+f]=s[0]-i[0]}(g[e]);!function(e){for(var r=0;r<64;++r){var t=e[0][r],n=e[1][r],a=e[2][r];e[0][r]=t+1.5747*a,e[1][r]=t-.1873*n-.4682*a,e[2][r]=t+1.8556*n}}(g);for(let r=0;r<3;++r)!function(e,r,t){for(var n,a=0;a<64;++a)r[t+a]=i.DataUtils.toHalfFloat((n=e[a])<=1?Math.sign(n)*Math.pow(Math.abs(n),2.2):Math.sign(n)*Math.pow(9.025013291561939,Math.abs(n)-1))}(g[r],y[r],64*e)}let o=0;for(let n=0;n<3;++n){let a=t[e.idx[n]].type;for(let e=8*r;e<8*r+S;++e){o=F[n][e];for(let r=0;r<u;++r){let t=64*r+(7&e)*8;l.setUint16(o+0*a,y[n][t+0],!0),l.setUint16(o+2*a,y[n][t+1],!0),l.setUint16(o+4*a,y[n][t+2],!0),l.setUint16(o+6*a,y[n][t+3],!0),l.setUint16(o+8*a,y[n][t+4],!0),l.setUint16(o+10*a,y[n][t+5],!0),l.setUint16(o+12*a,y[n][t+6],!0),l.setUint16(o+14*a,y[n][t+7],!0),o+=16*a}}if(u!=f)for(let e=8*r;e<8*r+S;++e){let r=F[n][e]+8*u*2*a,t=64*u+(7&e)*8;for(let e=0;e<A;++e)l.setUint16(r+2*e*a,y[n][t+e],!0)}}}for(var M=new Uint16Array(s),l=new DataView(o.buffer),C=0;C<3;++C){t[e.idx[C]].decoded=!0;var k=t[e.idx[C]].type;if(2==t[C].type)for(var I=0;I<c;++I){let e=F[C][I];for(var _=0;_<s;++_)M[_]=l.getUint16(e+2*_*k,!0);for(var _=0;_<s;++_)l.setFloat32(e+2*_*k,decodeFloat16(M[_]),!0)}}}(F,P,m,S,k,n);for(var g=0;g<m.length;++g){var b=m[g];if(!b.decoded){if(2===b.compression)for(var z=0,T=0,R=0;R<e.lines;++R){for(var O=P[g][z],L=0;L<b.width;++L){for(var B=0;B<2*b.type;++B)n[O++]=I[T+B*b.width*b.height];T++}z++}else throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(n.buffer)}function parseNullTerminatedString(e,r){for(var t=new Uint8Array(e),n=0;0!=t[r.value+n];)n+=1;var a=new TextDecoder().decode(t.slice(r.value,r.value+n));return r.value=r.value+n+1,a}function parseInt32(e,r){var t=e.getInt32(r.value,!0);return r.value=r.value+4,t}function parseUint32(e,r){var t=e.getUint32(r.value,!0);return r.value=r.value+4,t}function parseUint8Array(e,r){var t=e[r.value];return r.value=r.value+1,t}function parseUint8(e,r){var t=e.getUint8(r.value);return r.value=r.value+1,t}let parseInt64=function(e,r){let t;return t="getBigInt64"in DataView.prototype?Number(e.getBigInt64(r.value,!0)):e.getUint32(r.value+4,!0)+Number(e.getUint32(r.value,!0)<<32),r.value+=8,t};function parseFloat32(e,r){var t=e.getFloat32(r.value,!0);return r.value+=4,t}function decodeFloat32(e,r){return i.DataUtils.toHalfFloat(parseFloat32(e,r))}function decodeFloat16(e){var r=(31744&e)>>10,t=1023&e;return(e>>15?-1:1)*(r?31===r?t?NaN:1/0:Math.pow(2,r-15)*(1+t/1024):6103515625e-14*(t/1024))}function parseUint16(e,r){var t=e.getUint16(r.value,!0);return r.value+=2,t}function parseFloat16(e,r){return decodeFloat16(parseUint16(e,r))}let l=new DataView(e),s=new Uint8Array(e),c={value:0},u=function(e,r,t){let n={};if(20000630!=e.getUint32(0,!0))throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";n.version=e.getUint8(4);let a=e.getUint8(5);n.spec={singleTile:!!(2&a),longName:!!(4&a),deepFormat:!!(8&a),multiPart:!!(16&a)},t.value=8;for(var o=!0;o;){var i=parseNullTerminatedString(r,t);if(0==i)o=!1;else{var l=parseNullTerminatedString(r,t),s=parseUint32(e,t),c=function(e,r,t,n,a){var o,i,l,s,c;if("string"===n||"stringvector"===n||"iccProfile"===n)return o=new TextDecoder().decode(new Uint8Array(r).slice(t.value,t.value+a)),t.value=t.value+a,o;if("chlist"===n)return function(e,r,t,n){for(var a=t.value,o=[];t.value<a+n-1;){var i=parseNullTerminatedString(r,t),l=parseInt32(e,t),s=parseUint8(e,t);t.value+=3;var c=parseInt32(e,t),u=parseInt32(e,t);o.push({name:i,pixelType:l,pLinear:s,xSampling:c,ySampling:u})}return t.value+=1,o}(e,r,t,a);if("chromaticities"===n)return i=parseFloat32(e,t),l=parseFloat32(e,t),s=parseFloat32(e,t),c=parseFloat32(e,t),{redX:i,redY:l,greenX:s,greenY:c,blueX:parseFloat32(e,t),blueY:parseFloat32(e,t),whiteX:parseFloat32(e,t),whiteY:parseFloat32(e,t)};if("compression"===n)return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][parseUint8(e,t)];if("box2i"===n)return{xMin:parseUint32(e,t),yMin:parseUint32(e,t),xMax:parseUint32(e,t),yMax:parseUint32(e,t)};if("lineOrder"===n)return["INCREASING_Y"][parseUint8(e,t)];if("float"===n)return parseFloat32(e,t);else if("v2f"===n)return[parseFloat32(e,t),parseFloat32(e,t)];else if("v3f"===n)return[parseFloat32(e,t),parseFloat32(e,t),parseFloat32(e,t)];else if("int"===n)return parseInt32(e,t);else if("rational"===n)return[parseInt32(e,t),parseUint32(e,t)];else if("timecode"===n)return[parseUint32(e,t),parseUint32(e,t)];else return"preview"===n?(t.value+=a,"skipped"):void(t.value+=a)}(e,r,t,l,s);void 0===c?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${l}'.`):n[i]=c}}if((-5&a)!=0)throw console.error("EXRHeader:",n),"THREE.EXRLoader: provided file is currently unsupported.";return n}(l,e,c),f=function(e,r,t,n,a){let o={size:0,viewer:r,array:t,offset:n,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,[P?"colorSpace":"encoding"]:null};switch(e.compression){case"NO_COMPRESSION":o.lines=1,o.uncompress=uncompressRAW;break;case"RLE_COMPRESSION":o.lines=1,o.uncompress=uncompressRLE;break;case"ZIPS_COMPRESSION":o.lines=1,o.uncompress=uncompressZIP;break;case"ZIP_COMPRESSION":o.lines=16,o.uncompress=uncompressZIP;break;case"PIZ_COMPRESSION":o.lines=32,o.uncompress=uncompressPIZ;break;case"PXR24_COMPRESSION":o.lines=16,o.uncompress=uncompressPXR;break;case"DWAA_COMPRESSION":o.lines=32,o.uncompress=uncompressDWA;break;case"DWAB_COMPRESSION":o.lines=256,o.uncompress=uncompressDWA;break;default:throw"EXRLoader.parse: "+e.compression+" is unsupported"}if(o.scanlineBlockSize=o.lines,1==o.type)switch(a){case i.FloatType:o.getter=parseFloat16,o.inputSize=2;break;case i.HalfFloatType:o.getter=parseUint16,o.inputSize=2}else if(2==o.type)switch(a){case i.FloatType:o.getter=parseFloat32,o.inputSize=4;break;case i.HalfFloatType:o.getter=decodeFloat32,o.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+o.type+" for "+e.compression+".";o.blockCount=(e.dataWindow.yMax+1)/o.scanlineBlockSize;for(var l=0;l<o.blockCount;l++)parseInt64(r,n);o.outputChannels=3==o.channels?4:o.channels;let s=o.width*o.height*o.outputChannels;switch(a){case i.FloatType:o.byteArray=new Float32Array(s),o.channels<o.outputChannels&&o.byteArray.fill(1,0,s);break;case i.HalfFloatType:o.byteArray=new Uint16Array(s),o.channels<o.outputChannels&&o.byteArray.fill(15360,0,s);break;default:console.error("THREE.EXRLoader: unsupported type: ",a)}return o.bytesPerLine=o.width*o.inputSize*o.channels,4==o.outputChannels?o.format=i.RGBAFormat:o.format=i.RedFormat,P?o.colorSpace="srgb-linear":o.encoding=3e3,o}(u,l,s,c,this.type),d={value:0},p={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<f.height/f.scanlineBlockSize;e++){let r=parseUint32(l,c);f.size=parseUint32(l,c),f.lines=r+f.scanlineBlockSize>f.height?f.height-r:f.scanlineBlockSize;let t=f.size<f.lines*f.bytesPerLine,n=t?f.uncompress(f):uncompressRAW(f);c.value+=f.size;for(let r=0;r<f.scanlineBlockSize;r++){let t=r+e*f.scanlineBlockSize;if(t>=f.height)break;for(let e=0;e<f.channels;e++){let a=p[u.channels[e].name];for(let o=0;o<f.width;o++){d.value=(r*(f.channels*f.width)+e*f.width+o)*f.inputSize;let i=(f.height-1-t)*(f.width*f.outputChannels)+o*f.outputChannels+a;f.byteArray[i]=f.getter(n,d)}}}}return{header:u,width:f.width,height:f.height,data:f.byteArray,format:f.format,[P?"colorSpace":"encoding"]:f[P?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,r,t,n){return super.load(e,function(e,t){P?e.colorSpace=t.colorSpace:e.encoding=t.encoding,e.minFilter=i.LinearFilter,e.magFilter=i.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,r&&r(e,t)},t,n)}};let R={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},isArray=e=>Array.isArray(e);function useEnvironment({files:e=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"],path:r="",preset:t,encoding:n,extensions:a}={}){var l;let s;let c=null,u=!1;if(t){if(!(t in R))throw Error("Preset must be one of: "+Object.keys(R).join(", "));e=R[t]}if(u=isArray(e),s=isArray(e)?"cube":e.startsWith("data:application/exr")?"exr":e.startsWith("data:application/hdr")?"hdr":null==(l=e.split(".").pop())||null==(l=l.split("?"))||null==(l=l.shift())?void 0:l.toLowerCase(),!(c=u?i.CubeTextureLoader:"hdr"===s?RGBELoader:"exr"===s?EXRLoader:null))throw Error("useEnvironment: Unrecognized file extension: "+e);let f=(0,o.F)(c,u?[e]:e,e=>{null==e.setPath||e.setPath("https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/"),a&&a(e)}),d=u?f[0]:f;return d.mapping=u?i.CubeReflectionMapping:i.EquirectangularReflectionMapping,"colorSpace"in d?d.colorSpace=(null!=n?n:u)?"srgb":"srgb-linear":d.encoding=(null!=n?n:u)?3001:3e3,d}let isRef=e=>e.current&&e.current.isScene,resolveScene=e=>isRef(e)?e.current:e;function setEnvProps(e,r,t,n,a=0){let o=resolveScene(r||t),i=o.background,l=o.environment,s=o.backgroundBlurriness||0;return"only"!==e&&(o.environment=n),e&&(o.background=n),e&&void 0!==o.backgroundBlurriness&&(o.backgroundBlurriness=a),()=>{"only"!==e&&(o.environment=l),e&&(o.background=i),e&&void 0!==o.backgroundBlurriness&&(o.backgroundBlurriness=s)}}function EnvironmentMap({scene:e,background:r=!1,blur:t,map:n}){let i=(0,o.A)(e=>e.scene);return a.useLayoutEffect(()=>{if(n)return setEnvProps(r,e,i,n,t)},[i,e,n,r,t]),null}function EnvironmentCube({background:e=!1,scene:r,blur:t,...n}){let i=useEnvironment(n),l=(0,o.A)(e=>e.scene);return a.useLayoutEffect(()=>setEnvProps(e,r,l,i,t),[i,e,r,l,t]),null}function EnvironmentPortal({children:e,near:r=1,far:t=1e3,resolution:n=256,frames:l=1,map:s,background:c=!1,blur:u,scene:f,files:d,path:p,preset:v,extensions:h}){let m=(0,o.A)(e=>e.gl),g=(0,o.A)(e=>e.scene),b=a.useRef(null),[y]=a.useState(()=>new i.Scene),F=a.useMemo(()=>{let e=new i.WebGLCubeRenderTarget(n);return e.texture.type=i.HalfFloatType,e},[n]);a.useLayoutEffect(()=>(1===l&&b.current.update(m,y),setEnvProps(c,f,g,F.texture,u)),[e,y,F.texture,f,g,c,l,m]);let E=1;return(0,o.C)(()=>{(l===1/0||E<l)&&(b.current.update(m,y),E++)}),a.createElement(a.Fragment,null,(0,o.g)(a.createElement(a.Fragment,null,e,a.createElement("cubeCamera",{ref:b,args:[r,t,F]}),d||v?a.createElement(EnvironmentCube,{background:!0,files:d,preset:v,path:p,extensions:h}):s?a.createElement(EnvironmentMap,{background:!0,map:s,extensions:h}):null),y))}function EnvironmentGround(e){var r,t,i,l;let s=useEnvironment(e),c=e.map||s;a.useMemo(()=>(0,o.e)({GroundProjectedEnvImpl:GroundProjectedEnv}),[]);let u=a.useMemo(()=>[c],[c]),f=null==(r=e.ground)?void 0:r.height,d=null==(t=e.ground)?void 0:t.radius,p=null!==(i=null==(l=e.ground)?void 0:l.scale)&&void 0!==i?i:1e3;return a.createElement(a.Fragment,null,a.createElement(EnvironmentMap,(0,n.Z)({},e,{map:c})),a.createElement("groundProjectedEnvImpl",{args:u,scale:p,height:f,radius:d}))}function Environment(e){return e.ground?a.createElement(EnvironmentGround,e):e.map?a.createElement(EnvironmentMap,e):e.children?a.createElement(EnvironmentPortal,e):a.createElement(EnvironmentCube,e)}}}]);